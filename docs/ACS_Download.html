---

title: Explore and Download


keywords: fastai
sidebar: home_sidebar

summary: "In this tutorial, the basics of Colabs are introduced and an American Community Survey (ACS) dataset is downloaded."
description: "In this tutorial, the basics of Colabs are introduced and an American Community Survey (ACS) dataset is downloaded."
nb_path: "notebooks/03_ACS_Download.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: notebooks/03_ACS_Download.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This Coding Notebook is the <strong>first</strong> in a series.</p>
<p>An Interactive version can be found here <a href="https://colab.research.google.com/github/karpatic/dataplay/blob/master/notebooks/01_ACS_Explore_and_Download.ipynb" target="_parent"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"/></a>.</p>
<p>This colab and more can be found on our <a href="https://karpatic.github.io/dataplay/">webpage</a>.</p>
<ul>
<li><p>Content covered in previous tutorials will be used in later tutorials.</p>
</li>
<li><p><strong>New code and or  information <em>should</em> have explanations and or descriptions</strong> attached.</p>
</li>
<li><p>Concepts or code covered in previous tutorials will be used without being explaining in entirety.</p>
</li>
<li><p>The <a href="https://karpatic.github.io/dataplay/">Dataplay</a> Handbook development techniques covered in the <a href="https://karpatic.github.io/datalabs/">Datalabs</a> Guidebook</p>
</li>
<li><p><strong>If content can not be found in the current tutorial and is not covered in previous tutorials, please let me know.</strong></p>
</li>
<li><p>This notebook has been optimized for Google Colabs ran on a Chrome Browser.</p>
</li>
<li><p>Statements found in the index page on view expressed, responsibility, errors and ommissions, use at risk, and licensing  extend throughout the tutorial.</p>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="https://mybinder.org/v2/gh/karpatic/datalab/master?filepath=%2Fnotebooks%2Findex.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt="Binder"></a>
<a href="https://colab.research.google.com/github/karpatic/datalab/blob/master/notebooks/index.ipynb"><img src="https://pete88b.github.io/fastpages/assets/badges/colab.svg" alt="Binder"></a>
<a href="https://github.com/karpatic/datalab/tree/master/notebooks/index.ipynb"><img src="https://pete88b.github.io/fastpages/assets/badges/github.svg" alt="Binder"></a>
<a href="https://github.com/ellerbrock/open-source-badges/"><img src="https://badges.frapsoft.com/os/v3/open-source.svg?v=103" alt="Open Source Love svg3"></a></p>
<p><a href="https://github.com/karpatic/dataplay/blob/master/LICENSE"><img src="https://img.shields.io/npm/l/all-contributors.svg?style=flat" alt="NPM License"></a>
<a href="https://karpatic.github.io"><img src="http://img.shields.io/badge/Status-Active-green.svg" alt="Active"></a> 
<a href="https://pypi.python.org/pypi/dataplay/"><img src="https://img.shields.io/pypi/pyversions/dataplay.svg" alt="Python Versions"></a>
<a href=""><img src="https://img.shields.io/github/last-commit/karpatic/dataplay.svg?style=flat" alt="GitHub last commit"></a> 
<a href="http://unmaintained.tech/"><img src="http://unmaintained.tech/badge.svg" alt="No Maintenance Intended"></a></p>
<p><a href="https://github.com/karpatic/dataplay"><img src="https://img.shields.io/github/stars/karpatic/dataplay.svg?style=social&amp;label=Star" alt="GitHub stars"></a> 
<a href="https://github.com/karpatic/dataplay"><img src="https://img.shields.io/github/watchers/karpatic/dataplay.svg?style=social&amp;label=Watch" alt="GitHub watchers"></a> 
<a href="https://github.com/karpatic/dataplay"><img src="https://img.shields.io/github/forks/karpatic/dataplay.svg?style=social&amp;label=Fork" alt="GitHub forks"></a> 
<a href="https://github.com/karpatic/dataplay"><img src="https://img.shields.io/github/followers/karpatic.svg?style=social&amp;label=Follow" alt="GitHub followers"></a></p>
<p><a href="https://twitter.com/intent/tweet?text=Check%20out%20this%20%E2%9C%A8%20colab%20by%20@bniajfi%20https://github.com/karpatic/dataplay%20%F0%9F%A4%97"><img src="https://img.shields.io/twitter/url/https/github.com/karpatic/dataplay.svg?style=social" alt="Tweet"></a> 
<a href="https://twitter.com/bniajfi"><img src="https://img.shields.io/twitter/follow/bniajfi.svg?style=social" alt="Twitter Follow"></a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="About-this-Tutorial:">About this Tutorial:<a class="anchor-link" href="#About-this-Tutorial:"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Whats-inside?">Whats inside?<a class="anchor-link" href="#Whats-inside?"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="The-Tutorial"><strong>The Tutorial</strong><a class="anchor-link" href="#The-Tutorial"> </a></h4><p>In this notebook, the basics of Colabs are introduced.</p>
<ul>
<li>We will explore ACS data catalogs to locate data we like</li>
<li>We will programmatically download data from the American Community Survey (ACS)</li>
<li><ul>
<li>Examples will use ACS table B19001, Baltimore City 2017 estimates</li>
</ul>
</li>
<li>We will rework the datasets to be human friendly</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Objectives"><strong>Objectives</strong><a class="anchor-link" href="#Objectives"> </a></h4><p>By the end of this tutorial users should have an understanding of:</p>
<ul>
<li>Google Colabs</li>
<li>Census Data</li>
<li>Exploring, Retrieveing, and cleaning ACS Data programmatically</li>
<li>the 'retrieve_acs_data()' function, and how to use it in the future</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Background">Background<a class="anchor-link" href="#Background"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Using-Colabs:">Using Colabs:<a class="anchor-link" href="#Using-Colabs:"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Instructions:</strong> Read all text and execute all code in order.</p>
<p><strong>How to execute code:</strong></p>
<ul>
<li>Locate labels taking the form: '<em>Run: (A Short Description)</em>'</li>
<li>Left of this text you will see an open bracket [ ], possibly with a number inside it.</li>
<li><ul>
<li>Hovering over the brackets will reveal a play button. </li>
</ul>
</li>
<li><ul>
<li>Click the button to execute code.</li>
</ul>
</li>
<li>Alternately: Click on a box with code and hit 'Shift' + 'Enter' </li>
</ul>
<p>If you would like to see the code you are executing, double click the label 'Run: '. Code is accompanied with brief descriptions inlined.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Try It!</strong> Go ahead and try running the cell below. What you will be shown as a result is a flow chart of how this current tutorial may be used.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">html</span>
&lt;img src=&quot;https://bniajfi.org/images/mermaid/viewuserpath_short.PNG&quot;&gt;
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="About-The-Census-Data">About The Census Data<a class="anchor-link" href="#About-The-Census-Data"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Census-or-ACS-Data?">Census or ACS Data?<a class="anchor-link" href="#Census-or-ACS-Data?"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Census data comes in 2 flavors:</strong></p>
<hr>
<p>1) American Community Survey (ACS)</p>
<ul>
<li>First released to the public in 2006  </li>
<li>Derived using 5 Year Estimates (Past 5 years of data)</li>
<li>Delievered Annually</li>
<li>Delievered at Tract Level. (READ -&gt; 'Geographic Granularity')</li>
<li>Margin of error generally prohibit a more granular view </li>
<li>ACS Data is accessible programmatically  (READ -&gt; 'ACS Programmatic Retrieval')(READ -&gt; 'Geographic Reference Code')</li>
</ul>
<p>2) Decienial Census</p>
<ul>
<li>Estimates usings 10 years of ACS data</li>
<li>Decenial Census data are created, in part, by ACS data.</li>
<li>Delievered once every 10 years.</li>
<li>Delivered at Block Level. Most Accurate</li>
</ul>
<hr>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Geographic-Granularity">Geographic Granularity<a class="anchor-link" href="#Geographic-Granularity"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Census data can come in a variety of levels.</p>
<p>These levels define the specificity of the data.</p>
<p><strong>Ie.</strong> Weather a data is reporting on individual communities, or entire cities is contingent on the data granularity.</p>
<p>The data we will be downloading in this tutorial, ACS Data, can be found at the Tract level and no closer.</p>
<p>Aggregating Tracts is the way BNIA calculates some of their yearly community indicators!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Each of the bolded words in the list below are levels that are identifiable through a 'Geographic Reference Code'.</p>
<p>For more information on Geographic Reference Codes, refer to the table of contents for the section on that matter.</p>
<ul>
<li>A census block is the smallest unit of measurement used by the Census</li>
<li>Information by census <strong>block</strong> is only available decenially (i.e. not ACS data)</li>
<li><strong>Block groups</strong> are the next smallest unit of measurement used by the census and are composed of aggregate census blocks</li>
<li>Census <strong>tracts</strong> are composed of block groups and are the next largest unit of measurement used by the ACS</li>
<li><strong>County</strong>, <strong>city</strong> and census <strong>designated places</strong> are composed of Tracts</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Run the following code to see how these different levels nest into eachother!</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">html</span>
&lt;img src=&quot;https://bniajfi.org/images/mermaid/census_granularities.PNG&quot;&gt;
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Geographic-Reference-Codes">Geographic Reference Codes<a class="anchor-link" href="#Geographic-Reference-Codes"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>State, County, and Tract ID's are called Geographic Reference Codes.</p>
<p>This information is crucial to know when accessing data.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In order to successfully pull data, Census State and County Codes must be provided.</p>
<p>The code herin is configured by default to pull data on Baltimore City, MD and its constituent Tracts.</p>
<p><strong>In order to find your State and County code:</strong></p>
<hr>
<p>Either</p>
<p>A)  <a href="https://geocoding.geo.census.gov/geocoder/geographies/address">Here</a>: where upon entering a unique address you can locate state and county codes under the associated values 'Counties' and 'State'</p>
<p>OR</p>
<p>B) Conversly, click <a href="https://www.census.gov/geographies/reference-files/time-series/geo/tallies.html">here</a></p>
<ul>
<li>The Geographies mainpage contains a lot of data assets.</li>
<li>The link to these tallies was located by accessing the geographical references subdirectory of the geographies mainpage and then filtered for publications made on the year 2010 (We are using the 2010 census boundaries)</li>
<li>Once clicked, simply scroll down to where you find the header 'Tallies of Geographic Entities By State'</li>
<li>Enter your state and press enter.</li>
<li>You will be redirected to a plain text file that will contain all the information on your state and its counties. </li>
</ul>
<hr>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Working-with-the-ACS-Data">Working with the ACS Data<a class="anchor-link" href="#Working-with-the-ACS-Data"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Searching for a dataset is the first step in the data processing pipeline.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this tutorial we plan on processing ACS data in a programmatic fashion.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This tutorial will not just allow you to search/ explore ACS tables and inspect their contents (attributes), but also to download, format, and clean it!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Search-Advice">Search Advice<a class="anchor-link" href="#Search-Advice"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Despite a table explorer section being provided, it is not suggested you use this approach, but rather, explore available data tables and retrieve their ID's using the dedicated websites provided below:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="https://factfinder.census.gov/faces/nav/jsf/pages/index.xhtml">American Fact Finder</a> may assist you in your data locating and download needs:</p>
<p>Fact Finder provides a nice interface to explore available datasets. From Fact Finder you can grab a Table's ID and continue the tutorial. Alternately, from Fact Finder, You can download the data for your community directly via an interface. From there, you may continue the tutorial by loading the downloaded dataset as an external resource, instructions on how to do this are provided further below in this tutorial.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Update : 12/18/2019</strong>
" American FactFinder (AFF) will remain as an "archive" system for accessing historical data until spring 2020. " - American Fact Finder Website</p>
<p><em><a href="https://data.census.gov/cedsci/">The New American Fact Finder</a></em></p>
<p>This new website is provided by the Census Org.  Within its 'Advanced Search' feature exist all the filtering abilities of the older, depricated, (soon discontinued) American Fact Finder Website. It is still a bit buggy to date and may not apply all filters. Filters include years(can only pick on year at a time), geography(state county tract), topic, surveys and Table ID. The filters you apply are shown at the bottom of the query and submitting the search will yield data tables ready for download as well as table ID's that you may snag for use in this tutorial.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="ACS-Programmatic-Retrieval">ACS Programmatic Retrieval<a class="anchor-link" href="#ACS-Programmatic-Retrieval"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Developer-Resources">Developer Resources<a class="anchor-link" href="#Developer-Resources"> </a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Census dot gov <a href="https://www.census.gov/developers/">Developers Resource</a></li>
<li>ACS API <a href="https://www.census.gov/data/developers/data-sets.html">Datasets</a></li>
<li>Census ACS Developer Guide for the <a href="https://www.census.gov/data/developers/data-sets/acs-5year.html">5-year Datasets</a> </li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Notes-on-the-Census-API">Notes on the Census API<a class="anchor-link" href="#Notes-on-the-Census-API"> </a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Tutorial Notes:</p>
<ul>
<li>Details and Subject tables are derived using the 5 year ACS data.</li>
<li><ul>
<li>As a reminder, estimates using (ACS) 5-year estimates arrive at the tract level</li>
</ul>
</li>
<li><p>These tables are created by the census and are pre-compiled views of the data.</p>
</li>
<li>The Detail Tables contain all possible ACS Data. </li>
<li>The Subjects Table contains ACS data in convenient groups </li>
<li>BNIA create their data mostly using Details table, but sometimes pulling the data from a Subject Table is more convenient (the data would otherwise be found along multiple details tables).</li>
</ul>
<p>ACS Website Notes:</p>
<ul>
<li><p>Detailed Tables contain the most detailed cross-tabulations, many of which are published down to block groups. The data are population counts. There are over 20,000 variables in this dataset.</p>
</li>
<li><p>Subject Tables provide an overview of the estimates available in a particular topic.  The data are presented as population counts and percentages.  There are over 18,000 variables in this dataset.</p>
</li>
</ul>
<p>For more Information (via API) Please Visit This <a href="https://www.census.gov/data/developers/data-sets/acs-5year.html">Link</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Guided-Walkthrough">Guided Walkthrough<a class="anchor-link" href="#Guided-Walkthrough"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="SETUP">SETUP<a class="anchor-link" href="#SETUP"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Install these libraries onto the virtual environment.</p>

<pre><code>! pip install  -U -q ipywidgets 
! pip install geopandas</code></pre>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_colwidth&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;max_colwidth&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.expand_frame_repr&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.precision&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Once installed we need to..</span>

<span class="c1"># import and configure the Widgets</span>
<span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>
<span class="kn">from</span> <span class="nn">IPython.core.interactiveshell</span> <span class="kn">import</span> <span class="n">InteractiveShell</span>
<span class="n">InteractiveShell</span><span class="o">.</span><span class="n">ast_node_interactivity</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span>
<span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact</span><span class="p">,</span> <span class="n">interact_manual</span>

<span class="c1"># About importing data</span>
<span class="kn">import</span> <span class="nn">urllib.request</span> <span class="k">as</span> <span class="nn">urllib</span>
<span class="c1"># This Prevents Timeouts when Importing</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="n">socket</span><span class="o">.</span><span class="n">setdefaulttimeout</span><span class="p">(</span><span class="mf">10.0</span><span class="p">)</span>

<span class="c1"># Pandas Data Manipulation Libraries</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="c1"># Working with Json Data</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="c1"># Data Processing</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="c1"># Reading Json Data into Pandas</span>
<span class="kn">from</span> <span class="nn">pandas.io.json</span> <span class="kn">import</span> <span class="n">json_normalize</span>


<span class="c1"># Geo-Formatting</span>
<span class="c1"># Postgres-Conversion</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">from</span> <span class="nn">geopandas</span> <span class="kn">import</span> <span class="n">GeoDataFrame</span>
<span class="kn">import</span> <span class="nn">psycopg2</span><span class="o">,</span><span class="nn">pandas</span><span class="o">,</span><span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">shapely</span> <span class="kn">import</span> <span class="n">wkb</span>
<span class="kn">from</span> <span class="nn">shapely.wkt</span> <span class="kn">import</span> <span class="n">loads</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="c1"># In case file is KML</span>
<span class="c1"># enable KML support; disabled by default</span>
<span class="kn">import</span> <span class="nn">fiona</span>
<span class="n">fiona</span><span class="o">.</span><span class="n">drvsupport</span><span class="o">.</span><span class="n">supported_drivers</span><span class="p">[</span><span class="s1">&#39;kml&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;rw&#39;</span>
<span class="n">fiona</span><span class="o">.</span><span class="n">drvsupport</span><span class="o">.</span><span class="n">supported_drivers</span><span class="p">[</span><span class="s1">&#39;KML&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;rw&#39;</span>

<span class="c1"># load libraries</span>
<span class="c1"># from shapely.wkt import loads</span>
<span class="c1"># from pandas import ExcelWriter</span>
<span class="c1"># from pandas import ExcelFile</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">imageio</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/usr/local/lib/python3.7/dist-packages/psycopg2/__init__.py:144: UserWarning: The psycopg2 wheel package will be renamed from release 2.8; in order to keep installing from binary please use &#34;pip install psycopg2-binary&#34; instead. For details see: &lt;http://initd.org/psycopg/docs/install.html#binary-install-from-pypi&gt;.
  &#34;&#34;&#34;)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Explore-Table-Directories">Explore Table Directories<a class="anchor-link" href="#Explore-Table-Directories"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Please Note:</strong> The following section details a programmatic way to access and explore the census data catalogs. It is advised that rather than use this portion of the section of the tutorial, you read the section '<em>Searching For Data</em>' --&gt; '<em>Search Advice</em>' above and which provide links to dedicated websites hosted by the census bureaue explicitly  for your data exploration needs!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Explore-the-Detailed-Table-Directory">Explore the Detailed Table Directory<a class="anchor-link" href="#Explore-the-Detailed-Table-Directory"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Retrieve and search available ACS datasets through the ACS's table directory.</p>
<p>The table directory contains TableId's and Descriptions for each datatable the ACS provides.</p>
<p>By running the next cell, an interactive searchbox will filter the directory for keywords within the description.</p>
<p>Be sure to grab the TableId once you find a table with a description of interest.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">

<pre><code>response = urllib.urlopen('https://api.census.gov/data/2017/acs/acs5/groups/')
metaDataTable = json_normalize( json.loads(response.read())['groups'] )
metaDataTable.set_index('name', drop=True, inplace=True)
description = input("Search ACS Table Directory by Keyword: ")
metaDataTable[ metaDataTable['description'].str.contains(description.upper()) ]</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Once you a table from the explorer has been picked, you can inspect its column names in the next part.</p>
<p>This will help ensure it has the data you need!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">

<pre><code>tableId = input("Please enter a Table ID to inspect: ")
url = f'https://api.census.gov/data/2017/acs/acs5/groups/{tableId}.json'
metaDataTable = pd.read_json(url).reset_index(inplace = True, drop=False) 
metaDataTable = pd.merge(
    json_normalize(data=metaDataTable['variables']), 
    metaDataTable['index'] , left_index=True, right_index=True )
metaDataTable = metaDataTable[['index', 'concept']].dropna(subset=['concept'])</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Explore-the-Subject-Table-Directory">Explore the Subject Table Directory<a class="anchor-link" href="#Explore-the-Subject-Table-Directory"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The Data Structure we recieve is different than the prior table.</p>
<p>Intake and processing is different as a result.</p>
<p>Now lets explore what we got, just like before.</p>
<p>Only difference is that the column names are automatically included in this query.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">

<pre><code>url = 'https://api.census.gov/data/2017/acs/acs5/subject/variables.json'
data = json.loads(urllib.urlopen(url).read())['variables']
objArr = []
for key, value in data.items():
  value['name'] = key
  objArr.append(value)
metaDataTable = json_normalize(objArr).set_index('name', drop=True, inplace=True)
metaDataTable = metaDataTable[ ['attributes', 'concept', 'group', 'label', 'limit', 'predicateType' ] ]
concept = input("Search ACS Subject Table Directory by Keyword")
metaDataTable[ metaDataTable['concept'].str.contains(concept.upper(), na=False) ]</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Get-Table-Data">Get Table Data<a class="anchor-link" href="#Get-Table-Data"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Intro</strong></p>
<p>Hopefully, by now you know which datatable you would like to download!</p>
<p>The following Python function will do that for you.</p>
<ul>
<li>It can be imported and used in future projects or stand alone.</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="retrieve_acs_data" class="doc_header"><code>retrieve_acs_data</code><a href="https://github.com/bnia/VitalSigns/tree/main/VitalSigns/acsDownload.py#L37" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>retrieve_acs_data</code>(<strong><code>state</code></strong>, <strong><code>county</code></strong>, <strong><code>tract</code></strong>, <strong><code>tableId</code></strong>, <strong><code>year</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Function-Explanation">Function Explanation<a class="anchor-link" href="#Function-Explanation"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Description:</strong> This function returns ACS data given appropriate params.</p>
<p><strong>Purpose:</strong> Retrieves ACS data from the web</p>
<p><strong>Services</strong></p>
<ul>
<li>Download an ACS dataset from an Subject (S) table</li>
<li>Download an ACS dataset from a Details (B) table</li>
</ul>
<p><strong>Input:</strong></p>
<ul>
<li>state</li>
<li>county</li>
<li>tract</li>
<li>tableId</li>
<li>year</li>
<li>saveAcs</li>
</ul>
<p><strong>Output:</strong></p>
<ul>
<li>Acs Data. </li>
<li>Prints to ../../data/2_cleaned/acs/</li>
</ul>
<p><strong>How it works</strong></p>
<ul>
<li><p>Before our program retrieve the actual data, it will want the table's metadata.</p>
</li>
<li><ul>
<li>This metadata will be used as a crosswalk to replace the awkward column names</li>
</ul>
</li>
<li><ul>
<li>If this is not done, only a column ID would denote each column. not human readable.</li>
</ul>
</li>
<li><p>The Function changes the URL it requests data from depending on if it is an S or B type table the user has requested</p>
</li>
<li><p>Multiple calls for data must be made as a single table may have several hundred columns in them.</p>
</li>
<li><ul>
<li>Constructing a table requires merging the data from multiple responces </li>
</ul>
</li>
<li><p>Our program not just pulls tract level data but the aggregate for the county.</p>
</li>
<li><ul>
<li>County totals are included automatically as 'tract 010000'. </li>
</ul>
</li>
<li><ul>
<li><ul>
<li>The County total is not the sum of all other tracts but a seperate, indendent and unique query.</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li>Tract and County Datatables must be merged to form a single dataset </li>
</ul>
</li>
<li><p>Finally, we will download the data in two different formats if desired.</p>
</li>
<li><p>If we choose to save the data, we save it with the Table IDs + ColumnNames, and once without the TableIDs.</p>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Function-Diagrams">Function Diagrams<a class="anchor-link" href="#Function-Diagrams"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">html</span>
&lt;img src=&quot;https://bniajfi.org/images/mermaid/class_diagram_retrieve_acs_data.PNG&quot;&gt;
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">html</span>
&lt;img src=&quot;https://bniajfi.org/images/mermaid/flow_chart_retrieve_acs_data.PNG&quot;&gt;
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">html</span>
&lt;img src=&quot;https://bniajfi.org/images/mermaid/gannt_chart_retrieve_acs_data.PNG&quot;&gt;
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">html</span>
&lt;img src=&quot;https://bniajfi.org/images/mermaid/sequence_diagram_retrieve_acs_data.PNG&quot;&gt;
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Function-Examples">Function Examples<a class="anchor-link" href="#Function-Examples"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now use this function to Download the Data!</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Change these values in the cell below using different geographic reference codes will change those parameters</span>
<span class="n">tract</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span>
<span class="n">county</span> <span class="o">=</span> <span class="s1">&#39;153&#39;</span> <span class="c1"># &#39;059&#39; # 153 &#39;510&#39;</span>
<span class="n">state</span> <span class="o">=</span> <span class="s1">&#39;51&#39;</span>

<span class="c1"># Specify the download parameters the function will receieve here</span>
<span class="n">tableId</span> <span class="o">=</span> <span class="s1">&#39;B19049&#39;</span> <span class="c1"># &#39;B19001&#39;</span>
<span class="n">year</span> <span class="o">=</span> <span class="s1">&#39;17&#39;</span>
<span class="n">saveAcs</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">retrieve_acs_data</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">county</span><span class="p">,</span> <span class="n">tract</span><span class="p">,</span> <span class="n">tableId</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">saveAcs</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

