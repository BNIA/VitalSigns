---

title: VS BCPSS Data Intake and Operations


keywords: fastai
sidebar: home_sidebar

summary: "This notebook uses data to generate a portion of BNIA's Vital Signs report."
description: "This notebook uses data to generate a portion of BNIA's Vital Signs report."
nb_path: "notebooks/BCPSS_Schools.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: notebooks/BCPSS_Schools.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This colab and more can be found at <a href="https://github.com/BNIA/vitalsigns">https://github.com/BNIA/vitalsigns</a>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">SchoolSwitcherFlag</span>

<span class="sd"> </span>
<span class="sd">Frequency</span>
<span class="sd">Percent</span>
<span class="sd">Valid Percent</span>
<span class="sd">Cumulative Percent</span>

<span class="sd">0 = Duplicate</span>
<span class="sd">1 = ??</span>
<span class="sd">2 = School Switcher</span>
<span class="sd">3 = Grade Switcher (same school--so effectively a duplicate)</span>
<span class="sd">4 = Primary Record</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Whats-Inside?:">Whats Inside?:<a class="anchor-link" href="#Whats-Inside?:"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="The-Guided-Walkthrough"><strong>The Guided Walkthrough</strong><a class="anchor-link" href="#The-Guided-Walkthrough"> </a></h3><p>This notebook was made to create the following Vital Signs Indicators:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Indicators-Used"><strong>Indicators Used</strong><a class="anchor-link" href="#Indicators-Used"> </a></h4><ul>
<li>✅ 66 <strong>eattend</strong> - (BCPSS)</li>
<li>✅ 67 <strong>mattend</strong> - (BCPSS)</li>
<li>✅ 68 <strong>hsattend</strong> - (BCPSS)</li>
<li>✅ 70 <strong>aastud</strong> - (BCPSS)</li>
<li>✅ 71 <strong>wstud</strong> - (BCPSS)</li>
<li>✅ 72 <strong>hstud</strong> - (BCPSS)</li>
<li>✅ 73 <strong>abse</strong> - (BCPSS)</li>
<li>✅ 74 <strong>absmd</strong> - (BCPSS)</li>
<li>✅ 75 <strong>abshs</strong> - (BCPSS)</li>
<li>✅ 91 <strong>drop</strong> - (BCPSS)</li>
<li>✅ 92 <strong>compl</strong> - (BCPSS)</li>
<li>~❌ 94 <strong>sclsw</strong> - (BCPSS)</li>
<li>✅ 195 <strong>eenrol</strong> - (BCPSS)</li>
<li>✅ 196 <strong>menrol</strong> - (BCPSS)</li>
<li>✅ 197 <strong>hsenrol</strong> - (BCPSS)</li>
<li>❌ 206 <strong>pmath3</strong> - (BCPSS)</li>
<li>❌ 207 <strong>pread3</strong> - (BCPSS)</li>
<li>❌ 208 <strong>pmath5</strong> - (BCPSS)</li>
<li>❌ 209 <strong>pread5</strong> - (BCPSS)</li>
<li>❌ 210 <strong>pmath8</strong> - (BCPSS)</li>
<li>❌ 211 <strong>pread8</strong> - (BCPSS)</li>
<li>✅ 212 <strong>palg1</strong> - (BCPSS)</li>
<li>✅ 213 <strong>palg2</strong> - (BCPSS)</li>
<li>~❌ 214 <strong>kra</strong> - (BCPSS)</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Datasets-Used"><strong>Datasets Used</strong><a class="anchor-link" href="#Datasets-Used"> </a></h4><ul>
<li>✅ Schools.BCPSS_201X <strong>(66-eattend, 67-mattend -&gt;  grade )</strong></li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">year</span> <span class="o">=</span> <span class="s1">&#39;19&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Guided-Walkthrough">Guided Walkthrough<a class="anchor-link" href="#Guided-Walkthrough"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="SETUP-Enviornment:">SETUP Enviornment:<a class="anchor-link" href="#SETUP-Enviornment:"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Import-Modules">Import Modules<a class="anchor-link" href="#Import-Modules"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">capture</span>
! pip install -U -q PyDrive
! pip install geopy
! pip install geopandas
! pip install geoplot
! pip install dataplay
! pip install matplotlib
! pip install psycopg2-binary
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">capture</span>
! apt-get install build-dep python-psycopg2
! apt-get install libpq-dev
! apt-get install libspatialindex-dev
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">capture</span>
!pip install rtree
!pip install dexplot
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">dataplay.geoms</span> <span class="kn">import</span> <span class="n">workWithGeometryData</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">capture</span> 
# These imports will handle everything
import os
import sys
import csv
import matplotlib.pyplot as plt
import numpy as np
import pandas as pd
import geopandas as gpd
from geopandas import GeoDataFrame
import psycopg2
import pyproj
from pyproj import Proj, transform
# conda install -c conda-forge proj4
from shapely.geometry import Point
from shapely import wkb
from shapely.wkt import loads
# https://pypi.org/project/geopy/
from geopy.geocoders import Nominatim

# In case file is KML, enable support
import fiona
fiona.drvsupport.supported_drivers[&#39;kml&#39;] = &#39;rw&#39;
fiona.drvsupport.supported_drivers[&#39;KML&#39;] = &#39;rw&#39;
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">clear_output</span>
<span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact</span><span class="p">,</span> <span class="n">interact_manual</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Configure-Enviornment">Configure Enviornment<a class="anchor-link" href="#Configure-Enviornment"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.expand_frame_repr&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.precision&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">IPython.core.interactiveshell</span> <span class="kn">import</span> <span class="n">InteractiveShell</span>
<span class="n">InteractiveShell</span><span class="o">.</span><span class="n">ast_node_interactivity</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span>

<span class="c1"># pd.set_option(&#39;display.expand_frame_repr&#39;, False)</span>
<span class="c1"># pd.set_option(&#39;display.precision&#39;, 2)</span>
<span class="c1"># pd.reset_option(&#39;max_colwidth&#39;)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;max_colwidth&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="c1"># pd.reset_option(&#39;max_colwidth&#39;)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Prep-Datasets">Prep Datasets<a class="anchor-link" href="#Prep-Datasets"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="TPOP-CSA-and-Baltimore">TPOP CSA and Baltimore<a class="anchor-link" href="#TPOP-CSA-and-Baltimore"> </a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Get Baltimore</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse_input</span>
<span class="n">csa</span> <span class="o">=</span> <span class="s2">&quot;https://services1.arcgis.com/mVFRs7NF4iFitgbY/ArcGIS/rest/services/Tpop/FeatureServer/0/query?where=1%3D1&amp;outFields=*&amp;returnGeometry=true&amp;f=pgeojson&quot;</span>
<span class="n">csa</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">csa</span><span class="p">);</span>
<span class="n">csa</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Get CSA</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">url2</span> <span class="o">=</span> <span class="s2">&quot;https://services1.arcgis.com/mVFRs7NF4iFitgbY/ArcGIS/rest/services/Tpop/FeatureServer/1/query?where=1%3D1&amp;outFields=*&amp;returnGeometry=true&amp;f=pgeojson&quot;</span>
<span class="n">csa2</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">url2</span><span class="p">);</span>
<span class="n">csa2</span><span class="p">[</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">csa2</span><span class="p">[</span><span class="s1">&#39;City_1&#39;</span><span class="p">]</span> 
<span class="n">csa2</span><span class="p">[</span><span class="s1">&#39;OBJECTID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">56</span> 
<span class="n">csa2</span> <span class="o">=</span> <span class="n">csa2</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;City_1&#39;</span><span class="p">])</span>
<span class="n">csa2</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Append do no append Bcity. We put it on the Bottom of the df because when performing the ponp it returns only the last matching columns CSA Label.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">csa</span> <span class="o">=</span> <span class="n">csa</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">csa2</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">csa</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">csa</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">csa</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Shape__Area&#39;</span><span class="p">,</span> <span class="s1">&#39;Shape__Length&#39;</span><span class="p">,</span> <span class="s1">&#39;OBJECTID&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="s2">&quot;BCity_and_CSA.geojson&quot;</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s1">&#39;GeoJSON&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">csa</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="BCPSS">BCPSS<a class="anchor-link" href="#BCPSS"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">geopandas</span> 
<span class="c1"># original = gpd.read_file(&quot;BCPSS_20&quot;+year+&quot;_CSACity.shp&quot;, geometry=&#39;geometry&#39;);</span>
<span class="n">original</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;BCPSS_20&quot;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s2">&quot;_CSACity_dbf_to_csv.csv&quot;</span><span class="p">);</span>
<span class="n">original</span><span class="o">.</span><span class="n">columns</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">original</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">original</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span> <span class="s1">&#39;csa&#39;</span><span class="p">:</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">,</span> <span class="s1">&#39;BaltCity&#39;</span><span class="p">:</span><span class="s1">&#39;InBaltimore&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">original</span><span class="p">[</span> <span class="n">original</span><span class="p">[</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span> <span class="o">|</span> <span class="n">original</span><span class="p">[</span><span class="s1">&#39;InBaltimore&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>  <span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;After filtering records where a CSA or Baltimore geo-code match Exists&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;All rows Before Filter: &#39;</span><span class="p">,</span> <span class="n">original</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span> <span class="c1"># rows, columns</span>
<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;# w BCity.isnull: &#39;</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">InBaltimore</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="p">);</span> <span class="n">bmorow</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span> <span class="n">df</span><span class="o">.</span><span class="n">CSA2010</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>  <span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;# w CSA2010.isnull: &#39;</span><span class="p">,</span> <span class="n">bmorow</span> <span class="p">);</span> <span class="n">csarow</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span> <span class="n">df</span><span class="o">.</span><span class="n">CSA2010</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>  <span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> 
<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;# w CSA2010.notnull: &#39;</span><span class="p">,</span> <span class="n">csarow</span> <span class="p">);</span> 
<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;# rows After Filter: &#39;</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;==&#39;</span><span class="p">,</span><span class="n">csarow</span><span class="p">,</span><span class="s1">&#39;+&#39;</span><span class="p">,</span><span class="n">bmorow</span><span class="p">,</span><span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="n">csarow</span> <span class="o">+</span> <span class="n">bmorow</span><span class="p">);</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">][</span><span class="s1">&#39;InBaltimore&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39; &#39;</span><span class="p">]</span> <span class="c1">#[&#39;InBaltimore&#39;] # .unique()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">CSA2010</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">CSA2010</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;Baltimore City&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bcpssTemp</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">bcpssTemp</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">bcpssTemp</span> <span class="o">=</span> <span class="n">bcpssTemp</span><span class="p">[[</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">,</span><span class="s1">&#39;SchoolSwitcherFlag&#39;</span><span class="p">,</span> <span class="s1">&#39;EnrollmentFlag&#39;</span><span class="p">,</span> <span class="s1">&#39;daysattend&#39;</span><span class="p">,</span> <span class="s1">&#39;daysabsent&#39;</span><span class="p">,</span> <span class="s1">&#39;grade&#39;</span><span class="p">,</span> <span class="s1">&#39;wleavecode&#39;</span><span class="p">,</span> <span class="s1">&#39;hispani_la&#39;</span><span class="p">,</span> <span class="s1">&#39;race_AIAN&#39;</span><span class="p">,</span> <span class="s1">&#39;race_asian&#39;</span><span class="p">,</span> <span class="s1">&#39;race_AA&#39;</span><span class="p">,</span> <span class="s1">&#39;race_NHPI&#39;</span><span class="p">,</span> <span class="s1">&#39;race_white&#39;</span><span class="p">,</span> <span class="s1">&#39;std_number&#39;</span><span class="p">,</span> <span class="s1">&#39;enterdate&#39;</span><span class="p">]]</span>
<span class="n">bcpssTemp</span><span class="p">[</span><span class="s1">&#39;grade&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">bcpssTemp</span><span class="p">[</span><span class="s1">&#39;grade&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">bcpssTemp</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bcpssTemp</span><span class="p">[</span><span class="n">bcpssTemp</span><span class="p">[</span><span class="s1">&#39;SchoolSwitcherFlag&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># 0 = Duplicate</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bcpssTemp</span><span class="p">[</span><span class="n">bcpssTemp</span><span class="p">[</span><span class="s1">&#39;SchoolSwitcherFlag&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bcpssTemp</span><span class="p">[</span><span class="n">bcpssTemp</span><span class="p">[</span><span class="s1">&#39;SchoolSwitcherFlag&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bcpssTemp</span><span class="p">[</span><span class="n">bcpssTemp</span><span class="p">[</span><span class="s1">&#39;SchoolSwitcherFlag&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bcpssTemp</span><span class="p">[</span><span class="n">bcpssTemp</span><span class="p">[</span><span class="s1">&#39;SchoolSwitcherFlag&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>School switcher records 0 1 3 and 4 all together make a difference here because we do not dedup on enterdate for each student like we do on the other queries.</p>
<p>We want to know if students come in and out of enrollment multiple times</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Create the School Switchers Dataset</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">schoolSwitchersDF</span> <span class="o">=</span> <span class="n">bcpssTemp</span><span class="p">[</span><span class="n">bcpssTemp</span><span class="p">[</span><span class="s1">&#39;SchoolSwitcherFlag&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">]</span> <span class="c1"># 2 = School Switcher</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Create the Enrollment Dataset</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">enrollment</span> <span class="o">=</span> <span class="n">bcpssTemp</span><span class="p">[</span> <span class="p">(</span><span class="n">bcpssTemp</span><span class="p">[</span><span class="s1">&#39;EnrollmentFlag&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span> <span class="o">&amp;</span> 
                  <span class="p">(</span> <span class="p">(</span><span class="n">bcpssTemp</span><span class="p">[</span><span class="s1">&#39;SchoolSwitcherFlag&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">bcpssTemp</span><span class="p">[</span><span class="s1">&#39;SchoolSwitcherFlag&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="o">|</span> 
                    <span class="p">(</span><span class="n">bcpssTemp</span><span class="p">[</span><span class="s1">&#39;SchoolSwitcherFlag&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">bcpssTemp</span><span class="p">[</span><span class="s1">&#39;SchoolSwitcherFlag&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> 
                  <span class="p">)</span> 
                <span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bcpss</span> <span class="o">=</span> <span class="n">bcpssTemp</span><span class="p">[</span> <span class="p">(</span> <span class="p">(</span><span class="n">bcpssTemp</span><span class="p">[</span><span class="s1">&#39;SchoolSwitcherFlag&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">bcpssTemp</span><span class="p">[</span><span class="s1">&#39;SchoolSwitcherFlag&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="o">|</span> 
                    <span class="p">(</span><span class="n">bcpssTemp</span><span class="p">[</span><span class="s1">&#39;SchoolSwitcherFlag&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">bcpssTemp</span><span class="p">[</span><span class="s1">&#39;SchoolSwitcherFlag&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> 
                  <span class="p">)</span> <span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">schoolSwitchersDF</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">enrollment</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bcpss</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Indicators:">Indicators:<a class="anchor-link" href="#Indicators:"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="66-eattend---G---No-Drop-Dupes">66 eattend - G - No Drop Dupes<a class="anchor-link" href="#66-eattend---G---No-Drop-Dupes"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Who was in the classroom at any point in the year</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lbl</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; BCPSS - Education and Youth - Number of Students Ever Attended 1st - 5th Grade &quot;&quot;&quot;</span>

<span class="n">query16</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with tbl AS (</span>
<span class="s2">     select (sum(</span>
<span class="s2">  case </span>
<span class="s2">  when (daysattend &gt; 1) AND (grade = &#39;1&#39; OR grade = &#39;2&#39; OR grade = &#39;3&#39; OR grade = &#39;4&#39; OR grade = &#39;5&#39;)</span>
<span class="s2">  then 1</span>
<span class="s2">  else 0</span>
<span class="s2">  end)::numeric </span>
<span class="s2"> ) as result, csa</span>
<span class="s2"> from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2"> left join schools.afile_2016 b on a.gid = b.gid</span>
<span class="s2"> group by csa</span>
<span class="s2">     )</span>
<span class="s2">     update vital_signs.data</span>
<span class="s2">     set eattend = result from tbl where data.csa = tbl.csa and data_year = &#39;2016&#39;;</span>
<span class="s2">  &quot;&quot;&quot;</span>

<span class="n">OLD17Query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with tbl AS (</span>
<span class="s2">     select (sum(</span>
<span class="s2">  case </span>
<span class="s2">  when (daysattend &gt; 1) AND (grade = &#39;1&#39; OR grade = &#39;2&#39; OR grade = &#39;3&#39; OR grade = &#39;4&#39; OR grade = &#39;5&#39;)</span>
<span class="s2">  then 1</span>
<span class="s2">  else 0</span>
<span class="s2">  end)::numeric </span>
<span class="s2"> ) as result, csa</span>
<span class="s2"> from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2"> left join schools.afile_1617 b on a.gid = b.gid</span>
<span class="s2"> group by csa</span>
<span class="s2">     )</span>
<span class="s2">  select * from tbl where 1 = 1 ORDER BY csa ASC;</span>
<span class="s2"> &quot;&quot;&quot;</span>

<span class="n">NEW17Query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with tbl AS (</span>
<span class="s2">  -- What we want</span>
<span class="s2">  select count(*) as result, csa</span>
<span class="s2">  -- CSA</span>
<span class="s2">    from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">      left join schools.afile_1617 b on a.gid = b.gid</span>
<span class="s2">  -- RESULT</span>
<span class="s2">  where daysattend &gt; 1 AND grade in (&#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;) AND (std_number, enterdate) in </span>
<span class="s2">    ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )</span>
<span class="s2">      group by csa</span>
<span class="s2">  )</span>
<span class="s2">  select * from tbl where 1 = 1 ORDER BY csa ASC;</span>
<span class="s2">  &quot;&quot;&quot;</span>

<span class="n">simplifiedQuery</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">  daysattend &gt; 1 AND </span>
<span class="s2">  grade in (&#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;) AND </span>
<span class="s2">  (std_number, enterdate) in ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )</span>
<span class="s2">  &quot;&quot;&quot;</span>

<span class="c1"># The way the script goes, for every record it will it will take the entire dataset perform a group on it using std_number, </span>
<span class="c1"># then return  on std and max(enterdate) for each std_number and compare each and every to the current record&#39;s std_num and and enterdate.</span>
<span class="c1"># If any is a match, this one part of the filter succedes for the current record. And then in does this for the next record. </span>
<span class="n">hard</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;(std_number, enterdate) in ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )&quot;&quot;&quot;</span>
<span class="c1"># A simpler way would be to sort by enterdate and then remove duplicates on std_number leaving only the most recent enterdate for each unique std_num. </span>
<span class="n">easy</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;df.sort_values(&#39;enterdate&#39;, ascending=False).drop_duplicates([&#39;std_number&#39;])&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="eattend" class="doc_header"><code>eattend</code><a href="https://github.com/bnia/VitalSigns/tree/main/VitalSigns/BCPSS.py#L7" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>eattend</code>(<strong><code>df</code></strong>, <strong><code>csa</code></strong>, <strong><code>yr</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fin</span> <span class="o">=</span> <span class="n">eattend</span><span class="p">(</span><span class="n">bcpss</span><span class="p">,</span> <span class="n">csa</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;66-eattend&#39;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="67-mattend---G---No-Drop-Dupes">67 mattend - G - No Drop Dupes<a class="anchor-link" href="#67-mattend---G---No-Drop-Dupes"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lbl</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;BCPSS - Education and Youth - Number of Students Ever Attended 6th - 8th Grade &quot;&quot;&quot;</span>

<span class="n">query16</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with tbl AS (</span>
<span class="s2">      select (sum(</span>
<span class="s2">    case </span>
<span class="s2">    when (daysattend &gt; 1) AND ( grade =6 OR  grade = 7 OR  grade = 8)</span>
<span class="s2">    then 1</span>
<span class="s2">    else 0</span>
<span class="s2">    end)::numeric </span>
<span class="s2">  ) as result, csa</span>
<span class="s2">  from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">  left join schools.afile_2016 b on a.gid = b.gid</span>
<span class="s2">  group by csa</span>
<span class="s2">      )</span>
<span class="s2">      update vital_signs.data</span>
<span class="s2">      set mattend = result from tbl where data.csa = tbl.csa and data_year = &#39;2016&#39;;</span>
<span class="s2">  &quot;&quot;&quot;</span>

<span class="n">OLD17Query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; with tbl AS (</span>
<span class="s2">      select (sum(</span>
<span class="s2">    case </span>
<span class="s2">    when (daysattend &gt; 1) AND (grade = &#39;6&#39; OR grade = &#39;7&#39; OR grade = &#39;8&#39;)</span>
<span class="s2">    then 1</span>
<span class="s2">    else 0</span>
<span class="s2">    end)::numeric </span>
<span class="s2">  ) as result, csa</span>
<span class="s2">  from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">  left join schools.afile_1617 b on a.gid = b.gid</span>
<span class="s2">  group by csa</span>
<span class="s2">      )</span>
<span class="s2">  select * from tbl where 1 = 1 ORDER BY csa ASC;</span>
<span class="s2">  &quot;&quot;&quot;</span>

<span class="n">NEW17Query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; select count(*) as result, csa</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">        left join schools.afile_1617 b on a.gid = b.gid</span>
<span class="s2">    where daysattend &gt; 1 AND grade in (&#39;6&#39;, &#39;7&#39;, &#39;8&#39;) AND (std_number, enterdate) in </span>
<span class="s2">      ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )</span>
<span class="s2">        group by csa ORDER BY csa ASC;</span>
<span class="s2">  &quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="mattend" class="doc_header"><code>mattend</code><a href="https://github.com/bnia/VitalSigns/tree/main/VitalSigns/BCPSS.py#L36" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>mattend</code>(<strong><code>df</code></strong>, <strong><code>csa</code></strong>, <strong><code>yr</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fin</span> <span class="o">=</span> <span class="n">mattend</span><span class="p">(</span><span class="n">bcpss</span><span class="p">,</span> <span class="n">csa</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;67-mattend&#39;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="68-hsattend---G---No-Drop-Dupes">68 hsattend - G - No Drop Dupes<a class="anchor-link" href="#68-hsattend---G---No-Drop-Dupes"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="sd">&quot;&quot;&quot;  daysattend &gt; 1 AND grade in (&#39;9&#39;, &#39;10&#39;, &#39;11&#39;, &#39;12&#39;) AND (std_number, enterdate) in ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="hsattend" class="doc_header"><code>hsattend</code><a href="https://github.com/bnia/VitalSigns/tree/main/VitalSigns/BCPSS.py#L66" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>hsattend</code>(<strong><code>df</code></strong>, <strong><code>csa</code></strong>, <strong><code>yr</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fin</span> <span class="o">=</span> <span class="n">hsattend</span><span class="p">(</span><span class="n">bcpss</span><span class="p">,</span> <span class="n">csa</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;68-hsattend&#39;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="70-aastud---G--No-Drop-Dupes">70 aastud - G- No Drop Dupes<a class="anchor-link" href="#70-aastud---G--No-Drop-Dupes"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lbl</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; BCPSS - Education and Youth  - Percent of Students that are African American (non-Hispanic)&quot;&quot;&quot;</span>

<span class="n">query2016</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with numerator as (</span>
<span class="s2">   select sum(</span>
<span class="s2">   case </span>
<span class="s2">   when (daysattend::numeric &gt; 1) AND </span>
<span class="s2">     (future_rac::text =&#39;300&#39; OR future_rac::text =&#39;305&#39; OR future_rac::text =&#39;340&#39; OR future_rac::text =&#39;345&#39;) AND</span>
<span class="s2">     (hipani_lat LIKE &#39;N&#39;) AND </span>
<span class="s2">     (grade::numeric &lt;13 )</span>
<span class="s2">   then 1</span>
<span class="s2">   else 0</span>
<span class="s2">   end)::numeric as result, csa</span>
<span class="s2">   from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">   left join schools.afile_2016 b on a.gid = b.gid</span>
<span class="s2">   group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   denominator AS (</span>
<span class="s2">    select (sum(</span>
<span class="s2">     case </span>
<span class="s2">     when (daysattend::numeric &gt; 1) AND (grade::numeric &lt;13 )</span>
<span class="s2">     then 1</span>
<span class="s2">     else 0</span>
<span class="s2">     end)::numeric </span>
<span class="s2">    ) as result, csa</span>
<span class="s2">    from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">    left join schools.afile_2016 b on a.gid = b.gid</span>
<span class="s2">    group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   tbl AS (</span>
<span class="s2">     select denominator.csa,(numerator.result / denominator.result)*(100::numeric) as result </span>
<span class="s2">     from numerator left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">    )</span>
<span class="s2">   update vital_signs.data</span>
<span class="s2">   set aastud = result from tbl where data.csa = tbl.csa and data_year = &#39;2016&#39;;</span>
<span class="s2">  &quot;&quot;&quot;</span>

<span class="n">OLD17Query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with numerator as (</span>
<span class="s2">    select sum(</span>
<span class="s2">    case </span>
<span class="s2">    when (daysattend::numeric &gt; 1) AND (future_rac = 300 OR future_rac = 305 OR future_rac = 340 OR future_rac = 345) AND (hispani_la LIKE &#39;N&#39;) AND (grade &lt;13 ) </span>
<span class="s2">      then 1 else 0 end</span>
<span class="s2">    )::numeric as result, csa</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">        left join schools.afile_1617 b on a.gid = b.gid</span>
<span class="s2">          group by csa</span>
<span class="s2">  ),</span>
<span class="s2">  denominator AS (</span>
<span class="s2">    select (sum(</span>
<span class="s2">      case </span>
<span class="s2">        when (daysattend &gt; 1) AND (grade &lt;13 )</span>
<span class="s2">          then 1 else 0 end</span>
<span class="s2">    )::numeric ) as result, csa</span>
<span class="s2">        from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">          left join schools.afile_1617 b on a.gid = b.gid</span>
<span class="s2">            group by csa</span>
<span class="s2">  ),</span>
<span class="s2">  tbl AS (</span>
<span class="s2">      select denominator.csa,(numerator.result / NULLIF(denominator.result, 0) )*(100::numeric) as result </span>
<span class="s2">      from numerator left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">      )</span>
<span class="s2">  select * from tbl where 1 = 1 ORDER BY csa ASC;</span>
<span class="s2">    &quot;&quot;&quot;</span>

<span class="n">New17Query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with numerator as (</span>
<span class="s2">   select count(*)::numeric as result, csa</span>
<span class="s2">     from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">       left join schools.afile_1617 b on a.gid = b.gid</span>
<span class="s2">   where daysattend &gt; 1 AND future_rac in (&#39;300&#39;, &#39;305&#39;, &#39;340&#39;, &#39;345&#39;) AND (hispani_la LIKE &#39;N&#39;) AND (grade &lt;13 ) AND (std_number, enterdate) in </span>
<span class="s2">     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )</span>
<span class="s2">   group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   denominator AS (</span>
<span class="s2">   select count(*)::numeric as result, csa</span>
<span class="s2">     from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">       left join schools.afile_1617 b on a.gid = b.gid</span>
<span class="s2">   where daysattend &gt; 1 AND grade &lt;13 AND (std_number, enterdate) in </span>
<span class="s2">     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )</span>
<span class="s2">   group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   tbl AS (</span>
<span class="s2">     select denominator.csa,(numerator.result / NULLIF(denominator.result,0) )*(100::numeric) as result </span>
<span class="s2">     from numerator left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">    )</span>
<span class="s2">  select * from tbl where 1 = 1 ORDER BY csa ASC;</span>
<span class="s2">  &quot;&quot;&quot;</span>

<span class="n">miscNotes</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;afile_1617</span>
<span class="s2">  17 hispani_la</span>
<span class="s2">  16 hispani_lat</span>
<span class="s2">  NULLIF(denominator.result,0)</span>
<span class="s2">  &quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   where daysattend &gt; 1 AND future_rac in (&#39;300&#39;, &#39;305&#39;, &#39;340&#39;, &#39;345&#39;) AND (hispani_la LIKE &#39;N&#39;) AND (grade &lt;13 ) AND (std_number, enterdate) in </span>
<span class="sd">     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )</span>

<span class="sd">     /</span>

<span class="sd">   where daysattend &gt; 1 AND grade &lt;13 AND (std_number, enterdate) in </span>
<span class="sd">     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="aastud" class="doc_header"><code>aastud</code><a href="https://github.com/bnia/VitalSigns/tree/main/VitalSigns/BCPSS.py#L98" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>aastud</code>(<strong><code>df</code></strong>, <strong><code>csa</code></strong>, <strong><code>yr</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fin</span> <span class="o">=</span> <span class="n">aastud</span><span class="p">(</span><span class="n">bcpss</span><span class="p">,</span> <span class="n">csa</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;70-aastud&#39;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="71-wstud---G---No-Drop-Dupes">71 wstud - G - No Drop Dupes<a class="anchor-link" href="#71-wstud---G---No-Drop-Dupes"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lbl</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;BCPSS - Education and Youth - Percent of Students that are White (non-Hispanic)&quot;&quot;&quot;</span>

<span class="n">Query16</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with numerator as (</span>
<span class="s2">   select sum(</span>
<span class="s2">   case </span>
<span class="s2">   when (daysattend::numeric &gt; 1) AND (future_rac::text =&#39;5&#39;) AND (hipani_lat LIKE &#39;N&#39;) AND (grade::numeric &lt;13 )</span>
<span class="s2">   then 1</span>
<span class="s2">   else 0</span>
<span class="s2">   end)::numeric as result, csa</span>
<span class="s2">   from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">   left join schools.afile_2016 b on a.gid = b.gid</span>
<span class="s2">   group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   denominator AS (</span>
<span class="s2">    select (sum(</span>
<span class="s2">     case </span>
<span class="s2">     when (daysattend::numeric &gt; 1) AND (grade::numeric &lt;13 )</span>
<span class="s2">     then 1</span>
<span class="s2">     else 0</span>
<span class="s2">     end)::numeric </span>
<span class="s2">    ) as result, csa</span>
<span class="s2">    from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">    left join schools.afile_2016 b on a.gid = b.gid</span>
<span class="s2">    group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   tbl AS (</span>
<span class="s2">     select denominator.csa,(numerator.result / denominator.result)*(100::numeric) as result </span>
<span class="s2">     from numerator left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">    )</span>
<span class="s2">   update vital_signs.data</span>
<span class="s2">   set wstud = result from tbl where data.csa = tbl.csa and data_year = &#39;2016&#39;;</span>
<span class="s2"> &quot;&quot;&quot;</span>

<span class="n">OLD17Query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with numerator as (</span>
<span class="s2">   select sum(</span>
<span class="s2">   case </span>
<span class="s2">   when (daysattend::numeric &gt; 1) AND (future_rac::text =&#39;5&#39;) AND (hispani_la LIKE &#39;N&#39;) AND (grade::numeric &lt;13 )</span>
<span class="s2">   then 1</span>
<span class="s2">   else 0</span>
<span class="s2">   end)::numeric as result, csa</span>
<span class="s2">   from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">   left join schools.afile_1617 b on a.gid = b.gid</span>
<span class="s2">   group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   denominator AS (</span>
<span class="s2">    select (sum(</span>
<span class="s2">     case </span>
<span class="s2">     when (daysattend::numeric &gt; 1) AND (grade::numeric &lt;13 )</span>
<span class="s2">     then 1</span>
<span class="s2">     else 0</span>
<span class="s2">     end)::numeric </span>
<span class="s2">    ) as result, csa</span>
<span class="s2">    from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">    left join schools.afile_1617 b on a.gid = b.gid</span>
<span class="s2">    group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   tbl AS (</span>
<span class="s2">     select denominator.csa,(numerator.result / NULLIF(denominator.result,0) )*(100::numeric) as result </span>
<span class="s2">     from numerator left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">    )</span>
<span class="s2"> select * from tbl where 1 = 1 ORDER BY csa ASC;</span>
<span class="s2"> &quot;&quot;&quot;</span>

<span class="n">NEW17Query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with numerator as (</span>
<span class="s2">   select count(*)::numeric as result, csa</span>
<span class="s2">     from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">       left join schools.afile_1617 b on a.gid = b.gid</span>
<span class="s2">   where daysattend &gt; 1 AND future_rac =&#39;5&#39; AND hispani_la LIKE &#39;N&#39; AND grade &lt;13 AND (std_number, enterdate) in </span>
<span class="s2">     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )</span>
<span class="s2">   group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   denominator AS (</span>
<span class="s2">   select count(*)::numeric as result, csa</span>
<span class="s2">     from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">       left join schools.afile_1617 b on a.gid = b.gid</span>
<span class="s2">   where daysattend &gt; 1 AND grade &lt;13 AND (std_number, enterdate) in </span>
<span class="s2">     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )</span>
<span class="s2">   group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   tbl AS (</span>
<span class="s2">     select denominator.csa,(numerator.result / NULLIF(denominator.result,0) )*(100::numeric) as result </span>
<span class="s2">     from numerator left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">    )</span>
<span class="s2"> select * from tbl where 1 = 1 ORDER BY csa ASC;</span>
<span class="s2"> &quot;&quot;&quot;</span>

<span class="n">misc</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">  afile_1617</span>
<span class="s2">  17 hispani_la</span>
<span class="s2">  16 hispani_lat</span>
<span class="s2">  NULLIF(denominator.result,0)</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   where daysattend &gt; 1 AND future_rac =&#39;5&#39; AND hispani_la LIKE &#39;N&#39; AND grade &lt;13 AND (std_number, enterdate) in </span>
<span class="sd">     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )</span>
<span class="sd">     /</span>
<span class="sd">   where daysattend &gt; 1 AND grade &lt;13 AND (std_number, enterdate) in </span>
<span class="sd">     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="wstud" class="doc_header"><code>wstud</code><a href="https://github.com/bnia/VitalSigns/tree/main/VitalSigns/BCPSS.py#L143" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>wstud</code>(<strong><code>df</code></strong>, <strong><code>csa</code></strong>, <strong><code>yr</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fin</span> <span class="o">=</span> <span class="n">wstud</span><span class="p">(</span><span class="n">bcpss</span><span class="p">,</span> <span class="n">csa</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;71-wstud&#39;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="72-hstud---G---No-Drop-Dupes">72 hstud - G - No Drop Dupes<a class="anchor-link" href="#72-hstud---G---No-Drop-Dupes"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lbl</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; BCPSS - Education and Youth &quot;&quot;&quot;</span>

<span class="n">Query16</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; with numerator as (</span>
<span class="s2">   select sum(</span>
<span class="s2">   case </span>
<span class="s2">   when (daysattend::numeric &gt; 1) AND (hipani_lat LIKE &#39;Y&#39;) AND (grade::numeric &lt;13 )</span>
<span class="s2">   then 1</span>
<span class="s2">   else 0</span>
<span class="s2">   end)::numeric as result, csa</span>
<span class="s2">   from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">   left join schools.afile_2016 b on a.gid = b.gid</span>
<span class="s2">   group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   denominator AS (</span>
<span class="s2">    select (sum(</span>
<span class="s2">     case </span>
<span class="s2">     when (daysattend::numeric &gt; 1) AND (grade::numeric &lt;13 )</span>
<span class="s2">     then 1</span>
<span class="s2">     else 0</span>
<span class="s2">     end)::numeric </span>
<span class="s2">    ) as result, csa</span>
<span class="s2">    from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">    left join schools.afile_2016 b on a.gid = b.gid</span>
<span class="s2">    group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   tbl AS (</span>
<span class="s2">     select denominator.csa,(numerator.result / denominator.result)*(100::numeric) as result </span>
<span class="s2">     from numerator left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">    )</span>
<span class="s2">   update vital_signs.data</span>
<span class="s2">   set hstud = result from tbl where data.csa = tbl.csa and data_year = &#39;2016&#39;; </span>
<span class="s2">  &quot;&quot;&quot;</span>

<span class="n">NEW17Query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with numerator as (</span>
<span class="s2">   select count(*)::numeric as result, csa</span>
<span class="s2">     from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">       left join schools.afile_1617 b on a.gid = b.gid</span>
<span class="s2">   where daysattend &gt; 1 AND hispani_la LIKE &#39;Y&#39; AND grade &lt;13 AND (std_number, enterdate) in </span>
<span class="s2">     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )</span>
<span class="s2">   group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   denominator AS (</span>
<span class="s2">   select count(*)::numeric as result, csa</span>
<span class="s2">     from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">       left join schools.afile_1617 b on a.gid = b.gid</span>
<span class="s2">   where daysattend &gt; 1 AND grade &lt;13 AND (std_number, enterdate) in </span>
<span class="s2">     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )</span>
<span class="s2">   group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   tbl AS (</span>
<span class="s2">     select denominator.csa,(numerator.result / NULLIF(denominator.result,0) )*(100::numeric) as result </span>
<span class="s2">     from numerator left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">    )</span>
<span class="s2">  select * from tbl where 1 = 1 ORDER BY csa ASC;</span>
<span class="s2">  &quot;&quot;&quot;</span>

<span class="n">OLD17Query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with numerator as (</span>
<span class="s2">   select sum(</span>
<span class="s2">   case </span>
<span class="s2">   when (daysattend::numeric &gt; 1) AND (hispani_la LIKE &#39;Y&#39;) AND (grade::numeric &lt;13 )</span>
<span class="s2">   then 1</span>
<span class="s2">   else 0</span>
<span class="s2">   end)::numeric as result, csa</span>
<span class="s2">   from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">   left join schools.afile_1617 b on a.gid = b.gid</span>
<span class="s2">   group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   denominator AS (</span>
<span class="s2">    select (sum(</span>
<span class="s2">     case </span>
<span class="s2">     when (daysattend::numeric &gt; 1) AND (grade::numeric &lt;13 )</span>
<span class="s2">     then 1</span>
<span class="s2">     else NULL</span>
<span class="s2">     end)::numeric </span>
<span class="s2">    ) as result, csa</span>
<span class="s2">    from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">    left join schools.afile_1617 b on a.gid = b.gid</span>
<span class="s2">    group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   tbl AS (</span>
<span class="s2">     select denominator.csa,(numerator.result / NULLIF(denominator.result,0) )*(100::numeric) as result </span>
<span class="s2">     from numerator left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">    )</span>
<span class="s2">  select * from tbl order by csa asc</span>
<span class="s2">  &quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   where daysattend &gt; 1 AND hispani_la LIKE &#39;Y&#39; AND grade &lt;13 AND (std_number, enterdate) in </span>
<span class="sd">     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )</span>
<span class="sd">     /</span>
<span class="sd">   where daysattend &gt; 1 AND grade &lt;13 AND (std_number, enterdate) in </span>
<span class="sd">     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">denom</span> <span class="o">=</span> <span class="n">bcpss</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">denom</span><span class="p">[</span><span class="s1">&#39;grade&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">denom</span><span class="p">[</span><span class="s1">&#39;grade&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">denom</span> <span class="o">=</span> <span class="n">denom</span><span class="p">[</span> <span class="p">(</span><span class="n">denom</span><span class="p">[</span><span class="s1">&#39;daysattend&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">denom</span><span class="p">[</span><span class="s1">&#39;grade&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">13</span><span class="p">)</span> <span class="p">]</span> 
<span class="n">denom</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">numer</span> <span class="o">=</span> <span class="n">denom</span> <span class="o">=</span> <span class="n">denom</span><span class="p">[</span> <span class="p">(</span><span class="n">denom</span><span class="p">[</span><span class="s1">&#39;hispani_la&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">)</span> <span class="p">]</span> 
<span class="n">numer</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bcpss</span><span class="p">[</span> <span class="p">(</span><span class="n">bcpss</span><span class="p">[</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Allendale/Irvington/S. Hilton&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">bcpss</span><span class="p">[</span><span class="s1">&#39;hispani_la&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">)</span> <span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="hstud" class="doc_header"><code>hstud</code><a href="https://github.com/bnia/VitalSigns/tree/main/VitalSigns/BCPSS.py#L190" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>hstud</code>(<strong><code>df</code></strong>, <strong><code>csa</code></strong>, <strong><code>yr</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fin</span> <span class="o">=</span> <span class="n">hstud</span><span class="p">(</span><span class="n">bcpss</span><span class="p">,</span> <span class="n">csa</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;72-hstud&#39;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="73-abse---G---No-Drop-Dupes">73 abse - G - No Drop Dupes<a class="anchor-link" href="#73-abse---G---No-Drop-Dupes"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lbl</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; BCPSS - Education and Youth - Percent of 1st-5th Grade Students that are Chronically Absent (Missing at least 20 days) &quot;&quot;&quot;</span>

<span class="n">Query16</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with numerator as (</span>
<span class="s2">   select sum(</span>
<span class="s2">   case </span>
<span class="s2">   when (daysattend &gt; 1) AND (grade = &#39;1&#39; OR grade = &#39;2&#39; OR grade = &#39;3&#39; OR grade = &#39;4&#39;OR grade = &#39;5&#39;) AND (daysabsent &gt; 200)</span>
<span class="s2">   then 1</span>
<span class="s2">   else 0</span>
<span class="s2">   end)::numeric as result, csa</span>
<span class="s2">   from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">   left join schools.afile_2016 b on a.gid = b.gid</span>
<span class="s2">   group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   denominator AS (</span>
<span class="s2">    select (sum(</span>
<span class="s2">     case </span>
<span class="s2">     when (daysattend::numeric &gt; 1) AND (grade = &#39;1&#39; OR grade = &#39;2&#39; OR grade = &#39;3&#39; OR grade = &#39;4&#39;OR grade = &#39;5&#39;)</span>
<span class="s2">     then 1</span>
<span class="s2">     else 0</span>
<span class="s2">     end)::numeric </span>
<span class="s2">    ) as result, csa</span>
<span class="s2">    from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">    left join schools.afile_2016 b on a.gid = b.gid</span>
<span class="s2">    group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   tbl AS (</span>
<span class="s2">     select denominator.csa,(numerator.result / denominator.result)*(100::numeric) as result </span>
<span class="s2">     from numerator left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">    )</span>
<span class="s2">   update vital_signs.data</span>
<span class="s2">   set abse = result from tbl where data.csa = tbl.csa and data_year = &#39;2016&#39;;</span>
<span class="s2">  &quot;&quot;&quot;</span>

<span class="n">New17Query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with numerator as (</span>
<span class="s2">   select count(*)::numeric as result, csa</span>
<span class="s2">     from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">       left join schools.afile_1617 b on a.gid = b.gid</span>
<span class="s2">   where daysattend &gt; 1 AND daysabsent &gt; 200 AND grade in (&#39;1&#39;,&#39;2&#39;,&#39;3&#39;,&#39;4&#39;,&#39;5&#39;) AND (std_number, enterdate) in </span>
<span class="s2">     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )</span>
<span class="s2">   group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   denominator AS (</span>
<span class="s2">   select count(*)::numeric as result, csa</span>
<span class="s2">     from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">       left join schools.afile_1617 b on a.gid = b.gid</span>
<span class="s2">   where daysattend &gt; 1 AND grade in (&#39;1&#39;,&#39;2&#39;,&#39;3&#39;,&#39;4&#39;,&#39;5&#39;) AND (std_number, enterdate) in </span>
<span class="s2">     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )</span>
<span class="s2">   group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   tbl AS (</span>
<span class="s2">     select denominator.csa,(numerator.result / NULLIF(denominator.result,0) )*(100::numeric) as result </span>
<span class="s2">     from numerator left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">    )</span>
<span class="s2">  select * from tbl where 1 = 1 ORDER BY csa ASC;</span>
<span class="s2">  &quot;&quot;&quot;</span>

<span class="n">OLD17Query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with numerator as (</span>
<span class="s2">   select sum(</span>
<span class="s2">   case </span>
<span class="s2">   when (daysattend &gt; 1) AND (grade = 1 OR grade = 2 OR grade = 3 OR grade = 4 OR grade = 5 ) AND (daysabsent &gt; 200)</span>
<span class="s2">   then 1</span>
<span class="s2">   else 0</span>
<span class="s2">   end)::numeric as result, csa</span>
<span class="s2">   from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">   left join schools.afile_1617 b on a.gid = b.gid</span>
<span class="s2">   group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   denominator AS (</span>
<span class="s2">    select (sum(</span>
<span class="s2">     case </span>
<span class="s2">     when (daysattend::numeric &gt; 1) AND (grade = &#39;1&#39; OR grade = &#39;2&#39; OR grade = &#39;3&#39; OR grade = &#39;4&#39;OR grade = &#39;5&#39;)</span>
<span class="s2">     then 1</span>
<span class="s2">     else 0</span>
<span class="s2">     end)::numeric </span>
<span class="s2">    ) as result, csa</span>
<span class="s2">    from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">    left join schools.afile_1617 b on a.gid = b.gid</span>
<span class="s2">    group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   tbl AS (</span>
<span class="s2">     select denominator.csa,(numerator.result / NULLIF(denominator.result,0) )*(100::numeric) as result </span>
<span class="s2">     from numerator left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">    )</span>
<span class="s2">  select * from tbl where 1 = 1 ORDER BY csa ASC;</span>
<span class="s2">  &quot;&quot;</span>

<span class="s2">  afile_1617</span>
<span class="s2">  17 hispani_la</span>
<span class="s2">  16 hispani_lat</span>
<span class="s2">  NULLIF(denominator.result,0)</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   where daysattend &gt; 1 AND daysabsent &gt; 200 AND grade in (&#39;1&#39;,&#39;2&#39;,&#39;3&#39;,&#39;4&#39;,&#39;5&#39;) AND (std_number, enterdate) in </span>
<span class="sd">     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )</span>
<span class="sd">     /</span>
<span class="sd">   where daysattend &gt; 1 AND grade in (&#39;1&#39;,&#39;2&#39;,&#39;3&#39;,&#39;4&#39;,&#39;5&#39;) AND (std_number, enterdate) in </span>
<span class="sd">     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>numerator only differentiates from the denominator in that it looks for days absent &gt; 200..also. the query filters for 200 but the indicator description says 20</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">denom</span><span class="p">[</span> <span class="n">denom</span><span class="p">[</span><span class="s1">&#39;daysabsent&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="abse" class="doc_header"><code>abse</code><a href="https://github.com/bnia/VitalSigns/tree/main/VitalSigns/BCPSS.py#L235" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>abse</code>(<strong><code>df</code></strong>, <strong><code>csa</code></strong>, <strong><code>yr</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fin</span> <span class="o">=</span> <span class="n">abse</span><span class="p">(</span><span class="n">bcpss</span><span class="p">,</span> <span class="n">csa</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;73-abse&#39;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="74-absmd---G---No-Drop-Dupes">74 absmd - G - No Drop Dupes<a class="anchor-link" href="#74-absmd---G---No-Drop-Dupes"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lbl</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; BCPSS - Education and Youth - Percent of 6th-8th Grade Students that are Chronically Absent (Missing at least 20 days) &quot;&quot;&quot;</span>

<span class="n">query16</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; with numerator as (</span>
<span class="s2">   select sum(</span>
<span class="s2">   case </span>
<span class="s2">   when (daysattend &gt; 1) AND (grade = &#39;6&#39; OR grade = &#39;7&#39; OR grade = &#39;8&#39;) AND (daysabsent &gt; 200)</span>
<span class="s2">   then 1</span>
<span class="s2">   else 0</span>
<span class="s2">   end)::numeric as result, csa</span>
<span class="s2">   from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">   left join schools.afile_2016 b on a.gid = b.gid</span>
<span class="s2">   group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   denominator AS (</span>
<span class="s2">    select (sum(</span>
<span class="s2">     case </span>
<span class="s2">     when (daysattend::numeric &gt; 1) AND (grade = &#39;6&#39; OR grade = &#39;7&#39; OR grade = &#39;8&#39;) </span>
<span class="s2">     then 1</span>
<span class="s2">     else 0</span>
<span class="s2">     end)::numeric </span>
<span class="s2">    ) as result, csa</span>
<span class="s2">    from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">    left join schools.afile_2016 b on a.gid = b.gid</span>
<span class="s2">    group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   tbl AS (</span>
<span class="s2">     select denominator.csa,(numerator.result / denominator.result)*(100::numeric) as result </span>
<span class="s2">     from numerator left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">    )</span>
<span class="s2">   update vital_signs.data</span>
<span class="s2">   set absmd = result from tbl where data.csa = tbl.csa and data_year = &#39;2016&#39;; </span>
<span class="s2">  &quot;&quot;&quot;</span>


<span class="n">NEW17Query</span> <span class="o">=</span>  <span class="s2">&quot;&quot;&quot;with numerator as (</span>
<span class="s2">   select count(*)::numeric as result, csa</span>
<span class="s2">     from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">       left join schools.afile_1617 b on a.gid = b.gid</span>
<span class="s2">   where daysattend &gt; 1 AND daysabsent &gt; 200 AND grade in (&#39;6&#39;,&#39;7&#39;,&#39;8&#39;) AND (std_number, enterdate) in </span>
<span class="s2">     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )</span>
<span class="s2">   group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   denominator AS (</span>
<span class="s2">   select count(*)::numeric as result, csa</span>
<span class="s2">     from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">       left join schools.afile_1617 b on a.gid = b.gid</span>
<span class="s2">   where daysattend &gt; 1 AND grade in (&#39;6&#39;,&#39;7&#39;,&#39;8&#39;) AND (std_number, enterdate) in </span>
<span class="s2">     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )</span>
<span class="s2">   group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   tbl AS (</span>
<span class="s2">     select denominator.csa,(numerator.result / NULLIF(denominator.result,0) )*(100::numeric) as result </span>
<span class="s2">     from numerator left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">    )</span>
<span class="s2">  select * from tbl where 1 = 1 ORDER BY csa ASC;</span>
<span class="s2">  &quot;&quot;&quot;</span>

<span class="n">OLD17Query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with numerator as (</span>
<span class="s2">   select sum(</span>
<span class="s2">   case </span>
<span class="s2">   when (daysattend &gt; 1) AND (grade = &#39;6&#39; OR grade = &#39;7&#39; OR grade = &#39;8&#39;) AND (daysabsent &gt; 200)</span>
<span class="s2">   then 1</span>
<span class="s2">   else 0</span>
<span class="s2">   end)::numeric as result, csa</span>
<span class="s2">   from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">   left join schools.afile_1617 b on a.gid = b.gid</span>
<span class="s2">   group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   denominator AS (</span>
<span class="s2">    select (sum(</span>
<span class="s2">     case </span>
<span class="s2">     when (daysattend::numeric &gt; 1) AND (grade = &#39;6&#39; OR grade = &#39;7&#39; OR grade = &#39;8&#39;) </span>
<span class="s2">     then 1</span>
<span class="s2">     else 0</span>
<span class="s2">     end)::numeric </span>
<span class="s2">    ) as result, csa</span>
<span class="s2">    from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">    left join schools.afile_1617 b on a.gid = b.gid</span>
<span class="s2">    group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   tbl AS (</span>
<span class="s2">     select denominator.csa,(numerator.result / NULLIF(denominator.result,0) )*(100::numeric) as result </span>
<span class="s2">     from numerator left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">    )</span>
<span class="s2">  select * from tbl where 1 = 1 ORDER BY csa ASC;</span>
<span class="s2">  &quot;&quot;&quot;</span>

<span class="sd">&quot;&quot;&quot; afile_1617  NULLIF(denominator.result,0) &quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   where daysattend &gt; 1 AND daysabsent &gt; 200 AND grade in (&#39;6&#39;,&#39;7&#39;,&#39;8&#39;) AND (std_number, enterdate) in </span>
<span class="sd">     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )</span>
<span class="sd">     /</span>
<span class="sd">   where daysattend &gt; 1 AND grade in (&#39;6&#39;,&#39;7&#39;,&#39;8&#39;) AND (std_number, enterdate) in </span>
<span class="sd">     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="absmd" class="doc_header"><code>absmd</code><a href="https://github.com/bnia/VitalSigns/tree/main/VitalSigns/BCPSS.py#L288" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>absmd</code>(<strong><code>df</code></strong>, <strong><code>csa</code></strong>, <strong><code>yr</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fin</span> <span class="o">=</span> <span class="n">absmd</span><span class="p">(</span><span class="n">bcpss</span><span class="p">,</span> <span class="n">csa</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;74-absmd&#39;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="75-abshs---G---No-Drop-Dupes">75 abshs - G - No Drop Dupes<a class="anchor-link" href="#75-abshs---G---No-Drop-Dupes"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lbl</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; BCPSS - Education and Youth - Percent of 9th-12th Grade Students that are Chronically Absent (Missing at least 20 days) &quot;&quot;&quot;</span>

<span class="n">Query16</span>  <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with numerator as (</span>
<span class="s2">   select sum(</span>
<span class="s2">   case </span>
<span class="s2">   when (daysattend &gt; 1) AND (grade = &#39;9&#39; OR grade = &#39;10&#39; OR grade = &#39;11&#39; OR grade = &#39;12&#39;) AND (daysabsent &gt; 200)</span>
<span class="s2">   then 1</span>
<span class="s2">   else 0</span>
<span class="s2">   end)::numeric as result, csa</span>
<span class="s2">   from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">   left join schools.afile_2016 b on a.gid = b.gid</span>
<span class="s2">   group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   denominator AS (</span>
<span class="s2">    select (sum(</span>
<span class="s2">     case </span>
<span class="s2">     when (daysattend::numeric &gt; 1) AND (grade = &#39;9&#39; OR grade = &#39;10&#39; OR grade = &#39;11&#39; OR grade = &#39;12&#39;) </span>
<span class="s2">     then 1</span>
<span class="s2">     else 0</span>
<span class="s2">     end)::numeric </span>
<span class="s2">    ) as result, csa</span>
<span class="s2">    from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">    left join schools.afile_2016 b on a.gid = b.gid</span>
<span class="s2">    group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   tbl AS (</span>
<span class="s2">     select denominator.csa,(numerator.result / denominator.result)*(100::numeric) as result </span>
<span class="s2">     from numerator left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">    )</span>
<span class="s2">   update vital_signs.data</span>
<span class="s2">   set abshs = result from tbl where data.csa = tbl.csa and data_year = &#39;2016&#39;;</span>
<span class="s2">  &quot;&quot;&quot;</span>

<span class="n">New17Query</span> <span class="o">=</span>  <span class="s2">&quot;&quot;&quot;with numerator as (</span>
<span class="s2">   select count(*)::numeric as result, csa</span>
<span class="s2">     from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">       left join schools.afile_1617 b on a.gid = b.gid</span>
<span class="s2">   where daysattend &gt; 1 AND daysabsent &gt; 200 AND grade in (&#39;9&#39;,&#39;10&#39;,&#39;11&#39;,&#39;12&#39;) AND (std_number, enterdate) in </span>
<span class="s2">     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )</span>
<span class="s2">   group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   denominator AS (</span>
<span class="s2">   select count(*)::numeric as result, csa</span>
<span class="s2">     from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">       left join schools.afile_1617 b on a.gid = b.gid</span>
<span class="s2">   where daysattend &gt; 1 AND grade in (&#39;9&#39;,&#39;10&#39;,&#39;11&#39;,&#39;12&#39;) AND (std_number, enterdate) in </span>
<span class="s2">     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )</span>
<span class="s2">   group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   tbl AS (</span>
<span class="s2">     select denominator.csa,(numerator.result / NULLIF(denominator.result,0) )*(100::numeric) as result </span>
<span class="s2">     from numerator left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">    )</span>
<span class="s2">  select * from tbl where 1 = 1 ORDER BY csa ASC;</span>
<span class="s2">  &quot;&quot;&quot;</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  afile_1617</span>
<span class="sd">  NULLIF(denominator.result,0)</span>
<span class="sd">  &quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   where daysattend &gt; 1 AND daysabsent &gt; 200 AND grade in (&#39;9&#39;,&#39;10&#39;,&#39;11&#39;,&#39;12&#39;) AND (std_number, enterdate) in </span>
<span class="sd">     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )</span>
<span class="sd">     /</span>
<span class="sd">   where daysattend &gt; 1 AND grade in (&#39;9&#39;,&#39;10&#39;,&#39;11&#39;,&#39;12&#39;) AND (std_number, enterdate) in </span>
<span class="sd">     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="abshd" class="doc_header"><code>abshd</code><a href="https://github.com/bnia/VitalSigns/tree/main/VitalSigns/BCPSS.py#L341" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>abshd</code>(<strong><code>df</code></strong>, <strong><code>csa</code></strong>, <strong><code>yr</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fin</span> <span class="o">=</span> <span class="n">abshd</span><span class="p">(</span><span class="n">bcpss</span><span class="p">,</span> <span class="n">csa</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;75-abshs&#39;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="91-drop---G---No-Drop-Dupes">91 drop - G - No Drop Dupes<a class="anchor-link" href="#91-drop---G---No-Drop-Dupes"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lbl</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;BCPSS - Education and Youth - High School Dropout/Withdrawl Rate&quot;&quot;&quot;</span>

<span class="n">query16</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with numerator as (</span>
<span class="s2">   select sum(</span>
<span class="s2">   case </span>
<span class="s2">   when daysattend::numeric &gt; 1 AND (wleavecode LIKE &#39;W%&#39;) AND (wleavecode != &#39;W43&#39;) AND (grade = &#39;9&#39; OR grade = &#39;10&#39; OR grade = &#39;11&#39; OR grade = &#39;12&#39;)</span>
<span class="s2">   then 1</span>
<span class="s2">   else 0</span>
<span class="s2">   end)::numeric as result, csa</span>
<span class="s2">   from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">   left join schools.afile_2016 b on a.gid = b.gid</span>
<span class="s2">   group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   denominator AS (</span>
<span class="s2">    select (sum(</span>
<span class="s2">     case </span>
<span class="s2">     when (daysattend::numeric &gt; 1) AND (grade = &#39;9&#39; OR grade = &#39;10&#39; OR grade = &#39;11&#39; OR grade = &#39;12&#39;) </span>
<span class="s2">     then 1</span>
<span class="s2">     else 0</span>
<span class="s2">     end)::numeric </span>
<span class="s2">    ) as result, csa</span>
<span class="s2">    from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">    left join schools.afile_2016 b on a.gid = b.gid</span>
<span class="s2">    group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   tbl AS (</span>
<span class="s2">     select denominator.csa,(numerator.result / NULLIF(denominator.result,0) )*(100::numeric) as result </span>
<span class="s2">     from numerator left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">    )</span>
<span class="s2">  select * from tbl where 1 = 1 ORDER BY csa ASC;</span>
<span class="s2">  &quot;&quot;&quot;</span>

<span class="n">NEW17Query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with numerator as (</span>
<span class="s2">   select count(*)::numeric as result, csa</span>
<span class="s2">     from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">       left join schools.afile_1617 b on a.gid = b.gid</span>
<span class="s2">   where daysattend &gt; 1 AND  grade in (&#39;9&#39;,&#39;10&#39;,&#39;11&#39;,&#39;12&#39;) AND wleavecode IN (&#39;30&#39;,&#39;31&#39;,&#39;32&#39;,&#39;33&#39;,&#39;34&#39;,&#39;35&#39;,&#39;36&#39;,&#39;37&#39;,&#39;38&#39;,&#39;39&#39;,&#39;41&#39;,&#39;42&#39;,&#39;44&#39;,&#39;46&#39;,&#39;50&#39;,&#39;71&#39;,&#39;85&#39;) </span>
<span class="s2">   AND (std_number, enterdate) in ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )</span>
<span class="s2">   group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   denominator AS (</span>
<span class="s2">   select count(*)::numeric as result, csa</span>
<span class="s2">     from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">       left join schools.afile_1617 b on a.gid = b.gid</span>
<span class="s2">   where daysattend &gt; 1 AND grade in (&#39;9&#39;,&#39;10&#39;,&#39;11&#39;,&#39;12&#39;) AND (std_number, enterdate) in </span>
<span class="s2">     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )</span>
<span class="s2">   group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   tbl AS (</span>
<span class="s2">     select denominator.csa,(numerator.result / NULLIF(denominator.result,0) )*(100::numeric) as result </span>
<span class="s2">     from numerator left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">    )</span>
<span class="s2">  select * from tbl where 1 = 1 ORDER BY csa ASC;</span>
<span class="s2">  &quot;&quot;&quot;</span>


<span class="n">OLD17</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; with numerator as (</span>
<span class="s2">   select sum(</span>
<span class="s2">   case </span>
<span class="s2">   when daysattend::numeric &gt; 1 </span>
<span class="s2">     AND (grade = &#39;9&#39; OR grade = &#39;10&#39; OR grade = &#39;11&#39; OR grade = &#39;12&#39;) </span>
<span class="s2">     AND wleavecode IN (&#39;30&#39;,&#39;31&#39;,&#39;32&#39;,&#39;33&#39;,&#39;34&#39;,&#39;35&#39;,&#39;36&#39;,&#39;37&#39;,&#39;38&#39;,&#39;39&#39;,&#39;41&#39;,&#39;42&#39;,&#39;44&#39;,&#39;46&#39;,&#39;50&#39;,&#39;71&#39;,&#39;85&#39;)</span>
<span class="s2">   then 1</span>
<span class="s2">   else 0</span>
<span class="s2">   end)::numeric as result, csa</span>
<span class="s2">   from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">   left join schools.afile_1617 b on a.gid = b.gid</span>
<span class="s2">   group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   denominator AS (</span>
<span class="s2">    select (sum(</span>
<span class="s2">     case </span>
<span class="s2">     when (daysattend::numeric &gt; 1) AND (grade = &#39;9&#39; OR grade = &#39;10&#39; OR grade = &#39;11&#39; OR grade = &#39;12&#39;) </span>
<span class="s2">     then 1</span>
<span class="s2">     else 0</span>
<span class="s2">     end)::numeric </span>
<span class="s2">    ) as result, csa</span>
<span class="s2">    from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">    left join schools.afile_1617 b on a.gid = b.gid</span>
<span class="s2">    group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   tbl AS (</span>
<span class="s2">     select denominator.csa,(numerator.result / NULLIF(denominator.result,0) )*(100::numeric) as result </span>
<span class="s2">     from numerator left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">    )</span>
<span class="s2">  select * from tbl where 1 = 1 ORDER BY csa ASC;</span>
<span class="s2">  &quot;&quot;&quot;</span>

<span class="n">miscnotes</span> <span class="o">=</span>   <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">  afile_1617</span>


<span class="s2">  NULLIF(denominator.result,0)</span>

<span class="s2">  ERROR: wleavecode</span>

<span class="s2">  43 - &#39;W43 - Death&#39; </span>

<span class="s2">  LEAVE CODES</span>


<span class="s2">  WLEAVECODE SY15-16 LEAVECODE SY16-17 Code</span>
<span class="s2">  0 00 0 &#39;None&#39;</span>
<span class="s2">  C60 60 &#39;C60 - Graduated&#39;</span>
<span class="s2">  &#39;C61 - Graduated Certificate of Merit&#39;</span>
<span class="s2">  C62 62 &#39;C62 - Graduated HS certificate&#39;</span>
<span class="s2">  &#39;C63 - Graduated Special Ed&#39;</span>
<span class="s2">  C70 70 &#39;C70 - Early college admission&#39;</span>
<span class="s2">  T10 10 &#39;T10 - To other BCPS&#39;</span>
<span class="s2">  T13 13 &#39;T13 - Transfer to MD Public School&#39;</span>
<span class="s2">  T14 14 &#39;T14 - to US public school&#39;</span>
<span class="s2">  T15 15 &#39;T15 - to non-public school within city&#39;</span>
<span class="s2">  16 &#39;T16 - to non-public school outside Baltimore&#39;</span>
<span class="s2">  17 &#39;T17 - to Us Non-public school&#39; </span>
<span class="s2">  18&#39;T18 - to any school outside the US&#39; T21 T21 - to evening high school&#39;</span>
<span class="s2">  22 &#39;T22 - To state institution w/epdgm&#39;</span>
<span class="s2">  24 &#39;T24 - To parent teaching&#39;</span>
<span class="s2">  26 T27</span>
<span class="s2">  30 &#39;W30 - Illness- no education program&#39;</span>
<span class="s2">  31 &#39;W31 - Over 16, lack of academic success&#39;</span>
<span class="s2">  &#39;W32 - Over 16, discpl (not expelled) &#39;</span>
<span class="s2">  33 &#39;W33 - Over 16, lack of motivation&#39;</span>
<span class="s2">  34 &#39;W34  employment&#39;</span>
<span class="s2">  &#39;W35 - marriage&#39;</span>
<span class="s2">  &#39;W36 - military service&#39;</span>
<span class="s2">  38 &#39;W38 - Court action to institution&#39;</span>
<span class="s2">  W39 &#39;W39 - Over 16, economic reasons&#39;</span>
<span class="s2">  &#39;W40 - Under 16 expulsion&#39;</span>
<span class="s2">  41 &#39;W41 - Under 5 immaturity&#39;</span>
<span class="s2">  42 &#39;W42 - Under 16 special case&#39;</span>
<span class="s2">  43 &#39;W43 - Death&#39;</span>
<span class="s2">  &#39;W44 - Over 16 parenting&#39;</span>
<span class="s2">  &#39;W46 - Over 16 expulsion required&#39;</span>
<span class="s2">  50 &#39;W50 - Whereabouts unknown&#39;</span>
<span class="s2">  W71 &#39;W71 - Pregnancy&#39;.</span>
<span class="s2">  W85 85</span>
<span class="s2">  &quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="drop" class="doc_header"><code>drop</code><a href="https://github.com/bnia/VitalSigns/tree/main/VitalSigns/BCPSS.py#L394" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>drop</code>(<strong><code>df</code></strong>, <strong><code>csa</code></strong>, <strong><code>yr</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fin</span> <span class="o">=</span> <span class="n">drop</span><span class="p">(</span><span class="n">bcpss</span><span class="p">,</span> <span class="n">csa</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;91-drop&#39;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="92-compl---G---No-Drop-Dupes">92 compl - G - No Drop Dupes<a class="anchor-link" href="#92-compl---G---No-Drop-Dupes"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lbl</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;BCPSS - Education and Youth - High School Completion Rate&quot;&quot;&quot;</span>

<span class="n">query16</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with numerator as (</span>
<span class="s2">   select sum(</span>
<span class="s2">   case </span>
<span class="s2">   when (daysattend::numeric &gt; 1) AND (wleavecode LIKE &#39;C60&#39;) OR (wleavecode LIKE &#39;C62&#39;) AND (grade = &#39;12&#39;)</span>
<span class="s2">   then 1</span>
<span class="s2">   else 0</span>
<span class="s2">   end)::numeric as result, csa</span>
<span class="s2">   from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">   left join schools.afile_2016 b on a.gid = b.gid</span>
<span class="s2">   group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   denominator AS (</span>
<span class="s2">    select (sum(</span>
<span class="s2">     case </span>
<span class="s2">     when (daysattend::numeric &gt; 1) AND (grade = &#39;12&#39;) </span>
<span class="s2">     then 1</span>
<span class="s2">     else 0</span>
<span class="s2">     end)::numeric </span>
<span class="s2">    ) as result, csa</span>
<span class="s2">    from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">    left join schools.afile_2016 b on a.gid = b.gid</span>
<span class="s2">    group by csa</span>
<span class="s2">   ),</span>
<span class="s2"> tbl AS (</span>
<span class="s2">                        select vital_signs.div_zero (numerator.result, denominator.result)*(100::numeric) as result, numerator.csa</span>
<span class="s2">                        from numerator left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">                                                                )</span>
<span class="s2">     update vital_signs.data</span>
<span class="s2">   set compl = result from tbl where data.csa = tbl.csa and data_year = &#39;2016&#39;;    </span>
<span class="s2">  &quot;&quot;&quot;</span>

<span class="n">OLD17</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with numerator as (</span>
<span class="s2">   select sum(</span>
<span class="s2">   case </span>
<span class="s2">   when (daysattend::numeric &gt; 1) AND (wleavecode = &#39;60&#39;) OR (wleavecode = &#39;62&#39;) AND (grade = &#39;12&#39;)</span>
<span class="s2">   then 1</span>
<span class="s2">   else 0</span>
<span class="s2">   end)::numeric as result, csa</span>
<span class="s2">   from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">   left join schools.afile_1617 b on a.gid = b.gid</span>
<span class="s2">   group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   denominator AS (</span>
<span class="s2">    select (sum(</span>
<span class="s2">     case </span>
<span class="s2">     when (daysattend::numeric &gt; 1) AND (grade = &#39;12&#39;) </span>
<span class="s2">     then 1</span>
<span class="s2">     else 0</span>
<span class="s2">     end)::numeric </span>
<span class="s2">    ) as result, csa</span>
<span class="s2">    from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">    left join schools.afile_1617 b on a.gid = b.gid</span>
<span class="s2">    group by csa</span>
<span class="s2">   ),</span>
<span class="s2">  tbl AS (</span>
<span class="s2">  select vital_signs.div_zero (numerator.result, denominator.result)*(100::numeric) as result, numerator.csa</span>
<span class="s2">  from numerator left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">  )</span>
<span class="s2">  select * from tbl where 1 = 1 ORDER BY csa ASC;</span>
<span class="s2">  &quot;&quot;&quot;</span>

<span class="n">misc</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">  New 17: </span>

<span class="s2">  afile_1617</span>

<span class="s2">  NULLIF(denominator.result,0)</span>

<span class="s2">  ERROR: wleavecode</span>

<span class="s2">  2016 Leave Codes: W50 T10 C60 T22 </span>
<span class="s2">  2017 Leave Codes: 85 62 10 10 60</span>
<span class="s2">  &quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="compl" class="doc_header"><code>compl</code><a href="https://github.com/bnia/VitalSigns/tree/main/VitalSigns/BCPSS.py#L439" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>compl</code>(<strong><code>df</code></strong>, <strong><code>csa</code></strong>, <strong><code>yr</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fin</span> <span class="o">=</span> <span class="n">compl</span><span class="p">(</span><span class="n">bcpss</span><span class="p">,</span> <span class="n">csa</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;92-compl&#39;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="94-sclsw---B---No-Filter-Duplicates">94 sclsw - B - No Filter Duplicates<a class="anchor-link" href="#94-sclsw---B---No-Filter-Duplicates"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>daysattend</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lbl</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;BCPSS - Education and Youth - Percent of Students Switching Schools within School Year&quot;&quot;&quot;</span>
<span class="sd">&quot;&quot;&quot; Leave Code = 10 13 14 15 16 17 18 212 22 24&quot;&quot;&quot;</span>

<span class="n">q16</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; with numerator as (</span>
<span class="s2">   select sum(</span>
<span class="s2">   case </span>
<span class="s2">   when (daysattend &gt; 1) </span>
<span class="s2">   then 1</span>
<span class="s2">   else 0</span>
<span class="s2">   end)::numeric as result, csa</span>
<span class="s2">   from vital_signs.match_csas_and_bc_by_geom(&#39;schools.schoolswitchers_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">   left join schools.schoolswitchers_2016 b on a.gid = b.gid</span>
<span class="s2">   group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   denominator AS (</span>
<span class="s2">    select (sum(</span>
<span class="s2">     case </span>
<span class="s2">     when (daysattend::numeric &gt; 1) </span>
<span class="s2">     then 1</span>
<span class="s2">     else 0</span>
<span class="s2">     end)::numeric </span>
<span class="s2">    ) as result, csa</span>
<span class="s2">    from vital_signs.match_csas_and_bc_by_geom(&#39;schools.afile_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">    left join schools.afile_2016 b on a.gid = b.gid</span>
<span class="s2">    group by csa</span>
<span class="s2">   ),</span>
<span class="s2"> tbl AS (</span>
<span class="s2">                        select vital_signs.div_zero (numerator.result, denominator.result)*(100::numeric) as result, numerator.csa</span>
<span class="s2">                        from numerator left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">                                                                )</span>
<span class="s2">     update vital_signs.data</span>
<span class="s2">   set sclsw = result from tbl where data.csa = tbl.csa and data_year = &#39;2016&#39;;  </span>
<span class="s2">  &quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">       when (daysattend &gt; 1) </span>
<span class="sd">   then 1</span>
<span class="sd">   else 0</span>
<span class="sd">   /</span>
<span class="sd">     when (daysattend::numeric &gt; 1) </span>
<span class="sd">     then 1</span>
<span class="sd">     else 0</span>
<span class="sd">     &quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="sclsw" class="doc_header"><code>sclsw</code><a href="https://github.com/bnia/VitalSigns/tree/main/VitalSigns/BCPSS.py#L484" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>sclsw</code>(<strong><code>df</code></strong>, <strong><code>denomdf</code></strong>, <strong><code>csa</code></strong>, <strong><code>yr</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fin</span> <span class="o">=</span> <span class="n">sclsw</span><span class="p">(</span><span class="n">schoolSwitchersDF</span><span class="p">,</span> <span class="n">bcpss</span><span class="p">,</span> <span class="n">csa</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;94-sclsw&#39;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="195-eenrol---G---Drop-Dupes---enrollment-DF">195 eenrol - G - Drop Dupes - enrollment DF<a class="anchor-link" href="#195-eenrol---G---Drop-Dupes---enrollment-DF"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>grade</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lbl</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;BCPSS - Education and Youth - Number of Students Officially Enrolled in 1st - 5th Grade&quot;&quot;&quot;</span>

<span class="n">q16</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; with tbl AS (</span>
<span class="s2">    select (sum(</span>
<span class="s2">  case </span>
<span class="s2">  when grade = &#39;1&#39; OR grade = &#39;2&#39; OR grade = &#39;3&#39; OR grade = &#39;4&#39; OR grade = &#39;5&#39;</span>
<span class="s2">  then 1</span>
<span class="s2">  else 0</span>
<span class="s2">  end)::numeric </span>
<span class="s2"> ) as result, csa</span>
<span class="s2"> from vital_signs.match_csas_and_bc_by_geom(&#39;schools.enrollment_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2"> left join schools.enrollment_2016 b on a.gid = b.gid</span>
<span class="s2"> group by csa</span>
<span class="s2">     )</span>
<span class="s2">     update vital_signs.data</span>
<span class="s2">     set eenrol = result from tbl where data.csa = tbl.csa and data_year = &#39;2016&#39;;</span>
<span class="s2">  &quot;&quot;&quot;</span>

<span class="n">q17</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with tbl AS (</span>
<span class="s2">  select (sum( case </span>
<span class="s2">    when grade = &#39;1&#39; OR grade = &#39;2&#39; OR grade = &#39;3&#39; OR grade = &#39;4&#39; OR grade = &#39;5&#39;</span>
<span class="s2">     then 1 else 0</span>
<span class="s2">       end)::numeric </span>
<span class="s2">   ) as result, csa</span>
<span class="s2">     from vital_signs.match_csas_and_bc_by_geom(&#39;schools.enrollment_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">       left join schools.enrollment_1617 b on a.gid = b.gid</span>
<span class="s2">         group by csa</span>
<span class="s2">  )</span>
<span class="s2">  select * from tbl where 1 = 1 ORDER BY csa ASC;</span>
<span class="s2">  &quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bcpssTemp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bcpss</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">enrollment</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Whatever the VS year is, the school year is the year before. so for vs20, the school year to filter on (need to know the date they entered) is sept 2019.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">enrollment</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="eenrol" class="doc_header"><code>eenrol</code><a href="https://github.com/bnia/VitalSigns/tree/main/VitalSigns/BCPSS.py#L530" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>eenrol</code>(<strong><code>df</code></strong>, <strong><code>csa</code></strong>, <strong><code>yr</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fin</span> <span class="o">=</span> <span class="n">eenrol</span><span class="p">(</span><span class="n">enrollment</span><span class="p">,</span> <span class="n">csa</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;195-eenrol&#39;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="196-menrol---G---Drop-Dupes">196 menrol - G - Drop Dupes<a class="anchor-link" href="#196-menrol---G---Drop-Dupes"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>grade</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="sd">&quot;&quot;&quot; BCPSS - Education and Youth - Number of Students Officially Enrolled in 6th - 8th Grade&quot;&quot;&quot;</span>

<span class="n">q16</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with tbl AS (</span>
<span class="s2">    select (sum(</span>
<span class="s2">  case </span>
<span class="s2">  when grade = &#39;6&#39; OR grade = &#39;7&#39; OR grade = &#39;8&#39; </span>
<span class="s2">  then 1</span>
<span class="s2">  else 0</span>
<span class="s2">  end)::numeric </span>
<span class="s2"> ) as result, csa</span>
<span class="s2"> from vital_signs.match_csas_and_bc_by_geom(&#39;schools.enrollment_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2"> left join schools.enrollment_2016 b on a.gid = b.gid</span>
<span class="s2"> group by csa</span>
<span class="s2">     )</span>
<span class="s2">     update vital_signs.data</span>
<span class="s2">     set menrol = result from tbl where data.csa = tbl.csa and data_year = &#39;2016&#39;;</span>
<span class="s2">  &quot;&quot;&quot;</span>

<span class="n">q17</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with tbl AS (</span>
<span class="s2">    select (sum( case </span>
<span class="s2">      when grade = &#39;6&#39; OR grade = &#39;7&#39; OR grade = &#39;8&#39; </span>
<span class="s2">        then 1 else 0 end)::numeric </span>
<span class="s2">    ) as result, csa</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;schools.enrollment_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">        left join schools.enrollment_1617 b on a.gid = b.gid</span>
<span class="s2">          group by csa</span>
<span class="s2">  )</span>
<span class="s2">  select * from tbl where 1 = 1 ORDER BY csa ASC;</span>
<span class="s2">  &quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      when grade = &#39;6&#39; OR grade = &#39;7&#39; OR grade = &#39;8&#39; </span>
<span class="sd">        then 1 else 0 end)::numeric </span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="menrol" class="doc_header"><code>menrol</code><a href="https://github.com/bnia/VitalSigns/tree/main/VitalSigns/BCPSS.py#L567" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>menrol</code>(<strong><code>df</code></strong>, <strong><code>csa</code></strong>, <strong><code>yr</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fin</span> <span class="o">=</span> <span class="n">menrol</span><span class="p">(</span><span class="n">enrollment</span><span class="p">,</span> <span class="n">csa</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;196-menrol&#39;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="197-hsenrol---G---Drop-Dupes">197 hsenrol - G - Drop Dupes<a class="anchor-link" href="#197-hsenrol---G---Drop-Dupes"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>grade</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lbl</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;BCPSS - Education and Youth - Number of Students Officially Enrolled in 9th - 12th Grade &quot;&quot;&quot;</span>

<span class="n">q16</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with tbl AS (</span>
<span class="s2">    select (sum(</span>
<span class="s2">  case </span>
<span class="s2">  when grade = &#39;9&#39; OR grade = &#39;10&#39; OR grade = &#39;11&#39; OR grade = &#39;12&#39;</span>
<span class="s2">  then 1</span>
<span class="s2">  else 0</span>
<span class="s2">  end)::numeric </span>
<span class="s2"> ) as result, csa</span>
<span class="s2"> from vital_signs.match_csas_and_bc_by_geom(&#39;schools.enrollment_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2"> left join schools.enrollment_2016 b on a.gid = b.gid</span>
<span class="s2"> group by csa</span>
<span class="s2">     )</span>
<span class="s2">     update vital_signs.data</span>
<span class="s2">     set hsenrol = result from tbl where data.csa = tbl.csa and data_year = &#39;2016&#39;;</span>
<span class="s2">  &quot;&quot;&quot;</span>

<span class="n">q17</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; with tbl AS (</span>
<span class="s2">    select (sum( case </span>
<span class="s2">      when grade = &#39;9&#39; OR grade = &#39;10&#39; OR grade = &#39;11&#39; OR grade = &#39;12&#39;</span>
<span class="s2">        then 1 else 0 end)::numeric </span>
<span class="s2">    ) as result, csa</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;schools.enrollment_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">        left join schools.enrollment_1617 b on a.gid = b.gid</span>
<span class="s2">          group by csa</span>
<span class="s2">  )</span>
<span class="s2">  select * from tbl where 1 = 1 ORDER BY csa ASC;</span>
<span class="s2">  &quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">       when grade = &#39;9&#39; OR grade = &#39;10&#39; OR grade = &#39;11&#39; OR grade = &#39;12&#39;</span>
<span class="sd">        then 1 else 0 end)::numeric  </span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="hsenrol" class="doc_header"><code>hsenrol</code><a href="https://github.com/bnia/VitalSigns/tree/main/VitalSigns/BCPSS.py#L604" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>hsenrol</code>(<strong><code>df</code></strong>, <strong><code>csa</code></strong>, <strong><code>yr</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fin</span> <span class="o">=</span> <span class="n">hsenrol</span><span class="p">(</span><span class="n">enrollment</span><span class="p">,</span> <span class="n">csa</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;197-hsenrol&#39;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="206-pmath3---G-&#10060;">206 pmath3 - G &#10060;<a class="anchor-link" href="#206-pmath3---G-&#10060;"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>grade  parcc_perf subject</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lbl</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;BCPSS - Education and Youth - Percentage of 3rd Grade Students who Met or Exceeded PARCC Math&quot;&quot;&quot;</span>

<span class="n">q16</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with numerator as (</span>
<span class="s2">    select sum( case </span>
<span class="s2">      when (grade = &#39;3&#39;)  AND (parcc_perf =4 OR parcc_perf = 5) </span>
<span class="s2">        then 1 else 0 end</span>
<span class="s2">    )::numeric as math3_proficiency, csa</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;schools.math_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">        left join schools.math_2016 b on a.gid = b.gid</span>
<span class="s2">          group by csa</span>
<span class="s2">            order by csa</span>
<span class="s2">  ),</span>
<span class="s2">  denominator AS (</span>
<span class="s2">    select sum( case </span>
<span class="s2">      when (grade = &#39;3&#39;) </span>
<span class="s2">        then 1 else 0 end</span>
<span class="s2">    )::numeric as math3_testtakers, csa</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;schools.math_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">        left join schools.math_2016 b on a.gid = b.gid</span>
<span class="s2">          group by csa</span>
<span class="s2">            order by csa</span>
<span class="s2">  ),</span>
<span class="s2">  tbl AS (</span>
<span class="s2">  select vital_signs.div_zero (numerator.math3_proficiency, denominator.math3_testtakers)*(100::numeric) as result, numerator.csa</span>
<span class="s2">  from numerator left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">  )</span>
<span class="s2">  select * from tbl</span>
<span class="s2">  &quot;&quot;&quot;</span>

<span class="n">q17</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with numerator as (</span>
<span class="s2">    select sum( case </span>
<span class="s2">      when (grade = &#39;3&#39;)  AND (parcc_perf =4 OR parcc_perf = 5) AND subject = &#39;Mathematics&#39;</span>
<span class="s2">        then 1 else 0 end</span>
<span class="s2">    )::numeric as math3_proficiency, csa</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;schools.parcc_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">        left join schools.parcc_1617 b on a.gid = b.gid</span>
<span class="s2">          group by csa</span>
<span class="s2">            order by csa</span>
<span class="s2">  ),</span>
<span class="s2">  denominator AS (</span>
<span class="s2">    select sum( case </span>
<span class="s2">      when (grade = &#39;3&#39;) AND subject = &#39;Mathematics&#39;</span>
<span class="s2">        then 1 else 0 end</span>
<span class="s2">    )::numeric as math3_testtakers, csa</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;schools.parcc_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">        left join schools.parcc_1617 b on a.gid = b.gid</span>
<span class="s2">          group by csa</span>
<span class="s2">            order by csa</span>
<span class="s2">  ),</span>
<span class="s2">  tbl AS (</span>
<span class="s2">  select vital_signs.div_zero (numerator.math3_proficiency, denominator.math3_testtakers)*(100::numeric) as result, numerator.csa</span>
<span class="s2">  from numerator left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">  )</span>
<span class="s2">  select * from tbl where 1 = 1 ORDER BY csa ASC;&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>      <span class="n">when</span> <span class="p">(</span><span class="n">grade</span> <span class="o">=</span> <span class="s1">&#39;3&#39;</span><span class="p">)</span>  <span class="n">AND</span> <span class="p">(</span><span class="n">parcc_perf</span> <span class="o">=</span><span class="mi">4</span> <span class="n">OR</span> <span class="n">parcc_perf</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="n">AND</span> <span class="n">subject</span> <span class="o">=</span> <span class="s1">&#39;Mathematics&#39;</span>
        <span class="n">then</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span> <span class="n">end</span>
        
        <span class="o">/</span>

      <span class="n">when</span> <span class="p">(</span><span class="n">grade</span> <span class="o">=</span> <span class="s1">&#39;3&#39;</span><span class="p">)</span> <span class="n">AND</span> <span class="n">subject</span> <span class="o">=</span> <span class="s1">&#39;Mathematics&#39;</span>
        <span class="n">then</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span> <span class="n">end</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="207-pread3---G-&#10060;">207 pread3 - G &#10060;<a class="anchor-link" href="#207-pread3---G-&#10060;"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>grade  parcc_perf subject</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">BCPSS</span>
<span class="n">Education</span> <span class="ow">and</span> <span class="n">Youth</span>
<span class="n">Percentage</span> <span class="n">of</span> <span class="mi">3</span><span class="n">rd</span> <span class="n">Grade</span> <span class="n">Students</span> <span class="n">who</span> <span class="n">Met</span> <span class="ow">or</span> <span class="n">Exceeded</span> <span class="n">PARCC</span> <span class="n">Reading</span>

<span class="n">q16</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with numerator as (</span>
<span class="s2">    select sum( case </span>
<span class="s2">      when (grade = &#39;3&#39;) AND (parcc_perf =4 OR parcc_perf = 5)</span>
<span class="s2">        then 1 else 0 end</span>
<span class="s2">    )::numeric as eng_prof, csa</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;schools.english_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">        left join schools.english_2016 b on a.gid = b.gid</span>
<span class="s2">          group by csa</span>
<span class="s2">            order by csa</span>
<span class="s2">  ),</span>
<span class="s2">  denominator AS (</span>
<span class="s2">    select sum( case </span>
<span class="s2">      when (grade = &#39;3&#39;)</span>
<span class="s2">        then 1 else 0 end</span>
<span class="s2">    )::numeric as eng_prof, csa</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;schools.english_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">        left join schools.english_2016 b on a.gid = b.gid</span>
<span class="s2">          group by csa</span>
<span class="s2">            order by csa</span>
<span class="s2">  ),</span>
<span class="s2">  tbl AS (</span>
<span class="s2">    select vital_signs.div_zero (numerator.eng_prof, denominator.eng_prof)*(100::numeric) as result, numerator.csa</span>
<span class="s2">      from numerator </span>
<span class="s2">        left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">  )</span>
<span class="s2">  select * from tbl where 1 = 1 ORDER BY csa ASC;</span>
<span class="s2">  &quot;&quot;&quot;</span>

<span class="n">q17</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; with numerator as (</span>
<span class="s2">    select sum( case </span>
<span class="s2">      when (grade = &#39;3&#39;) AND (parcc_perf =4 OR parcc_perf = 5) AND subject = &#39;English Language Arts/Literacy&#39;</span>
<span class="s2">        then 1 else 0 end</span>
<span class="s2">    )::numeric as eng_prof, csa</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;schools.parcc_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">        left join schools.parcc_1617 b on a.gid = b.gid</span>
<span class="s2">          group by csa</span>
<span class="s2">            order by csa</span>
<span class="s2">  ),</span>
<span class="s2">  denominator AS (</span>
<span class="s2">    select sum( case </span>
<span class="s2">      when (grade = &#39;3&#39;) AND subject = &#39;English Language Arts/Literacy&#39;</span>
<span class="s2">        then 1 else 0 end</span>
<span class="s2">    )::numeric as eng_prof, csa</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;schools.parcc_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">        left join schools.parcc_1617 b on a.gid = b.gid</span>
<span class="s2">          group by csa</span>
<span class="s2">            order by csa</span>
<span class="s2">  ),</span>
<span class="s2">  tbl AS (</span>
<span class="s2">    select vital_signs.div_zero (numerator.eng_prof, denominator.eng_prof)*(100::numeric) as result, numerator.csa</span>
<span class="s2">      from numerator </span>
<span class="s2">        left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">  )</span>
<span class="s2">  select * from tbl where 1 = 1 ORDER BY csa ASC;</span>
<span class="s2">  &quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>      <span class="n">when</span> <span class="p">(</span><span class="n">grade</span> <span class="o">=</span> <span class="s1">&#39;3&#39;</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">parcc_perf</span> <span class="o">=</span><span class="mi">4</span> <span class="n">OR</span> <span class="n">parcc_perf</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="n">AND</span> <span class="n">subject</span> <span class="o">=</span> <span class="s1">&#39;English Language Arts/Literacy&#39;</span>
        <span class="n">then</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span> <span class="n">end</span>

        <span class="o">/</span>
      <span class="n">when</span> <span class="p">(</span><span class="n">grade</span> <span class="o">=</span> <span class="s1">&#39;3&#39;</span><span class="p">)</span> <span class="n">AND</span> <span class="n">subject</span> <span class="o">=</span> <span class="s1">&#39;English Language Arts/Literacy&#39;</span>
        <span class="n">then</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span> <span class="n">end</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="208-pmath5---G-&#10060;">208 pmath5 - G &#10060;<a class="anchor-link" href="#208-pmath5---G-&#10060;"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>grade  parcc_perf subject</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lbl</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;BCPSS - Education and Youth - Percentage of 5th Grade Students who Met or Exceeded PARCC Math&quot;&quot;&quot;</span>

<span class="n">q16</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; with numerator as (</span>
<span class="s2">    select sum( case </span>
<span class="s2">      when (grade = &#39;5&#39;)  AND (parcc_perf =4 OR parcc_perf = 5)</span>
<span class="s2">        then 1 else 0 end</span>
<span class="s2">    )::numeric as math3_proficiency, csa</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;schools.math_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">        left join schools.math_2016 b on a.gid = b.gid</span>
<span class="s2">          group by csa</span>
<span class="s2">            order by csa</span>
<span class="s2">  ),</span>
<span class="s2">  denominator AS (</span>
<span class="s2">    select sum( case </span>
<span class="s2">      when (grade = &#39;5&#39;)</span>
<span class="s2">        then 1 else 0 end</span>
<span class="s2">    )::numeric as math3_testtakers, csa</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;schools.math_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">        left join schools.math_2016 b on a.gid = b.gid</span>
<span class="s2">          group by csa</span>
<span class="s2">            order by csa</span>
<span class="s2">  ),</span>
<span class="s2">  tbl AS (</span>
<span class="s2">    select vital_signs.div_zero (numerator.math3_proficiency, denominator.math3_testtakers)*(100::numeric) as result, numerator.csa</span>
<span class="s2">      from numerator </span>
<span class="s2">        left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">  )</span>
<span class="s2">  select * from tbl</span>
<span class="s2">  &quot;&quot;&quot;</span>

<span class="n">q17</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">  with numerator as (</span>
<span class="s2">    select sum( case </span>
<span class="s2">      when (grade = &#39;5&#39;)  AND (parcc_perf =4 OR parcc_perf = 5) AND subject = &#39;Mathematics&#39;</span>
<span class="s2">        then 1 else 0 end</span>
<span class="s2">    )::numeric as math3_proficiency, csa</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;schools.parcc_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">        left join schools.parcc_1617 b on a.gid = b.gid</span>
<span class="s2">          group by csa</span>
<span class="s2">            order by csa</span>
<span class="s2">  ),</span>
<span class="s2">  denominator AS (</span>
<span class="s2">    select sum( case </span>
<span class="s2">      when (grade = &#39;5&#39;) AND subject = &#39;Mathematics&#39;</span>
<span class="s2">        then 1 else 0 end</span>
<span class="s2">    )::numeric as math3_testtakers, csa</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;schools.parcc_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">        left join schools.parcc_1617 b on a.gid = b.gid</span>
<span class="s2">          group by csa</span>
<span class="s2">            order by csa</span>
<span class="s2">  ),</span>
<span class="s2">  tbl AS (</span>
<span class="s2">    select vital_signs.div_zero (numerator.math3_proficiency, denominator.math3_testtakers)*(100::numeric) as result, numerator.csa</span>
<span class="s2">      from numerator </span>
<span class="s2">        left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">  )</span>
<span class="s2">  select * from tbl</span>
<span class="s2">  &quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>      <span class="n">when</span> <span class="p">(</span><span class="n">grade</span> <span class="o">=</span> <span class="s1">&#39;5&#39;</span><span class="p">)</span>  <span class="n">AND</span> <span class="p">(</span><span class="n">parcc_perf</span> <span class="o">=</span><span class="mi">4</span> <span class="n">OR</span> <span class="n">parcc_perf</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="n">AND</span> <span class="n">subject</span> <span class="o">=</span> <span class="s1">&#39;Mathematics&#39;</span>
        <span class="n">then</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span> <span class="n">end</span>

        <span class="o">/</span>

      <span class="n">when</span> <span class="p">(</span><span class="n">grade</span> <span class="o">=</span> <span class="s1">&#39;5&#39;</span><span class="p">)</span> <span class="n">AND</span> <span class="n">subject</span> <span class="o">=</span> <span class="s1">&#39;Mathematics&#39;</span>
        <span class="n">then</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span> <span class="n">end</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="209-pread5---G-&#10060;">209 pread5 - G &#10060;<a class="anchor-link" href="#209-pread5---G-&#10060;"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>grade  parcc_perf subject</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lbl</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;BCPSS - Education and Youth - Percentage of 5th Grade Students who Met or Exceeded PARCC Reading&quot;&quot;&quot;</span>

<span class="n">queries16</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;select sum(</span>
<span class="s2">  case </span>
<span class="s2">  when (grade = &#39;5&#39;) AND (parcc_perf =4 OR parcc_perf = 5) </span>
<span class="s2">  then 1</span>
<span class="s2">  else 0</span>
<span class="s2">  end)::numeric as eng_prof, csa</span>
<span class="s2">  from vital_signs.match_csas_and_bc_by_geom(&#39;schools.english_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">  left join schools.english_2016 b on a.gid = b.gid</span>
<span class="s2">  group by csa</span>
<span class="s2">  order by csa;</span>


<span class="s2">  select sum(</span>
<span class="s2">  case </span>
<span class="s2">  when (grade_code = &#39;5&#39;) </span>
<span class="s2">  then 1</span>
<span class="s2">  else 0</span>
<span class="s2">  end)::numeric as eng_prof, csa</span>
<span class="s2">  from vital_signs.match_csas_and_bc_by_geom(&#39;schools.english_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">  left join schools.english_2016 b on a.gid = b.gid</span>
<span class="s2">  group by csa</span>
<span class="s2">  order by csa;</span>
<span class="s2">  &quot;&quot;&quot;</span>

<span class="n">q17</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with numerator as (</span>
<span class="s2">    select sum( case </span>
<span class="s2">      when (grade = &#39;8&#39;)  AND (parcc_perf =4 OR parcc_perf = 5) AND subject = &#39;Mathematics&#39;</span>
<span class="s2">        then 1 else 0 end</span>
<span class="s2">    )::numeric as math3_proficiency, csa</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;schools.parcc_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">        left join schools.parcc_1617 b on a.gid = b.gid</span>
<span class="s2">          group by csa</span>
<span class="s2">            order by csa</span>
<span class="s2">  ),</span>
<span class="s2">  denominator AS (</span>
<span class="s2">    select sum( case </span>
<span class="s2">      when (grade = &#39;8&#39;) </span>
<span class="s2">        then 1 else 0 end</span>
<span class="s2">    )::numeric as math3_testtakers, csa</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;schools.parcc_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">        left join schools.parcc_1617 b on a.gid = b.gid</span>
<span class="s2">          group by csa</span>
<span class="s2">            order by csa</span>
<span class="s2">  ),</span>
<span class="s2">  tbl AS (</span>
<span class="s2">  select vital_signs.div_zero (numerator.math3_proficiency, denominator.math3_testtakers)*(100::numeric) as result, numerator.csa</span>
<span class="s2">  from numerator left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">  )</span>
<span class="s2">  select * from tbl</span>
<span class="s2">  &quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>      <span class="n">when</span> <span class="p">(</span><span class="n">grade</span> <span class="o">=</span> <span class="s1">&#39;8&#39;</span><span class="p">)</span>  <span class="n">AND</span> <span class="p">(</span><span class="n">parcc_perf</span> <span class="o">=</span><span class="mi">4</span> <span class="n">OR</span> <span class="n">parcc_perf</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="n">AND</span> <span class="n">subject</span> <span class="o">=</span> <span class="s1">&#39;Mathematics&#39;</span>
        <span class="n">then</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span> <span class="n">end</span>

  <span class="o">/</span>

      <span class="n">when</span> <span class="p">(</span><span class="n">grade</span> <span class="o">=</span> <span class="s1">&#39;8&#39;</span><span class="p">)</span> 
        <span class="n">then</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span> <span class="n">end</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="210-pmath8---G-&#10060;">210 pmath8 - G &#10060;<a class="anchor-link" href="#210-pmath8---G-&#10060;"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>grade  parcc_perf subject</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lbl</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;BCPSS - Education and Youth - Percentage of 8th Grade Students who Met or Exceeded PARCC Math&quot;&quot;&quot;</span>

<span class="n">q16</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with numerator as (</span>
<span class="s2">    select sum( case </span>
<span class="s2">      when (grade = &#39;8&#39;)  AND (parcc_perf =4 OR parcc_perf = 5)</span>
<span class="s2">        then 1 else 0 end</span>
<span class="s2">    )::numeric as math3_proficiency, csa</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;schools.math_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">        left join schools.math_2016 b on a.gid = b.gid</span>
<span class="s2">          group by csa</span>
<span class="s2">            order by csa</span>
<span class="s2">  ),</span>
<span class="s2">  denominator AS (</span>
<span class="s2">    select sum( case </span>
<span class="s2">      when (grade = &#39;8&#39;)</span>
<span class="s2">        then 1 else 0 end</span>
<span class="s2">    )::numeric as math3_testtakers, csa</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;schools.math_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">        left join schools.math_2016 b on a.gid = b.gid</span>
<span class="s2">          group by csa</span>
<span class="s2">            order by csa</span>
<span class="s2">  ),</span>
<span class="s2">  tbl AS (</span>
<span class="s2">    select vital_signs.div_zero (numerator.math3_proficiency, denominator.math3_testtakers)*(100::numeric) as result, numerator.csa</span>
<span class="s2">      from numerator </span>
<span class="s2">        left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">  )</span>
<span class="s2">  select * from tbl</span>
<span class="s2">  &quot;&quot;&quot;</span>

<span class="n">q17</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with numerator as (</span>
<span class="s2">    select sum( case </span>
<span class="s2">      when (grade = &#39;8&#39;)  AND (parcc_perf =4 OR parcc_perf = 5) AND subject = &#39;Mathematics&#39;</span>
<span class="s2">        then 1 else 0 end</span>
<span class="s2">    )::numeric as math3_proficiency, csa</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;schools.parcc_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">        left join schools.parcc_1617 b on a.gid = b.gid</span>
<span class="s2">          group by csa</span>
<span class="s2">            order by csa</span>
<span class="s2">  ),</span>
<span class="s2">  denominator AS (</span>
<span class="s2">    select sum( case </span>
<span class="s2">      when (grade = &#39;8&#39;) AND subject = &#39;Mathematics&#39;</span>
<span class="s2">        then 1 else 0 end</span>
<span class="s2">    )::numeric as math3_testtakers, csa</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;schools.parcc_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">        left join schools.parcc_1617 b on a.gid = b.gid</span>
<span class="s2">          group by csa</span>
<span class="s2">            order by csa</span>
<span class="s2">  ),</span>
<span class="s2">  tbl AS (</span>
<span class="s2">    select vital_signs.div_zero (numerator.math3_proficiency, denominator.math3_testtakers)*(100::numeric) as result, numerator.csa</span>
<span class="s2">      from numerator </span>
<span class="s2">        left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">  )</span>
<span class="s2">  select * from tbl</span>
<span class="s2">  &quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>      <span class="n">when</span> <span class="p">(</span><span class="n">grade</span> <span class="o">=</span> <span class="s1">&#39;8&#39;</span><span class="p">)</span>  <span class="n">AND</span> <span class="p">(</span><span class="n">parcc_perf</span> <span class="o">=</span><span class="mi">4</span> <span class="n">OR</span> <span class="n">parcc_perf</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="n">AND</span> <span class="n">subject</span> <span class="o">=</span> <span class="s1">&#39;Mathematics&#39;</span>
        <span class="n">then</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span> <span class="n">end</span>

        <span class="o">/</span>

      <span class="n">when</span> <span class="p">(</span><span class="n">grade</span> <span class="o">=</span> <span class="s1">&#39;8&#39;</span><span class="p">)</span> <span class="n">AND</span> <span class="n">subject</span> <span class="o">=</span> <span class="s1">&#39;Mathematics&#39;</span>
        <span class="n">then</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span> <span class="n">end</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="211-pread8---G-&#10060;">211 pread8 - G &#10060;<a class="anchor-link" href="#211-pread8---G-&#10060;"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>grade  parcc_perf subject eng_prof</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lbl</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;BCPSS  - Education and Youth - Percentage of 8th Grade Students who Met or Exceeded PARCC Reading&quot;&quot;&quot;</span>

<span class="n">q16</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with numerator as (</span>
<span class="s2">    select sum( case </span>
<span class="s2">      when (grade = &#39;8&#39;) AND (parcc_perf =4 OR parcc_perf = 5) </span>
<span class="s2">        then 1 else 0 end</span>
<span class="s2">  )::numeric as eng_prof, csa</span>
<span class="s2">    from vital_signs.match_csas_and_bc_by_geom(&#39;schools.english_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">      left join schools.english_2016 b on a.gid = b.gid</span>
<span class="s2">        group by csa </span>
<span class="s2">          order by csa</span>
<span class="s2">  ),</span>
<span class="s2">  denominator AS (</span>
<span class="s2">    select sum( case </span>
<span class="s2">      when (grade = &#39;8&#39;) </span>
<span class="s2">        then 1 else 0</span>
<span class="s2">          end</span>
<span class="s2">    )::numeric as eng8_testtakers, csa</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;schools.english_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">        left join schools.english_2016 b on a.gid = b.gid</span>
<span class="s2">          group by csa </span>
<span class="s2">            order by csa</span>
<span class="s2">  ),</span>
<span class="s2">  tbl AS (</span>
<span class="s2">    select vital_signs.div_zero (numerator.eng_prof, denominator.eng8_testtakers)*(100::numeric) as result, numerator.csa</span>
<span class="s2">      from numerator left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">  )</span>
<span class="s2">  select * from tbl</span>
<span class="s2">  &quot;&quot;&quot;</span>

<span class="n">q17</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with numerator as (</span>
<span class="s2">  select sum( case </span>
<span class="s2">      when (grade = &#39;8&#39;) AND (parcc_perf =4 OR parcc_perf = 5) AND subject = &#39;English Language Arts/Literacy&#39;</span>
<span class="s2">        then 1 else 0 end</span>
<span class="s2">    )::numeric as eng_prof, csa</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;schools.parcc_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">        left join schools.parcc_1617 b on a.gid = b.gid</span>
<span class="s2">          group by csa</span>
<span class="s2">            order by csa</span>
<span class="s2">  ),</span>
<span class="s2">  denominator AS (</span>
<span class="s2">    select sum( case </span>
<span class="s2">      when (grade = &#39;8&#39;) AND subject = &#39;English Language Arts/Literacy&#39;</span>
<span class="s2">        then 1 else 0 end</span>
<span class="s2">    )::numeric as eng_prof, csa</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;schools.parcc_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">        left join schools.parcc_1617 b on a.gid = b.gid</span>
<span class="s2">          group by csa</span>
<span class="s2">            order by csa</span>
<span class="s2">  ),</span>
<span class="s2">  tbl AS (</span>
<span class="s2">    select vital_signs.div_zero (numerator.eng_prof, denominator.eng_prof)*(100::numeric) as result, numerator.csa</span>
<span class="s2">      from numerator </span>
<span class="s2">        left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">  )</span>
<span class="s2">  select * from tbl where 1 = 1 ORDER BY csa ASC;</span>
<span class="s2">  &quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>      <span class="n">when</span> <span class="p">(</span><span class="n">grade</span> <span class="o">=</span> <span class="s1">&#39;8&#39;</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">parcc_perf</span> <span class="o">=</span><span class="mi">4</span> <span class="n">OR</span> <span class="n">parcc_perf</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="n">AND</span> <span class="n">subject</span> <span class="o">=</span> <span class="s1">&#39;English Language Arts/Literacy&#39;</span>
        <span class="n">then</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span> <span class="n">end</span>

        <span class="o">/</span>

      <span class="n">when</span> <span class="p">(</span><span class="n">grade</span> <span class="o">=</span> <span class="s1">&#39;8&#39;</span><span class="p">)</span> <span class="n">AND</span> <span class="n">subject</span> <span class="o">=</span> <span class="s1">&#39;English Language Arts/Literacy&#39;</span>
        <span class="n">then</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span> <span class="n">end</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="212-palg1---G-?---&#10060;">212 palg1 - G ? - &#10060;<a class="anchor-link" href="#212-palg1---G-?---&#10060;"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>grade  parcc_perf subject</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lbl</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;BCPSS - Education and Youth - Percentage of Students who Met or Exceeded PARCC Algebra I&quot;&quot;&quot;</span>

<span class="n">q16</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with numerator as (</span>
<span class="s2">    select sum( case </span>
<span class="s2">      when (grade = &#39;9&#39; or grade = &#39;10&#39; or grade = &#39;11&#39; or grade = &#39;12&#39;) </span>
<span class="s2">        AND (parcc_perf =4 OR parcc_perf = 5)</span>
<span class="s2">        then 1 else 0 </span>
<span class="s2">          end</span>
<span class="s2">    )::numeric as algebra1_met, csa</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;schools.algebra1_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">        left join schools.algebra1_2016 b on a.gid = b.gid</span>
<span class="s2">          group by csa</span>
<span class="s2">            order by csa</span>
<span class="s2">  ),</span>
<span class="s2">  denominator AS (</span>
<span class="s2">    select sum( case </span>
<span class="s2">      when  (grade = &#39;9&#39; or grade = &#39;10&#39; or grade = &#39;11&#39; or grade = &#39;12&#39;)</span>
<span class="s2">        then 1 else 0</span>
<span class="s2">          end</span>
<span class="s2">    )::numeric as algebra1_testtakers, csa</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;schools.algebra1_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">        left join schools.algebra1_2016 b on a.gid = b.gid</span>
<span class="s2">          group by csa </span>
<span class="s2">            order by csa</span>
<span class="s2">  ),</span>
<span class="s2">  tbl AS (</span>
<span class="s2">    select vital_signs.div_zero (numerator.algebra1_met, denominator.algebra1_testtakers)*(100::numeric) as result, numerator.csa</span>
<span class="s2">      from numerator left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">  )</span>
<span class="s2">  select * from tbl</span>
<span class="s2">  &quot;&quot;&quot;</span>

<span class="n">q17</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with numerator as (</span>
<span class="s2">    select sum( case </span>
<span class="s2">      when (grade = &#39;9&#39; or grade = &#39;10&#39; or grade = &#39;11&#39; or grade = &#39;12&#39;) AND subject = &#39;Algebra I&#39;</span>
<span class="s2">        AND (parcc_perf =4 OR parcc_perf = 5)</span>
<span class="s2">        then 1 else 0 </span>
<span class="s2">          end</span>
<span class="s2">    )::numeric as algebra1_met, csa</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;schools.parcc_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">        left join schools.parcc_1617 b on a.gid = b.gid</span>
<span class="s2">          group by csa</span>
<span class="s2">            order by csa</span>
<span class="s2">  ),</span>
<span class="s2">  denominator AS (</span>
<span class="s2">    select sum( case </span>
<span class="s2">      when  (grade = &#39;9&#39; or grade = &#39;10&#39; or grade = &#39;11&#39; or grade = &#39;12&#39;) AND subject = &#39;Algebra I&#39;</span>
<span class="s2">        then 1 else 0</span>
<span class="s2">          end</span>
<span class="s2">    )::numeric as algebra1_testtakers, csa</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;schools.parcc_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">        left join schools.parcc_1617 b on a.gid = b.gid</span>
<span class="s2">          group by csa </span>
<span class="s2">            order by csa</span>
<span class="s2">  ),</span>
<span class="s2">  tbl AS (</span>
<span class="s2">    select vital_signs.div_zero (numerator.algebra1_met, denominator.algebra1_testtakers)*(100::numeric) as result, numerator.csa</span>
<span class="s2">      from numerator left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">  )</span>
<span class="s2">  select * from tbl</span>
<span class="s2">  &quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      when (grade = &#39;9&#39; or grade = &#39;10&#39; or grade = &#39;11&#39; or grade = &#39;12&#39;) AND subject = &#39;Algebra I&#39;</span>
<span class="sd">        AND (parcc_perf =4 OR parcc_perf = 5)</span>

<span class="sd">        /</span>
<span class="sd">      when  (grade = &#39;9&#39; or grade = &#39;10&#39; or grade = &#39;11&#39; or grade = &#39;12&#39;) AND subject = &#39;Algebra I&#39;</span>
<span class="sd">        then 1 else 0</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">palg1</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">csa</span><span class="p">,</span> <span class="n">yr</span><span class="p">):</span> 
  <span class="n">df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

  <span class="c1"># Create the Denominator</span>
  <span class="n">denom</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;enterdate&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="s1">&#39;std_number&#39;</span><span class="p">])</span> 
  <span class="n">denom</span> <span class="o">=</span> <span class="n">denom</span><span class="p">[</span> <span class="n">denom</span><span class="p">[</span><span class="s1">&#39;grade&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;9|10|11|12&#39;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="o">&amp;</span> <span class="p">(</span><span class="n">denom</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Algebra I&#39;</span><span class="p">)</span> <span class="p">]</span> 

  <span class="c1"># Create the Numerator </span>
  <span class="n">denom</span><span class="p">[</span><span class="s1">&#39;parcc_perf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">denom</span><span class="p">[</span><span class="s1">&#39;parcc_perf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
  <span class="n">numer</span> <span class="o">=</span> <span class="n">denom</span><span class="p">[</span> <span class="p">(</span> <span class="n">denom</span><span class="p">[</span><span class="s1">&#39;parcc_perf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;4|5&#39;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">)</span> <span class="p">]</span>

  <span class="nb">id</span> <span class="o">=</span> <span class="s1">&#39;212&#39;</span>
  <span class="n">shortname</span> <span class="o">=</span> <span class="s1">&#39;palg1&#39;</span>
  
  <span class="c1"># Group by CSA</span>
  <span class="n">numer</span> <span class="o">=</span> <span class="n">numer</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
  <span class="n">denom</span> <span class="o">=</span> <span class="n">denom</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 

  <span class="c1"># Make sure ALL csas and BaltimoreCity are included and sorted.</span>
  <span class="n">numer</span> <span class="o">=</span> <span class="n">csa</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span> <span class="n">numer</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span> <span class="p">)</span>
  <span class="n">denom</span> <span class="o">=</span> <span class="n">csa</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span> <span class="n">denom</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span> <span class="p">)</span>
  <span class="n">numer</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="s1">&#39;Shape__Length&#39;</span><span class="p">,</span><span class="s1">&#39;Shape__Area&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
  <span class="n">numer</span><span class="p">[</span><span class="s1">&#39;denomCount&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">denom</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>
  
  <span class="c1"># Do after sortViaCsaMerge to get index right. False records would show underneath it but still get added to the sum.</span>
  <span class="n">numer</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">55</span><span class="p">,</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">numer</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
  <span class="n">numer</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">55</span><span class="p">,</span><span class="s1">&#39;denomCount&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">numer</span><span class="p">[</span><span class="s1">&#39;denomCount&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

  <span class="c1"># Perform the calculation</span>
  <span class="n">numer</span><span class="p">[</span><span class="nb">id</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">shortname</span><span class="o">+</span><span class="n">year</span><span class="p">]</span> <span class="o">=</span> <span class="n">numer</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">numer</span><span class="p">[</span><span class="s1">&#39;denomCount&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>

  <span class="n">compareYears</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;https://services1.arcgis.com/mVFRs7NF4iFitgbY/ArcGIS/rest/services/&quot;</span><span class="o">+</span><span class="n">shortname</span><span class="o">+</span><span class="s2">&quot;/FeatureServer/0/query?where=1%3D1&amp;outFields=*&amp;returnGeometry=true&amp;f=pgeojson&quot;</span><span class="p">);</span>
  <span class="n">prevYear</span> <span class="o">=</span> <span class="n">shortname</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span> <span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">)</span>
  <span class="k">if</span> <span class="n">prevYear</span> <span class="ow">in</span> <span class="n">compareYears</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">numer</span> <span class="o">=</span> <span class="n">numer</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span> <span class="n">compareYears</span><span class="p">[[</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">,</span> <span class="n">prevYear</span><span class="p">]],</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span> <span class="p">)</span> 
    <span class="n">numer</span><span class="p">[</span><span class="s1">&#39;change&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">numer</span><span class="p">[</span><span class="nb">id</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">shortname</span><span class="o">+</span><span class="n">year</span><span class="p">]</span> <span class="o">-</span> <span class="n">numer</span><span class="p">[</span> <span class="n">prevYear</span> <span class="p">]</span>
    <span class="n">numer</span><span class="p">[</span><span class="s1">&#39;percentChange&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">numer</span><span class="p">[</span><span class="s1">&#39;change&#39;</span> <span class="p">]</span> <span class="o">/</span> <span class="n">numer</span><span class="p">[</span> <span class="n">prevYear</span> <span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">numer</span><span class="p">[</span><span class="s1">&#39;change&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">numer</span><span class="p">[</span><span class="s1">&#39;change&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;Records Matching Query: &#39;</span><span class="p">,</span> <span class="n">numer</span><span class="o">.</span><span class="n">size</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">numer</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="p">)</span>
  <span class="k">return</span> <span class="n">numer</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;daysattend&#39;</span><span class="p">,</span> <span class="s1">&#39;daysabsent&#39;</span><span class="p">,</span> <span class="s1">&#39;GENDER&#39;</span><span class="p">,</span> <span class="s1">&#39;race_AIAN&#39;</span><span class="p">,</span> <span class="s1">&#39;race_asian&#39;</span><span class="p">,</span> <span class="s1">&#39;race_AA&#39;</span><span class="p">,</span> <span class="s1">&#39;race_NHPI&#39;</span><span class="p">,</span> <span class="s1">&#39;race_white&#39;</span><span class="p">,</span> <span class="s1">&#39;std_number&#39;</span><span class="p">,</span> <span class="s1">&#39;enterdate&#39;</span><span class="p">])</span>


<span class="n">fin</span> <span class="o">=</span> <span class="n">palg1</span><span class="p">(</span><span class="n">bcpss</span><span class="p">,</span> <span class="n">csa</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;212-palg1&#39;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="213-palg2---G-?---&#10060;">213 palg2 - G ? - &#10060;<a class="anchor-link" href="#213-palg2---G-?---&#10060;"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>grade  parcc_perf subject</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lbl</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Percentage of Students who Met or Exceeded PARCC Algebra II - Education and Youth - BCPSS&quot;&quot;&quot;</span>

<span class="n">query16</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with numerator as (</span>
<span class="s2">    select sum( case </span>
<span class="s2">      when (grade = &#39;9&#39; or grade = &#39;10&#39; or grade = &#39;11&#39; or grade = &#39;12&#39;)</span>
<span class="s2">        AND (parcc_perf =4 OR parcc_perf = 5)</span>
<span class="s2">        then 1 else 0 </span>
<span class="s2">          end</span>
<span class="s2">    )::numeric as algebra1_met, csa</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;schools.algebra2_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">        left join schools.algebra2_2016 b on a.gid = b.gid</span>
<span class="s2">          group by csa</span>
<span class="s2">            order by csa</span>
<span class="s2">  ),</span>
<span class="s2">  denominator AS (</span>
<span class="s2">    select sum( case </span>
<span class="s2">      when  (grade = &#39;9&#39; or grade = &#39;10&#39; or grade = &#39;11&#39; or grade = &#39;12&#39;)</span>
<span class="s2">        then 1 else 0</span>
<span class="s2">          end</span>
<span class="s2">    )::numeric as algebra1_testtakers, csa</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;schools.algebra2_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">        left join schools.algebra2_2016 b on a.gid = b.gid</span>
<span class="s2">          group by csa </span>
<span class="s2">            order by csa</span>
<span class="s2">  ),</span>
<span class="s2">  tbl AS (</span>
<span class="s2">    select vital_signs.div_zero (numerator.algebra1_met, denominator.algebra1_testtakers)*(100::numeric) as result, numerator.csa</span>
<span class="s2">      from numerator left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">  )</span>
<span class="s2">  select * from tbl</span>
<span class="s2">  &quot;&quot;&quot;</span>


<span class="n">query17</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; with numerator as (</span>
<span class="s2">    select sum( case </span>
<span class="s2">      when (grade = &#39;9&#39; or grade = &#39;10&#39; or grade = &#39;11&#39; or grade = &#39;12&#39;) AND subject = &#39;Algebra II&#39;</span>
<span class="s2">        AND (parcc_perf =4 OR parcc_perf = 5)</span>
<span class="s2">        then 1 else 0 </span>
<span class="s2">          end</span>
<span class="s2">    )::numeric as algebra1_met, csa</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;schools.parcc_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">        left join schools.parcc_1617 b on a.gid = b.gid</span>
<span class="s2">          group by csa</span>
<span class="s2">            order by csa</span>
<span class="s2">  ),</span>
<span class="s2">  denominator AS (</span>
<span class="s2">    select sum( case </span>
<span class="s2">      when  (grade = &#39;9&#39; or grade = &#39;10&#39; or grade = &#39;11&#39; or grade = &#39;12&#39;) AND subject = &#39;Algebra II&#39;</span>
<span class="s2">        then 1 else 0</span>
<span class="s2">          end</span>
<span class="s2">    )::numeric as algebra1_testtakers, csa</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;schools.parcc_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">        left join schools.parcc_1617 b on a.gid = b.gid</span>
<span class="s2">          group by csa </span>
<span class="s2">            order by csa</span>
<span class="s2">  ),</span>
<span class="s2">  tbl AS (</span>
<span class="s2">    select vital_signs.div_zero (numerator.algebra1_met, denominator.algebra1_testtakers)*(100::numeric) as result, numerator.csa</span>
<span class="s2">      from numerator left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">  )</span>
<span class="s2">  select * from tbl</span>
<span class="s2">  &quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      when (grade = &#39;9&#39; or grade = &#39;10&#39; or grade = &#39;11&#39; or grade = &#39;12&#39;) AND subject = &#39;Algebra II&#39;</span>
<span class="sd">        AND (parcc_perf =4 OR parcc_perf = 5)</span>
<span class="sd">/</span>

<span class="sd">      when  (grade = &#39;9&#39; or grade = &#39;10&#39; or grade = &#39;11&#39; or grade = &#39;12&#39;) AND subject = &#39;Algebra II&#39;</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">palg2</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">csa</span><span class="p">,</span> <span class="n">yr</span><span class="p">):</span> 
  <span class="n">df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

  <span class="c1"># Create the Denominator</span>
  <span class="n">denom</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;enterdate&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="s1">&#39;std_number&#39;</span><span class="p">])</span> 
  <span class="n">denom</span> <span class="o">=</span> <span class="n">denom</span><span class="p">[</span> <span class="n">denom</span><span class="p">[</span><span class="s1">&#39;grade&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;9|10|11|12&#39;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="o">&amp;</span> <span class="p">(</span><span class="n">denom</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Algebra I&#39;</span><span class="p">)</span> <span class="p">]</span> 

  <span class="c1"># Create the Numerator </span>
  <span class="n">denom</span><span class="p">[</span><span class="s1">&#39;parcc_perf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">denom</span><span class="p">[</span><span class="s1">&#39;parcc_perf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
  <span class="n">numer</span> <span class="o">=</span> <span class="n">denom</span><span class="p">[</span> <span class="p">(</span> <span class="n">denom</span><span class="p">[</span><span class="s1">&#39;parcc_perf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;4|5&#39;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">)</span> <span class="p">]</span>

  <span class="nb">id</span> <span class="o">=</span> <span class="s1">&#39;213&#39;</span>
  <span class="n">shortname</span> <span class="o">=</span> <span class="s1">&#39;palg2&#39;</span>
  
  <span class="c1"># Group by CSA</span>
  <span class="n">numer</span> <span class="o">=</span> <span class="n">numer</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
  <span class="n">denom</span> <span class="o">=</span> <span class="n">denom</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 

  <span class="c1"># Make sure ALL csas and BaltimoreCity are included and sorted.</span>
  <span class="n">numer</span> <span class="o">=</span> <span class="n">csa</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span> <span class="n">numer</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span> <span class="p">)</span>
  <span class="n">denom</span> <span class="o">=</span> <span class="n">csa</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span> <span class="n">denom</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span> <span class="p">)</span>
  <span class="n">numer</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="s1">&#39;Shape__Length&#39;</span><span class="p">,</span><span class="s1">&#39;Shape__Area&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
  <span class="n">numer</span><span class="p">[</span><span class="s1">&#39;denomCount&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">denom</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>
  
  <span class="c1"># Do after sortViaCsaMerge to get index right. False records would show underneath it but still get added to the sum.</span>
  <span class="n">numer</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">55</span><span class="p">,</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">numer</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
  <span class="n">numer</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">55</span><span class="p">,</span><span class="s1">&#39;denomCount&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">numer</span><span class="p">[</span><span class="s1">&#39;denomCount&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

  <span class="c1"># Perform the calculation</span>
  <span class="n">numer</span><span class="p">[</span><span class="nb">id</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">shortname</span><span class="o">+</span><span class="n">year</span><span class="p">]</span> <span class="o">=</span> <span class="n">numer</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">numer</span><span class="p">[</span><span class="s1">&#39;denomCount&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>

  <span class="n">compareYears</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;https://services1.arcgis.com/mVFRs7NF4iFitgbY/ArcGIS/rest/services/&quot;</span><span class="o">+</span><span class="n">shortname</span><span class="o">+</span><span class="s2">&quot;/FeatureServer/0/query?where=1%3D1&amp;outFields=*&amp;returnGeometry=true&amp;f=pgeojson&quot;</span><span class="p">);</span>
  <span class="n">prevYear</span> <span class="o">=</span> <span class="n">shortname</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span> <span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">)</span>
  <span class="k">if</span> <span class="n">prevYear</span> <span class="ow">in</span> <span class="n">compareYears</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">numer</span> <span class="o">=</span> <span class="n">numer</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span> <span class="n">compareYears</span><span class="p">[[</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">,</span> <span class="n">prevYear</span><span class="p">]],</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span> <span class="p">)</span> 
    <span class="n">numer</span><span class="p">[</span><span class="s1">&#39;change&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">numer</span><span class="p">[</span><span class="nb">id</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">shortname</span><span class="o">+</span><span class="n">year</span><span class="p">]</span> <span class="o">-</span> <span class="n">numer</span><span class="p">[</span> <span class="n">prevYear</span> <span class="p">]</span>
    <span class="n">numer</span><span class="p">[</span><span class="s1">&#39;percentChange&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">numer</span><span class="p">[</span><span class="s1">&#39;change&#39;</span> <span class="p">]</span> <span class="o">/</span> <span class="n">numer</span><span class="p">[</span> <span class="n">prevYear</span> <span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">numer</span><span class="p">[</span><span class="s1">&#39;change&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">numer</span><span class="p">[</span><span class="s1">&#39;change&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;Records Matching Query: &#39;</span><span class="p">,</span> <span class="n">numer</span><span class="o">.</span><span class="n">size</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">numer</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="p">)</span>
  <span class="k">return</span> <span class="n">numer</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;daysattend&#39;</span><span class="p">,</span> <span class="s1">&#39;daysabsent&#39;</span><span class="p">,</span> <span class="s1">&#39;GENDER&#39;</span><span class="p">,</span> <span class="s1">&#39;race_AIAN&#39;</span><span class="p">,</span> <span class="s1">&#39;race_asian&#39;</span><span class="p">,</span> <span class="s1">&#39;race_AA&#39;</span><span class="p">,</span> <span class="s1">&#39;race_NHPI&#39;</span><span class="p">,</span> <span class="s1">&#39;race_white&#39;</span><span class="p">,</span> <span class="s1">&#39;std_number&#39;</span><span class="p">,</span> <span class="s1">&#39;enterdate&#39;</span><span class="p">])</span>


<span class="n">fin</span> <span class="o">=</span> <span class="n">palg2</span><span class="p">(</span><span class="n">bcpss</span><span class="p">,</span> <span class="n">csa</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;213-palg2&#39;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="214-kra---O-&#10060;">214 kra - O &#10060;<a class="anchor-link" href="#214-kra---O-&#10060;"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>std_number Demonstrating comp</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lbl</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; Kindergarten Readiness - Education and Youth - BCPSS&quot;&quot;&quot;</span>

<span class="n">desc</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;The Kindergarten Readiness Assessment (KRA) measure children’s readiness to do kindergarten work. </span>
<span class="s2">  The KRA is a developmentally appropriate assessment tool that measures of incoming public-school </span>
<span class="s2">  kindergarteners across four learning domains. A child is considered to be ready for kindergarten </span>
<span class="s2">  if assessed as “demonstrating” the foundational skills and behaviors that prepare him/her for </span>
<span class="s2">  curriculum based on the kindergarten standards. &quot;&quot;&quot;</span>

<span class="n">query16</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with numerator as (</span>
<span class="s2">    select csa, count ( DISTINCT std_numb_1 ) as test_met</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;schools.kra_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) as a</span>
<span class="s2">        left join schools.kra_2016 as b </span>
<span class="s2">          on a.gid = b.gid AND comp = &#39;Demonstrating&#39;</span>
<span class="s2">            group by csa</span>
<span class="s2">              order by csa</span>
<span class="s2">  ),</span>
<span class="s2">  denominator AS (</span>
<span class="s2">    select csa, count ( DISTINCT std_number ) test_takers</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;schools.kra_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) as a</span>
<span class="s2">        left join schools.kra_2016 as b </span>
<span class="s2">          on a.gid = b.gid AND comp NOT IN (&#39;Other&#39;, &#39;Incomplete&#39;)</span>
<span class="s2">            group by csa</span>
<span class="s2">              order by csa</span>
<span class="s2">  ),</span>
<span class="s2">  tbl AS (</span>
<span class="s2">    select vital_signs.div_zero (numerator.test_met, denominator.test_takers)*(100::numeric) </span>
<span class="s2">      as result, numerator.csa</span>
<span class="s2">      from numerator </span>
<span class="s2">        left join denominator </span>
<span class="s2">          on numerator.csa = denominator.csa</span>
<span class="s2">  )</span>
<span class="s2">  select * from tbl</span>
<span class="s2">  &quot;&quot;&quot;</span>

<span class="n">query17</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with numerator as (</span>
<span class="s2">    select csa, count ( DISTINCT std_number ) as test_met</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;schools.kra_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) as a</span>
<span class="s2">        left join schools.kra_1617 as b </span>
<span class="s2">          on a.gid = b.gid AND comp = &#39;Demonstrating&#39;</span>
<span class="s2">            group by csa</span>
<span class="s2">              order by csa</span>
<span class="s2">  ),</span>
<span class="s2">  denominator AS (</span>
<span class="s2">    select csa, count ( DISTINCT std_number ) test_takers</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;schools.kra_1617&#39;, &#39;gid&#39;, &#39;the_geom&#39;) as a</span>
<span class="s2">        left join schools.kra_1617 as b </span>
<span class="s2">          on a.gid = b.gid AND comp NOT IN (&#39;Other&#39;, &#39;Incomplete&#39;)</span>
<span class="s2">            group by csa</span>
<span class="s2">              order by csa</span>
<span class="s2">  ),</span>
<span class="s2">  tbl AS (</span>
<span class="s2">    select vital_signs.div_zero (numerator.test_met, denominator.test_takers)*(100::numeric) </span>
<span class="s2">      as result, numerator.csa</span>
<span class="s2">      from numerator </span>
<span class="s2">        left join denominator </span>
<span class="s2">          on numerator.csa = denominator.csa</span>
<span class="s2">  )</span>
<span class="s2">  select * from tbl</span>
<span class="s2">  &quot;&quot;&quot;</span>

<span class="n">uhmm</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">  The percentage of children whose composite score indicates full school readiness out of all </span>
<span class="s2">  kindergarten school children tested within an area in a school year. The Maryland Model for </span>
<span class="s2">  School Readiness (MMSR) is an assessment and instructional system that was designed to provide </span>
<span class="s2">  parents, teachers, and early childhood providers with a common understanding of what children </span>
<span class="s2">  know and are able to do upon entering school. Under the MMSR system, all children entering </span>
<span class="s2">  kindergarten are assessed for level of mastery across several learning domains. These domains </span>
<span class="s2">  include: social and personal development; language and literacy; mathematical thinking; </span>
<span class="s2">  scientific thinking; social studies; the arts; and physical development and health. </span>
<span class="s2">  Kindergarten  teachers must evaluate students during the first few months of the kindergarten </span>
<span class="s2">  year using selected Work Sampling System (WSS) indicators and report their ratings by the </span>
<span class="s2">  end of November of each year to the state. &quot;&quot;&quot;</span>

<span class="n">query2013</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">  &quot;-- mmsr13nbr_bcf</span>
<span class="s2">  --mmsr13 indicator number 80</span>
<span class="s2">  SELECT bAll.name AS Bound, sum(bQuery.mmsr13nbr) as mmsr13nbr</span>
<span class="s2">    FROM boundaries.bcf_areas bAll</span>
<span class="s2">      LEFT JOIN (</span>
<span class="s2">    SELECT bounds.name as Boundary, (count(DISTINCT b.sid::numeric(20,4))) as mmsr13nbr</span>
<span class="s2">    FROM schools.mmsr_2013 as b</span>
<span class="s2">      LEFT JOIN boundaries.bcf_areas as a</span>
<span class="s2">        ON ST_Contains(a.the_geom, b.the_geom)</span>
<span class="s2">      WHERE compscore = 3</span>
<span class="s2">        GROUP BY bounds.name</span>
<span class="s2">        ORDER BY bounds.name</span>
<span class="s2">  ) bQuery</span>
<span class="s2">    ON bAll.name = bQuery.Boundary</span>
<span class="s2">      GROUP BY Bound</span>
<span class="s2">      ORDER BY Bound;</span>

<span class="s2">  -- mmsr_total13nbr_bcf</span>
<span class="s2">  --mmsr13 indicator number 80</span>
<span class="s2">  SELECT bAll.name AS Bound, sum(bQuery.mmsr13nbr) as mmsr13nbr</span>
<span class="s2">    FROM boundaries.bcf_areas bAll</span>
<span class="s2">      LEFT JOIN (</span>
<span class="s2">        SELECT bounds.name as Boundary, (count(DISTINCT Tables.sid::numeric(20,4))) as mmsr13nbr</span>
<span class="s2">      FROM schools.mmsr_2013 as Tables</span>
<span class="s2">      LEFT JOIN boundaries.bcf_areas as bounds</span>
<span class="s2">        ON ST_Contains(bounds.the_geom, Tables.the_geom)</span>
<span class="s2">      GROUP BY bounds.name</span>
<span class="s2">        ORDER BY bounds.name</span>
<span class="s2">  ) bQuery</span>
<span class="s2">    ON bAll.name = bQuery.Boundary</span>
<span class="s2">      GROUP BY Bound</span>
<span class="s2">      ORDER BY Bound;</span>
<span class="s2">  &quot;&quot;&quot;</span> 

<span class="n">specialnote</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;2014 and 2015 does not exist for either kindergarden Indicator. These two years the tests were in the process of changing.&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">query17</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;with numerator = on a.gid = b.gid AND comp = &#39;Demonstrating&#39;</span>
<span class="s2">  denominator AS on a.gid = b.gid AND comp NOT IN (&#39;Other&#39;, &#39;Incomplete&#39;)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

