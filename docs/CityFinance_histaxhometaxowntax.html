---

title: Housing -> TaxCredits (BCDF) Data Intake and Operations


keywords: fastai
sidebar: home_sidebar

summary: "This notebook uses data to generate a portion of BNIA's Vital Signs report."
description: "This notebook uses data to generate a portion of BNIA's Vital Signs report."
nb_path: "notebooks/CityFinance_histaxhometaxowntax.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: notebooks/CityFinance_histaxhometaxowntax.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This colab and more can be found at <a href="https://github.com/BNIA/VitalSigns">https://github.com/BNIA/VitalSigns</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Whats-Inside?:">Whats Inside?:<a class="anchor-link" href="#Whats-Inside?:"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="https://bniajfi.org/indicators/Housing%20And%20Community%20Development/homtax">https://bniajfi.org/indicators/Housing%20And%20Community%20Development/homtax</a></p>
<p><a href="https://bniajfi.org/indicators/Housing%20And%20Community%20Development/histax">https://bniajfi.org/indicators/Housing%20And%20Community%20Development/histax</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Indicators-Used"><strong>Indicators Used</strong><a class="anchor-link" href="#Indicators-Used"> </a></h4><ul>
<li>✔️ 46 - <strong>histax</strong> - (MdProp, BCDF) Number of Historic Tax Credits per 1,000 Residential Units</li>
</ul>
<p>The number of residential properties that received the Historic Tax Credit per 1,000 residential properties within an area. The credit is granted on the increased assessment directly resulting from qualified improvements. The duration of the credit is for 10 years, and is applicable to properties located in designated areas of significant historical value.</p>
<ul>
<li>✔️ 47 - <strong>homtax</strong> - (MdProp, BCDF) Number of Homestead Tax Credits per 1,000 Residential Units</li>
</ul>
<p>The number of residential properties that received the homestead tax credit per 1,000 residential properties within an area. The Homestead Credit limits the increase in taxable assessments each year to a fixed percentage. Every county and municipality in Maryland is required to limit taxable assessment increases to 10% or less each year, with the Baltimore City rate capped at 4%.</p>
<p>❌</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Datasets-Used"><strong>Datasets Used</strong><a class="anchor-link" href="#Datasets-Used"> </a></h4><ul>
<li>✔️ housing.TaxCredits_201X <strong>(46-homtax, 47-owntax)</strong> From BidBaltimore</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">year</span> <span class="o">=</span> <span class="s2">&quot;20&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Import-Modules">Import Modules<a class="anchor-link" href="#Import-Modules"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">capture</span>
! pip install -U -q PyDrive
! pip install geopy
! pip install geopandas
! pip install geoplot
! pip install dataplay
! pip install matplotlib
! pip install psycopg2-binary
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">capture</span>
! apt-get install build-dep python-psycopg2
! apt-get install libpq-dev
! apt-get install libspatialindex-dev
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">capture</span>
!pip install rtree
!pip install dexplot
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">dataplay.geoms</span> <span class="kn">import</span> <span class="n">workWithGeometryData</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">capture</span> 
# These imports will handle everything
import os
import sys
import csv
import matplotlib.pyplot as plt
import numpy as np
import pandas as pd
import geopandas as gpd
from geopandas import GeoDataFrame
import psycopg2
import pyproj
from pyproj import Proj, transform
# conda install -c conda-forge proj4
from shapely.geometry import Point
from shapely import wkb
from shapely.wkt import loads
# https://pypi.org/project/geopy/
from geopy.geocoders import Nominatim

# In case file is KML, enable support
import fiona
fiona.drvsupport.supported_drivers[&#39;kml&#39;] = &#39;rw&#39;
fiona.drvsupport.supported_drivers[&#39;KML&#39;] = &#39;rw&#39;
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">clear_output</span>
<span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact</span><span class="p">,</span> <span class="n">interact_manual</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Configure-Enviornment">Configure Enviornment<a class="anchor-link" href="#Configure-Enviornment"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.expand_frame_repr&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.precision&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">IPython.core.interactiveshell</span> <span class="kn">import</span> <span class="n">InteractiveShell</span>
<span class="n">InteractiveShell</span><span class="o">.</span><span class="n">ast_node_interactivity</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span>

<span class="c1"># pd.set_option(&#39;display.expand_frame_repr&#39;, False)</span>
<span class="c1"># pd.set_option(&#39;display.precision&#39;, 2)</span>
<span class="c1"># pd.reset_option(&#39;max_colwidth&#39;)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;max_colwidth&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="c1"># pd.reset_option(&#39;max_colwidth&#39;)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">totalres</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;37-totalres-19.csv&quot;</span><span class="p">)</span>
<span class="c1"># totalres.set_index(&#39;CSA2010&#39;, inplace=True)</span>
<span class="n">totalres</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="HomesteadTax_FY20---BidBaltimore---NEW">HomesteadTax_FY20 - BidBaltimore - NEW<a class="anchor-link" href="#HomesteadTax_FY20---BidBaltimore---NEW"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ls</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">original</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;HomesteadTax_FY20&quot;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s2">&quot;_CSACity.shp&quot;</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">original</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span> <span class="s1">&#39;CSA&#39;</span><span class="p">:</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">,</span> <span class="s1">&#39;BaltCity&#39;</span><span class="p">:</span><span class="s1">&#39;InBaltimore&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">original</span><span class="p">[</span> <span class="n">original</span><span class="p">[</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span> <span class="o">|</span> <span class="n">original</span><span class="p">[</span><span class="s1">&#39;InBaltimore&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>  <span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;After filtering records where a CSA or Baltimore geo-code match Exists&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;All rows Before Filter: &#39;</span><span class="p">,</span> <span class="n">original</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span> <span class="c1"># rows, columns</span>
<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;# w BCity.isnull: &#39;</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">InBaltimore</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="p">);</span> <span class="n">bmorow</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span> <span class="n">df</span><span class="o">.</span><span class="n">CSA2010</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>  <span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;# w CSA2010.isnull: &#39;</span><span class="p">,</span> <span class="n">bmorow</span> <span class="p">);</span> <span class="n">csarow</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span> <span class="n">df</span><span class="o">.</span><span class="n">CSA2010</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>  <span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> 
<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;# w CSA2010.notnull: &#39;</span><span class="p">,</span> <span class="n">csarow</span> <span class="p">);</span> 
<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;# rows After Filter: &#39;</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;==&#39;</span><span class="p">,</span><span class="n">csarow</span><span class="p">,</span><span class="s1">&#39;+&#39;</span><span class="p">,</span><span class="n">bmorow</span><span class="p">,</span><span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="n">csarow</span> <span class="o">+</span> <span class="n">bmorow</span><span class="p">);</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">CSA2010</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">CSA2010</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;Baltimore City&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">homesteadTax</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">homesteadTax</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="HistoricTax_FY20xx---BidBaltimore---NEW">HistoricTax_FY20xx - BidBaltimore - NEW<a class="anchor-link" href="#HistoricTax_FY20xx---BidBaltimore---NEW"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ls</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">original</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;HistoricTax_FY20&quot;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s2">&quot;_CSACity.shp&quot;</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">original</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span> <span class="s1">&#39;CSA&#39;</span><span class="p">:</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">,</span> <span class="s1">&#39;BaltCity&#39;</span><span class="p">:</span><span class="s1">&#39;InBaltimore&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">original</span><span class="p">[</span> <span class="n">original</span><span class="p">[</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span> <span class="o">|</span> <span class="n">original</span><span class="p">[</span><span class="s1">&#39;InBaltimore&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>  <span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;After filtering records where a CSA or Baltimore geo-code match Exists&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;All rows Before Filter: &#39;</span><span class="p">,</span> <span class="n">original</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span> <span class="c1"># rows, columns</span>
<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;# w BCity.isnull: &#39;</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">InBaltimore</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="p">);</span> <span class="n">bmorow</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span> <span class="n">df</span><span class="o">.</span><span class="n">CSA2010</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>  <span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;# w CSA2010.isnull: &#39;</span><span class="p">,</span> <span class="n">bmorow</span> <span class="p">);</span> <span class="n">csarow</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span> <span class="n">df</span><span class="o">.</span><span class="n">CSA2010</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>  <span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> 
<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;# w CSA2010.notnull: &#39;</span><span class="p">,</span> <span class="n">csarow</span> <span class="p">);</span> 
<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;# rows After Filter: &#39;</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;==&#39;</span><span class="p">,</span><span class="n">csarow</span><span class="p">,</span><span class="s1">&#39;+&#39;</span><span class="p">,</span><span class="n">bmorow</span><span class="p">,</span><span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="n">csarow</span> <span class="o">+</span> <span class="n">bmorow</span><span class="p">);</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">CSA2010</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">CSA2010</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;Baltimore City&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">historicTax</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">historicTax</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="HistoricTax-46---(MdProp,-TaxSale)">HistoricTax 46 - (MdProp, TaxSale)<a class="anchor-link" href="#HistoricTax-46---(MdProp,-TaxSale)"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="https://bniajfi.org/indicators/Housing%20And%20Community%20Development/histax">https://bniajfi.org/indicators/Housing%20And%20Community%20Development/histax</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Above:2016Query. Beloew:2017Query</p>
<p>with numerator AS (
   select (sum(
   case 
   when csa_present
   then 1
   else NULL
   end)::numeric) as result, csa
   from vital_signs.match_csas_and_bc_by_geom('housing.historictax_fy2018', 'gid', 'the_geom') a
   left join housing.historictax_fy2018 b on a.gid = b.gid
   group by csa
   ),
   denominator AS (
    select (sum(
     case 
     when (address != $$NULL$$) AND (desclu = $$Apartments$$ OR desclu = $$Residential$$ OR desclu = $$Residential Commercial$$ OR desclu = $$Residential Condominium$$)
     then 1
     else NULL
     end)::numeric 
    ) as result, csa
    from vital_signs.match_csas_and_bc_by_geom('housing.mdprop_2017v2', 'gid', 'the_geom') a
    left join housing.mdprop_2017v2 b on a.gid = b.gid
    group by csa, the_pop
   ),
   tbl AS (
     select denominator.csa,(numerator.result / denominator.result)*(1000::numeric) as result 
     from numerator left join denominator on numerator.csa = denominator.csa
    )</p>
<p>select * from tbl where 1 = 1 ORDER BY csa ASC;</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">  with numerator AS (</span>
<span class="s2">   select (sum(</span>
<span class="s2">   case </span>
<span class="s2">   when csa_present</span>
<span class="s2">   then 1</span>
<span class="s2">   else NULL</span>
<span class="s2">   end)::numeric) as result, csa</span>
<span class="s2">   from vital_signs.match_csas_and_bc_by_geom(&#39;housing.historictax_fy2017&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">   left join housing.historictax_fy2017 b on a.gid = b.gid</span>
<span class="s2">   group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   denominator AS (</span>
<span class="s2">    select (sum(</span>
<span class="s2">     case </span>
<span class="s2">     when (address != $$NULL$$) AND (desclu = $$Apartments$$ OR desclu = $$Residential$$ OR desclu = $$Residential Commercial$$ OR desclu = $$Residential Condominium$$)</span>
<span class="s2">     then 1</span>
<span class="s2">     else NULL</span>
<span class="s2">     end)::numeric </span>
<span class="s2">    ) as result, csa</span>
<span class="s2">    from vital_signs.match_csas_and_bc_by_geom(&#39;housing.mdprop_2017&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">    left join housing.mdprop_2017 b on a.gid = b.gid</span>
<span class="s2">    group by csa, the_pop</span>
<span class="s2">   ),</span>
<span class="s2">   tbl AS (</span>
<span class="s2">     select denominator.csa,(numerator.result / denominator.result)*(1000::numeric) as result </span>
<span class="s2">     from numerator left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">    )</span>
<span class="s2">   update vital_signs.data</span>
<span class="s2">   set histax = result from tbl where data.csa = tbl.csa and data_year = &#39;2016&#39;;</span>
<span class="s2">  &quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">historicTax</span><span class="o">.</span><span class="n">columns</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">totalres</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;37-totalres-&quot;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s2">&quot;.csv&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">histax</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">totalres</span><span class="p">,</span> <span class="n">year</span><span class="p">):</span>
  <span class="n">histax</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
  <span class="c1"># Aggregate Numeric Values by Sum </span>
  <span class="n">histax</span><span class="p">[</span><span class="s1">&#39;histaxCount&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="n">histax</span> <span class="o">=</span> <span class="n">histax</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 

  <span class="c1"># Make sure ALL csas and BaltimoreCity are included. among other things</span>
  <span class="n">histax</span> <span class="o">=</span> <span class="n">totalres</span><span class="p">[</span> <span class="p">[</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">,</span><span class="s1">&#39;totalres&#39;</span><span class="o">+</span><span class="n">year</span><span class="p">]</span> <span class="p">]</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span> <span class="n">histax</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span> <span class="p">)</span> 

  <span class="c1"># Update the baltimore CSA.</span>
  <span class="n">histax</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">55</span><span class="p">,</span><span class="s1">&#39;histaxCount&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">histax</span><span class="p">[</span><span class="s1">&#39;histaxCount&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> 

  <span class="c1"># Create the Indicator</span>
  <span class="n">histax</span><span class="p">[</span><span class="s1">&#39;46-histax&#39;</span><span class="o">+</span><span class="n">year</span><span class="p">]</span> <span class="o">=</span> <span class="n">histax</span><span class="p">[</span><span class="s1">&#39;histaxCount&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">/</span> <span class="n">totalres</span><span class="p">[</span><span class="s1">&#39;totalres&#39;</span><span class="o">+</span><span class="n">year</span><span class="p">]</span>

  <span class="n">histax</span> <span class="o">=</span> <span class="n">histax</span><span class="p">[[</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">,</span> <span class="s1">&#39;histaxCount&#39;</span><span class="p">,</span> <span class="s1">&#39;46-histax&#39;</span><span class="o">+</span><span class="n">year</span><span class="p">,</span> <span class="s1">&#39;totalres&#39;</span><span class="o">+</span><span class="n">year</span> <span class="p">]]</span>
 
  <span class="n">compareYears</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;https://services1.arcgis.com/mVFRs7NF4iFitgbY/ArcGIS/rest/services/Histax/FeatureServer/0/query?where=1%3D1&amp;outFields=*&amp;returnGeometry=true&amp;f=pgeojson&quot;</span><span class="p">);</span>
  <span class="n">prevYear</span> <span class="o">=</span> <span class="s1">&#39;histax&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span> <span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">)</span>
  <span class="k">if</span> <span class="n">prevYear</span> <span class="ow">in</span> <span class="n">compareYears</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">histax</span> <span class="o">=</span> <span class="n">histax</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span> <span class="n">compareYears</span><span class="p">[[</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">,</span> <span class="n">prevYear</span><span class="p">]],</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span> <span class="p">)</span> 
    <span class="n">histax</span><span class="p">[</span><span class="s1">&#39;change&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">histax</span><span class="p">[</span><span class="s1">&#39;46-histax&#39;</span><span class="o">+</span><span class="n">year</span><span class="p">]</span> <span class="o">-</span> <span class="n">histax</span><span class="p">[</span> <span class="n">prevYear</span> <span class="p">]</span>
    <span class="n">histax</span><span class="p">[</span><span class="s1">&#39;percentChange&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">histax</span><span class="p">[</span><span class="s1">&#39;change&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">histax</span><span class="p">[</span> <span class="n">prevYear</span> <span class="p">]</span> <span class="o">*</span> <span class="mi">1000</span>
    <span class="n">histax</span><span class="p">[</span><span class="s1">&#39;change&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">histax</span><span class="p">[</span><span class="s1">&#39;change&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">histax</span> <span class="o">=</span> <span class="n">histax</span><span class="p">[[</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">,</span> <span class="s1">&#39;histaxCount&#39;</span><span class="p">,</span> <span class="s1">&#39;totalres19&#39;</span><span class="p">,</span> <span class="s1">&#39;histax18&#39;</span><span class="p">,</span> <span class="s1">&#39;40-histax19&#39;</span><span class="p">,</span> <span class="s1">&#39;percentChange&#39;</span><span class="p">,</span> <span class="s1">&#39;change&#39;</span><span class="p">]]</span>
    
  <span class="k">return</span> <span class="n">histax</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">histax</span> <span class="o">=</span> <span class="n">histax</span><span class="p">(</span> <span class="n">historicTax</span><span class="p">,</span> <span class="n">totalres</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>

<span class="n">histax</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
<span class="n">histax</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;46-histax&#39;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="HomesteadTax-47---(MdProp,-TaxSale)">HomesteadTax 47 - (MdProp, TaxSale)<a class="anchor-link" href="#HomesteadTax-47---(MdProp,-TaxSale)"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">  with numerator AS (</span>
<span class="s2">   select (sum(</span>
<span class="s2">   case </span>
<span class="s2">   when csa_present</span>
<span class="s2">   then 1</span>
<span class="s2">   else NULL</span>
<span class="s2">   end)::numeric) as result, csa</span>
<span class="s2">   from vital_signs.match_csas_and_bc_by_geom(&#39;housing.homesteadtax_fy2017&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">   left join housing.homesteadtax_fy2017 b on a.gid = b.gid</span>
<span class="s2">   group by csa</span>
<span class="s2">   ),</span>
<span class="s2">   denominator AS (</span>
<span class="s2">    select (sum(</span>
<span class="s2">     case </span>
<span class="s2">     when (address != $$NULL$$) AND (desclu = $$Apartments$$ OR desclu = $$Residential$$ OR desclu = $$Residential Commercial$$ OR desclu = $$Residential Condominium$$)</span>
<span class="s2">     then 1</span>
<span class="s2">     else NULL</span>
<span class="s2">     end)::numeric </span>
<span class="s2">    ) as result, csa</span>
<span class="s2">    from vital_signs.match_csas_and_bc_by_geom(&#39;housing.mdprop_2017&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">    left join housing.mdprop_2017 b on a.gid = b.gid</span>
<span class="s2">    group by csa, the_pop</span>
<span class="s2">   ),</span>
<span class="s2">   tbl AS (</span>
<span class="s2">     select denominator.csa,(numerator.result / denominator.result)*(1000::numeric) as result </span>
<span class="s2">     from numerator left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">    )</span>
<span class="s2">   update vital_signs.data</span>
<span class="s2">   set homtax = result from tbl where data.csa = tbl.csa and data_year = &#39;2016&#39;;</span>

<span class="s2">  Above:2016Query. Beloew:2017Query</span>


<span class="s2">  with numerator AS (</span>
<span class="s2">    select (sum(</span>
<span class="s2">    case </span>
<span class="s2">    when csa_present</span>
<span class="s2">    then 1</span>
<span class="s2">    else NULL</span>
<span class="s2">    end)::numeric) as result, csa</span>
<span class="s2">    from vital_signs.match_csas_and_bc_by_geom(&#39;housing.homesteadtax_fy2018&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">    left join housing.homesteadtax_fy2018 b on a.gid = b.gid</span>
<span class="s2">    group by csa</span>
<span class="s2">    ),</span>
<span class="s2">    denominator AS (</span>
<span class="s2">      select (sum(</span>
<span class="s2">      case </span>
<span class="s2">      when (address != $$NULL$$) AND (desclu = $$Apartments$$ OR desclu = $$Residential$$ OR desclu = $$Residential Commercial$$ OR desclu = $$Residential Condominium$$)</span>
<span class="s2">      then 1</span>
<span class="s2">      else NULL</span>
<span class="s2">      end)::numeric </span>
<span class="s2">      ) as result, csa</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;housing.mdprop_2017v2&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">      left join housing.mdprop_2017v2 b on a.gid = b.gid</span>
<span class="s2">      group by csa, the_pop</span>
<span class="s2">    ),</span>
<span class="s2">    tbl AS (</span>
<span class="s2">      select denominator.csa,(numerator.result / denominator.result)*(1000::numeric) as result </span>
<span class="s2">      from numerator left join denominator on numerator.csa = denominator.csa</span>
<span class="s2">      )</span>

<span class="s2">  select * from tbl where 1 = 1 ORDER BY csa ASC;</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">totalres</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;37-totalres-&quot;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s2">&quot;.csv&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">totalres</span><span class="o">.</span><span class="n">columns</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="homtax" class="doc_header"><code>homtax</code><a href="https://github.com/bnia/VitalSigns/tree/main/VitalSigns/cityfinance.py#L6" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>homtax</code>(<strong><code>df</code></strong>, <strong><code>totalres</code></strong>, <strong><code>year</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">homtax</span> <span class="o">=</span> <span class="n">homtax</span><span class="p">(</span> <span class="n">homesteadTax</span><span class="p">,</span> <span class="n">totalres</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>

<span class="n">homtax</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
<span class="n">homtax</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;47-homtax&#39;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="owntax-48">owntax 48<a class="anchor-link" href="#owntax-48"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Seema did it most recently</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>select (sum(
   case 
   when csa_present
   then 1
   else 0
   end)::numeric) as result, csa
   from vital_signs.match_csas_and_bc_by_geom('housing.homeownertax_2016', 'gid', 'the_geom') a
   left join housing.homeownertax_2016 b on a.gid = b.gid
   group by csa order by csa</p>
<p>WE ARE NOT USING THE QUERY OR THE DATA FROM THE QUERY</p>
<p>DATA WAS PROVIDED IN AN ALREADY AGGREGATED FORM</p>
<p>STARTING FROM 2016; WE Used to get it raw.</p>
<p>We do not get it raw for data confidentiality reasons (you would know how much people earn.)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>we don't have 2020 so i know it's 19. but just something to keep in our notes, that for dept of finance data the fiscal year is +1 on what we call it for VS</p>

</div>
</div>
</div>
</div>
 

