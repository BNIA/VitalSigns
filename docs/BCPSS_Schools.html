<!DOCTYPE HTML>

<!-- BEGIN html -->
<html lang="en-US">

<!-- BEGIN head -->
<head>
	<!-- Charset -->
    <meta charset="UTF-8">

	<!-- Description -->
    <meta name="description" content="BNIA - Baltimore Neighborhood Indicators Alliance, Providing reliable, actionable quality of life indicators for Baltimore’s neighborhoods">
	
	<!-- Keywords -->
	<meta name="keywords" content="BNIA - Baltimore Neighborhood Indicators Alliance, Providing reliable, actionable quality of life indicators for Baltimore’s neighborhoods">

	<!-- Author -->
	<meta name="author" content="BNIA &#8211; Baltimore Neighborhood Indicators Alliance">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
	
	<!-- RSS -->
	<link rel="alternate" type="application/rss+xml" title="BNIA &#8211; Baltimore Neighborhood Indicators Alliance RSS Feed" href="http://bniajfi.org/feed/" />
	<link rel="alternate" type="application/rss+xml" title="BNIA &#8211; Baltimore Neighborhood Indicators Alliance Comments Feed" href="http://bniajfi.org/comments/feed/" />
	
	<!-- Pingbacks -->
	<link rel="pingback" href="http://bniajfi.org/xmlrpc.php" />
	
	<!-- Favicon -->
		
	<!-- Title -->
	<title>
	BNIA &#8211; Baltimore Neighborhood Indicators Alliance	</title>
	
	<!-- Stylesheets -->
	<link rel="stylesheet" type="text/css" href="http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/style.css" />
	
    <!--[if lt IE 9]><script src="http://ie7-js.googlecode.com/svn/version/2.1(beta4)/IE9.js"></script><![endif]-->
	
		
	<!-- Theme Hook -->
	<script>(function(d, s, id){
				 var js, fjs = d.getElementsByTagName(s)[0];
				 if (d.getElementById(id)) {return;}
				 js = d.createElement(s); js.id = id;
				 js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.6";
				 fjs.parentNode.insertBefore(js, fjs);
			   }(document, 'script', 'facebook-jssdk'));</script><link rel='dns-prefetch' href='//platform.twitter.com' />
<link rel='dns-prefetch' href='//w.sharethis.com' />
<link rel='dns-prefetch' href='//ajax.googleapis.com' />
<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel='dns-prefetch' href='//maxcdn.bootstrapcdn.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="BNIA - Baltimore Neighborhood Indicators Alliance &raquo; Feed" href="http://bniajfi.org/feed/" />
<link rel="alternate" type="application/rss+xml" title="BNIA - Baltimore Neighborhood Indicators Alliance &raquo; Comments Feed" href="http://bniajfi.org/comments/feed/" />
<link rel="alternate" type="text/calendar" title="BNIA - Baltimore Neighborhood Indicators Alliance &raquo; iCal Feed" href="http://bniajfi.org/events/?ical=1" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.4\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.4\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/bniajfi.org\/wp-includes\/js\/wp-emoji-release.min.js?ver=2483f238954e7cae2cd4dcb43c59bf93"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55357,56692,8205,9792,65039],[55357,56692,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='login-with-ajax-css'  href='http://bniajfi.org/wp-content/plugins/login-with-ajax/widget/widget.css?ver=3.1.7' type='text/css' media='all' />
<link rel='stylesheet' id='wpa-css-css'  href='http://bniajfi.org/wp-content/plugins/wp-attachments/styles/0/wpa.css?ver=2483f238954e7cae2cd4dcb43c59bf93' type='text/css' media='all' />
<link rel='stylesheet' id='jquery-style-css'  href='http://bniajfi.org/wp-content/plugins/wordpress-creation-kit-pro/wordpress-creation-kit-api/assets/datepicker/datepicker.css?ver=2483f238954e7cae2cd4dcb43c59bf93' type='text/css' media='all' />
<link rel='stylesheet' id='wp-color-picker-css'  href='http://bniajfi.org/wp-admin/css/color-picker.min.css?ver=2483f238954e7cae2cd4dcb43c59bf93' type='text/css' media='all' />
<link rel='stylesheet' id='wck-colorpicker-style-css'  href='http://bniajfi.org/wp-content/plugins/wordpress-creation-kit-pro/wordpress-creation-kit-api/assets/colorpicker/colorpicker.css?ver=1.0' type='text/css' media='all' />
<link rel='stylesheet' id='tribe-common-skeleton-style-css'  href='http://bniajfi.org/wp-content/plugins/the-events-calendar/common/src/resources/css/common-skeleton.min.css?ver=4.12.5' type='text/css' media='all' />
<link rel='stylesheet' id='tribe-tooltip-css'  href='http://bniajfi.org/wp-content/plugins/the-events-calendar/common/src/resources/css/tooltip.min.css?ver=4.12.5' type='text/css' media='all' />
<link rel='stylesheet' id='default-css'  href='http://bniajfi.org/wp-content/plugins/ajax-wp-query-search-filter/classes/scripts/default.css?ver=all' type='text/css' media='all' />
<link rel='stylesheet' id='bbp-default-css'  href='http://bniajfi.org/wp-content/plugins/bbpress/templates/default/css/bbpress.css?ver=2.5.14-6684' type='text/css' media='screen' />
<link rel='stylesheet' id='bp-legacy-css-css'  href='http://bniajfi.org/wp-content/plugins/buddypress/bp-templates/bp-legacy/css/buddypress.min.css?ver=3.1.0' type='text/css' media='screen' />
<link rel='stylesheet' id='contact-form-7-css'  href='http://bniajfi.org/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=5.0.2' type='text/css' media='all' />
<link rel='stylesheet' id='ctf_styles-css'  href='http://bniajfi.org/wp-content/plugins/custom-twitter-feeds/css/ctf-styles.css?ver=1.2.9' type='text/css' media='all' />
<link rel='stylesheet' id='simple-share-buttons-adder-indie-css'  href='//fonts.googleapis.com/css?family=Indie+Flower&#038;ver=2483f238954e7cae2cd4dcb43c59bf93' type='text/css' media='all' />
<link rel='stylesheet' id='simple-share-buttons-adder-font-awesome-css'  href='//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css?ver=2483f238954e7cae2cd4dcb43c59bf93' type='text/css' media='all' />
<link rel='stylesheet' id='opensans-css'  href='http://fonts.googleapis.com/css?family=Open+Sans%3A400%2C600%2C700%2C800%2C300&#038;ver=2483f238954e7cae2cd4dcb43c59bf93' type='text/css' media='all' />
<link rel='stylesheet' id='opensanscondensed-css'  href='http://fonts.googleapis.com/css?family=Open+Sans+Condensed%3A700&#038;ver=2483f238954e7cae2cd4dcb43c59bf93' type='text/css' media='all' />
<link rel='stylesheet' id='reset-css'  href='http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/css/reset.css?ver=2483f238954e7cae2cd4dcb43c59bf93' type='text/css' media='all' />
<link rel='stylesheet' id='bootstrap-css'  href='http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/css/bootstrap.css?ver=2483f238954e7cae2cd4dcb43c59bf93' type='text/css' media='all' />
<link rel='stylesheet' id='main-css'  href='http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/css/main.css?ver=2483f238954e7cae2cd4dcb43c59bf93' type='text/css' media='all' />
<link rel='stylesheet' id='flexslider-css'  href='http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/css/flexslider.css?ver=2483f238954e7cae2cd4dcb43c59bf93' type='text/css' media='all' />
<link rel='stylesheet' id='prettyphoto-css'  href='http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/css/prettyPhoto.css?ver=2483f238954e7cae2cd4dcb43c59bf93' type='text/css' media='all' />
<link rel='stylesheet' id='youtube-channel-gallery-css'  href='http://bniajfi.org/wp-content/plugins/youtube-channel-gallery/styles.css?ver=2483f238954e7cae2cd4dcb43c59bf93' type='text/css' media='all' />
<link rel='stylesheet' id='jquery.magnific-popup-css'  href='http://bniajfi.org/wp-content/plugins/youtube-channel-gallery/magnific-popup.css?ver=2483f238954e7cae2cd4dcb43c59bf93' type='text/css' media='all' />
<link rel='stylesheet' id='rjqc-jqplot-css'  href='http://bniajfi.org/wp-content/plugins/rj-quickcharts/css/jquery.jqplot.min.css?ver=2483f238954e7cae2cd4dcb43c59bf93' type='text/css' media='all' />
<script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js?ver=2483f238954e7cae2cd4dcb43c59bf93'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var LWA = {"ajaxurl":"http:\/\/bniajfi.org\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script type='text/javascript' src='http://bniajfi.org/wp-content/plugins/login-with-ajax/widget/login-with-ajax.js?ver=3.1.7'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var BP_Confirm = {"are_you_sure":"Are you sure?"};
/* ]]> */
</script>
<script type='text/javascript' src='http://bniajfi.org/wp-content/plugins/buddypress/bp-core/js/confirm.min.js?ver=3.1.0'></script>
<script type='text/javascript' src='http://bniajfi.org/wp-content/plugins/buddypress/bp-core/js/widget-members.min.js?ver=3.1.0'></script>
<script type='text/javascript' src='http://bniajfi.org/wp-content/plugins/buddypress/bp-core/js/jquery-query.min.js?ver=3.1.0'></script>
<script type='text/javascript' src='http://bniajfi.org/wp-content/plugins/buddypress/bp-core/js/vendor/jquery-cookie.min.js?ver=3.1.0'></script>
<script type='text/javascript' src='http://bniajfi.org/wp-content/plugins/buddypress/bp-core/js/vendor/jquery-scroll-to.min.js?ver=3.1.0'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var BP_DTheme = {"accepted":"Accepted","close":"Close","comments":"comments","leave_group_confirm":"Are you sure you want to leave this group?","mark_as_fav":"Favorite","my_favs":"My Favorites","rejected":"Rejected","remove_fav":"Remove Favorite","show_all":"Show all","show_all_comments":"Show all comments for this thread","show_x_comments":"Show all comments (%d)","unsaved_changes":"Your profile has unsaved changes. If you leave the page, the changes will be lost.","view":"View"};
/* ]]> */
</script>
<script type='text/javascript' src='http://bniajfi.org/wp-content/plugins/buddypress/bp-templates/bp-legacy/js/buddypress.min.js?ver=3.1.0'></script>
<script type='text/javascript' src='https://platform.twitter.com/widgets.js?ver=2483f238954e7cae2cd4dcb43c59bf93'></script>
<script id='st_insights_js' type='text/javascript' src='http://w.sharethis.com/button/st_insights.js?publisher=4d48b7c5-0ae3-43d4-bfbe-3ff8c17a8ae6&#038;product=simpleshare'></script>
<script type='text/javascript' src='http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/js/jquery.tweet.js?ver=2483f238954e7cae2cd4dcb43c59bf93'></script>
<script type='text/javascript' src='http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/js/jquery.easing.1.3.js?ver=2483f238954e7cae2cd4dcb43c59bf93'></script>
<script type='text/javascript' src='http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/js/jquery.waitforimages.js?ver=2483f238954e7cae2cd4dcb43c59bf93'></script>
<script type='text/javascript' src='http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/js/bootstrap.js?ver=2483f238954e7cae2cd4dcb43c59bf93'></script>
<script type='text/javascript' src='http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/js/jquery.flexslider-min.js?ver=2483f238954e7cae2cd4dcb43c59bf93'></script>
<script type='text/javascript' src='http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/js/jquery.validate.min.js?ver=2483f238954e7cae2cd4dcb43c59bf93'></script>
<script type='text/javascript' src='http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/js/jquery.isotope.min.js?ver=2483f238954e7cae2cd4dcb43c59bf93'></script>
<script type='text/javascript' src='http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/js/main3.js?ver=2483f238954e7cae2cd4dcb43c59bf93'></script>
<script type='text/javascript' src='http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/js/jquery.redirectreg.js?ver=2483f238954e7cae2cd4dcb43c59bf93'></script>
<script type='text/javascript' src='http://bniajfi.org/wp-content/plugins/rj-quickcharts/js/min/rjqc-frontend-full.min.js?ver=2483f238954e7cae2cd4dcb43c59bf93'></script>
<link rel='https://api.w.org/' href='http://bniajfi.org/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://bniajfi.org/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://bniajfi.org/wp-includes/wlwmanifest.xml" /> 


	<script type="text/javascript">var ajaxurl = 'http://bniajfi.org/wp-admin/admin-ajax.php';</script>

<script>
var twitterWidgets;
!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];
  if(!d.getElementById(id)){
      js=d.createElement(s);
    js.id=id;js.src="//platform.twitter.com/widgets.js";
    fjs.parentNode.insertBefore(js,fjs);
  }}
  (document,"script","twitter-wjs");
  // twitterWidgets.onload = _ga.trackTwitter;
</script>
<meta name="tec-api-version" content="v1"><meta name="tec-api-origin" content="http://bniajfi.org"><link rel="https://theeventscalendar.com/" href="http://bniajfi.org/wp-json/tribe/events/v1/" />
<!-- Dynamic Widgets by QURL loaded - http://www.dynamic-widgets.com //-->
<script type="text/javascript">var wckAjaxurl = "https://bniajfi.org/wp-admin/admin-ajax.php";</script><link rel="me" href="https://twitter.com/bniajfi" /><meta name="twitter:partner" content="tfwp" />

		<style type="text/css" id="wp-custom-css">
			#nav { margin-top:0px; float:right; } 
#nav li { position:relative; display:inline-block; margin:0 4px; } 
#nav > li:last-child { margin-right:0px; }  
#nav li a { position:relative; display:block; padding:17px; min-width:40px; line-height: 18px; text-align:center; font-size:14px; z-index:300; }
#nav li a:hover, #nav li a.selected:hover, #nav li a.current { text-decoration:none;}

/* menu level 2 */
#nav ul { display:none; position:relative; width:160px; z-index:310; margin:0; position:absolute; top:35px; left:0; padding: 10px 0 0 0; background-image:url(https://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/img/background/nav-dropdown.png); background-position:18px 4px; background-repeat:no-repeat; background-color: #EEE;
box-shadow: 5px 5px 5px #888;}
#nav ul li { display:block; padding:0; margin:0; text-align:center;}
#nav ul li a { text-align:left; padding:10px 18px; font-size:12px; }
#nav ul li:first-child a { border-top:none; }
#nav ul li:last-child a { border-bottom:none; }

/* menu level 3 */
#nav ul ul { top:0; left:auto; right:-168px; padding:0px 0 0 8px; 
background:url(https://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/img/background/nav-dropdown-left.png) 1px 13px no-repeat; 
background-color: #EEE;
box-shadow: 5px 5px 5px #888;
z-index: 1;}

/* hyperlink in HeaderBlue */

#pTopic a {
	text-decoration: underline;
}

/*
#vsData img{
	visibility: hidden;
}
*/

#vsDownloads img {
	float: left;
	margin-left:5px !important;
	margin-right:10px !important;
	margin-top: 5px !important;
content:url("https://i.imgur.com/sGXFYtI.png");
	
}
/*
#vsDownloads img:hover{
content:url("https://i.imgur.com/S5F2d31.png")
}
*/
/* #vsTrends img{ visibility: hidden;}
*/

#vsGallery img {
	float: left;
	margin-left:5px !important;
	margin-right:10px !important;
	margin-top: 5px !important;
content:url("https://i.imgur.com/eaSw2du.png");
}

#divShare{
	display: none;
}

.span9 img{
	display: none;
}

.span9 h1{
	font-size: 28px !important;
	font-weight: 450;
}		</style>
	    <link href='http://fonts.googleapis.com/css?family=Lobster' rel='stylesheet' type='text/css'>
	<!-- <link href='../resources/rtable/responsive-tables.css' rel='stylesheet' type='text/css'> -->
	
<link rel="stylesheet" type="text/css" href="http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/css/bg_styles/default.css">	
    
	<style type="text/css">body {
background-image: none;
}
@media (max-width: 480px) {
.menu {
margin-top: -180px;
}
}
header {
background-color: #FFFFFF;
max-height: 180px;
}
h2 {
border-bottom: 1px solid #FF5D00;
background-image: none !important;
border-color: #FF5D00 !important;
}
#logo {
padding-bottom: 0px;
}
#nav li a {
color: #007db6;
font-family: Open Sans, sans-serif;
font-weight: 600;
font-size: 14px;
text-transform: uppercase;
}
#nav {
float: left;
margin-left: 0;
}
#logo p {
color: #FFF;
font-size: 10px;
font-weight: 700;
margin: -10px 0 7px 0;
}
.header-wrap {
padding-bottom: 15px;
background-color: #007db6;
background-image: none;}
.tab-content > .tab-pane, .pill-content > .pill-pane {
padding: 0;
}
.nav-tabs > .active > a, .nav-tabs > .active > a:hover {
color: #FFFFFF;
font-weight: 600;
}
.accordion-group.active .accordion-heading .accordion-toggle, .accordion-group .accordion-heading .accordion-toggle:hover, .accordion-group .accordion-heading .accordion-toggle, .nav-tabs > .active > a, .nav-tabs > .active > a:hover {
color: #007db6;
font-size: 14px;
}
.headerBlue {
color: #007db6;
}
.social {
margin: 10px 0 -15px 0;
}
.nav {
margin-bottom: -5px;
margin-left: 4px;
}
@media all and (max-width: 770px) {
    .txtLogo { display: none; }
}
#nav ul li a {
color: #007db6;
text-shadow: none;
font-size: 11px;
}
.accordion-group.active .accordion-heading .accordion-toggle, .accordion-group .accordion-heading .accordion-toggle:hover, .accordion-group .accordion-heading .accordion-toggle, .nav-tabs > .active > a, .nav-tabs >
 .active > a:hover {
background-color: #FFFFFF;
}
.polaroid {
padding: 4px;
line-height: 1.42857143;
background-color: #fff;
border: 1px solid #ddd;
border-radius: 4px;
-webkit-transition: all .2s ease-in-out;
transition: all .2s ease-in-out;
display: inline-block;
max-width: 100%;
}
.tab-content > .active, .pill-content > .active {
padding: 4px;
line-height: 1.42857143;
background-color: #fff;
border: 1px solid #ddd;
border-radius: 4px;
-webkit-transition: all .2s ease-in-out;
transition: all .2s ease-in-out;
display: inline-block;
max-width: 100%;
}
#comInfo {
background: white;
background: rgba(255,255,255,0.8);
box-shadow: 0 0 15px rgba(0,0,0,0.2);
border-radius: 5px;
position: relative;
z-index: 9999;
}
#comInner {
opacity:0.6;
filter:alpha(opacity=60); /* For IE8 and earlier */
}
#comNew {
height: 45px;
width: 275px;
position: absolute;
background-color: #FFFFFF;
bottom: 0;
z-index: 1000;
background: rgba(255,255,255,0.8);
box-shadow: 0 0 15px rgba(0,0,0,0.2);
border-radius: 5px;
}
h3 b {
color: #FF5D00 !important;
}
footer {
background-color: #007db6;
}
.polaroid {
padding: 4px;
line-height: 1.42857143;
background-color: #fff;
border: 1px solid #ddd;
border-radius: 4px;
-webkit-transition: all .2s ease-in-out;
transition: all .2s ease-in-out;
display: inline-block;
max-width: 100%;
}
.tab-content > .active, .pill-content > .active {
padding: 4px;
padding-right: 45px;
line-height: 1.42857143;
background-color: #fff;
border: 1px solid #ddd;
border-radius: 4px;
-webkit-transition: all .2s ease-in-out;
transition: all .2s ease-in-out;
display: inline-block;
max-width: 100%;
width: 95%;
}
#comInfo {
background: white;
background: rgba(255,255,255,0.8);
box-shadow: 0 0 15px rgba(0,0,0,0.2);
border-radius: 5px;
position: relative;
z-index: 9999;
}
#comInner {
opacity:0.6;
filter:alpha(opacity=60); /* For IE8 and earlier */
}
#comNew {
height: 45px;
width: 275px;
position: absolute;
background-color: #FFFFFF;
bottom: 0;
z-index: 1000;
background: rgba(255,255,255,0.8);
box-shadow: 0 0 15px rgba(0,0,0,0.2);
border-radius: 5px;
}
#comSearch {
position: absolute;
background-color: #FFFFFF;
z-index: 1000;
background: rgba(255,255,255,0.8);
box-shadow: 0 0 15px rgba(0,0,0,0.2);
border-radius: 5px;
right: 15px;
top: 10px;
}
.txtLogo {
color: #FFFFFF;
margin: 0;
padding: 0;
line-height: 1;
font-size: 14px;
}
#tLogo {
margin-top: 20px;
}
#boldSlogan {
font-weight: 800;
}
#tLogo {
margin-left: 0;
}
#imgSlogan {
margin-top: 70px;
}
#containLogo {

}
@media all and (max-width: 770px) {
    #imgSlogan { margin-top: 2px; }
    #containLogo { margin-bottom: 0px; }
    #tLogo { margin-top: 0px; }
     .header-wrap { max-height: 310px; }
     .header { max-height: 310px; }
     .menu {margin-top: -175px; }
}
#scrollable-dropdown-menu .tt-dropdown-menu {
  max-height: 150px;
  overflow-y: auto;
  width: 400px;
}

.tt-menu {
	background-color: rgb(255,255,255);
	border: 1px solid #CCC;
	margin-top: -10px;
}
.tt-suggestion {
	border-bottom: 1px solid #CCC;
	cursor: pointer;
}
.typeahead {
	width: 360px;
}</style>	
<!-- END head -->
</head>

<!-- BEGIN body -->
<body class="bp-legacy tribe-no-js no-js">
        <!-- ************************** HEADER -->
		<div class="span12" style="width: 100%; margin-left: 0;">
        <header class="header row clearfix">
			
            <div class="header-wrap">
			
			    <!-- ************************** CONTAINER -->
				
				<div id="containLogo" class="container" style="">
                <div class="row">
				
                    <!-- ************************** LOGO -->
                    <div id="logo" class="span2">
		
					<a href="http://bniajfi.org/"><img src="http://bniajfi.org/wp-content/uploads/2021/02/bnia_logo_new.png" alt="BNIA - Baltimore Neighborhood Indicators Alliance"></a>					
                    </div>
					
					<div id="tLogo" class="span5">
						<img id="imgSlogan" alt="Baltimore Neighborhood Indicators Alliance" src="https://bniajfi.org/wp-content/uploads/2021/02/bnia_text.png"/>					
					</div>
					
                    <!-- ************************** end LOGO -->
                    
                 
					
					<div class="span5" style="margin-top: 20px;">
						<form method="get" action="http://bniajfi.org/" style="float: right;display: inline; margin-bottom: 0;">
							<div class="input-append">
								<input type="text" id="headerSearchText" name="s" size="16" class="span3" placeholder="Enter keywords to search..." value="" style="outline: none; min-width: 250px;">
								<input type="submit" id="" class="send" value="Go" style="outline: none;">
							  </div>
						</form>
						<ul class="social" style="float: right; margin-top: 0px;">
							<li><a target="_blank" class="facebook" href="http://www.facebook.com/bniajfi/">Facebook</a></li>
							<li><a target="_blank" class="twitter" href="http://www.twitter.com/bniajfi/">Twitter</a></li>
							<li><a target="_blank" class="youtube" href="http://www.youtube.com/bniajfi">YouTube</a></li>
							<li><a target="_blank" class="rss" href="/feed/">RSS</a></li>
						</ul>
					
						<a href="http://www.ubalt.edu" target="_blank" title="University of Baltimore"><img src="https://www.ubalt.edu/_resources/images/ub-logo-big.svg" style="height: 55px; width: 160px; float: right; margin-top: -10px; margin-right: -15px"/></a>
					</div>
					
                </div>
                <!-- end row -->
				
				
            </div>
			</div>
            <!-- end header-wrap -->
			<div class="container">
			 <!-- ************************** NAV -->
                    <nav class="span12" style="width: inherit;">
					
                        <!-- PRIMARY NAV -->
						<ul id="nav" class=""><li id="menu-item-428" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-428"><a href="http://bniajfi.org/vital_signs/">Vital Signs</a>
<ul class="sub-menu">
	<li id="menu-item-1088" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1088"><a href="http://bniajfi.org/vital_signs/">Explore Vital Signs 19</a></li>
	<li id="menu-item-434" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-434"><a href="http://bniajfi.org/vital_signs/fullreport/">Vital Signs – Full Report</a></li>
	<li id="menu-item-432" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-432"><a href="http://bniajfi.org/vital_signs/cprofiles/">Community Profiles</a></li>
	<li id="menu-item-3117" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3117"><a href="http://bniajfi.org/indicators/all">Indicators</a></li>
	<li id="menu-item-7417" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7417"><a target="_blank" href="https://vital-signs-bniajfi.hub.arcgis.com/">Vital Signs Open Data</a></li>
	<li id="menu-item-983" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-983"><a href="http://bniajfi.org/vital_signs/archives">Archives</a></li>
</ul>
</li>
<li id="menu-item-429" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-429"><a href="http://bniajfi.org/resources/">Resource Library</a>
<ul class="sub-menu">
	<li id="menu-item-480" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-480"><a href="http://bniajfi.org/bnia_projects/">BNIA Projects and Research</a>
	<ul class="sub-menu">
		<li id="menu-item-438" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-438"><a href="http://bniajfi.org/currentprojects/">Current Projects</a></li>
		<li id="menu-item-439" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-439"><a href="http://bniajfi.org/publications_and_research/">All Research</a></li>
	</ul>
</li>
	<li id="menu-item-440" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-440"><a href="http://bniajfi.org/mapgallery/">Map Gallery</a>
	<ul class="sub-menu">
		<li id="menu-item-441" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-441"><a href="http://bniajfi.org/mapping-resources/">Mapping Resources</a></li>
	</ul>
</li>
	<li id="menu-item-442" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-442"><a href="http://bniajfi.org/community_mapping/">Community Mapping</a>
	<ul class="sub-menu">
		<li id="menu-item-6686" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6686"><a href="http://bniajfi.org/currentprojects/cultural-mapping-tool/">GEOLOOM co>map: Cultural Mapping in Baltimore</a></li>
		<li id="menu-item-479" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-479"><a href="http://realestate.bniajfi.org">Real Estate Map</a></li>
		<li id="menu-item-477" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-477"><a href="http://foreclosures.bniajfi.org">Foreclosures Map</a></li>
		<li id="menu-item-478" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-478"><a href="https://bniajfi.org/greenpatterns/">Green Patterns</a></li>
	</ul>
</li>
	<li id="menu-item-11562" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-11562"><a href="http://bniajfi.org/community-guidepost/">Community Guidepost</a></li>
</ul>
</li>
<li id="menu-item-1994" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-1994"><a href="http://bniajfi.org/resources/learning-community/">Learning Community</a>
<ul class="sub-menu">
	<li id="menu-item-2002" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-2002"><a href="http://bniajfi.org/resources/learning-community/projects/">Projects</a>
	<ul class="sub-menu">
		<li id="menu-item-2003" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2003"><a href="http://bniajfi.org/resources/learning-community/add-project/">Add Your Project</a></li>
	</ul>
</li>
	<li id="menu-item-2007" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-2007"><a href="http://bniajfi.org/resources/learning-community/for-instructors/">For Instructors</a>
	<ul class="sub-menu">
		<li id="menu-item-2010" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2010"><a href="http://bniajfi.org/resources/learning-community/for-instructors/register-your-class/">Register Your Class</a></li>
	</ul>
</li>
	<li id="menu-item-2016" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2016"><a href="http://bniajfi.org/resources/learning-community/new-member/">Join Learning Community</a></li>
	<li id="menu-item-2013" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2013"><a href="http://bniajfi.org/resources/learning-community/discussion/">Discussion Forum</a></li>
</ul>
</li>
<li id="menu-item-944" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-944"><a href="http://bniajfi.org/news_events">News &#038; Events</a>
<ul class="sub-menu">
	<li id="menu-item-956" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-956"><a href="http://bniajfi.org/data_day/">Baltimore Data Day (Week)</a></li>
	<li id="menu-item-1084" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1084"><a href="http://bniajfi.org/bnia-in-the-news/">BNIA Data In The News</a></li>
</ul>
</li>
<li id="menu-item-430" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-430"><a href="http://bniajfi.org/about_bnia/">About BNIA</a>
<ul class="sub-menu">
	<li id="menu-item-449" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-449"><a href="http://bniajfi.org/history/">History and Mission</a></li>
	<li id="menu-item-450" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-450"><a href="http://bniajfi.org/staff/">Staff</a></li>
	<li id="menu-item-1085" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1085"><a href="http://bniajfi.org/donate/">Donate</a></li>
</ul>
</li>
<li id="menu-item-431" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-431"><a href="http://bniajfi.org/help_center/">Help Center</a>
<ul class="sub-menu">
	<li id="menu-item-1087" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1087"><a href="http://bniajfi.org/faqs/">Frequently Asked Questions (FAQs)</a></li>
	<li id="menu-item-1086" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1086"><a href="http://bniajfi.org/contact_us/">Contact Us</a></li>
	<li id="menu-item-12994" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-12994"><a href="http://bniajfi.org/stay-connected/">Stay Connected</a></li>
</ul>
</li>
</ul>                        <!-- end PRIMARY NAV -->
                        
						
                    </nav>
			</div>
        </header>
		</div>
        <!-- ************************** end HEADER -->
	<!-- ************************** CONTAINER -->
    <div class="container">
	 
                        <!-- ************************** MIDDLE --> <section class="middle row">
  <!-- ************************** SIDEBAR -->
  <aside class="span4 content sidebar">
    <!-- SEARCH - WIDGET -->
    <div class="search-widget clearfix">
      <span style="display: block;">Share </span><!-- Simple Share Buttons Adder (7.4.18) simplesharebuttons.com -->
      <div id="ssba-classic-2" class="ssba ssbp-wrap ssbp--theme-1">
        <div style="display: flex;">
          <a data-site="" class="ssba_facebook_share" href="https://www.facebook.com/sharer.php?u=http://bniajfi.org/data_day/" target="_blank">
            <img src="https://bniajfi.org/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/facebook.png" style="padding-right: 20px; width: 35px;" title="Facebook" class="ssba ssba-img" alt="Share on Facebook">
            <div title="Facebook" class="ssbp-text" style="display: none;">Facebook</div>
          </a>
          <a data-site="" class="ssba_twitter_share" href="https://twitter.com/share?url=http://bniajfi.org/data_day/&amp;text=Baltimore%20Data%20Day%20%28Week%29%20" target="&quot;_blank&quot;">
            <img src="https://bniajfi.org/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/twitter.png" style="padding-right: 20px; width: 35px;" title="Twitter" class="ssba ssba-img" alt="Tweet about this on Twitter">
            <div title="Twitter" class="ssbp-text" style="display: none;">Twitter</div>
          </a>
          <a data-site="linkedin" class="ssba_linkedin_share ssba_share_link" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http://bniajfi.org/data_day/" target="&quot;_blank&quot;">
            <img src="https://bniajfi.org/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/linkedin.png" style="padding-right: 20px; width: 35px;" title="LinkedIn" class="ssba ssba-img" alt="Share on LinkedIn">
            <div title="Linkedin" class="ssbp-text" style="display: none;">Linkedin</div>
          </a>
          <a data-site="email" class="ssba_email_share" href="mailto:?subject=Baltimore%20Data%20Day%20(Week)&amp;body=%20http://bniajfi.org/data_day/">
            <img src="https://bniajfi.org/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/email.png" style="width: 35px;" title="Email" class="ssba ssba-img" alt="Email this to someone">
            <div title="email" class="ssbp-text" style="display: none;">email</div>
          </a>
        </div>
      </div>
    </div>
    <!-- end SEARCH - WIDGET -->
    <!-- WIDGET -->
    <div class="widget clearfix" style="display: block; margin-top: 5px;">
      <h3>Data Day Events</h3>
      <p>There are no upcoming events at this time.</p>
    </div>
    <div class="widget clearfix" style="display: block; margin-top: 5px;">
      <h3>Site Navigation</h3>
      <div class="menu-newsnav-container">
        <ul id="menu-newsnav" class="menu">
          <li id="menu-item-1524" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-home current-menu-ancestor current_page_ancestor menu-item-has-children menu-item-1524">
            <a href="https://bniajfi.org/">Home</a>
            <ul class="sub-menu">
              <li id="menu-item-1528" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-1528">
                <a href="https://bniajfi.org/vital_signs/">Vital Signs 19</a>
                <ul class="sub-menu">
                  <li id="menu-item-1529" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1529"><a href="https://bniajfi.org/vital_signs/fullreport/">Vital Signs – Full Report</a></li>
                  <li id="menu-item-1532" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1532"><a href="https://bniajfi.org/vital_signs/cprofiles/">Community Profiles</a></li>
                  <li id="menu-item-1531" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1531"><a href="https://bniajfi.org/vital_signs/data_downloads/">Data Downloads</a></li>
                  <li id="menu-item-1530" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1530"><a href="https://bniajfi.org/vital_signs/archives/">Archives</a></li>
                </ul>
              </li>
  
            <li id="menu-item-1526" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-ancestor current-menu-parent current_page_parent current_page_ancestor menu-item-has-children menu-item-1526">
              <a href="https://bniajfi.org/news_events/">News &amp; Events</a>
              <ul class="sub-menu">
                <li id="menu-item-1527" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-109 current_page_item menu-item-1527"><a href="https://github.com/bnia/">All Repositories </a></li>
                <li id="menu-item-1527" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-109 current_page_item menu-item-1527"><a href="https://bniajfi.org/VitalSigns/">Vital Signs Scripts </a></li>
                <li id="menu-item-1527" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-109 current_page_item menu-item-1527"><a href="https://github.com/dataplay/">Dataplay Scripts</a></li>
                <li id="menu-item-1527" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-109 current_page_item menu-item-1527"><a href="https://github.com/dataguide/">Data Handling Guidebook</a></li>
                <li id="menu-item-1527" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-109 current_page_item menu-item-1527"><a href="https://github.com/datalabs/">Data Laboratories</a></li>
              </ul>
            </li>

            </ul>
          </li>
        </ul>
      </div>
    </div>
    <!-- end WIDGET -->
    <!-- WIDGET -->
    <!-- end WIDGET -->
    <!-- WIDGET -->
    <!-- end WIDGET -->
  </aside>
  <!-- ************************** end SIDEBAR -->
  <!-- ************************** CONTENT -->
  <div class="span8 content">
  <!-- end WIDGET -->
  <!-- WIDGET -->
  <!-- end WIDGET -->
  <!-- WIDGET -->
  <!-- end WIDGET -->
  </aside>
  <!-- ************************** end SIDEBAR -->
    <div class="span8 content"> <!-- PAGE HEADER --> <div class="page-header"><h1><b>BCPSS_Schools</b><small></small></h1></div> <!-- end PAGE HEADER --># default_exp BCPSS<p>This colab and more can be found at https://github.com/BNIA/vitalsigns.</p>
"""
SchoolSwitcherFlag

 
Frequency
Percent
Valid Percent
Cumulative Percent

0 = Duplicate
1 = ??
2 = School Switcher
3 = Grade Switcher (same school--so effectively a duplicate)
4 = Primary Record
"""<h2>Whats Inside?:</h2>
<h3><strong>The Guided Walkthrough</strong></h3>
<p>This notebook was made to create the following Vital Signs Indicators:</p>
<h4><strong>Indicators Used</strong></h4>
<ul>
<li>✅ 66 <strong>eattend</strong> - (BCPSS)</li>
<li>✅ 67 <strong>mattend</strong> - (BCPSS)</li>
<li>✅ 68 <strong>hsattend</strong> - (BCPSS)</li>
<li>✅ 70 <strong>aastud</strong> - (BCPSS)</li>
<li>✅ 71 <strong>wstud</strong> - (BCPSS)</li>
<li>✅ 72 <strong>hstud</strong> - (BCPSS)</li>
<li>✅ 73 <strong>abse</strong> - (BCPSS)</li>
<li>✅ 74 <strong>absmd</strong> - (BCPSS)</li>
<li>✅ 75 <strong>abshs</strong> - (BCPSS)</li>
<li>✅ 91 <strong>drop</strong> - (BCPSS)</li>
<li>✅ 92 <strong>compl</strong> - (BCPSS)</li>
<li>~❌ 94 <strong>sclsw</strong> - (BCPSS)</li>
<li>✅ 195 <strong>eenrol</strong> - (BCPSS)</li>
<li>✅ 196 <strong>menrol</strong> - (BCPSS)</li>
<li>✅ 197 <strong>hsenrol</strong> - (BCPSS)</li>
<li>❌ 206 <strong>pmath3</strong> - (BCPSS)</li>
<li>❌ 207 <strong>pread3</strong> - (BCPSS)</li>
<li>❌ 208 <strong>pmath5</strong> - (BCPSS)</li>
<li>❌ 209 <strong>pread5</strong> - (BCPSS)</li>
<li>❌ 210 <strong>pmath8</strong> - (BCPSS)</li>
<li>❌ 211 <strong>pread8</strong> - (BCPSS)</li>
<li>✅ 212 <strong>palg1</strong> - (BCPSS)</li>
<li>✅ 213 <strong>palg2</strong> - (BCPSS)</li>
<li>~❌ 214 <strong>kra</strong> - (BCPSS)</li>
</ul>
<h4><strong>Datasets Used</strong></h4>
<ul>
<li>✅ Schools.BCPSS_201X <strong>(66-eattend, 67-mattend -&gt;  grade )</strong></li>
</ul>
year = '19'<h1>Guided Walkthrough</h1>
<h2>SETUP Enviornment:</h2>
<h3>Import Modules</h3>
! pip install -U -q PyDrive
! pip install geopy
! pip install geopandas
! pip install geoplot
! pip install dataplay
! pip install matplotlib
! pip install psycopg2-binary! apt-get install build-dep python-psycopg2
! apt-get install libpq-dev
! apt-get install libspatialindex-dev!pip install rtree
!pip install dexplotfrom dataplay.geoms import workWithGeometryData%%capture 
# These imports will handle everything
import os
import sys
import csv
import matplotlib.pyplot as plt
import numpy as np
import pandas as pd
import geopandas as gpd
from geopandas import GeoDataFrame
import psycopg2
import pyproj
from pyproj import Proj, transform
# conda install -c conda-forge proj4
from shapely.geometry import Point
from shapely import wkb
from shapely.wkt import loads
# https://pypi.org/project/geopy/
from geopy.geocoders import Nominatim

# In case file is KML, enable support
import fiona
fiona.drvsupport.supported_drivers['kml'] = 'rw'
fiona.drvsupport.supported_drivers['KML'] = 'rw'from IPython.display import clear_output
clear_output(wait=True)import ipywidgets as widgets
from ipywidgets import interact, interact_manual<h3>Configure Enviornment</h3>
# This will just beautify the output

pd.set_option('display.expand_frame_repr', False)
pd.set_option('display.precision', 2)
from IPython.core.interactiveshell import InteractiveShell
InteractiveShell.ast_node_interactivity = "all"

# pd.set_option('display.expand_frame_repr', False)
# pd.set_option('display.precision', 2)
# pd.reset_option('max_colwidth')
pd.set_option('max_colwidth', 20)
# pd.reset_option('max_colwidth')<h2>Prep Datasets</h2>
<h4>TPOP CSA and Baltimore</h4>
<p>Get Baltimore</p>
<details > <summary>Click to toggle</summary> csa = "https://services1.arcgis.com/mVFRs7NF4iFitgbY/ArcGIS/rest/services/Tpop/FeatureServer/0/query?where=1%3D1&outFields=*&returnGeometry=true&f=pgeojson"
csa = gpd.read_file(csa);
csa.head(1)</details><p>Get CSA</p>
url2 = "https://services1.arcgis.com/mVFRs7NF4iFitgbY/ArcGIS/rest/services/Tpop/FeatureServer/1/query?where=1%3D1&outFields=*&returnGeometry=true&f=pgeojson"
csa2 = gpd.read_file(url2);
csa2['CSA2010'] = csa2['City_1'] 
csa2['OBJECTID'] = 56 
csa2 = csa2.drop(columns=['City_1'])
csa2.head()<p>Append do no append Bcity. We put it on the Bottom of the df because when performing the ponp it returns only the last matching columns CSA Label. </p>
# csa = pd.concat([csa2, csa], ignore_index=True)
csa = csa.append(csa2).reset_index(drop=True)csa.head(3)csa.tail(3)csa.drop(columns=['Shape__Area', 'Shape__Length', 'OBJECTID'], axis=1).to_file("BCity_and_CSA.geojson", driver='GeoJSON')csa.head()<h3>BCPSS</h3>
import pandas as pd
import geopandas 
# original = gpd.read_file("BCPSS_20"+year+"_CSACity.shp", geometry='geometry');
original = pd.read_csv("BCPSS_20"+year+"_CSACity_dbf_to_csv.csv");
original.columns original.head()original.rename(columns={ 'csa':'CSA2010', 'BaltCity':'InBaltimore'}, inplace=True)
df = original[ original['CSA2010'].notnull() | original['InBaltimore'].notnull()  ]df.head(1)print('After filtering records where a CSA or Baltimore geo-code match Exists')
print( 'All rows Before Filter: ', original.shape[0] ) # rows, columns
print( '# w BCity.isnull: ', df.InBaltimore.isnull().sum() ); bmorow = df[ df.CSA2010.isnull()  ].shape[0]
print( '# w CSA2010.isnull: ', bmorow ); csarow = df[ df.CSA2010.notnull()  ].shape[0] 
print( '# w CSA2010.notnull: ', csarow ); 
print( '# rows After Filter: ', df.shape[0],'==',csarow,'+',bmorow,'==', csarow + bmorow); df[df['CSA2010'] == ' ']['InBaltimore'].unique()df = df[df['CSA2010'] != ' '] #['InBaltimore'] # .unique()# add baltimore city
df.CSA2010 = df.CSA2010.fillna('Baltimore City')df['CSA2010'].head()bcpssTemp = df.copy()
bcpssTemp.head(1)
bcpssTemp = bcpssTemp[['CSA2010','SchoolSwitcherFlag', 'EnrollmentFlag', 'daysattend', 'daysabsent', 'grade', 'wleavecode', 'hispani_la', 'race_AIAN', 'race_asian', 'race_AA', 'race_NHPI', 'race_white', 'std_number', 'enterdate']]
bcpssTemp['grade']= bcpssTemp['grade'].map(str)
bcpssTemp.head(1)bcpssTemp[bcpssTemp['SchoolSwitcherFlag'] == 0].shape[0] # 0 = DuplicatebcpssTemp[bcpssTemp['SchoolSwitcherFlag'] == 1].shape[0]bcpssTemp[bcpssTemp['SchoolSwitcherFlag'] == 2].shape[0]bcpssTemp[bcpssTemp['SchoolSwitcherFlag'] == 3].shape[0]bcpssTemp[bcpssTemp['SchoolSwitcherFlag'] == 4].shape[0]<p>School switcher records 0 1 3 and 4 all together make a difference here because we do not dedup on enterdate for each student like we do on the other queries.</p>
<p>We want to know if students come in and out of enrollment multiple times</p>
<p>Create the School Switchers Dataset</p>
schoolSwitchersDF = bcpssTemp[bcpssTemp['SchoolSwitcherFlag'] == 2] # 2 = School Switcher<p>Create the Enrollment Dataset</p>
enrollment = bcpssTemp[ (bcpssTemp['EnrollmentFlag'] == 1 ) & 
                  ( (bcpssTemp['SchoolSwitcherFlag'] == 4) | (bcpssTemp['SchoolSwitcherFlag'] == 3) | 
                    (bcpssTemp['SchoolSwitcherFlag'] == 1) | (bcpssTemp['SchoolSwitcherFlag'] == 0) 
                  ) 
                ]bcpss = bcpssTemp[ ( (bcpssTemp['SchoolSwitcherFlag'] == 4) | (bcpssTemp['SchoolSwitcherFlag'] == 3) | 
                    (bcpssTemp['SchoolSwitcherFlag'] == 1) | (bcpssTemp['SchoolSwitcherFlag'] == 0) 
                  ) ]schoolSwitchersDF.shape[0]enrollment.shape[0]bcpss.shape[0]<h2>Indicators:</h2>
<h3>66 eattend - G - No Drop Dupes</h3>
<p>Who was in the classroom at any point in the year</p>
lbl = """ BCPSS - Education and Youth - Number of Students Ever Attended 1st - 5th Grade """

query16 = """with tbl AS (
     select (sum(
  case 
  when (daysattend > 1) AND (grade = '1' OR grade = '2' OR grade = '3' OR grade = '4' OR grade = '5')
  then 1
  else 0
  end)::numeric 
 ) as result, csa
 from vital_signs.match_csas_and_bc_by_geom('schools.afile_2016', 'gid', 'the_geom') a
 left join schools.afile_2016 b on a.gid = b.gid
 group by csa
     )
     update vital_signs.data
     set eattend = result from tbl where data.csa = tbl.csa and data_year = '2016';
  """

OLD17Query = """with tbl AS (
     select (sum(
  case 
  when (daysattend > 1) AND (grade = '1' OR grade = '2' OR grade = '3' OR grade = '4' OR grade = '5')
  then 1
  else 0
  end)::numeric 
 ) as result, csa
 from vital_signs.match_csas_and_bc_by_geom('schools.afile_1617', 'gid', 'the_geom') a
 left join schools.afile_1617 b on a.gid = b.gid
 group by csa
     )
  select * from tbl where 1 = 1 ORDER BY csa ASC;
 """

NEW17Query = """with tbl AS (
  -- What we want
  select count(*) as result, csa
  -- CSA
    from vital_signs.match_csas_and_bc_by_geom('schools.afile_1617', 'gid', 'the_geom') a
      left join schools.afile_1617 b on a.gid = b.gid
  -- RESULT
  where daysattend > 1 AND grade in ('1', '2', '3', '4', '5') AND (std_number, enterdate) in 
    ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )
      group by csa
  )
  select * from tbl where 1 = 1 ORDER BY csa ASC;
  """

simplifiedQuery = """
  daysattend > 1 AND 
  grade in ('1', '2', '3', '4', '5') AND 
  (std_number, enterdate) in ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )
  """

# The way the script goes, for every record it will it will take the entire dataset perform a group on it using std_number, 
# then return  on std and max(enterdate) for each std_number and compare each and every to the current record's std_num and and enterdate.
# If any is a match, this one part of the filter succedes for the current record. And then in does this for the next record. 
hard = """(std_number, enterdate) in ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )"""
# A simpler way would be to sort by enterdate and then remove duplicates on std_number leaving only the most recent enterdate for each unique std_num. 
easy = """df.sort_values('enterdate', ascending=False).drop_duplicates(['std_number'])"""
#export
def eattend(df, csa, yr): 

  # Create the Numerator
  eattend = df.copy()
  eattend = eattend[ eattend['grade'].str.contains('^1$|^2$|^3$|^4$|^5$', regex=True)  & (eattend['daysattend'] > 1) ]

  eattend['count'] = 1
  eattend = eattend.groupby('CSA2010').sum(numeric_only=True) 

  # Make sure ALL csas and BaltimoreCity are included and sorted.
  eattend = csa.merge( eattend, left_on='CSA2010', right_on='CSA2010', how='outer' )  
  eattend.drop( columns=['geometry', 'Shape__Length','Shape__Area'], inplace=True)
  # Baltimoire has records not in the 
  eattend.at[55,'count']=eattend['count'].sum()
  # Perform the calculation
  eattend['66-eattend'+year] = eattend['count']

  compareYears = gpd.read_file("https://services1.arcgis.com/mVFRs7NF4iFitgbY/ArcGIS/rest/services/Eattend/FeatureServer/0/query?where=1%3D1&outFields=*&returnGeometry=true&f=pgeojson");
  goback = 2 if year == '19' else 3
  prevYear = 'eattend'+ str( int(year) - goback )
  if prevYear in compareYears.columns:
    eattend = eattend.merge( compareYears[['CSA2010', prevYear]], left_on='CSA2010', right_on='CSA2010', how='outer' ) 
    eattend['change'] = eattend['66-eattend'+year] - eattend[ prevYear ]
    eattend['percentChange'] = eattend['change' ] / eattend[ prevYear ] * 100
    eattend['change'] = eattend['change'].apply(lambda x: "{:.2f}".format(x) )
  print( 'Records Matching Query: ', eattend.size / len(eattend.columns) )
  return eattend.drop(columns=['daysattend', 'SchoolSwitcherFlag', 'wleavecode', 'daysabsent', 'race_AIAN', 'race_asian', 'race_AA', 'race_NHPI', 'race_white', 'std_number', 'enterdate'])fin = eattend(bcpss, csa, year)
fin.to_csv('66-eattend'+year+'.csv', index=False)
fin.tail(6)<h3>67 mattend - G - No Drop Dupes</h3>
lbl = """BCPSS - Education and Youth - Number of Students Ever Attended 6th - 8th Grade """

query16 = """with tbl AS (
      select (sum(
    case 
    when (daysattend > 1) AND ( grade =6 OR  grade = 7 OR  grade = 8)
    then 1
    else 0
    end)::numeric 
  ) as result, csa
  from vital_signs.match_csas_and_bc_by_geom('schools.afile_2016', 'gid', 'the_geom') a
  left join schools.afile_2016 b on a.gid = b.gid
  group by csa
      )
      update vital_signs.data
      set mattend = result from tbl where data.csa = tbl.csa and data_year = '2016';
  """

OLD17Query = """ with tbl AS (
      select (sum(
    case 
    when (daysattend > 1) AND (grade = '6' OR grade = '7' OR grade = '8')
    then 1
    else 0
    end)::numeric 
  ) as result, csa
  from vital_signs.match_csas_and_bc_by_geom('schools.afile_1617', 'gid', 'the_geom') a
  left join schools.afile_1617 b on a.gid = b.gid
  group by csa
      )
  select * from tbl where 1 = 1 ORDER BY csa ASC;
  """

NEW17Query = """ select count(*) as result, csa
      from vital_signs.match_csas_and_bc_by_geom('schools.afile_1617', 'gid', 'the_geom') a
        left join schools.afile_1617 b on a.gid = b.gid
    where daysattend > 1 AND grade in ('6', '7', '8') AND (std_number, enterdate) in 
      ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )
        group by csa ORDER BY csa ASC;
  """#export
def mattend(df, csa, yr): 

  # Create the Numerator
  mattend = df.copy()

  mattend = mattend[ mattend['grade'].str.contains('^6$|^7$|^8$', regex=True)  & (mattend['daysattend'] > 1) ]

  mattend['count'] = 1
  mattend = mattend.groupby('CSA2010').sum(numeric_only=True) 

  # Make sure ALL csas and BaltimoreCity are included and sorted.
  mattend = csa.merge( mattend, left_on='CSA2010', right_on='CSA2010', how='outer' )  
  mattend.drop( columns=['geometry', 'Shape__Length','Shape__Area'], inplace=True)
  # Baltimoire has records not in the 
  mattend.at[55,'count']=mattend['count'].sum()
  # Perform the calculation
  mattend['67-mattend'+year] = mattend['count']

  compareYears = gpd.read_file("https://services1.arcgis.com/mVFRs7NF4iFitgbY/ArcGIS/rest/services/Mattend/FeatureServer/0/query?where=1%3D1&outFields=*&returnGeometry=true&f=pgeojson");
  goback = 2 if year == '19' else 3
  prevYear = 'mattend'+ str( int(year) - goback )
  if prevYear in compareYears.columns:
    mattend = mattend.merge( compareYears[['CSA2010', prevYear]], left_on='CSA2010', right_on='CSA2010', how='outer' ) 
    mattend['change'] = mattend['67-mattend'+year] - mattend[ prevYear ]
    mattend['percentChange'] = mattend['change' ] / mattend[ prevYear ] * 100
    mattend['change'] = mattend['change'].apply(lambda x: "{:.2f}".format(x) )
  print( 'Records Matching Query: ', mattend.size / len(mattend.columns) )
  return mattend.drop(columns=['daysattend', 'SchoolSwitcherFlag', 'wleavecode', 'daysabsent', 'race_AIAN', 'race_asian', 'race_AA', 'race_NHPI', 'race_white', 'std_number', 'enterdate'])fin = mattend(bcpss, csa, year)
fin.to_csv('67-mattend'+year+'.csv', index=False)
fin.tail(6) <h3>68 hsattend - G - No Drop Dupes</h3>
"""  daysattend > 1 AND grade in ('9', '10', '11', '12') AND (std_number, enterdate) in ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )"""#export
def hsattend(df, csa, yr): 

  # Create the Numerator
  hsattend = df.copy()

  hsattend = hsattend[ hsattend['grade'].str.contains('^9$|^10$|^11$|^12$', regex=True)  & (hsattend['daysattend'] > 1) ]

  hsattend['count'] = 1
  hsattend = hsattend.groupby('CSA2010').sum(numeric_only=True) 

  # Make sure ALL csas and BaltimoreCity are included and sorted.
  hsattend = csa.merge( hsattend, left_on='CSA2010', right_on='CSA2010', how='outer' )  
  hsattend.drop( columns=['geometry', 'Shape__Length','Shape__Area'], inplace=True)
  # Baltimoire has records not in the 
  hsattend.at[55,'count']=hsattend['count'].sum()
  # Perform the calculation
  hsattend['68-hsattend'+year] = hsattend['count']

  compareYears = gpd.read_file("https://services1.arcgis.com/mVFRs7NF4iFitgbY/ArcGIS/rest/services/Hsattend/FeatureServer/0/query?where=1%3D1&outFields=*&returnGeometry=true&f=pgeojson");
  goback = 2 if year == '19' else 3
  prevYear = 'hsattend'+ str( int(year) - goback )
  if prevYear in compareYears.columns:
    hsattend = hsattend.merge( compareYears[['CSA2010', prevYear]], left_on='CSA2010', right_on='CSA2010', how='outer' ) 
    hsattend['change'] = hsattend['68-hsattend'+year] - hsattend[ prevYear ]
    hsattend['percentChange'] = hsattend['change' ] / hsattend[ prevYear ] * 100
    hsattend['change'] = hsattend['change'].apply(lambda x: "{:.2f}".format(x) )
  print( 'Records Matching Query: ', hsattend.size / len(hsattend.columns) )
  return hsattend.drop(columns=['daysattend', 'SchoolSwitcherFlag', 'wleavecode', 
               'daysabsent', 'race_AIAN', 'race_asian', 'race_AA', 
               'race_NHPI', 'race_white', 'std_number', 'enterdate'])fin = hsattend(bcpss, csa, year)
fin.to_csv('68-hsattend'+year+'.csv', index=False)
fin.head(6) <h3>70 aastud - G- No Drop Dupes</h3>
lbl = """ BCPSS - Education and Youth  - Percent of Students that are African American (non-Hispanic)"""

query2016 = """with numerator as (
   select sum(
   case 
   when (daysattend::numeric > 1) AND 
     (future_rac::text ='300' OR future_rac::text ='305' OR future_rac::text ='340' OR future_rac::text ='345') AND
     (hipani_lat LIKE 'N') AND 
     (grade::numeric <13 )
   then 1
   else 0
   end)::numeric as result, csa
   from vital_signs.match_csas_and_bc_by_geom('schools.afile_2016', 'gid', 'the_geom') a
   left join schools.afile_2016 b on a.gid = b.gid
   group by csa
   ),
   denominator AS (
    select (sum(
     case 
     when (daysattend::numeric > 1) AND (grade::numeric <13 )
     then 1
     else 0
     end)::numeric 
    ) as result, csa
    from vital_signs.match_csas_and_bc_by_geom('schools.afile_2016', 'gid', 'the_geom') a
    left join schools.afile_2016 b on a.gid = b.gid
    group by csa
   ),
   tbl AS (
     select denominator.csa,(numerator.result / denominator.result)*(100::numeric) as result 
     from numerator left join denominator on numerator.csa = denominator.csa
    )
   update vital_signs.data
   set aastud = result from tbl where data.csa = tbl.csa and data_year = '2016';
  """

OLD17Query = """with numerator as (
    select sum(
    case 
    when (daysattend::numeric > 1) AND (future_rac = 300 OR future_rac = 305 OR future_rac = 340 OR future_rac = 345) AND (hispani_la LIKE 'N') AND (grade <13 ) 
      then 1 else 0 end
    )::numeric as result, csa
      from vital_signs.match_csas_and_bc_by_geom('schools.afile_1617', 'gid', 'the_geom') a
        left join schools.afile_1617 b on a.gid = b.gid
          group by csa
  ),
  denominator AS (
    select (sum(
      case 
        when (daysattend > 1) AND (grade <13 )
          then 1 else 0 end
    )::numeric ) as result, csa
        from vital_signs.match_csas_and_bc_by_geom('schools.afile_1617', 'gid', 'the_geom') a
          left join schools.afile_1617 b on a.gid = b.gid
            group by csa
  ),
  tbl AS (
      select denominator.csa,(numerator.result / NULLIF(denominator.result, 0) )*(100::numeric) as result 
      from numerator left join denominator on numerator.csa = denominator.csa
      )
  select * from tbl where 1 = 1 ORDER BY csa ASC;
    """

New17Query = """with numerator as (
   select count(*)::numeric as result, csa
     from vital_signs.match_csas_and_bc_by_geom('schools.afile_1617', 'gid', 'the_geom') a
       left join schools.afile_1617 b on a.gid = b.gid
   where daysattend > 1 AND future_rac in ('300', '305', '340', '345') AND (hispani_la LIKE 'N') AND (grade <13 ) AND (std_number, enterdate) in 
     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )
   group by csa
   ),
   denominator AS (
   select count(*)::numeric as result, csa
     from vital_signs.match_csas_and_bc_by_geom('schools.afile_1617', 'gid', 'the_geom') a
       left join schools.afile_1617 b on a.gid = b.gid
   where daysattend > 1 AND grade <13 AND (std_number, enterdate) in 
     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )
   group by csa
   ),
   tbl AS (
     select denominator.csa,(numerator.result / NULLIF(denominator.result,0) )*(100::numeric) as result 
     from numerator left join denominator on numerator.csa = denominator.csa
    )
  select * from tbl where 1 = 1 ORDER BY csa ASC;
  """

miscNotes = """afile_1617
  17 hispani_la
  16 hispani_lat
  NULLIF(denominator.result,0)
  """"""
   where daysattend > 1 AND future_rac in ('300', '305', '340', '345') AND (hispani_la LIKE 'N') AND (grade <13 ) AND (std_number, enterdate) in 
     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )

     /

   where daysattend > 1 AND grade <13 AND (std_number, enterdate) in 
     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )
"""#export
def aastud(df, csa, yr): 
  df['count'] = 1

  # Create the Denominator
  denom = df.copy()
  denom['grade'] = denom['grade'].apply(pd.to_numeric, errors='coerce')
  denom = denom[ (denom['daysattend'] > 1) & (denom['grade'] < 13) ] 

  # Create the Numerator 
  numer = denom[ (denom['race_AA'] > 0 ) & (denom['hispani_la'] == 'N') ]

  id = '70'
  shortname = 'aastud'
  
  # Group by CSA
  numer = numer.groupby('CSA2010').sum(numeric_only=True) 
  denom = denom.groupby('CSA2010').sum(numeric_only=True) 

  # Make sure ALL csas and BaltimoreCity are included and sorted.
  numer = csa.merge( numer, left_on='CSA2010', right_on='CSA2010', how='outer' )
  denom = csa.merge( denom, left_on='CSA2010', right_on='CSA2010', how='outer' )
  numer.drop( columns=['geometry', 'Shape__Length','Shape__Area'], inplace=True) 
  numer['denomCount'] = denom['count']
  
  # Do after sortViaCsaMerge to get index right. False records would show underneath it but still get added to the sum.
  numer.at[55,'count']=numer['count'].sum()
  numer.at[55,'denomCount']=numer['denomCount'].sum()

  # Perform the calculation
  numer[id+'-'+shortname+year] = numer['count'] / numer['denomCount'] * 100

  compareYears = gpd.read_file("https://services1.arcgis.com/mVFRs7NF4iFitgbY/ArcGIS/rest/services/"+shortname.capitalize()+"/FeatureServer/0/query?where=1%3D1&outFields=*&returnGeometry=true&f=pgeojson");
  goback = 2 if year == '19' else 3
  prevYear = shortname+ str( int(year) - goback )
  if prevYear in compareYears.columns:
    numer = numer.merge( compareYears[['CSA2010', prevYear]], left_on='CSA2010', right_on='CSA2010', how='outer' ) 
    numer['change'] = numer[id+'-'+shortname+year] - numer[ prevYear ]
    numer['percentChange'] = numer['change' ] / numer[ prevYear ] * 100
    numer['change'] = numer['change'].apply(lambda x: "{:.2f}".format(x) )
    print( 'Records Matching Query: ', numer.size / len(numer.columns) )
  return numer.drop(columns=['daysattend', 'SchoolSwitcherFlag', 'wleavecode', 
               'daysabsent', 'race_AIAN', 'race_asian', 'race_AA', 
               'race_NHPI', 'race_white', 'std_number', 'enterdate'])fin = aastud(bcpss, csa, year)
fin.to_csv('70-aastud'+year+'.csv', index=False)
fin.head(6) <h3>71 wstud - G - No Drop Dupes</h3>
lbl = """BCPSS - Education and Youth - Percent of Students that are White (non-Hispanic)"""

Query16 = """with numerator as (
   select sum(
   case 
   when (daysattend::numeric > 1) AND (future_rac::text ='5') AND (hipani_lat LIKE 'N') AND (grade::numeric <13 )
   then 1
   else 0
   end)::numeric as result, csa
   from vital_signs.match_csas_and_bc_by_geom('schools.afile_2016', 'gid', 'the_geom') a
   left join schools.afile_2016 b on a.gid = b.gid
   group by csa
   ),
   denominator AS (
    select (sum(
     case 
     when (daysattend::numeric > 1) AND (grade::numeric <13 )
     then 1
     else 0
     end)::numeric 
    ) as result, csa
    from vital_signs.match_csas_and_bc_by_geom('schools.afile_2016', 'gid', 'the_geom') a
    left join schools.afile_2016 b on a.gid = b.gid
    group by csa
   ),
   tbl AS (
     select denominator.csa,(numerator.result / denominator.result)*(100::numeric) as result 
     from numerator left join denominator on numerator.csa = denominator.csa
    )
   update vital_signs.data
   set wstud = result from tbl where data.csa = tbl.csa and data_year = '2016';
 """

OLD17Query = """with numerator as (
   select sum(
   case 
   when (daysattend::numeric > 1) AND (future_rac::text ='5') AND (hispani_la LIKE 'N') AND (grade::numeric <13 )
   then 1
   else 0
   end)::numeric as result, csa
   from vital_signs.match_csas_and_bc_by_geom('schools.afile_1617', 'gid', 'the_geom') a
   left join schools.afile_1617 b on a.gid = b.gid
   group by csa
   ),
   denominator AS (
    select (sum(
     case 
     when (daysattend::numeric > 1) AND (grade::numeric <13 )
     then 1
     else 0
     end)::numeric 
    ) as result, csa
    from vital_signs.match_csas_and_bc_by_geom('schools.afile_1617', 'gid', 'the_geom') a
    left join schools.afile_1617 b on a.gid = b.gid
    group by csa
   ),
   tbl AS (
     select denominator.csa,(numerator.result / NULLIF(denominator.result,0) )*(100::numeric) as result 
     from numerator left join denominator on numerator.csa = denominator.csa
    )
 select * from tbl where 1 = 1 ORDER BY csa ASC;
 """

NEW17Query = """with numerator as (
   select count(*)::numeric as result, csa
     from vital_signs.match_csas_and_bc_by_geom('schools.afile_1617', 'gid', 'the_geom') a
       left join schools.afile_1617 b on a.gid = b.gid
   where daysattend > 1 AND future_rac ='5' AND hispani_la LIKE 'N' AND grade <13 AND (std_number, enterdate) in 
     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )
   group by csa
   ),
   denominator AS (
   select count(*)::numeric as result, csa
     from vital_signs.match_csas_and_bc_by_geom('schools.afile_1617', 'gid', 'the_geom') a
       left join schools.afile_1617 b on a.gid = b.gid
   where daysattend > 1 AND grade <13 AND (std_number, enterdate) in 
     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )
   group by csa
   ),
   tbl AS (
     select denominator.csa,(numerator.result / NULLIF(denominator.result,0) )*(100::numeric) as result 
     from numerator left join denominator on numerator.csa = denominator.csa
    )
 select * from tbl where 1 = 1 ORDER BY csa ASC;
 """

misc = """
  afile_1617
  17 hispani_la
  16 hispani_lat
  NULLIF(denominator.result,0)
""""""
   where daysattend > 1 AND future_rac ='5' AND hispani_la LIKE 'N' AND grade <13 AND (std_number, enterdate) in 
     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )
     /
   where daysattend > 1 AND grade <13 AND (std_number, enterdate) in 
     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )
"""#export
def wstud(df, csa, yr): 
  id = '71'
  shortname = 'wstud'
  df['count'] = 1

  # Create the Denominator
  denom = df.copy()
  denom['grade'] = denom['grade'].apply(pd.to_numeric, errors='coerce')
  denom = denom[ (denom['daysattend'] > 1) & (denom['grade'] < 13) ] 

  # Create the Numerator 
  numer = denom[ (denom['race_white'] > 0 ) & (denom['hispani_la'] == 'N') ]

  id = '71'
  shortname = 'wstud'
  
  # Group by CSA
  numer = numer.groupby('CSA2010').sum(numeric_only=True) 
  denom = denom.groupby('CSA2010').sum(numeric_only=True) 

  # Make sure ALL csas and BaltimoreCity are included and sorted.
  numer = csa.merge( numer, left_on='CSA2010', right_on='CSA2010', how='outer' )
  denom = csa.merge( denom, left_on='CSA2010', right_on='CSA2010', how='outer' )
  numer.drop( columns=['geometry', 'Shape__Length','Shape__Area'], inplace=True) 
  numer['denomCount'] = denom['count']
  
  # Do after sortViaCsaMerge to get index right. False records would show underneath it but still get added to the sum.
  numer.at[55,'count']=numer['count'].sum()
  numer.at[55,'denomCount']=numer['denomCount'].sum()

  # Perform the calculation
  numer[id+'-'+shortname+year] = numer['count'] / numer['denomCount'] * 100

  compareYears = gpd.read_file("https://services1.arcgis.com/mVFRs7NF4iFitgbY/ArcGIS/rest/services/"+shortname.capitalize()+"/FeatureServer/0/query?where=1%3D1&outFields=*&returnGeometry=true&f=pgeojson");
  goback = 2 if year == '19' else 3
  prevYear = shortname + str( int(year) - goback )
  if prevYear in compareYears.columns:
    numer = numer.merge( compareYears[['CSA2010', prevYear]], left_on='CSA2010', right_on='CSA2010', how='outer' ) 
    numer['change'] = numer[id+'-'+shortname+year] - numer[ prevYear ]
    numer['percentChange'] = numer['change' ] / numer[ prevYear ] * 100
    numer['change'] = numer['change'].apply(lambda x: "{:.2f}".format(x) )
    print( 'Records Matching Query: ', numer.size / len(numer.columns) )
  return numer.drop(columns=['daysattend', 'SchoolSwitcherFlag', 'wleavecode', 
               'daysabsent', 'race_AIAN', 'race_asian', 'race_AA', 
               'race_NHPI', 'race_white', 'std_number', 'enterdate'])fin = wstud(bcpss, csa, year)
fin.to_csv('71-wstud'+year+'.csv', index=False)
fin.head(6) <h3>72 hstud - G - No Drop Dupes</h3>
lbl = """ BCPSS - Education and Youth """

Query16 = """ with numerator as (
   select sum(
   case 
   when (daysattend::numeric > 1) AND (hipani_lat LIKE 'Y') AND (grade::numeric <13 )
   then 1
   else 0
   end)::numeric as result, csa
   from vital_signs.match_csas_and_bc_by_geom('schools.afile_2016', 'gid', 'the_geom') a
   left join schools.afile_2016 b on a.gid = b.gid
   group by csa
   ),
   denominator AS (
    select (sum(
     case 
     when (daysattend::numeric > 1) AND (grade::numeric <13 )
     then 1
     else 0
     end)::numeric 
    ) as result, csa
    from vital_signs.match_csas_and_bc_by_geom('schools.afile_2016', 'gid', 'the_geom') a
    left join schools.afile_2016 b on a.gid = b.gid
    group by csa
   ),
   tbl AS (
     select denominator.csa,(numerator.result / denominator.result)*(100::numeric) as result 
     from numerator left join denominator on numerator.csa = denominator.csa
    )
   update vital_signs.data
   set hstud = result from tbl where data.csa = tbl.csa and data_year = '2016'; 
  """

NEW17Query = """with numerator as (
   select count(*)::numeric as result, csa
     from vital_signs.match_csas_and_bc_by_geom('schools.afile_1617', 'gid', 'the_geom') a
       left join schools.afile_1617 b on a.gid = b.gid
   where daysattend > 1 AND hispani_la LIKE 'Y' AND grade <13 AND (std_number, enterdate) in 
     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )
   group by csa
   ),
   denominator AS (
   select count(*)::numeric as result, csa
     from vital_signs.match_csas_and_bc_by_geom('schools.afile_1617', 'gid', 'the_geom') a
       left join schools.afile_1617 b on a.gid = b.gid
   where daysattend > 1 AND grade <13 AND (std_number, enterdate) in 
     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )
   group by csa
   ),
   tbl AS (
     select denominator.csa,(numerator.result / NULLIF(denominator.result,0) )*(100::numeric) as result 
     from numerator left join denominator on numerator.csa = denominator.csa
    )
  select * from tbl where 1 = 1 ORDER BY csa ASC;
  """

OLD17Query = """with numerator as (
   select sum(
   case 
   when (daysattend::numeric > 1) AND (hispani_la LIKE 'Y') AND (grade::numeric <13 )
   then 1
   else 0
   end)::numeric as result, csa
   from vital_signs.match_csas_and_bc_by_geom('schools.afile_1617', 'gid', 'the_geom') a
   left join schools.afile_1617 b on a.gid = b.gid
   group by csa
   ),
   denominator AS (
    select (sum(
     case 
     when (daysattend::numeric > 1) AND (grade::numeric <13 )
     then 1
     else NULL
     end)::numeric 
    ) as result, csa
    from vital_signs.match_csas_and_bc_by_geom('schools.afile_1617', 'gid', 'the_geom') a
    left join schools.afile_1617 b on a.gid = b.gid
    group by csa
   ),
   tbl AS (
     select denominator.csa,(numerator.result / NULLIF(denominator.result,0) )*(100::numeric) as result 
     from numerator left join denominator on numerator.csa = denominator.csa
    )
  select * from tbl order by csa asc
  """"""
   where daysattend > 1 AND hispani_la LIKE 'Y' AND grade <13 AND (std_number, enterdate) in 
     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )
     /
   where daysattend > 1 AND grade <13 AND (std_number, enterdate) in 
     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )
"""denom = bcpss.copy()
denom['grade'] = denom['grade'].apply(pd.to_numeric, errors='coerce')
denom = denom[ (denom['daysattend'] > 1) & (denom['grade'] < 13) ] 
denom.groupby('CSA2010').sum(numeric_only=True).head()numer = denom = denom[ (denom['hispani_la'] == 'Y') ] 
numer.groupby('CSA2010').sum(numeric_only=True).head()bcpss[ (bcpss['CSA2010'] == 'Allendale/Irvington/S. Hilton') & (bcpss['hispani_la'] == 'Y') ].head(1)#export
def hstud(df, csa, yr): 
  df['count'] = 1

  # Create the Denominator
  denom = df.copy()
  denom['grade'] = denom['grade'].apply(pd.to_numeric, errors='coerce')
  denom = denom[ (denom['daysattend'] > 1) & (denom['grade'] < 13) ] 

  # Create the Numerator 
  numer = denom[ (denom['hispani_la'] == 'Y') ]

  id = '72'
  shortname = 'hstud'
  
  # Group by CSA
  numer = numer.groupby('CSA2010').sum(numeric_only=True) 
  denom = denom.groupby('CSA2010').sum(numeric_only=True) 

  # Make sure ALL csas and BaltimoreCity are included and sorted.
  numer = csa.merge( numer, left_on='CSA2010', right_on='CSA2010', how='outer' )
  denom = csa.merge( denom, left_on='CSA2010', right_on='CSA2010', how='outer' )
  numer.drop( columns=['geometry', 'Shape__Length','Shape__Area'], inplace=True) 
  numer['denomCount'] = denom['count']
  
  # Do after sortViaCsaMerge to get index right. False records would show underneath it but still get added to the sum.
  numer.at[55,'count']=numer['count'].sum()
  numer.at[55,'denomCount']=numer['denomCount'].sum()

  # Perform the calculation
  numer[id+'-'+shortname+year] = numer['count'] / numer['denomCount'] * 100

  compareYears = gpd.read_file("https://services1.arcgis.com/mVFRs7NF4iFitgbY/ArcGIS/rest/services/"+shortname.capitalize()+"/FeatureServer/0/query?where=1%3D1&outFields=*&returnGeometry=true&f=pgeojson");
  goback = 2 if year == '19' else 3
  prevYear = shortname + str( int(year) - goback )
  if prevYear in compareYears.columns:
    numer = numer.merge( compareYears[['CSA2010', prevYear]], left_on='CSA2010', right_on='CSA2010', how='outer' ) 
    numer['change'] = numer[id+'-'+shortname+year] - numer[ prevYear ]
    numer['percentChange'] = numer['change' ] / numer[ prevYear ] * 100
    numer['change'] = numer['change'].apply(lambda x: "{:.2f}".format(x) )
    print( 'Records Matching Query: ', numer.size / len(numer.columns) )
  return numer.drop(columns=['daysattend', 'SchoolSwitcherFlag', 'wleavecode', 
               'daysabsent', 'race_AIAN', 'race_asian', 'race_AA', 
               'race_NHPI', 'race_white', 'std_number', 'enterdate'])fin = hstud(bcpss, csa, year)
fin.to_csv('72-hstud'+year+'.csv', index=False)
fin.head(6) <h3>73 abse - G - No Drop Dupes</h3>
lbl = """ BCPSS - Education and Youth - Percent of 1st-5th Grade Students that are Chronically Absent (Missing at least 20 days) """

Query16 = """with numerator as (
   select sum(
   case 
   when (daysattend > 1) AND (grade = '1' OR grade = '2' OR grade = '3' OR grade = '4'OR grade = '5') AND (daysabsent > 200)
   then 1
   else 0
   end)::numeric as result, csa
   from vital_signs.match_csas_and_bc_by_geom('schools.afile_2016', 'gid', 'the_geom') a
   left join schools.afile_2016 b on a.gid = b.gid
   group by csa
   ),
   denominator AS (
    select (sum(
     case 
     when (daysattend::numeric > 1) AND (grade = '1' OR grade = '2' OR grade = '3' OR grade = '4'OR grade = '5')
     then 1
     else 0
     end)::numeric 
    ) as result, csa
    from vital_signs.match_csas_and_bc_by_geom('schools.afile_2016', 'gid', 'the_geom') a
    left join schools.afile_2016 b on a.gid = b.gid
    group by csa
   ),
   tbl AS (
     select denominator.csa,(numerator.result / denominator.result)*(100::numeric) as result 
     from numerator left join denominator on numerator.csa = denominator.csa
    )
   update vital_signs.data
   set abse = result from tbl where data.csa = tbl.csa and data_year = '2016';
  """

New17Query = """with numerator as (
   select count(*)::numeric as result, csa
     from vital_signs.match_csas_and_bc_by_geom('schools.afile_1617', 'gid', 'the_geom') a
       left join schools.afile_1617 b on a.gid = b.gid
   where daysattend > 1 AND daysabsent > 200 AND grade in ('1','2','3','4','5') AND (std_number, enterdate) in 
     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )
   group by csa
   ),
   denominator AS (
   select count(*)::numeric as result, csa
     from vital_signs.match_csas_and_bc_by_geom('schools.afile_1617', 'gid', 'the_geom') a
       left join schools.afile_1617 b on a.gid = b.gid
   where daysattend > 1 AND grade in ('1','2','3','4','5') AND (std_number, enterdate) in 
     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )
   group by csa
   ),
   tbl AS (
     select denominator.csa,(numerator.result / NULLIF(denominator.result,0) )*(100::numeric) as result 
     from numerator left join denominator on numerator.csa = denominator.csa
    )
  select * from tbl where 1 = 1 ORDER BY csa ASC;
  """

OLD17Query = """with numerator as (
   select sum(
   case 
   when (daysattend > 1) AND (grade = 1 OR grade = 2 OR grade = 3 OR grade = 4 OR grade = 5 ) AND (daysabsent > 200)
   then 1
   else 0
   end)::numeric as result, csa
   from vital_signs.match_csas_and_bc_by_geom('schools.afile_1617', 'gid', 'the_geom') a
   left join schools.afile_1617 b on a.gid = b.gid
   group by csa
   ),
   denominator AS (
    select (sum(
     case 
     when (daysattend::numeric > 1) AND (grade = '1' OR grade = '2' OR grade = '3' OR grade = '4'OR grade = '5')
     then 1
     else 0
     end)::numeric 
    ) as result, csa
    from vital_signs.match_csas_and_bc_by_geom('schools.afile_1617', 'gid', 'the_geom') a
    left join schools.afile_1617 b on a.gid = b.gid
    group by csa
   ),
   tbl AS (
     select denominator.csa,(numerator.result / NULLIF(denominator.result,0) )*(100::numeric) as result 
     from numerator left join denominator on numerator.csa = denominator.csa
    )
  select * from tbl where 1 = 1 ORDER BY csa ASC;
  ""

  afile_1617
  17 hispani_la
  16 hispani_lat
  NULLIF(denominator.result,0)
""""""
   where daysattend > 1 AND daysabsent > 200 AND grade in ('1','2','3','4','5') AND (std_number, enterdate) in 
     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )
     /
   where daysattend > 1 AND grade in ('1','2','3','4','5') AND (std_number, enterdate) in 
     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )
"""<p>numerator only differentiates from the denominator in that it looks for days absent &gt; 200..also. the query filters for 200 but the indicator description says 20</p>
denom[ denom['daysabsent'] > 200]#export
def abse(df, csa, yr): 
  df['count'] = 1

  # Create the Denominator
  denom = df.copy()
  denom = denom[ denom['grade'].str.contains('^1$|^2$|^3$|^4$|^5$', regex=True)  & (denom['daysattend'] > 1) ] 

  # Create the Numerator 
  numer = denom[ (denom['daysabsent'] > 200 ) ]

  id = '73'
  shortname = 'abse'
  
  # Group by CSA
  numer = numer.groupby('CSA2010').sum(numeric_only=True) 
  denom = denom.groupby('CSA2010').sum(numeric_only=True) 

  # Make sure ALL csas and BaltimoreCity are included and sorted.
  numer = csa.merge( numer, left_on='CSA2010', right_on='CSA2010', how='outer' )
  denom = csa.merge( denom, left_on='CSA2010', right_on='CSA2010', how='outer' )
  numer.drop( columns=['geometry', 'Shape__Length','Shape__Area'], inplace=True) 
  denom.drop( columns=['geometry', 'Shape__Length','Shape__Area'], inplace=True) 

  numer.drop(columns=['tpop10', 'EnrollmentFlag', 'daysattend', 'SchoolSwitcherFlag', 'wleavecode', 
               'daysabsent', 'race_AIAN', 'race_asian', 'race_AA', 
               'race_NHPI', 'race_white', 'std_number', 'enterdate']).to_csv(id+'-'+shortname+year+'_numer.csv', index=False)
  denom.drop(columns=['tpop10', 'EnrollmentFlag', 'daysattend', 'SchoolSwitcherFlag', 'wleavecode', 
               'daysabsent', 'race_AIAN', 'race_asian', 'race_AA', 
               'race_NHPI', 'race_white', 'std_number', 'enterdate']).to_csv(id+'-'+shortname+year+'_denom.csv', index=False)

  numer['denomCount'] = denom['count']
  
  # Do after sortViaCsaMerge to get index right. False records would show underneath it but still get added to the sum.
  numer.at[55,'count']=numer['count'].sum()
  numer.at[55,'denomCount']=numer['denomCount'].sum()

  # Perform the calculation
  numer[id+'-'+shortname+year] = numer['count'] / numer['denomCount'] * 100

  compareYears = gpd.read_file("https://services1.arcgis.com/mVFRs7NF4iFitgbY/ArcGIS/rest/services/"+shortname.capitalize()+"/FeatureServer/0/query?where=1%3D1&outFields=*&returnGeometry=true&f=pgeojson");
  goback = 2 if year == '19' else 3
  prevYear = shortname + str( int(year) - goback )
  if prevYear in compareYears.columns:
    numer = numer.merge( compareYears[['CSA2010', prevYear]], left_on='CSA2010', right_on='CSA2010', how='outer' ) 
    numer['change'] = numer[id+'-'+shortname+year] - numer[ prevYear ]
    numer['percentChange'] = numer['change' ] / numer[ prevYear ] * 100
    numer['change'] = numer['change'].apply(lambda x: "{:.2f}".format(x) )
    print( 'Records Matching Query: ', numer.size / len(numer.columns) )
  return numer.drop(columns=['daysattend', 'SchoolSwitcherFlag', 'wleavecode', 
               'daysabsent', 'race_AIAN', 'race_asian', 'race_AA', 
               'race_NHPI', 'race_white', 'std_number', 'enterdate'])fin = abse(bcpss, csa, year)
fin.to_csv('73-abse'+year+'.csv', index=False)
fin.head(6) <h3>74 absmd - G - No Drop Dupes</h3>
lbl = """ BCPSS - Education and Youth - Percent of 6th-8th Grade Students that are Chronically Absent (Missing at least 20 days) """

query16 = """ with numerator as (
   select sum(
   case 
   when (daysattend > 1) AND (grade = '6' OR grade = '7' OR grade = '8') AND (daysabsent > 200)
   then 1
   else 0
   end)::numeric as result, csa
   from vital_signs.match_csas_and_bc_by_geom('schools.afile_2016', 'gid', 'the_geom') a
   left join schools.afile_2016 b on a.gid = b.gid
   group by csa
   ),
   denominator AS (
    select (sum(
     case 
     when (daysattend::numeric > 1) AND (grade = '6' OR grade = '7' OR grade = '8') 
     then 1
     else 0
     end)::numeric 
    ) as result, csa
    from vital_signs.match_csas_and_bc_by_geom('schools.afile_2016', 'gid', 'the_geom') a
    left join schools.afile_2016 b on a.gid = b.gid
    group by csa
   ),
   tbl AS (
     select denominator.csa,(numerator.result / denominator.result)*(100::numeric) as result 
     from numerator left join denominator on numerator.csa = denominator.csa
    )
   update vital_signs.data
   set absmd = result from tbl where data.csa = tbl.csa and data_year = '2016'; 
  """


NEW17Query =  """with numerator as (
   select count(*)::numeric as result, csa
     from vital_signs.match_csas_and_bc_by_geom('schools.afile_1617', 'gid', 'the_geom') a
       left join schools.afile_1617 b on a.gid = b.gid
   where daysattend > 1 AND daysabsent > 200 AND grade in ('6','7','8') AND (std_number, enterdate) in 
     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )
   group by csa
   ),
   denominator AS (
   select count(*)::numeric as result, csa
     from vital_signs.match_csas_and_bc_by_geom('schools.afile_1617', 'gid', 'the_geom') a
       left join schools.afile_1617 b on a.gid = b.gid
   where daysattend > 1 AND grade in ('6','7','8') AND (std_number, enterdate) in 
     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )
   group by csa
   ),
   tbl AS (
     select denominator.csa,(numerator.result / NULLIF(denominator.result,0) )*(100::numeric) as result 
     from numerator left join denominator on numerator.csa = denominator.csa
    )
  select * from tbl where 1 = 1 ORDER BY csa ASC;
  """

OLD17Query = """with numerator as (
   select sum(
   case 
   when (daysattend > 1) AND (grade = '6' OR grade = '7' OR grade = '8') AND (daysabsent > 200)
   then 1
   else 0
   end)::numeric as result, csa
   from vital_signs.match_csas_and_bc_by_geom('schools.afile_1617', 'gid', 'the_geom') a
   left join schools.afile_1617 b on a.gid = b.gid
   group by csa
   ),
   denominator AS (
    select (sum(
     case 
     when (daysattend::numeric > 1) AND (grade = '6' OR grade = '7' OR grade = '8') 
     then 1
     else 0
     end)::numeric 
    ) as result, csa
    from vital_signs.match_csas_and_bc_by_geom('schools.afile_1617', 'gid', 'the_geom') a
    left join schools.afile_1617 b on a.gid = b.gid
    group by csa
   ),
   tbl AS (
     select denominator.csa,(numerator.result / NULLIF(denominator.result,0) )*(100::numeric) as result 
     from numerator left join denominator on numerator.csa = denominator.csa
    )
  select * from tbl where 1 = 1 ORDER BY csa ASC;
  """

""" afile_1617  NULLIF(denominator.result,0) """"""
   where daysattend > 1 AND daysabsent > 200 AND grade in ('6','7','8') AND (std_number, enterdate) in 
     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )
     /
   where daysattend > 1 AND grade in ('6','7','8') AND (std_number, enterdate) in 
     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )
"""#export
def absmd(df, csa, yr): 
  df['count'] = 1

  # Create the Denominator
  denom = df.copy()
  denom = denom[ denom['grade'].str.contains('^6$|^7$|^8$', regex=True)  & (denom['daysattend'] > 1) ] 

  # Create the Numerator 
  numer = denom[ (denom['daysabsent'] > 200 ) ]

  id = '74'
  shortname = 'absmd'
  
  # Group by CSA
  numer = numer.groupby('CSA2010').sum(numeric_only=True) 
  denom = denom.groupby('CSA2010').sum(numeric_only=True) 

  # Make sure ALL csas and BaltimoreCity are included and sorted.
  numer = csa.merge( numer, left_on='CSA2010', right_on='CSA2010', how='outer' )
  denom = csa.merge( denom, left_on='CSA2010', right_on='CSA2010', how='outer' )
  numer.drop( columns=['geometry', 'Shape__Length','Shape__Area'], inplace=True) 
  denom.drop( columns=['geometry', 'Shape__Length','Shape__Area'], inplace=True) 

  numer.drop(columns=['tpop10', 'EnrollmentFlag', 'daysattend', 'SchoolSwitcherFlag', 'wleavecode', 
               'daysabsent', 'race_AIAN', 'race_asian', 'race_AA', 
               'race_NHPI', 'race_white', 'std_number', 'enterdate']).to_csv(id+'-'+shortname+year+'_numer.csv', index=False)
  denom.drop(columns=['tpop10', 'EnrollmentFlag', 'daysattend', 'SchoolSwitcherFlag', 'wleavecode', 
               'daysabsent', 'race_AIAN', 'race_asian', 'race_AA', 
               'race_NHPI', 'race_white', 'std_number', 'enterdate']).to_csv(id+'-'+shortname+year+'_denom.csv', index=False)

  numer['denomCount'] = denom['count']
  
  # Do after sortViaCsaMerge to get index right. False records would show underneath it but still get added to the sum.
  numer.at[55,'count']=numer['count'].sum()
  numer.at[55,'denomCount']=numer['denomCount'].sum()

  # Perform the calculation
  numer[id+'-'+shortname+year] = numer['count'] / numer['denomCount'] * 100

  compareYears = gpd.read_file("https://services1.arcgis.com/mVFRs7NF4iFitgbY/ArcGIS/rest/services/"+shortname.capitalize()+"/FeatureServer/0/query?where=1%3D1&outFields=*&returnGeometry=true&f=pgeojson");
  goback = 2 if year == '19' else 3
  prevYear = shortname + str( int(year) - goback )
  if prevYear in compareYears.columns:
    numer = numer.merge( compareYears[['CSA2010', prevYear]], left_on='CSA2010', right_on='CSA2010', how='outer' ) 
    numer['change'] = numer[id+'-'+shortname+year] - numer[ prevYear ]
    numer['percentChange'] = numer['change' ] / numer[ prevYear ] * 100
    numer['change'] = numer['change'].apply(lambda x: "{:.2f}".format(x) )
    print( 'Records Matching Query: ', numer.size / len(numer.columns) )
  return numer.drop(columns=['daysattend', 'SchoolSwitcherFlag', 'wleavecode', 
               'daysabsent', 'race_AIAN', 'race_asian', 'race_AA', 
               'race_NHPI', 'race_white', 'std_number', 'enterdate']) fin = absmd(bcpss, csa, year)
fin.to_csv('74-absmd'+year+'.csv', index=False)
fin.head(6)<h3>75 abshs - G - No Drop Dupes</h3>
lbl = """ BCPSS - Education and Youth - Percent of 9th-12th Grade Students that are Chronically Absent (Missing at least 20 days) """

Query16  = """with numerator as (
   select sum(
   case 
   when (daysattend > 1) AND (grade = '9' OR grade = '10' OR grade = '11' OR grade = '12') AND (daysabsent > 200)
   then 1
   else 0
   end)::numeric as result, csa
   from vital_signs.match_csas_and_bc_by_geom('schools.afile_2016', 'gid', 'the_geom') a
   left join schools.afile_2016 b on a.gid = b.gid
   group by csa
   ),
   denominator AS (
    select (sum(
     case 
     when (daysattend::numeric > 1) AND (grade = '9' OR grade = '10' OR grade = '11' OR grade = '12') 
     then 1
     else 0
     end)::numeric 
    ) as result, csa
    from vital_signs.match_csas_and_bc_by_geom('schools.afile_2016', 'gid', 'the_geom') a
    left join schools.afile_2016 b on a.gid = b.gid
    group by csa
   ),
   tbl AS (
     select denominator.csa,(numerator.result / denominator.result)*(100::numeric) as result 
     from numerator left join denominator on numerator.csa = denominator.csa
    )
   update vital_signs.data
   set abshs = result from tbl where data.csa = tbl.csa and data_year = '2016';
  """

New17Query =  """with numerator as (
   select count(*)::numeric as result, csa
     from vital_signs.match_csas_and_bc_by_geom('schools.afile_1617', 'gid', 'the_geom') a
       left join schools.afile_1617 b on a.gid = b.gid
   where daysattend > 1 AND daysabsent > 200 AND grade in ('9','10','11','12') AND (std_number, enterdate) in 
     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )
   group by csa
   ),
   denominator AS (
   select count(*)::numeric as result, csa
     from vital_signs.match_csas_and_bc_by_geom('schools.afile_1617', 'gid', 'the_geom') a
       left join schools.afile_1617 b on a.gid = b.gid
   where daysattend > 1 AND grade in ('9','10','11','12') AND (std_number, enterdate) in 
     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )
   group by csa
   ),
   tbl AS (
     select denominator.csa,(numerator.result / NULLIF(denominator.result,0) )*(100::numeric) as result 
     from numerator left join denominator on numerator.csa = denominator.csa
    )
  select * from tbl where 1 = 1 ORDER BY csa ASC;
  """

"""
  afile_1617
  NULLIF(denominator.result,0)
  """"""
   where daysattend > 1 AND daysabsent > 200 AND grade in ('9','10','11','12') AND (std_number, enterdate) in 
     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )
     /
   where daysattend > 1 AND grade in ('9','10','11','12') AND (std_number, enterdate) in 
     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )
"""#export
def abshd(df, csa, yr): 
  df['count'] = 1

  # Create the Denominator
  denom = df.copy()
  denom = denom[ denom['grade'].str.contains('^9$|^10$|^11$|^12$', regex=True)  & (denom['daysattend'] > 1) ] 

  # Create the Numerator 
  numer = denom[ (denom['daysabsent'] > 200 ) ]

  id = '75'
  shortname = 'abshs'
  
  # Group by CSA
  numer = numer.groupby('CSA2010').sum(numeric_only=True) 
  denom = denom.groupby('CSA2010').sum(numeric_only=True) 

  # Make sure ALL csas and BaltimoreCity are included and sorted.
  numer = csa.merge( numer, left_on='CSA2010', right_on='CSA2010', how='outer' )
  denom = csa.merge( denom, left_on='CSA2010', right_on='CSA2010', how='outer' )
  numer.drop( columns=['geometry', 'Shape__Length','Shape__Area'], inplace=True) 
  denom.drop( columns=['geometry', 'Shape__Length','Shape__Area'], inplace=True) 

  numer.drop(columns=['tpop10', 'EnrollmentFlag', 'daysattend', 'SchoolSwitcherFlag', 'wleavecode', 
               'daysabsent', 'race_AIAN', 'race_asian', 'race_AA', 
               'race_NHPI', 'race_white', 'std_number', 'enterdate']).to_csv(id+'-'+shortname+year+'_numer.csv', index=False)
  denom.drop(columns=['tpop10', 'EnrollmentFlag', 'daysattend', 'SchoolSwitcherFlag', 'wleavecode', 
               'daysabsent', 'race_AIAN', 'race_asian', 'race_AA', 
               'race_NHPI', 'race_white', 'std_number', 'enterdate']).to_csv(id+'-'+shortname+year+'_denom.csv', index=False)

  numer['denomCount'] = denom['count']
  
  # Do after sortViaCsaMerge to get index right. False records would show underneath it but still get added to the sum.
  numer.at[55,'count']=numer['count'].sum()
  numer.at[55,'denomCount']=numer['denomCount'].sum()

  # Perform the calculation
  numer[id+'-'+shortname+year] = numer['count'] / numer['denomCount'] * 100

  compareYears = gpd.read_file("https://services1.arcgis.com/mVFRs7NF4iFitgbY/ArcGIS/rest/services/"+shortname.capitalize()+"/FeatureServer/0/query?where=1%3D1&outFields=*&returnGeometry=true&f=pgeojson");
  goback = 2 if year == '19' else 3
  prevYear = shortname + str( int(year) - goback )
  if prevYear in compareYears.columns:
    numer = numer.merge( compareYears[['CSA2010', prevYear]], left_on='CSA2010', right_on='CSA2010', how='outer' ) 
    numer['change'] = numer[id+'-'+shortname+year] - numer[ prevYear ]
    numer['percentChange'] = numer['change' ] / numer[ prevYear ] * 100
    numer['change'] = numer['change'].apply(lambda x: "{:.2f}".format(x) )
    print( 'Records Matching Query: ', numer.size / len(numer.columns) )
  return numer.drop(columns=['daysattend', 'SchoolSwitcherFlag', 'wleavecode', 
               'daysabsent', 'race_AIAN', 'race_asian', 'race_AA', 
               'race_NHPI', 'race_white', 'std_number', 'enterdate'])fin = abshd(bcpss, csa, year)
fin.to_csv('75-abshs'+year+'.csv', index=False)
fin.head(6) <h3>91 drop - G - No Drop Dupes</h3>
lbl = """BCPSS - Education and Youth - High School Dropout/Withdrawl Rate"""

query16 = """with numerator as (
   select sum(
   case 
   when daysattend::numeric > 1 AND (wleavecode LIKE 'W%') AND (wleavecode != 'W43') AND (grade = '9' OR grade = '10' OR grade = '11' OR grade = '12')
   then 1
   else 0
   end)::numeric as result, csa
   from vital_signs.match_csas_and_bc_by_geom('schools.afile_2016', 'gid', 'the_geom') a
   left join schools.afile_2016 b on a.gid = b.gid
   group by csa
   ),
   denominator AS (
    select (sum(
     case 
     when (daysattend::numeric > 1) AND (grade = '9' OR grade = '10' OR grade = '11' OR grade = '12') 
     then 1
     else 0
     end)::numeric 
    ) as result, csa
    from vital_signs.match_csas_and_bc_by_geom('schools.afile_2016', 'gid', 'the_geom') a
    left join schools.afile_2016 b on a.gid = b.gid
    group by csa
   ),
   tbl AS (
     select denominator.csa,(numerator.result / NULLIF(denominator.result,0) )*(100::numeric) as result 
     from numerator left join denominator on numerator.csa = denominator.csa
    )
  select * from tbl where 1 = 1 ORDER BY csa ASC;
  """

NEW17Query = """with numerator as (
   select count(*)::numeric as result, csa
     from vital_signs.match_csas_and_bc_by_geom('schools.afile_1617', 'gid', 'the_geom') a
       left join schools.afile_1617 b on a.gid = b.gid
   where daysattend > 1 AND  grade in ('9','10','11','12') AND wleavecode IN ('30','31','32','33','34','35','36','37','38','39','41','42','44','46','50','71','85') 
   AND (std_number, enterdate) in ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )
   group by csa
   ),
   denominator AS (
   select count(*)::numeric as result, csa
     from vital_signs.match_csas_and_bc_by_geom('schools.afile_1617', 'gid', 'the_geom') a
       left join schools.afile_1617 b on a.gid = b.gid
   where daysattend > 1 AND grade in ('9','10','11','12') AND (std_number, enterdate) in 
     ( select std_number, max(enterdate) enterdate from schools.afile_1617 group by std_number )
   group by csa
   ),
   tbl AS (
     select denominator.csa,(numerator.result / NULLIF(denominator.result,0) )*(100::numeric) as result 
     from numerator left join denominator on numerator.csa = denominator.csa
    )
  select * from tbl where 1 = 1 ORDER BY csa ASC;
  """


OLD17 = """ with numerator as (
   select sum(
   case 
   when daysattend::numeric > 1 
     AND (grade = '9' OR grade = '10' OR grade = '11' OR grade = '12') 
     AND wleavecode IN ('30','31','32','33','34','35','36','37','38','39','41','42','44','46','50','71','85')
   then 1
   else 0
   end)::numeric as result, csa
   from vital_signs.match_csas_and_bc_by_geom('schools.afile_1617', 'gid', 'the_geom') a
   left join schools.afile_1617 b on a.gid = b.gid
   group by csa
   ),
   denominator AS (
    select (sum(
     case 
     when (daysattend::numeric > 1) AND (grade = '9' OR grade = '10' OR grade = '11' OR grade = '12') 
     then 1
     else 0
     end)::numeric 
    ) as result, csa
    from vital_signs.match_csas_and_bc_by_geom('schools.afile_1617', 'gid', 'the_geom') a
    left join schools.afile_1617 b on a.gid = b.gid
    group by csa
   ),
   tbl AS (
     select denominator.csa,(numerator.result / NULLIF(denominator.result,0) )*(100::numeric) as result 
     from numerator left join denominator on numerator.csa = denominator.csa
    )
  select * from tbl where 1 = 1 ORDER BY csa ASC;
  """

miscnotes =   """
  afile_1617


  NULLIF(denominator.result,0)

  ERROR: wleavecode

  43 - 'W43 - Death' 

  LEAVE CODES


  WLEAVECODE SY15-16 LEAVECODE SY16-17 Code
  0 00 0 'None'
  C60 60 'C60 - Graduated'
  'C61 - Graduated Certificate of Merit'
  C62 62 'C62 - Graduated HS certificate'
  'C63 - Graduated Special Ed'
  C70 70 'C70 - Early college admission'
  T10 10 'T10 - To other BCPS'
  T13 13 'T13 - Transfer to MD Public School'
  T14 14 'T14 - to US public school'
  T15 15 'T15 - to non-public school within city'
  16 'T16 - to non-public school outside Baltimore'
  17 'T17 - to Us Non-public school' 
  18'T18 - to any school outside the US' T21 T21 - to evening high school'
  22 'T22 - To state institution w/epdgm'
  24 'T24 - To parent teaching'
  26 T27
  30 'W30 - Illness- no education program'
  31 'W31 - Over 16, lack of academic success'
  'W32 - Over 16, discpl (not expelled) '
  33 'W33 - Over 16, lack of motivation'
  34 'W34  employment'
  'W35 - marriage'
  'W36 - military service'
  38 'W38 - Court action to institution'
  W39 'W39 - Over 16, economic reasons'
  'W40 - Under 16 expulsion'
  41 'W41 - Under 5 immaturity'
  42 'W42 - Under 16 special case'
  43 'W43 - Death'
  'W44 - Over 16 parenting'
  'W46 - Over 16 expulsion required'
  50 'W50 - Whereabouts unknown'
  W71 'W71 - Pregnancy'.
  W85 85
  """#export
def drop(df, csa, yr): 
  df['count'] = 1

  # Create the Denominator
  denom = df.copy()
  denom = denom[ denom['grade'].str.contains('^9$|^10$|^11$|^12$', regex=True)  & (denom['daysattend'] > 1) ] 

  # Create the Numerator 
  denom['wleavecode'] = denom['wleavecode'].astype(str)
  numer = denom[ ( denom['wleavecode'].str.contains('30|31|32|33|34|35|36|37|38|39|41|42|44|46|50|71|85', regex=True) ) ]

  id = '91'
  shortname = 'drop'
  
  # Group by CSA
  numer = numer.groupby('CSA2010').sum(numeric_only=True) 
  denom = denom.groupby('CSA2010').sum(numeric_only=True) 

  # Make sure ALL csas and BaltimoreCity are included and sorted.
  numer = csa.merge( numer, left_on='CSA2010', right_on='CSA2010', how='outer' )
  denom = csa.merge( denom, left_on='CSA2010', right_on='CSA2010', how='outer' )
  numer.drop( columns=['geometry', 'Shape__Length','Shape__Area'], inplace=True) 
  numer['denomCount'] = denom['count']
  
  # Do after sortViaCsaMerge to get index right. False records would show underneath it but still get added to the sum.
  numer.at[55,'count']=numer['count'].sum()
  numer.at[55,'denomCount']=numer['denomCount'].sum()

  # Perform the calculation
  numer[id+'-'+shortname+year] = numer['count'] / numer['denomCount'] * 100

  compareYears = gpd.read_file("https://services1.arcgis.com/mVFRs7NF4iFitgbY/ArcGIS/rest/services/"+shortname.capitalize()+"/FeatureServer/0/query?where=1%3D1&outFields=*&returnGeometry=true&f=pgeojson");
  goback = 2 if year == '19' else 3
  prevYear = shortname + str( int(year) - goback )
  if prevYear in compareYears.columns:
    numer = numer.merge( compareYears[['CSA2010', prevYear]], left_on='CSA2010', right_on='CSA2010', how='outer' ) 
    numer['change'] = numer[id+'-'+shortname+year] - numer[ prevYear ]
    numer['percentChange'] = numer['change' ] / numer[ prevYear ] * 100
    numer['change'] = numer['change'].apply(lambda x: "{:.2f}".format(x) )
    print( 'Records Matching Query: ', numer.size / len(numer.columns) )
  return numer.drop(columns=['daysattend', 'SchoolSwitcherFlag', 
               'daysabsent', 'race_AIAN', 'race_asian', 'race_AA', 
               'race_NHPI', 'race_white', 'std_number', 'enterdate'])fin = drop(bcpss, csa, year)
fin.to_csv('91-drop'+year+'.csv', index=False)
fin.head(6) <h3>92 compl - G - No Drop Dupes</h3>
lbl = """BCPSS - Education and Youth - High School Completion Rate"""

query16 = """with numerator as (
   select sum(
   case 
   when (daysattend::numeric > 1) AND (wleavecode LIKE 'C60') OR (wleavecode LIKE 'C62') AND (grade = '12')
   then 1
   else 0
   end)::numeric as result, csa
   from vital_signs.match_csas_and_bc_by_geom('schools.afile_2016', 'gid', 'the_geom') a
   left join schools.afile_2016 b on a.gid = b.gid
   group by csa
   ),
   denominator AS (
    select (sum(
     case 
     when (daysattend::numeric > 1) AND (grade = '12') 
     then 1
     else 0
     end)::numeric 
    ) as result, csa
    from vital_signs.match_csas_and_bc_by_geom('schools.afile_2016', 'gid', 'the_geom') a
    left join schools.afile_2016 b on a.gid = b.gid
    group by csa
   ),
 tbl AS (
                        select vital_signs.div_zero (numerator.result, denominator.result)*(100::numeric) as result, numerator.csa
                        from numerator left join denominator on numerator.csa = denominator.csa
                                                                )
     update vital_signs.data
   set compl = result from tbl where data.csa = tbl.csa and data_year = '2016';    
  """

OLD17 = """with numerator as (
   select sum(
   case 
   when (daysattend::numeric > 1) AND (wleavecode = '60') OR (wleavecode = '62') AND (grade = '12')
   then 1
   else 0
   end)::numeric as result, csa
   from vital_signs.match_csas_and_bc_by_geom('schools.afile_1617', 'gid', 'the_geom') a
   left join schools.afile_1617 b on a.gid = b.gid
   group by csa
   ),
   denominator AS (
    select (sum(
     case 
     when (daysattend::numeric > 1) AND (grade = '12') 
     then 1
     else 0
     end)::numeric 
    ) as result, csa
    from vital_signs.match_csas_and_bc_by_geom('schools.afile_1617', 'gid', 'the_geom') a
    left join schools.afile_1617 b on a.gid = b.gid
    group by csa
   ),
  tbl AS (
  select vital_signs.div_zero (numerator.result, denominator.result)*(100::numeric) as result, numerator.csa
  from numerator left join denominator on numerator.csa = denominator.csa
  )
  select * from tbl where 1 = 1 ORDER BY csa ASC;
  """

misc = """
  New 17: 

  afile_1617

  NULLIF(denominator.result,0)

  ERROR: wleavecode

  2016 Leave Codes: W50 T10 C60 T22 
  2017 Leave Codes: 85 62 10 10 60
  """#export
def compl(df, csa, yr): 
  df['count'] = 1

  # Create the Denominator
  denom = df.copy()
  denom = denom[ denom['grade'].str.contains('^12$', regex=True)  & (denom['daysattend'] > 1) ] 

  # Create the Numerator 
  denom['wleavecode'] = denom['wleavecode'].astype(str)
  numer = denom[ ( denom['wleavecode'].str.contains('85|62|10|60', regex=True) ) ]

  id = '92'
  shortname = 'compl'
  
  # Group by CSA
  numer = numer.groupby('CSA2010').sum(numeric_only=True) 
  denom = denom.groupby('CSA2010').sum(numeric_only=True) 

  # Make sure ALL csas and BaltimoreCity are included and sorted.
  numer = csa.merge( numer, left_on='CSA2010', right_on='CSA2010', how='outer' )
  denom = csa.merge( denom, left_on='CSA2010', right_on='CSA2010', how='outer' )
  numer.drop( columns=['geometry', 'Shape__Length','Shape__Area'], inplace=True) 
  numer['denomCount'] = denom['count']
  
  # Do after sortViaCsaMerge to get index right. False records would show underneath it but still get added to the sum.
  numer.at[55,'count']=numer['count'].sum()
  numer.at[55,'denomCount']=numer['denomCount'].sum()

  # Perform the calculation
  numer[id+'-'+shortname+year] = numer['count'] / numer['denomCount'] * 100

  compareYears = gpd.read_file("https://services1.arcgis.com/mVFRs7NF4iFitgbY/ArcGIS/rest/services/"+shortname.capitalize()+"/FeatureServer/0/query?where=1%3D1&outFields=*&returnGeometry=true&f=pgeojson");
  goback = 2 if year == '19' else 3
  prevYear = shortname + str( int(year) - goback )
  if prevYear in compareYears.columns:
    numer = numer.merge( compareYears[['CSA2010', prevYear]], left_on='CSA2010', right_on='CSA2010', how='outer' ) 
    numer['change'] = numer[id+'-'+shortname+year] - numer[ prevYear ]
    numer['percentChange'] = numer['change' ] / numer[ prevYear ] * 100
    numer['change'] = numer['change'].apply(lambda x: "{:.2f}".format(x) )
    print( 'Records Matching Query: ', numer.size / len(numer.columns) )
  return numer.drop(columns=['daysattend', 'SchoolSwitcherFlag', 
               'daysabsent', 'race_AIAN', 'race_asian', 'race_AA', 
               'race_NHPI', 'race_white', 'std_number', 'enterdate'])fin = compl(bcpss, csa, year)
fin.to_csv('92-compl'+year+'.csv', index=False)
fin.head(6) <h3>94 sclsw - B - No Filter Duplicates</h3>
<p>daysattend </p>
lbl = """BCPSS - Education and Youth - Percent of Students Switching Schools within School Year"""
""" Leave Code = 10 13 14 15 16 17 18 212 22 24"""

q16 = """ with numerator as (
   select sum(
   case 
   when (daysattend > 1) 
   then 1
   else 0
   end)::numeric as result, csa
   from vital_signs.match_csas_and_bc_by_geom('schools.schoolswitchers_2016', 'gid', 'the_geom') a
   left join schools.schoolswitchers_2016 b on a.gid = b.gid
   group by csa
   ),
   denominator AS (
    select (sum(
     case 
     when (daysattend::numeric > 1) 
     then 1
     else 0
     end)::numeric 
    ) as result, csa
    from vital_signs.match_csas_and_bc_by_geom('schools.afile_2016', 'gid', 'the_geom') a
    left join schools.afile_2016 b on a.gid = b.gid
    group by csa
   ),
 tbl AS (
                        select vital_signs.div_zero (numerator.result, denominator.result)*(100::numeric) as result, numerator.csa
                        from numerator left join denominator on numerator.csa = denominator.csa
                                                                )
     update vital_signs.data
   set sclsw = result from tbl where data.csa = tbl.csa and data_year = '2016';  
  """      """
       when (daysattend > 1) 
   then 1
   else 0
   /
     when (daysattend::numeric > 1) 
     then 1
     else 0
     """#export
def sclsw(df, denomdf, csa, yr): 
  df['count'] = 1
  denomdf['count'] = 1

  # Create the Denominator
  denom = denomdf.copy() #.sort_values('enterdate', ascending=False).drop_duplicates(['std_number']) 
  denom = denom[ (denom['daysattend'] > 1) ] 

  # Create the Numerator 
  numer = df.copy()
  numer = numer[ (numer['daysattend'] > 1) ] 

  id = '94'
  shortname = 'sclsw'
  
  # Group by CSA
  numer = numer.groupby('CSA2010').sum(numeric_only=True) 
  denom = denom.groupby('CSA2010').sum(numeric_only=True) 

  # Make sure ALL csas and BaltimoreCity are included and sorted.
  numer = csa.merge( numer, left_on='CSA2010', right_on='CSA2010', how='outer' )
  denom = csa.merge( denom, left_on='CSA2010', right_on='CSA2010', how='outer' )
  numer.drop( columns=['geometry', 'Shape__Length','Shape__Area'], inplace=True) 
  numer['denomCount'] = denom['count']
  
  # Do after sortViaCsaMerge to get index right. False records would show underneath it but still get added to the sum.
  numer.at[55,'count']=numer['count'].sum()
  numer.at[55,'denomCount']=numer['denomCount'].sum()

  # Perform the calculation
  numer[id+'-'+shortname+year] = numer['count'] / numer['denomCount'] * 100

  compareYears = gpd.read_file("https://services1.arcgis.com/mVFRs7NF4iFitgbY/ArcGIS/rest/services/"+shortname.capitalize()+"/FeatureServer/0/query?where=1%3D1&outFields=*&returnGeometry=true&f=pgeojson");
  goback = 2 if year == '19' else 3
  prevYear = shortname + str( int(year) - goback )
  if prevYear in compareYears.columns:
    numer = numer.merge( compareYears[['CSA2010', prevYear]], left_on='CSA2010', right_on='CSA2010', how='outer' ) 
    numer['change'] = numer[id+'-'+shortname+year] - numer[ prevYear ]
    numer['percentChange'] = numer['change' ] / numer[ prevYear ] * 100
    numer['change'] = numer['change'].apply(lambda x: "{:.2f}".format(x) )
    print( 'Records Matching Query: ', numer.size / len(numer.columns) )
  return numer.drop(columns=['daysattend', 'SchoolSwitcherFlag', 
               'daysabsent', 'race_AIAN', 'race_asian', 'race_AA', 
               'race_NHPI', 'race_white', 'std_number', 'enterdate'])fin = sclsw(schoolSwitchersDF, bcpss, csa, year)
fin.to_csv('94-sclsw'+year+'.csv', index=False)
fin.head(6) <h3>195 eenrol - G - Drop Dupes - enrollment DF</h3>
<p>grade</p>
lbl = """BCPSS - Education and Youth - Number of Students Officially Enrolled in 1st - 5th Grade"""

q16 = """ with tbl AS (
    select (sum(
  case 
  when grade = '1' OR grade = '2' OR grade = '3' OR grade = '4' OR grade = '5'
  then 1
  else 0
  end)::numeric 
 ) as result, csa
 from vital_signs.match_csas_and_bc_by_geom('schools.enrollment_2016', 'gid', 'the_geom') a
 left join schools.enrollment_2016 b on a.gid = b.gid
 group by csa
     )
     update vital_signs.data
     set eenrol = result from tbl where data.csa = tbl.csa and data_year = '2016';
  """

q17 = """with tbl AS (
  select (sum( case 
    when grade = '1' OR grade = '2' OR grade = '3' OR grade = '4' OR grade = '5'
     then 1 else 0
       end)::numeric 
   ) as result, csa
     from vital_signs.match_csas_and_bc_by_geom('schools.enrollment_1617', 'gid', 'the_geom') a
       left join schools.enrollment_1617 b on a.gid = b.gid
         group by csa
  )
  select * from tbl where 1 = 1 ORDER BY csa ASC;
  """bcpssTemp.shape[0]bcpss.shape[0]enrollment.shape[0]<p>Whatever the VS year is, the school year is the year before. so for vs20, the school year to filter on (need to know the date they entered) is sept 2019.</p>
enrollment.dtypes#export
def eenrol(df, csa, yr): 
  df['count'] = 1

  # Create the Numerator 
  numer = df.copy() # .sort_values('enterdate', ascending=False).drop_duplicates(['std_number']) 
  numer = numer[ numer['grade'].str.contains('^1$|^2$|^3$|^4$|^5$', regex=True) ]

  id = '195'
  shortname = 'eenrol'
  
  # Group by CSA
  numer = numer.groupby('CSA2010').sum(numeric_only=True)  

  # Make sure ALL csas and BaltimoreCity are included and sorted.
  numer = csa.merge( numer, left_on='CSA2010', right_on='CSA2010', how='outer' ) 
  numer.drop( columns=['geometry', 'Shape__Length','Shape__Area'], inplace=True)
  
  # Do after sortViaCsaMerge to get index right. False records would show underneath it but still get added to the sum.
  numer.at[55,'count']=numer['count'].sum()

  # Perform the calculation
  numer[id+'-'+shortname+year] = numer['count']

  compareYears = gpd.read_file("https://services1.arcgis.com/mVFRs7NF4iFitgbY/ArcGIS/rest/services/"+shortname.capitalize()+"/FeatureServer/0/query?where=1%3D1&outFields=*&returnGeometry=true&f=pgeojson");
  goback = 2 if year == '19' else 3
  prevYear = shortname + str( int(year) - goback )
  if prevYear in compareYears.columns:
    numer = numer.merge( compareYears[['CSA2010', prevYear]], left_on='CSA2010', right_on='CSA2010', how='outer' ) 
    numer['change'] = numer[id+'-'+shortname+year] - numer[ prevYear ]
    numer['percentChange'] = numer['change' ] / numer[ prevYear ] * 100
    numer['change'] = numer['change'].apply(lambda x: "{:.2f}".format(x) )
    print( 'Records Matching Query: ', numer.size / len(numer.columns) )
  return numer.drop(columns=['daysattend', 'SchoolSwitcherFlag', 
               'daysabsent', 'race_AIAN', 'race_asian', 'race_AA', 
               'race_NHPI', 'race_white', 'std_number', 'enterdate'])fin = eenrol(enrollment, csa, year)
fin.to_csv('195-eenrol'+year+'.csv', index=False)
fin.tail(3)<h3>196 menrol - G - Drop Dupes</h3>
<p>grade</p>
""" BCPSS - Education and Youth - Number of Students Officially Enrolled in 6th - 8th Grade"""

q16 = """with tbl AS (
    select (sum(
  case 
  when grade = '6' OR grade = '7' OR grade = '8' 
  then 1
  else 0
  end)::numeric 
 ) as result, csa
 from vital_signs.match_csas_and_bc_by_geom('schools.enrollment_2016', 'gid', 'the_geom') a
 left join schools.enrollment_2016 b on a.gid = b.gid
 group by csa
     )
     update vital_signs.data
     set menrol = result from tbl where data.csa = tbl.csa and data_year = '2016';
  """

q17 = """with tbl AS (
    select (sum( case 
      when grade = '6' OR grade = '7' OR grade = '8' 
        then 1 else 0 end)::numeric 
    ) as result, csa
      from vital_signs.match_csas_and_bc_by_geom('schools.enrollment_1617', 'gid', 'the_geom') a
        left join schools.enrollment_1617 b on a.gid = b.gid
          group by csa
  )
  select * from tbl where 1 = 1 ORDER BY csa ASC;
  """"""
      when grade = '6' OR grade = '7' OR grade = '8' 
        then 1 else 0 end)::numeric 
"""#export
def menrol(df, csa, yr): 
  df['count'] = 1

  # Create the Denominator
  numer = df.copy()
  numer = numer[ numer['grade'].str.contains('^6$|^7$|^8$', regex=True) ]

  id = '196'
  shortname = 'menrol'
  
  # Group by CSA
  numer = numer.groupby('CSA2010').sum(numeric_only=True)  

  # Make sure ALL csas and BaltimoreCity are included and sorted.
  numer = csa.merge( numer, left_on='CSA2010', right_on='CSA2010', how='outer' ) 
  numer.drop( columns=['geometry', 'Shape__Length','Shape__Area'], inplace=True)
  
  # Do after sortViaCsaMerge to get index right. False records would show underneath it but still get added to the sum.
  numer.at[55,'count']=numer['count'].sum()

  # Perform the calculation
  numer[id+'-'+shortname+year] = numer['count']

  compareYears = gpd.read_file("https://services1.arcgis.com/mVFRs7NF4iFitgbY/ArcGIS/rest/services/"+shortname.capitalize()+"/FeatureServer/0/query?where=1%3D1&outFields=*&returnGeometry=true&f=pgeojson");
  goback = 2 if year == '19' else 3
  prevYear = shortname + str( int(year) - goback )
  if prevYear in compareYears.columns:
    numer = numer.merge( compareYears[['CSA2010', prevYear]], left_on='CSA2010', right_on='CSA2010', how='outer' ) 
    numer['change'] = numer[id+'-'+shortname+year] - numer[ prevYear ]
    numer['percentChange'] = numer['change' ] / numer[ prevYear ] * 100
    numer['change'] = numer['change'].apply(lambda x: "{:.2f}".format(x) )
    print( 'Records Matching Query: ', numer.size / len(numer.columns) )
  return numer.drop(columns=['daysattend', 'SchoolSwitcherFlag', 'wleavecode', 
               'daysabsent', 'race_AIAN', 'race_asian', 'race_AA', 
               'race_NHPI', 'race_white', 'std_number', 'enterdate'])fin = menrol(enrollment, csa, year)
fin.to_csv('196-menrol'+year+'.csv', index=False)
fin.tail(6) <h3>197 hsenrol - G - Drop Dupes</h3>
<p>grade</p>
lbl = """BCPSS - Education and Youth - Number of Students Officially Enrolled in 9th - 12th Grade """

q16 = """with tbl AS (
    select (sum(
  case 
  when grade = '9' OR grade = '10' OR grade = '11' OR grade = '12'
  then 1
  else 0
  end)::numeric 
 ) as result, csa
 from vital_signs.match_csas_and_bc_by_geom('schools.enrollment_2016', 'gid', 'the_geom') a
 left join schools.enrollment_2016 b on a.gid = b.gid
 group by csa
     )
     update vital_signs.data
     set hsenrol = result from tbl where data.csa = tbl.csa and data_year = '2016';
  """

q17 = """ with tbl AS (
    select (sum( case 
      when grade = '9' OR grade = '10' OR grade = '11' OR grade = '12'
        then 1 else 0 end)::numeric 
    ) as result, csa
      from vital_signs.match_csas_and_bc_by_geom('schools.enrollment_1617', 'gid', 'the_geom') a
        left join schools.enrollment_1617 b on a.gid = b.gid
          group by csa
  )
  select * from tbl where 1 = 1 ORDER BY csa ASC;
  """"""
       when grade = '9' OR grade = '10' OR grade = '11' OR grade = '12'
        then 1 else 0 end)::numeric  
"""#export
def hsenrol(df, csa, yr): 
  df['count'] = 1

  # Create the Denominator
  numer = df.copy() #.sort_values('enterdate', ascending=False).drop_duplicates(['std_number']) 
  numer = numer[ numer['grade'].str.contains('^9$|^10$|^11$|^12$', regex=True) ]
  print( numer['grade'].unique() )

  id = '197'
  shortname = 'hsenrol'
  
  # Group by CSA
  numer = numer.groupby('CSA2010').sum(numeric_only=True)  

  # Make sure ALL csas and BaltimoreCity are included and sorted.
  numer = csa.merge( numer, left_on='CSA2010', right_on='CSA2010', how='outer' ) 
  numer.drop( columns=['geometry', 'Shape__Length','Shape__Area'], inplace=True)
  
  # Bcity is the sum of the community sums.
  # Incorrect Bcity Sum IFF Groupby keeps a 'False' row (index 56)
  numer.at[55,'count']=numer['count'].sum()

  # Perform the calculation
  fincol = id+'-'+shortname+year 
  numer[fincol] = numer['count']

  compareYears = gpd.read_file("https://services1.arcgis.com/mVFRs7NF4iFitgbY/ArcGIS/rest/services/"+shortname.capitalize()+"/FeatureServer/0/query?where=1%3D1&outFields=*&returnGeometry=true&f=pgeojson");
  goback = 2 if year == '19' else 3
  prevYear = shortname + str( int(year) - goback )
  if prevYear in compareYears.columns:
    numer = numer.merge( compareYears[['CSA2010', prevYear]], left_on='CSA2010', right_on='CSA2010', how='outer' ) 
    numer['change'] = numer[fincol] - numer[ prevYear ]
    numer['percentChange'] = numer['change' ] / numer[ prevYear ] * 100
    numer['change'] = numer['change'].apply(lambda x: "{:.2f}".format(x) )
    print( 'Records Matching Query: ', numer.size / len(numer.columns) )
  return numer.drop(columns=['daysattend', 'daysabsent', 'race_AIAN', 'race_asian', 'race_AA', 'race_NHPI', 'race_white', 'std_number', 'enterdate'])fin = hsenrol(enrollment, csa, year)
fin.to_csv('197-hsenrol'+year+'.csv', index=False)
fin.tail(6) <h3>206 pmath3 - G ❌</h3>
<p>grade  parcc_perf subject</p>
lbl = """BCPSS - Education and Youth - Percentage of 3rd Grade Students who Met or Exceeded PARCC Math"""

q16 = """with numerator as (
    select sum( case 
      when (grade = '3')  AND (parcc_perf =4 OR parcc_perf = 5) 
        then 1 else 0 end
    )::numeric as math3_proficiency, csa
      from vital_signs.match_csas_and_bc_by_geom('schools.math_2016', 'gid', 'the_geom') a
        left join schools.math_2016 b on a.gid = b.gid
          group by csa
            order by csa
  ),
  denominator AS (
    select sum( case 
      when (grade = '3') 
        then 1 else 0 end
    )::numeric as math3_testtakers, csa
      from vital_signs.match_csas_and_bc_by_geom('schools.math_2016', 'gid', 'the_geom') a
        left join schools.math_2016 b on a.gid = b.gid
          group by csa
            order by csa
  ),
  tbl AS (
  select vital_signs.div_zero (numerator.math3_proficiency, denominator.math3_testtakers)*(100::numeric) as result, numerator.csa
  from numerator left join denominator on numerator.csa = denominator.csa
  )
  select * from tbl
  """

q17 = """with numerator as (
    select sum( case 
      when (grade = '3')  AND (parcc_perf =4 OR parcc_perf = 5) AND subject = 'Mathematics'
        then 1 else 0 end
    )::numeric as math3_proficiency, csa
      from vital_signs.match_csas_and_bc_by_geom('schools.parcc_1617', 'gid', 'the_geom') a
        left join schools.parcc_1617 b on a.gid = b.gid
          group by csa
            order by csa
  ),
  denominator AS (
    select sum( case 
      when (grade = '3') AND subject = 'Mathematics'
        then 1 else 0 end
    )::numeric as math3_testtakers, csa
      from vital_signs.match_csas_and_bc_by_geom('schools.parcc_1617', 'gid', 'the_geom') a
        left join schools.parcc_1617 b on a.gid = b.gid
          group by csa
            order by csa
  ),
  tbl AS (
  select vital_signs.div_zero (numerator.math3_proficiency, denominator.math3_testtakers)*(100::numeric) as result, numerator.csa
  from numerator left join denominator on numerator.csa = denominator.csa
  )
  select * from tbl where 1 = 1 ORDER BY csa ASC;"""      when (grade = '3')  AND (parcc_perf =4 OR parcc_perf = 5) AND subject = 'Mathematics'
        then 1 else 0 end
        
        /

      when (grade = '3') AND subject = 'Mathematics'
        then 1 else 0 end<h3>207 pread3 - G ❌</h3>
<p>grade  parcc_perf subject</p>
BCPSS
Education and Youth
Percentage of 3rd Grade Students who Met or Exceeded PARCC Reading

q16 = """with numerator as (
    select sum( case 
      when (grade = '3') AND (parcc_perf =4 OR parcc_perf = 5)
        then 1 else 0 end
    )::numeric as eng_prof, csa
      from vital_signs.match_csas_and_bc_by_geom('schools.english_2016', 'gid', 'the_geom') a
        left join schools.english_2016 b on a.gid = b.gid
          group by csa
            order by csa
  ),
  denominator AS (
    select sum( case 
      when (grade = '3')
        then 1 else 0 end
    )::numeric as eng_prof, csa
      from vital_signs.match_csas_and_bc_by_geom('schools.english_2016', 'gid', 'the_geom') a
        left join schools.english_2016 b on a.gid = b.gid
          group by csa
            order by csa
  ),
  tbl AS (
    select vital_signs.div_zero (numerator.eng_prof, denominator.eng_prof)*(100::numeric) as result, numerator.csa
      from numerator 
        left join denominator on numerator.csa = denominator.csa
  )
  select * from tbl where 1 = 1 ORDER BY csa ASC;
  """

q17 = """ with numerator as (
    select sum( case 
      when (grade = '3') AND (parcc_perf =4 OR parcc_perf = 5) AND subject = 'English Language Arts/Literacy'
        then 1 else 0 end
    )::numeric as eng_prof, csa
      from vital_signs.match_csas_and_bc_by_geom('schools.parcc_1617', 'gid', 'the_geom') a
        left join schools.parcc_1617 b on a.gid = b.gid
          group by csa
            order by csa
  ),
  denominator AS (
    select sum( case 
      when (grade = '3') AND subject = 'English Language Arts/Literacy'
        then 1 else 0 end
    )::numeric as eng_prof, csa
      from vital_signs.match_csas_and_bc_by_geom('schools.parcc_1617', 'gid', 'the_geom') a
        left join schools.parcc_1617 b on a.gid = b.gid
          group by csa
            order by csa
  ),
  tbl AS (
    select vital_signs.div_zero (numerator.eng_prof, denominator.eng_prof)*(100::numeric) as result, numerator.csa
      from numerator 
        left join denominator on numerator.csa = denominator.csa
  )
  select * from tbl where 1 = 1 ORDER BY csa ASC;
  """      when (grade = '3') AND (parcc_perf =4 OR parcc_perf = 5) AND subject = 'English Language Arts/Literacy'
        then 1 else 0 end

        /
      when (grade = '3') AND subject = 'English Language Arts/Literacy'
        then 1 else 0 end<h3>208 pmath5 - G ❌</h3>
<p>grade  parcc_perf subject</p>
lbl = """BCPSS - Education and Youth - Percentage of 5th Grade Students who Met or Exceeded PARCC Math"""

q16 = """ with numerator as (
    select sum( case 
      when (grade = '5')  AND (parcc_perf =4 OR parcc_perf = 5)
        then 1 else 0 end
    )::numeric as math3_proficiency, csa
      from vital_signs.match_csas_and_bc_by_geom('schools.math_2016', 'gid', 'the_geom') a
        left join schools.math_2016 b on a.gid = b.gid
          group by csa
            order by csa
  ),
  denominator AS (
    select sum( case 
      when (grade = '5')
        then 1 else 0 end
    )::numeric as math3_testtakers, csa
      from vital_signs.match_csas_and_bc_by_geom('schools.math_2016', 'gid', 'the_geom') a
        left join schools.math_2016 b on a.gid = b.gid
          group by csa
            order by csa
  ),
  tbl AS (
    select vital_signs.div_zero (numerator.math3_proficiency, denominator.math3_testtakers)*(100::numeric) as result, numerator.csa
      from numerator 
        left join denominator on numerator.csa = denominator.csa
  )
  select * from tbl
  """

q17 = """
  with numerator as (
    select sum( case 
      when (grade = '5')  AND (parcc_perf =4 OR parcc_perf = 5) AND subject = 'Mathematics'
        then 1 else 0 end
    )::numeric as math3_proficiency, csa
      from vital_signs.match_csas_and_bc_by_geom('schools.parcc_1617', 'gid', 'the_geom') a
        left join schools.parcc_1617 b on a.gid = b.gid
          group by csa
            order by csa
  ),
  denominator AS (
    select sum( case 
      when (grade = '5') AND subject = 'Mathematics'
        then 1 else 0 end
    )::numeric as math3_testtakers, csa
      from vital_signs.match_csas_and_bc_by_geom('schools.parcc_1617', 'gid', 'the_geom') a
        left join schools.parcc_1617 b on a.gid = b.gid
          group by csa
            order by csa
  ),
  tbl AS (
    select vital_signs.div_zero (numerator.math3_proficiency, denominator.math3_testtakers)*(100::numeric) as result, numerator.csa
      from numerator 
        left join denominator on numerator.csa = denominator.csa
  )
  select * from tbl
  """      when (grade = '5')  AND (parcc_perf =4 OR parcc_perf = 5) AND subject = 'Mathematics'
        then 1 else 0 end

        /

      when (grade = '5') AND subject = 'Mathematics'
        then 1 else 0 end<h3>209 pread5 - G ❌</h3>
<p>grade  parcc_perf subject</p>
lbl = """BCPSS - Education and Youth - Percentage of 5th Grade Students who Met or Exceeded PARCC Reading"""

queries16 = """select sum(
  case 
  when (grade = '5') AND (parcc_perf =4 OR parcc_perf = 5) 
  then 1
  else 0
  end)::numeric as eng_prof, csa
  from vital_signs.match_csas_and_bc_by_geom('schools.english_2016', 'gid', 'the_geom') a
  left join schools.english_2016 b on a.gid = b.gid
  group by csa
  order by csa;


  select sum(
  case 
  when (grade_code = '5') 
  then 1
  else 0
  end)::numeric as eng_prof, csa
  from vital_signs.match_csas_and_bc_by_geom('schools.english_2016', 'gid', 'the_geom') a
  left join schools.english_2016 b on a.gid = b.gid
  group by csa
  order by csa;
  """

q17 = """with numerator as (
    select sum( case 
      when (grade = '8')  AND (parcc_perf =4 OR parcc_perf = 5) AND subject = 'Mathematics'
        then 1 else 0 end
    )::numeric as math3_proficiency, csa
      from vital_signs.match_csas_and_bc_by_geom('schools.parcc_1617', 'gid', 'the_geom') a
        left join schools.parcc_1617 b on a.gid = b.gid
          group by csa
            order by csa
  ),
  denominator AS (
    select sum( case 
      when (grade = '8') 
        then 1 else 0 end
    )::numeric as math3_testtakers, csa
      from vital_signs.match_csas_and_bc_by_geom('schools.parcc_1617', 'gid', 'the_geom') a
        left join schools.parcc_1617 b on a.gid = b.gid
          group by csa
            order by csa
  ),
  tbl AS (
  select vital_signs.div_zero (numerator.math3_proficiency, denominator.math3_testtakers)*(100::numeric) as result, numerator.csa
  from numerator left join denominator on numerator.csa = denominator.csa
  )
  select * from tbl
  """      when (grade = '8')  AND (parcc_perf =4 OR parcc_perf = 5) AND subject = 'Mathematics'
        then 1 else 0 end

  /

      when (grade = '8') 
        then 1 else 0 end<h3>210 pmath8 - G ❌</h3>
<p>grade  parcc_perf subject</p>
lbl = """BCPSS - Education and Youth - Percentage of 8th Grade Students who Met or Exceeded PARCC Math"""

q16 = """with numerator as (
    select sum( case 
      when (grade = '8')  AND (parcc_perf =4 OR parcc_perf = 5)
        then 1 else 0 end
    )::numeric as math3_proficiency, csa
      from vital_signs.match_csas_and_bc_by_geom('schools.math_2016', 'gid', 'the_geom') a
        left join schools.math_2016 b on a.gid = b.gid
          group by csa
            order by csa
  ),
  denominator AS (
    select sum( case 
      when (grade = '8')
        then 1 else 0 end
    )::numeric as math3_testtakers, csa
      from vital_signs.match_csas_and_bc_by_geom('schools.math_2016', 'gid', 'the_geom') a
        left join schools.math_2016 b on a.gid = b.gid
          group by csa
            order by csa
  ),
  tbl AS (
    select vital_signs.div_zero (numerator.math3_proficiency, denominator.math3_testtakers)*(100::numeric) as result, numerator.csa
      from numerator 
        left join denominator on numerator.csa = denominator.csa
  )
  select * from tbl
  """

q17 = """with numerator as (
    select sum( case 
      when (grade = '8')  AND (parcc_perf =4 OR parcc_perf = 5) AND subject = 'Mathematics'
        then 1 else 0 end
    )::numeric as math3_proficiency, csa
      from vital_signs.match_csas_and_bc_by_geom('schools.parcc_1617', 'gid', 'the_geom') a
        left join schools.parcc_1617 b on a.gid = b.gid
          group by csa
            order by csa
  ),
  denominator AS (
    select sum( case 
      when (grade = '8') AND subject = 'Mathematics'
        then 1 else 0 end
    )::numeric as math3_testtakers, csa
      from vital_signs.match_csas_and_bc_by_geom('schools.parcc_1617', 'gid', 'the_geom') a
        left join schools.parcc_1617 b on a.gid = b.gid
          group by csa
            order by csa
  ),
  tbl AS (
    select vital_signs.div_zero (numerator.math3_proficiency, denominator.math3_testtakers)*(100::numeric) as result, numerator.csa
      from numerator 
        left join denominator on numerator.csa = denominator.csa
  )
  select * from tbl
  """      when (grade = '8')  AND (parcc_perf =4 OR parcc_perf = 5) AND subject = 'Mathematics'
        then 1 else 0 end

        /

      when (grade = '8') AND subject = 'Mathematics'
        then 1 else 0 end<h3>211 pread8 - G ❌</h3>
<p>grade  parcc_perf subject eng_prof</p>
lbl = """BCPSS  - Education and Youth - Percentage of 8th Grade Students who Met or Exceeded PARCC Reading"""

q16 = """with numerator as (
    select sum( case 
      when (grade = '8') AND (parcc_perf =4 OR parcc_perf = 5) 
        then 1 else 0 end
  )::numeric as eng_prof, csa
    from vital_signs.match_csas_and_bc_by_geom('schools.english_2016', 'gid', 'the_geom') a
      left join schools.english_2016 b on a.gid = b.gid
        group by csa 
          order by csa
  ),
  denominator AS (
    select sum( case 
      when (grade = '8') 
        then 1 else 0
          end
    )::numeric as eng8_testtakers, csa
      from vital_signs.match_csas_and_bc_by_geom('schools.english_2016', 'gid', 'the_geom') a
        left join schools.english_2016 b on a.gid = b.gid
          group by csa 
            order by csa
  ),
  tbl AS (
    select vital_signs.div_zero (numerator.eng_prof, denominator.eng8_testtakers)*(100::numeric) as result, numerator.csa
      from numerator left join denominator on numerator.csa = denominator.csa
  )
  select * from tbl
  """

q17 = """with numerator as (
  select sum( case 
      when (grade = '8') AND (parcc_perf =4 OR parcc_perf = 5) AND subject = 'English Language Arts/Literacy'
        then 1 else 0 end
    )::numeric as eng_prof, csa
      from vital_signs.match_csas_and_bc_by_geom('schools.parcc_1617', 'gid', 'the_geom') a
        left join schools.parcc_1617 b on a.gid = b.gid
          group by csa
            order by csa
  ),
  denominator AS (
    select sum( case 
      when (grade = '8') AND subject = 'English Language Arts/Literacy'
        then 1 else 0 end
    )::numeric as eng_prof, csa
      from vital_signs.match_csas_and_bc_by_geom('schools.parcc_1617', 'gid', 'the_geom') a
        left join schools.parcc_1617 b on a.gid = b.gid
          group by csa
            order by csa
  ),
  tbl AS (
    select vital_signs.div_zero (numerator.eng_prof, denominator.eng_prof)*(100::numeric) as result, numerator.csa
      from numerator 
        left join denominator on numerator.csa = denominator.csa
  )
  select * from tbl where 1 = 1 ORDER BY csa ASC;
  """
      when (grade = '8') AND (parcc_perf =4 OR parcc_perf = 5) AND subject = 'English Language Arts/Literacy'
        then 1 else 0 end

        /

      when (grade = '8') AND subject = 'English Language Arts/Literacy'
        then 1 else 0 end<h3>212 palg1 - G ? - ❌</h3>
<p>grade  parcc_perf subject</p>
lbl = """BCPSS - Education and Youth - Percentage of Students who Met or Exceeded PARCC Algebra I"""

q16 = """with numerator as (
    select sum( case 
      when (grade = '9' or grade = '10' or grade = '11' or grade = '12') 
        AND (parcc_perf =4 OR parcc_perf = 5)
        then 1 else 0 
          end
    )::numeric as algebra1_met, csa
      from vital_signs.match_csas_and_bc_by_geom('schools.algebra1_2016', 'gid', 'the_geom') a
        left join schools.algebra1_2016 b on a.gid = b.gid
          group by csa
            order by csa
  ),
  denominator AS (
    select sum( case 
      when  (grade = '9' or grade = '10' or grade = '11' or grade = '12')
        then 1 else 0
          end
    )::numeric as algebra1_testtakers, csa
      from vital_signs.match_csas_and_bc_by_geom('schools.algebra1_2016', 'gid', 'the_geom') a
        left join schools.algebra1_2016 b on a.gid = b.gid
          group by csa 
            order by csa
  ),
  tbl AS (
    select vital_signs.div_zero (numerator.algebra1_met, denominator.algebra1_testtakers)*(100::numeric) as result, numerator.csa
      from numerator left join denominator on numerator.csa = denominator.csa
  )
  select * from tbl
  """

q17 = """with numerator as (
    select sum( case 
      when (grade = '9' or grade = '10' or grade = '11' or grade = '12') AND subject = 'Algebra I'
        AND (parcc_perf =4 OR parcc_perf = 5)
        then 1 else 0 
          end
    )::numeric as algebra1_met, csa
      from vital_signs.match_csas_and_bc_by_geom('schools.parcc_1617', 'gid', 'the_geom') a
        left join schools.parcc_1617 b on a.gid = b.gid
          group by csa
            order by csa
  ),
  denominator AS (
    select sum( case 
      when  (grade = '9' or grade = '10' or grade = '11' or grade = '12') AND subject = 'Algebra I'
        then 1 else 0
          end
    )::numeric as algebra1_testtakers, csa
      from vital_signs.match_csas_and_bc_by_geom('schools.parcc_1617', 'gid', 'the_geom') a
        left join schools.parcc_1617 b on a.gid = b.gid
          group by csa 
            order by csa
  ),
  tbl AS (
    select vital_signs.div_zero (numerator.algebra1_met, denominator.algebra1_testtakers)*(100::numeric) as result, numerator.csa
      from numerator left join denominator on numerator.csa = denominator.csa
  )
  select * from tbl
  """"""
      when (grade = '9' or grade = '10' or grade = '11' or grade = '12') AND subject = 'Algebra I'
        AND (parcc_perf =4 OR parcc_perf = 5)

        /
      when  (grade = '9' or grade = '10' or grade = '11' or grade = '12') AND subject = 'Algebra I'
        then 1 else 0
"""def palg1(df, csa, yr): 
  df['count'] = 1

  # Create the Denominator
  denom = df.copy().sort_values('enterdate', ascending=False).drop_duplicates(['std_number']) 
  denom = denom[ denom['grade'].str.contains('9|10|11|12', regex=True)  & (denom['subject'] == 'Algebra I') ] 

  # Create the Numerator 
  denom['parcc_perf'] = denom['parcc_perf'].astype(str)
  numer = denom[ ( denom['parcc_perf'].str.contains('4|5', regex=True) ) ]

  id = '212'
  shortname = 'palg1'
  
  # Group by CSA
  numer = numer.groupby('CSA2010').sum(numeric_only=True) 
  denom = denom.groupby('CSA2010').sum(numeric_only=True) 

  # Make sure ALL csas and BaltimoreCity are included and sorted.
  numer = csa.merge( numer, left_on='CSA2010', right_on='CSA2010', how='outer' )
  denom = csa.merge( denom, left_on='CSA2010', right_on='CSA2010', how='outer' )
  numer.drop( columns=['geometry', 'Shape__Length','Shape__Area'], inplace=True) 
  numer['denomCount'] = denom['count']
  
  # Do after sortViaCsaMerge to get index right. False records would show underneath it but still get added to the sum.
  numer.at[55,'count']=numer['count'].sum()
  numer.at[55,'denomCount']=numer['denomCount'].sum()

  # Perform the calculation
  numer[id+'-'+shortname+year] = numer['count'] / numer['denomCount'] * 100

  compareYears = gpd.read_file("https://services1.arcgis.com/mVFRs7NF4iFitgbY/ArcGIS/rest/services/"+shortname+"/FeatureServer/0/query?where=1%3D1&outFields=*&returnGeometry=true&f=pgeojson");
  prevYear = shortname+ str( int(year) - 1 )
  if prevYear in compareYears.columns:
    numer = numer.merge( compareYears[['CSA2010', prevYear]], left_on='CSA2010', right_on='CSA2010', how='outer' ) 
    numer['change'] = numer[id+'-'+shortname+year] - numer[ prevYear ]
    numer['percentChange'] = numer['change' ] / numer[ prevYear ] * 100
    numer['change'] = numer['change'].apply(lambda x: "{:.2f}".format(x) )
    print( 'Records Matching Query: ', numer.size / len(numer.columns) )
  return numer.drop(columns=['daysattend', 'daysabsent', 'GENDER', 'race_AIAN', 'race_asian', 'race_AA', 'race_NHPI', 'race_white', 'std_number', 'enterdate'])


fin = palg1(bcpss, csa, year)
fin.to_csv('212-palg1'+year+'.csv', index=False)
fin.head(60) <h3>213 palg2 - G ? - ❌</h3>
<p>grade  parcc_perf subject</p>
lbl = """Percentage of Students who Met or Exceeded PARCC Algebra II - Education and Youth - BCPSS"""

query16 = """with numerator as (
    select sum( case 
      when (grade = '9' or grade = '10' or grade = '11' or grade = '12')
        AND (parcc_perf =4 OR parcc_perf = 5)
        then 1 else 0 
          end
    )::numeric as algebra1_met, csa
      from vital_signs.match_csas_and_bc_by_geom('schools.algebra2_2016', 'gid', 'the_geom') a
        left join schools.algebra2_2016 b on a.gid = b.gid
          group by csa
            order by csa
  ),
  denominator AS (
    select sum( case 
      when  (grade = '9' or grade = '10' or grade = '11' or grade = '12')
        then 1 else 0
          end
    )::numeric as algebra1_testtakers, csa
      from vital_signs.match_csas_and_bc_by_geom('schools.algebra2_2016', 'gid', 'the_geom') a
        left join schools.algebra2_2016 b on a.gid = b.gid
          group by csa 
            order by csa
  ),
  tbl AS (
    select vital_signs.div_zero (numerator.algebra1_met, denominator.algebra1_testtakers)*(100::numeric) as result, numerator.csa
      from numerator left join denominator on numerator.csa = denominator.csa
  )
  select * from tbl
  """


query17 = """ with numerator as (
    select sum( case 
      when (grade = '9' or grade = '10' or grade = '11' or grade = '12') AND subject = 'Algebra II'
        AND (parcc_perf =4 OR parcc_perf = 5)
        then 1 else 0 
          end
    )::numeric as algebra1_met, csa
      from vital_signs.match_csas_and_bc_by_geom('schools.parcc_1617', 'gid', 'the_geom') a
        left join schools.parcc_1617 b on a.gid = b.gid
          group by csa
            order by csa
  ),
  denominator AS (
    select sum( case 
      when  (grade = '9' or grade = '10' or grade = '11' or grade = '12') AND subject = 'Algebra II'
        then 1 else 0
          end
    )::numeric as algebra1_testtakers, csa
      from vital_signs.match_csas_and_bc_by_geom('schools.parcc_1617', 'gid', 'the_geom') a
        left join schools.parcc_1617 b on a.gid = b.gid
          group by csa 
            order by csa
  ),
  tbl AS (
    select vital_signs.div_zero (numerator.algebra1_met, denominator.algebra1_testtakers)*(100::numeric) as result, numerator.csa
      from numerator left join denominator on numerator.csa = denominator.csa
  )
  select * from tbl
  """"""
      when (grade = '9' or grade = '10' or grade = '11' or grade = '12') AND subject = 'Algebra II'
        AND (parcc_perf =4 OR parcc_perf = 5)
/

      when  (grade = '9' or grade = '10' or grade = '11' or grade = '12') AND subject = 'Algebra II'
"""def palg2(df, csa, yr): 
  df['count'] = 1

  # Create the Denominator
  denom = df.copy().sort_values('enterdate', ascending=False).drop_duplicates(['std_number']) 
  denom = denom[ denom['grade'].str.contains('9|10|11|12', regex=True)  & (denom['subject'] == 'Algebra I') ] 

  # Create the Numerator 
  denom['parcc_perf'] = denom['parcc_perf'].astype(str)
  numer = denom[ ( denom['parcc_perf'].str.contains('4|5', regex=True) ) ]

  id = '213'
  shortname = 'palg2'
  
  # Group by CSA
  numer = numer.groupby('CSA2010').sum(numeric_only=True) 
  denom = denom.groupby('CSA2010').sum(numeric_only=True) 

  # Make sure ALL csas and BaltimoreCity are included and sorted.
  numer = csa.merge( numer, left_on='CSA2010', right_on='CSA2010', how='outer' )
  denom = csa.merge( denom, left_on='CSA2010', right_on='CSA2010', how='outer' )
  numer.drop( columns=['geometry', 'Shape__Length','Shape__Area'], inplace=True) 
  numer['denomCount'] = denom['count']
  
  # Do after sortViaCsaMerge to get index right. False records would show underneath it but still get added to the sum.
  numer.at[55,'count']=numer['count'].sum()
  numer.at[55,'denomCount']=numer['denomCount'].sum()

  # Perform the calculation
  numer[id+'-'+shortname+year] = numer['count'] / numer['denomCount'] * 100

  compareYears = gpd.read_file("https://services1.arcgis.com/mVFRs7NF4iFitgbY/ArcGIS/rest/services/"+shortname+"/FeatureServer/0/query?where=1%3D1&outFields=*&returnGeometry=true&f=pgeojson");
  prevYear = shortname+ str( int(year) - 1 )
  if prevYear in compareYears.columns:
    numer = numer.merge( compareYears[['CSA2010', prevYear]], left_on='CSA2010', right_on='CSA2010', how='outer' ) 
    numer['change'] = numer[id+'-'+shortname+year] - numer[ prevYear ]
    numer['percentChange'] = numer['change' ] / numer[ prevYear ] * 100
    numer['change'] = numer['change'].apply(lambda x: "{:.2f}".format(x) )
    print( 'Records Matching Query: ', numer.size / len(numer.columns) )
  return numer.drop(columns=['daysattend', 'daysabsent', 'GENDER', 'race_AIAN', 'race_asian', 'race_AA', 'race_NHPI', 'race_white', 'std_number', 'enterdate'])


fin = palg2(bcpss, csa, year)
fin.to_csv('213-palg2'+year+'.csv', index=False)
fin.head(60) <h3>214 kra - O ❌</h3>
<p>std_number Demonstrating comp</p>
lbl = """ Kindergarten Readiness - Education and Youth - BCPSS"""

desc = """The Kindergarten Readiness Assessment (KRA) measure children’s readiness to do kindergarten work. 
  The KRA is a developmentally appropriate assessment tool that measures of incoming public-school 
  kindergarteners across four learning domains. A child is considered to be ready for kindergarten 
  if assessed as “demonstrating” the foundational skills and behaviors that prepare him/her for 
  curriculum based on the kindergarten standards. """

query16 = """with numerator as (
    select csa, count ( DISTINCT std_numb_1 ) as test_met
      from vital_signs.match_csas_and_bc_by_geom('schools.kra_2016', 'gid', 'the_geom') as a
        left join schools.kra_2016 as b 
          on a.gid = b.gid AND comp = 'Demonstrating'
            group by csa
              order by csa
  ),
  denominator AS (
    select csa, count ( DISTINCT std_number ) test_takers
      from vital_signs.match_csas_and_bc_by_geom('schools.kra_2016', 'gid', 'the_geom') as a
        left join schools.kra_2016 as b 
          on a.gid = b.gid AND comp NOT IN ('Other', 'Incomplete')
            group by csa
              order by csa
  ),
  tbl AS (
    select vital_signs.div_zero (numerator.test_met, denominator.test_takers)*(100::numeric) 
      as result, numerator.csa
      from numerator 
        left join denominator 
          on numerator.csa = denominator.csa
  )
  select * from tbl
  """

query17 = """with numerator as (
    select csa, count ( DISTINCT std_number ) as test_met
      from vital_signs.match_csas_and_bc_by_geom('schools.kra_1617', 'gid', 'the_geom') as a
        left join schools.kra_1617 as b 
          on a.gid = b.gid AND comp = 'Demonstrating'
            group by csa
              order by csa
  ),
  denominator AS (
    select csa, count ( DISTINCT std_number ) test_takers
      from vital_signs.match_csas_and_bc_by_geom('schools.kra_1617', 'gid', 'the_geom') as a
        left join schools.kra_1617 as b 
          on a.gid = b.gid AND comp NOT IN ('Other', 'Incomplete')
            group by csa
              order by csa
  ),
  tbl AS (
    select vital_signs.div_zero (numerator.test_met, denominator.test_takers)*(100::numeric) 
      as result, numerator.csa
      from numerator 
        left join denominator 
          on numerator.csa = denominator.csa
  )
  select * from tbl
  """

uhmm = """
  The percentage of children whose composite score indicates full school readiness out of all 
  kindergarten school children tested within an area in a school year. The Maryland Model for 
  School Readiness (MMSR) is an assessment and instructional system that was designed to provide 
  parents, teachers, and early childhood providers with a common understanding of what children 
  know and are able to do upon entering school. Under the MMSR system, all children entering 
  kindergarten are assessed for level of mastery across several learning domains. These domains 
  include: social and personal development; language and literacy; mathematical thinking; 
  scientific thinking; social studies; the arts; and physical development and health. 
  Kindergarten  teachers must evaluate students during the first few months of the kindergarten 
  year using selected Work Sampling System (WSS) indicators and report their ratings by the 
  end of November of each year to the state. """

query2013 = """
  "-- mmsr13nbr_bcf
  --mmsr13 indicator number 80
  SELECT bAll.name AS Bound, sum(bQuery.mmsr13nbr) as mmsr13nbr
    FROM boundaries.bcf_areas bAll
      LEFT JOIN (
    SELECT bounds.name as Boundary, (count(DISTINCT b.sid::numeric(20,4))) as mmsr13nbr
    FROM schools.mmsr_2013 as b
      LEFT JOIN boundaries.bcf_areas as a
        ON ST_Contains(a.the_geom, b.the_geom)
      WHERE compscore = 3
        GROUP BY bounds.name
        ORDER BY bounds.name
  ) bQuery
    ON bAll.name = bQuery.Boundary
      GROUP BY Bound
      ORDER BY Bound;

  -- mmsr_total13nbr_bcf
  --mmsr13 indicator number 80
  SELECT bAll.name AS Bound, sum(bQuery.mmsr13nbr) as mmsr13nbr
    FROM boundaries.bcf_areas bAll
      LEFT JOIN (
        SELECT bounds.name as Boundary, (count(DISTINCT Tables.sid::numeric(20,4))) as mmsr13nbr
      FROM schools.mmsr_2013 as Tables
      LEFT JOIN boundaries.bcf_areas as bounds
        ON ST_Contains(bounds.the_geom, Tables.the_geom)
      GROUP BY bounds.name
        ORDER BY bounds.name
  ) bQuery
    ON bAll.name = bQuery.Boundary
      GROUP BY Bound
      ORDER BY Bound;
  """ 

specialnote = """2014 and 2015 does not exist for either kindergarden Indicator. These two years the tests were in the process of changing."""query17 = """with numerator = on a.gid = b.gid AND comp = 'Demonstrating'
  denominator AS on a.gid = b.gid AND comp NOT IN ('Other', 'Incomplete')</div></section></div>    	<div class="row"  style="background-color: #FDFDFD; border-top: 15px solid #007db6; -moz-box-shadow: inset 0 0 5px #888; -webkit-box-shadow: inset 0 0 5px#888; box-shadow: inner 0 0 5px #888;">
		<div class="container" style="margin-top: 10px;">
		<style>#copy-text-lakin{overflow:hidden;}#copy-text-lakin::after{clear:both; content:' '; display:block}#copy-text-lakin>*{width:822px; float:left; margin:0}#copy-text-lakin>#copy-text-lak{margin-left:-822px; background-color:#007db6; width:100%}</style>
            <div class="row">
                <!-- widget -->
				<div class="span3 widget">
					<h3><b>SEARCH</b></h3><form method="get" action="http://bniajfi.org/">
	<div class="input-append">
		<input type="text" id="appendedPrependedInput" name="s" size="16" class="span3" placeholder="Enter keywords to search..." value=""><input type="submit" id="searchsubmit" class="send" value="Go">
	  </div>
</form>				</div>
                <!-- end widget -->
				
                <!-- widget -->
				<div class="span3 widget">
					<h3><b>CONNECT WITH US</b></h3>			<div class="textwidget"><ul class="social" style="float: none; margin-bottom: 20px;">
<li><a target="_blank" class="facebook" href="http://www.facebook.com/bniajfi/">Facebook</a></li>
<li><a target="_blank" class="twitter" href="http://www.twitter.com/bniajfi/">Twitter</a></li>
<li><a target="_blank" class="youtube" href="http://www.youtube.com/bniajfi">YouTube</a></li>
<li><a target="_blank" class="rss" href="/feed/">RSS</a></li>
</ul>
</div>
						</div>
                <!-- end widget -->
				
                <!-- widget -->
				<div class="span3 widget">
					<h3><b>DONATE</b></h3>			<div class="textwidget"><p>Help us keep this resource free and available to the public. Donate now!</p>
<p><a href="http://bniajfi.org/donate" title="Donate Now" class="btn btn-warning">Donate to BNIA-JFI</a></p>
</div>
						</div>
                <!-- end widget -->
				
                <!-- widget -->
				<div class="span3 widget">
					<h3><b>CONTACT US</b></h3>			<div class="textwidget"><p style="font-size: 11px; font-weight: 600;">Baltimore Neighborhood Indicators Alliance<br />
The Jacob France Institute<br />
1420 N. Charles Street, Baltimore, MD 21201<br />
410-837-4377 | <a href="mailto:bnia-jfi@ubalt.edu">bnia-jfi@ubalt.edu</a></p>
</div>
						</div>
                <!-- end widget -->
            </div>
            <!-- end row -->
		</div>
		</div>
		    <!-- ************************** FOOTER -->
    <footer class="footer" style="padding-top: 5px; padding-bottom: 5px;">	
								<!-- row -->
					<div class="container">
					<div class="row">
						<div class="span6">
							<p style="color: #FFF; font-size: 10px;">Baltimore Neighborhood Indicators Alliance - &copy; 2018</p>
						</div>
						<!-- copyright text -->
						<div class="span6 copy-text">
<div id="copy-text-lakin"><div id="copy-text-lak">
										<a href="http://www.ubalt.edu" target="_blank" title="University of Baltimore"><img src="https://www.ubalt.edu/_resources/images/ub-logo-big.svg" style="height: 50px; width: 155px; float: right; margin-top: -5px;"/></a>
							<a href="http://www.ubalt.edu/jfi" target="_blank" title="Jacob France Institute"><img src="/images/jfilogo.png" style="height: 50px; width: 170px; float: right; margin-top: -5px;"/></a>
							<br/><br/>
							<p> </p>
</div></div>
						</div>
						<!-- end copyright text -->
					</div>
					</div>
					<!-- end row -->
				
        <!-- end contaner -->	
    </footer>
    <!-- ************************** end FOOTER -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-50651404-1', 'bniajfi.org');
ga('require', 'linkid', 'linkid.js');
ga('send', 'pageview');

</script>		<script>
		( function ( body ) {
			'use strict';
			body.className = body.className.replace( /\btribe-no-js\b/, 'tribe-js' );
		} )( document.body );
		</script>
		<script> /* <![CDATA[ */var tribe_l10n_datatables = {"aria":{"sort_ascending":": activate to sort column ascending","sort_descending":": activate to sort column descending"},"length_menu":"Show _MENU_ entries","empty_table":"No data available in table","info":"Showing _START_ to _END_ of _TOTAL_ entries","info_empty":"Showing 0 to 0 of 0 entries","info_filtered":"(filtered from _MAX_ total entries)","zero_records":"No matching records found","search":"Search:","all_selected_text":"All items on this page were selected. ","select_all_link":"Select all pages","clear_selection":"Clear Selection.","pagination":{"all":"All","next":"Next","previous":"Previous"},"select":{"rows":{"0":"","_":": Selected %d rows","1":": Selected 1 row"}},"datepicker":{"dayNames":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"dayNamesShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"dayNamesMin":["S","M","T","W","T","F","S"],"monthNames":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthNamesShort":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthNamesMin":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"nextText":"Next","prevText":"Prev","currentText":"Today","closeText":"Done","today":"Today","clear":"Clear"}};/* ]]> */ </script><link rel='stylesheet' id='login-with-ajax-css'  href='http://bniajfi.org/wp-content/plugins/login-with-ajax/widget/widget.css?ver=3.1.7' type='text/css' media='all' />
<link rel='stylesheet' id='wpa-css-css'  href='http://bniajfi.org/wp-content/plugins/wp-attachments/styles/0/wpa.css?ver=2483f238954e7cae2cd4dcb43c59bf93' type='text/css' media='all' />
<script type='text/javascript' src='http://bniajfi.org/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='http://bniajfi.org/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var LWA = {"ajaxurl":"http:\/\/bniajfi.org\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script type='text/javascript' src='http://bniajfi.org/wp-content/plugins/login-with-ajax/widget/login-with-ajax.js?ver=3.1.7'></script>
 
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.css" />
  <script src="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js"></script><script src="http://code.highcharts.com/highcharts.js"></script>
<script src="http://code.highcharts.com/modules/exporting.js"></script>

<script src="http://twitter.github.io/typeahead.js/releases/latest/typeahead.bundle.js"></script>
<script src=http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/js/Chart.min.js></script><script src=http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/js/bnia.js></script><script src=http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/js/indList.js?t=200></script><script src=http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/js/map3.js?t=1></script><script src=http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/js/vschart.js></script><script type='text/javascript' src='/vs_resources/charts/Chart.HorizontalBar.js'></script>
</body>
</html>
<div id='template'>  </div>