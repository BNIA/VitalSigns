---

title: Housing -> BidBaltimore -> TaxSale -> Taxlien Data Intake and Operations


keywords: fastai
sidebar: home_sidebar

summary: "This notebook uses data to generate a portion of BNIA's Vital Signs report."
description: "This notebook uses data to generate a portion of BNIA's Vital Signs report."
nb_path: "notebooks/Bidbalt_TaxSale_Taxlien.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: notebooks/Bidbalt_TaxSale_Taxlien.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This colab and more can be found at <a href="https://github.com/BNIA/VitalSigns">https://github.com/BNIA/VitalSigns</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Whats-Inside?:">Whats Inside?:<a class="anchor-link" href="#Whats-Inside?:"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Indicators-Used"><strong>Indicators Used</strong><a class="anchor-link" href="#Indicators-Used"> </a></h4><ul>
<li>✔️ 40 - <strong>taxlien</strong> - (MdProp, TaxSale) Percentage of residential tax lien sales</li>
</ul>
<p>❌</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Datasets-Used"><strong>Datasets Used</strong><a class="anchor-link" href="#Datasets-Used"> </a></h4><ul>
<li>✔️ housing.taxsales_201X <strong>(40-taxlien)</strong> From BidBaltimore</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">year</span> <span class="o">=</span> <span class="s2">&quot;19&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Import-Modules">Import Modules<a class="anchor-link" href="#Import-Modules"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">capture</span>
! pip install -U -q PyDrive
! pip install geopy
! pip install geopandas
! pip install geoplot
! pip install dataplay
! pip install matplotlib
! pip install psycopg2-binary
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">capture</span>
! apt-get install build-dep python-psycopg2
! apt-get install libpq-dev
! apt-get install libspatialindex-dev
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">capture</span>
!pip install rtree
!pip install dexplot
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">dataplay.geoms</span> <span class="kn">import</span> <span class="n">workWithGeometryData</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">capture</span> 
# These imports will handle everything
import os
import sys
import csv
import matplotlib.pyplot as plt
import numpy as np
import pandas as pd
import geopandas as gpd
from geopandas import GeoDataFrame
import psycopg2
import pyproj
from pyproj import Proj, transform
# conda install -c conda-forge proj4
from shapely.geometry import Point
from shapely import wkb
from shapely.wkt import loads
# https://pypi.org/project/geopy/
from geopy.geocoders import Nominatim

# In case file is KML, enable support
import fiona
fiona.drvsupport.supported_drivers[&#39;kml&#39;] = &#39;rw&#39;
fiona.drvsupport.supported_drivers[&#39;KML&#39;] = &#39;rw&#39;
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">clear_output</span>
<span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact</span><span class="p">,</span> <span class="n">interact_manual</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Configure-Enviornment">Configure Enviornment<a class="anchor-link" href="#Configure-Enviornment"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.expand_frame_repr&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.precision&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">IPython.core.interactiveshell</span> <span class="kn">import</span> <span class="n">InteractiveShell</span>
<span class="n">InteractiveShell</span><span class="o">.</span><span class="n">ast_node_interactivity</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span>

<span class="c1"># pd.set_option(&#39;display.expand_frame_repr&#39;, False)</span>
<span class="c1"># pd.set_option(&#39;display.precision&#39;, 2)</span>
<span class="c1"># pd.reset_option(&#39;max_colwidth&#39;)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;max_colwidth&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="c1"># pd.reset_option(&#39;max_colwidth&#39;)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">totalres</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;37-totalres-19.csv&quot;</span><span class="p">)</span>
<span class="c1"># totalres.set_index(&#39;CSA2010&#39;, inplace=True)</span>
<span class="n">totalres</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Taxsales_2019---BidBaltimore---OLD">Taxsales_2019 - BidBaltimore - OLD<a class="anchor-link" href="#Taxsales_2019---BidBaltimore---OLD"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">taxSales</span> <span class="o">=</span> <span class="n">taxSales</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">4326</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">taxSales</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">taxSales</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span>
<span class="n">taxSales</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">taxSales</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">y</span>
<span class="c1"># taxSales.head(5)</span>

<span class="n">taxSales</span> <span class="o">=</span> <span class="n">taxSales</span><span class="p">[</span> <span class="n">taxSales</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="mi">38</span> <span class="p">]</span>
<span class="n">taxSales</span> <span class="o">=</span> <span class="n">taxSales</span><span class="p">[</span> <span class="n">taxSales</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">70</span> <span class="p">]</span>
<span class="n">taxSales</span> <span class="o">=</span> <span class="n">taxSales</span><span class="p">[</span> <span class="n">taxSales</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">80</span> <span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">base</span> <span class="o">=</span> <span class="n">csa</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">taxSales</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">base</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">taxSalesCsa</span> <span class="o">=</span> <span class="n">workWithGeometryData</span><span class="p">(</span> 
     <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ponp&#39;</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="n">taxSales</span><span class="p">,</span> <span class="n">polys</span><span class="o">=</span><span class="n">csa</span><span class="p">,</span> <span class="n">ptsCoordCol</span><span class="o">=</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span> 
     <span class="n">polygonsCoordCol</span><span class="o">=</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="n">polygonsLabel</span><span class="o">=</span><span class="s1">&#39;CSA2010&#39;</span>
<span class="p">)</span>
<span class="n">taxSalesCsa</span> <span class="o">=</span> <span class="n">taxSalesCsa</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">taxSalesCsa</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;ponp_taxSales_19.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">taxSalesCsa</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Taxsales_2018---BidBaltimore---OLD">Taxsales_2018 - BidBaltimore - OLD<a class="anchor-link" href="#Taxsales_2018---BidBaltimore---OLD"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ls</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">taxSales</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;./TaxSales_2018.shp&quot;</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">taxSales</span> <span class="o">=</span> <span class="n">taxSales</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">4326</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">taxSales</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">taxSales</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span>
<span class="n">taxSales</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">taxSales</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">y</span>
<span class="c1"># taxSales.head(5)</span>

<span class="n">taxSales</span> <span class="o">=</span> <span class="n">taxSales</span><span class="p">[</span> <span class="n">taxSales</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="mi">38</span> <span class="p">]</span>
<span class="n">taxSales</span> <span class="o">=</span> <span class="n">taxSales</span><span class="p">[</span> <span class="n">taxSales</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">70</span> <span class="p">]</span>
<span class="n">taxSales</span> <span class="o">=</span> <span class="n">taxSales</span><span class="p">[</span> <span class="n">taxSales</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">80</span> <span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">base</span> <span class="o">=</span> <span class="n">csa</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">taxSales</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">base</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">taxSalesCsa18</span> <span class="o">=</span> <span class="n">workWithGeometryData</span><span class="p">(</span> 
     <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ponp&#39;</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="n">taxSales</span><span class="p">,</span> <span class="n">polys</span><span class="o">=</span><span class="n">csa</span><span class="p">,</span> <span class="n">ptsCoordCol</span><span class="o">=</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span> 
     <span class="n">polygonsCoordCol</span><span class="o">=</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="n">polygonsLabel</span><span class="o">=</span><span class="s1">&#39;CSA2010&#39;</span>
<span class="p">)</span>
<span class="n">taxSalesCsa18</span> <span class="o">=</span> <span class="n">taxSalesCsa18</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">taxSalesCsa18</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;ponp_taxSales_18.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">taxSalesCsa18</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Taxsales_2019---BidBaltimore---NEW">Taxsales_2019 - BidBaltimore - NEW<a class="anchor-link" href="#Taxsales_2019---BidBaltimore---NEW"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ls</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">original</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;TaxSales_20&quot;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s2">&quot;_CSACity.shp&quot;</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">original</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span> <span class="s1">&#39;CSA&#39;</span><span class="p">:</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">,</span> <span class="s1">&#39;BaltCity&#39;</span><span class="p">:</span><span class="s1">&#39;InBaltimore&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">original</span><span class="p">[</span> <span class="n">original</span><span class="p">[</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span> <span class="o">|</span> <span class="n">original</span><span class="p">[</span><span class="s1">&#39;InBaltimore&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>  <span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;After filtering records where a CSA or Baltimore geo-code match Exists&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;All rows Before Filter: &#39;</span><span class="p">,</span> <span class="n">original</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span> <span class="c1"># rows, columns</span>
<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;# w BCity.isnull: &#39;</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">InBaltimore</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="p">);</span> <span class="n">bmorow</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span> <span class="n">df</span><span class="o">.</span><span class="n">CSA2010</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>  <span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;# w CSA2010.isnull: &#39;</span><span class="p">,</span> <span class="n">bmorow</span> <span class="p">);</span> <span class="n">csarow</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span> <span class="n">df</span><span class="o">.</span><span class="n">CSA2010</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>  <span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> 
<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;# w CSA2010.notnull: &#39;</span><span class="p">,</span> <span class="n">csarow</span> <span class="p">);</span> 
<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;# rows After Filter: &#39;</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;==&#39;</span><span class="p">,</span><span class="n">csarow</span><span class="p">,</span><span class="s1">&#39;+&#39;</span><span class="p">,</span><span class="n">bmorow</span><span class="p">,</span><span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="n">csarow</span> <span class="o">+</span> <span class="n">bmorow</span><span class="p">);</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">CSA2010</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">CSA2010</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;Baltimore City&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">taxSales</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">taxSales</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Taxlien-40---(MdProp,-TaxSale)">Taxlien 40 - (MdProp, TaxSale)<a class="anchor-link" href="#Taxlien-40---(MdProp,-TaxSale)"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># https://services1.arcgis.com/mVFRs7NF4iFitgbY/arcgis/rest/services/taxlien/FeatureServer/layers</span>
<span class="c1"># https://bniajfi.org/indicators/Housing%20And%20Community%20Development/taxlien</span>

<span class="c1"># Numerator: housing.taxsales_201X</span>
<span class="c1"># Denominator: housing.mdprop_201X</span>

<span class="n">long_Description</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">The percentage of residential properties with city liens sold as tax certificates at the annual tax lien certificate sale held in May. </span>
<span class="s2">Tax sales are used to collect delinquent real property taxes and other unpaid charges to the city, which are liens against the real property.</span>
<span class="s2">The tax certificate sale is a public online auction of City lien interests on properties that occurs annually in May.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">taxlien_SQL</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2"> 2017 Query</span>
<span class="s2">  WITH numerator AS ( </span>
<span class="s2">   select (sum( case </span>
<span class="s2">    when csa_present</span>
<span class="s2">   then 1 else 0 end)::numeric) as result, csa</span>
<span class="s2">    from vital_signs.match_csas_and_bc_by_geom(&#39;housing.taxsales_2017&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">      left join housing.taxsales_2017 b on a.gid = b.gid</span>
<span class="s2">        group by csa ), </span>
<span class="s2">  denominator AS (</span>
<span class="s2">   select (sum( case </span>
<span class="s2">    when (address != $$NULL$$) AND (desclu = $$Apartments$$ OR desclu = $$Residential$$ OR desclu = $$Residential Commercial$$ OR desclu = $$Residential Condominium$$) then 1 else NULL end)::numeric ) as result, csa</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;housing.mdprop_2017&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">        left join housing.mdprop_2017 b on a.gid = b.gid</span>
<span class="s2">          group by csa, the_pop ),</span>
<span class="s2">  tbl AS (</span>
<span class="s2">   select denominator.csa,(numerator.result / denominator.result)*(100::numeric) as result </span>
<span class="s2">   from numerator left join denominator on numerator.csa = denominator.csa )</span>
<span class="s2">  select * from tbl where 1 = 1 ORDER BY csa ASC;&quot;</span>

<span class="s2"> 2016 query</span>
<span class="s2">  WITH numerator AS ( select (sum( case </span>
<span class="s2">   when csa_present then 1 else 0 end)::numeric) as result, csa</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;housing.taxsales_2016&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">        left join housing.taxsales_2016 b on a.gid = b.gid</span>
<span class="s2">          group by csa ),</span>
<span class="s2">  denominator AS (</span>
<span class="s2">   select (sum( case </span>
<span class="s2">    when (address != $$NULL$$) AND (desclu = $$Apartments$$ OR desclu = $$Residential$$ OR desclu = $$Residential Commercial$$ OR desclu = $$Residential Condominium$$) then 1 else NULL end)::numeric ) as result, csa</span>
<span class="s2">      from vital_signs.match_csas_and_bc_by_geom(&#39;housing.mdprop_2017&#39;, &#39;gid&#39;, &#39;the_geom&#39;) a</span>
<span class="s2">        left join housing.mdprop_2017 b on a.gid = b.gid</span>
<span class="s2">          group by csa, the_pop ),</span>
<span class="s2">  tbl AS (</span>
<span class="s2">   select denominator.csa,(numerator.result / denominator.result)*(100::numeric) as result </span>
<span class="s2">   from numerator left join denominator on numerator.csa = denominator.csa )</span>
<span class="s2">  update vital_signs.data</span>
<span class="s2">  set taxlien = result from tbl where data.csa = tbl.csa and data_year = &#39;2016&#39;; </span>
<span class="s2">  &quot;&quot;&quot;</span>

<span class="n">taxlien_translation</span> <span class="o">=</span> <span class="s2">&quot; (sum taxsales_2017 when csa_present / mdprop.totalres )* 100 &quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">oldpy</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">taxlien18 = df18.drop([&#39;X&#39;, &#39;Y&#39;, &#39;x&#39;, &#39;y&#39;], axis=1).copy()</span>
<span class="s2">taxlien18.head(2)</span>
<span class="s2">taxlien19 = df19.drop([&#39;X&#39;, &#39;Y&#39;, &#39;x&#39;, &#39;y&#39;], axis=1).copy()</span>
<span class="s2">taxlien19.head(2)</span>
<span class="s2">taxlien18[&#39;taxlien18Count&#39;] = 1</span>
<span class="s2">taxlien19[&#39;taxlien19Count&#39;] = 1</span>
<span class="s2">taxlien = taxlien19.groupby(&#39;CSA2010&#39;).sum(numeric_only=True) </span>
<span class="s2">taxlien[&#39;taxlien18Count&#39;] = taxlien18.groupby(&#39;CSA2010&#39;).sum(numeric_only=True)[&#39;taxlien18Count&#39;]</span>
<span class="s2">taxlien = taxlien[[&#39;taxlien18Count&#39;, &#39;taxlien19Count&#39;]]</span>
<span class="s2">taxlien[&#39;totalres18&#39;] = totalres[&#39;totalres18&#39;]</span>
<span class="s2">taxlien.head(1)</span>

<span class="s2"># DOES 2019 use the same denominator as 2018 as 2017?</span>
<span class="s2">taxlien[&#39;totalres19&#39;] = taxlien[&#39;totalres18&#39;]</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">totalres</span><span class="o">.</span><span class="n">columns</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">totalres</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;37-totalres-&quot;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s2">&quot;.csv&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="taxlien" class="doc_header"><code>taxlien</code><a href="https://github.com/bnia/VitalSigns/tree/main/VitalSigns/bidbaltimore.py#L6" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>taxlien</code>(<strong><code>df</code></strong>, <strong><code>totalres</code></strong>, <strong><code>year</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">taxlien</span> <span class="o">=</span> <span class="n">taxlien</span><span class="p">(</span> <span class="n">taxSales</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">totalres</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>

<span class="n">taxlien</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
<span class="n">taxlien</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;40-taxlien&#39;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

