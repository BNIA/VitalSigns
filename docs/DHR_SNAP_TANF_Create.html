---

title: VS SNAP/ TANF Data Intake and Operations


keywords: fastai
sidebar: home_sidebar

summary: "This notebook uses data to generate a portion of BNIA's Vital Signs report."
description: "This notebook uses data to generate a portion of BNIA's Vital Signs report."
nb_path: "notebooks/DHR_SNAP_TANF_Create.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: notebooks/DHR_SNAP_TANF_Create.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This colab and more can be found at <a href="https://github.com/BNIA/vitalsigns">https://github.com/BNIA/vitalsigns</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Whats-Inside?:">Whats Inside?:<a class="anchor-link" href="#Whats-Inside?:"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="The-Guided-Walkthrough"><strong>The Guided Walkthrough</strong><a class="anchor-link" href="#The-Guided-Walkthrough"> </a></h3><p>This notebook was made to create the following Housing Vital Signs Indicators:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Indicators-Used"><strong>Indicators Used</strong><a class="anchor-link" href="#Indicators-Used"> </a></h4><ul>
<li><p>✅ 106 - <strong>TANF</strong> -  (TANF) Percent of Families Receiving TANF</p>
</li>
<li><p>✅ ??? - <strong>SNAP</strong> -  (TANF) Percent of Families Receiving TANF</p>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Datasets-Used"><strong>Datasets Used</strong><a class="anchor-link" href="#Datasets-Used"> </a></h4><ul>
<li><p>✅ TANF.TANF_201X <strong>(106-columns)</strong></p>
</li>
<li><p>✅ SNAP.SNAP_201X <strong>(???-columns)</strong></p>
</li>
</ul>
<p>❌</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">year</span> <span class="o">=</span> <span class="s1">&#39;19&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Guided-Walkthrough">Guided Walkthrough<a class="anchor-link" href="#Guided-Walkthrough"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="SETUP-Enviornment:">SETUP Enviornment:<a class="anchor-link" href="#SETUP-Enviornment:"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Import-Modules">Import Modules<a class="anchor-link" href="#Import-Modules"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">capture</span>
! pip install -U -q PyDrive
! pip install geopy
! pip install geopandas
! pip install geoplot
! pip install dataplay
! pip install matplotlib
! pip install psycopg2-binary
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">capture</span>
! apt-get install build-dep python-psycopg2
! apt-get install libpq-dev
! apt-get install libspatialindex-dev
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">capture</span>
!pip install rtree
!pip install dexplot
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">dataplay.geoms</span> <span class="kn">import</span> <span class="n">workWithGeometryData</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">capture</span> 
# These imports will handle everything
import os
import sys
import csv
import matplotlib.pyplot as plt
import numpy as np
import pandas as pd
import geopandas as gpd
from geopandas import GeoDataFrame
import psycopg2
import pyproj
from pyproj import Proj, transform
# conda install -c conda-forge proj4
from shapely.geometry import Point
from shapely import wkb
from shapely.wkt import loads
# https://pypi.org/project/geopy/
from geopy.geocoders import Nominatim

# In case file is KML, enable support
import fiona
fiona.drvsupport.supported_drivers[&#39;kml&#39;] = &#39;rw&#39;
fiona.drvsupport.supported_drivers[&#39;KML&#39;] = &#39;rw&#39;
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">clear_output</span>
<span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact</span><span class="p">,</span> <span class="n">interact_manual</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Configure-Enviornment">Configure Enviornment<a class="anchor-link" href="#Configure-Enviornment"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.expand_frame_repr&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.precision&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">IPython.core.interactiveshell</span> <span class="kn">import</span> <span class="n">InteractiveShell</span>
<span class="n">InteractiveShell</span><span class="o">.</span><span class="n">ast_node_interactivity</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span>

<span class="c1"># pd.set_option(&#39;display.expand_frame_repr&#39;, False)</span>
<span class="c1"># pd.set_option(&#39;display.precision&#39;, 2)</span>
<span class="c1"># pd.reset_option(&#39;max_colwidth&#39;)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;max_colwidth&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="c1"># pd.reset_option(&#39;max_colwidth&#39;)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Prep-Datasets">Prep Datasets<a class="anchor-link" href="#Prep-Datasets"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="TPOP-CSA-and-Baltimore">TPOP CSA and Baltimore<a class="anchor-link" href="#TPOP-CSA-and-Baltimore"> </a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Get Baltimore</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse_input</span>
<span class="n">csa</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Families Denominator 2010 for TANF.csv&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Get CSA</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">csa</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">csa</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="SNAP">SNAP<a class="anchor-link" href="#SNAP"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">geopandas</span> 

<span class="n">original</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;SNAP20&quot;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s2">&quot;_CSACity.shp&quot;</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s1">&#39;geometry&#39;</span><span class="p">);</span>
<span class="n">original</span><span class="o">.</span><span class="n">columns</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">original</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span> <span class="s1">&#39;CSA&#39;</span><span class="p">:</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">,</span> <span class="s1">&#39;BaltCity&#39;</span><span class="p">:</span><span class="s1">&#39;InBaltimore&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">original</span><span class="p">[</span> <span class="n">original</span><span class="p">[</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span> <span class="o">|</span> <span class="n">original</span><span class="p">[</span><span class="s1">&#39;InBaltimore&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>  <span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;After filtering records where a CSA or Baltimore geo-code match Exists&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;All rows Before Filter: &#39;</span><span class="p">,</span> <span class="n">original</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span> <span class="c1"># rows, columns</span>
<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;# w BCity.isnull: &#39;</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">InBaltimore</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="p">);</span> <span class="n">bmorow</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span> <span class="n">df</span><span class="o">.</span><span class="n">CSA2010</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>  <span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;# w CSA2010.isnull: &#39;</span><span class="p">,</span> <span class="n">bmorow</span> <span class="p">);</span> <span class="n">csarow</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span> <span class="n">df</span><span class="o">.</span><span class="n">CSA2010</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>  <span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> 
<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;# w CSA2010.notnull: &#39;</span><span class="p">,</span> <span class="n">csarow</span> <span class="p">);</span> 
<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;# rows After Filter: &#39;</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;==&#39;</span><span class="p">,</span><span class="n">csarow</span><span class="p">,</span><span class="s1">&#39;+&#39;</span><span class="p">,</span><span class="n">bmorow</span><span class="p">,</span><span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="n">csarow</span> <span class="o">+</span> <span class="n">bmorow</span><span class="p">);</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">CSA2010</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">CSA2010</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;Baltimore City&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">snapdf</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">snapdf</span> <span class="o">=</span> <span class="n">snapdf</span><span class="p">[[</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">,</span><span class="s1">&#39;InBaltimore&#39;</span><span class="p">]]</span>
<span class="n">snapdf</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="TANF">TANF<a class="anchor-link" href="#TANF"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">geopandas</span> 

<span class="n">original</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;TANF20&quot;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s2">&quot;_CSACity.shp&quot;</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s1">&#39;geometry&#39;</span><span class="p">);</span>
<span class="n">original</span><span class="o">.</span><span class="n">columns</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">original</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span> <span class="s1">&#39;CSA&#39;</span><span class="p">:</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">,</span> <span class="s1">&#39;BaltCity&#39;</span><span class="p">:</span><span class="s1">&#39;InBaltimore&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">original</span><span class="p">[</span> <span class="n">original</span><span class="p">[</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span> <span class="o">|</span> <span class="n">original</span><span class="p">[</span><span class="s1">&#39;InBaltimore&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>  <span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;After filtering records where a CSA or Baltimore geo-code match Exists&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;All rows Before Filter: &#39;</span><span class="p">,</span> <span class="n">original</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span> <span class="c1"># rows, columns</span>
<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;# w BCity.isnull: &#39;</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">InBaltimore</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="p">);</span> <span class="n">bmorow</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span> <span class="n">df</span><span class="o">.</span><span class="n">CSA2010</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>  <span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;# w CSA2010.isnull: &#39;</span><span class="p">,</span> <span class="n">bmorow</span> <span class="p">);</span> <span class="n">csarow</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span> <span class="n">df</span><span class="o">.</span><span class="n">CSA2010</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>  <span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> 
<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;# w CSA2010.notnull: &#39;</span><span class="p">,</span> <span class="n">csarow</span> <span class="p">);</span> 
<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;# rows After Filter: &#39;</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;==&#39;</span><span class="p">,</span><span class="n">csarow</span><span class="p">,</span><span class="s1">&#39;+&#39;</span><span class="p">,</span><span class="n">bmorow</span><span class="p">,</span><span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="n">csarow</span> <span class="o">+</span> <span class="n">bmorow</span><span class="p">);</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">CSA2010</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">CSA2010</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;Baltimore City&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tandf</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">tandf</span> <span class="o">=</span> <span class="n">tandf</span><span class="p">[[</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">,</span><span class="s1">&#39;InBaltimore&#39;</span><span class="p">]]</span>
<span class="n">tandf</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="106-tanf---G">106 tanf - G<a class="anchor-link" href="#106-tanf---G"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="https://bniajfi.org/indicators/Children%20And%20Family%20Health/tanf">https://bniajfi.org/indicators/Children%20And%20Family%20Health/tanf</a></p>
<p>Temporary Assistance for Needy Families (TANF) is a federal assistance program. The Act provides temporary financial assistance while aiming to get people off of that assistance, primarily through employment.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Percent of Families Receiving TANF</p>
<p>Temporary Assistance for Needy Families (TANF) is a federal assistance program. The Act provides temporary financial assistance while aiming to get people off of that assistance, primarily through employment.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">WORKS</span> <span class="n">BUT</span> <span class="n">NEEDS</span> <span class="n">TO</span> <span class="n">BE</span> <span class="n">DIVIDED</span> <span class="n">BY</span> <span class="err">?</span> <span class="n">Normalization</span> <span class="n">Source</span>

<span class="n">Population</span><span class="p">,</span> <span class="c1"># Houses, Avg HH Size</span>

 <span class="n">We</span> <span class="n">need</span> <span class="n">the</span> <span class="n">Family</span> <span class="n">Households</span><span class="o">.</span> <span class="n">From</span> <span class="mf">2010.</span> <span class="n">Census</span> <span class="ow">not</span> <span class="n">ACS</span> <span class="n">Data</span><span class="o">.</span>


<span class="n">df1</span><span class="p">[</span><span class="s1">&#39;FamHHChildrenUnder18&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;B11005_003E_Total_Households_with_one_or_more_people_under_18_years_Family_households&#39;</span><span class="p">]</span>
<span class="n">df1</span><span class="p">[</span><span class="s1">&#39;FamHHChildrenOver18&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;B11005_012E_Total_Households_with_no_people_under_18_years_Family_households&#39;</span><span class="p">]</span>
<span class="n">df1</span><span class="p">[</span><span class="s1">&#39;FamHH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df1</span><span class="p">[</span><span class="s1">&#39;FamHHChildrenOver18&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df1</span><span class="p">[</span><span class="s1">&#39;FamHHChildrenUnder18&#39;</span><span class="p">]</span>

<span class="n">FINAL</span> <span class="n">NOTE</span> <span class="o">^</span> <span class="n">EVERYTHING</span> <span class="n">ABOVE</span> <span class="n">WAS</span> <span class="n">WRITTEN</span> <span class="n">PRIOR</span> <span class="n">TO</span> <span class="n">THIS</span> <span class="n">NOTICE</span><span class="p">:</span>

<span class="n">Normalization</span> <span class="n">Source</span> <span class="n">Location</span> <span class="n">V</span>

<span class="n">P</span><span class="p">:</span>\<span class="n">Project</span> <span class="n">Libraries</span>\<span class="n">Vital</span> <span class="n">Signs</span>\<span class="n">Vital</span> <span class="n">Signs</span> <span class="mi">12</span>\<span class="mi">5</span> <span class="n">Chapter</span> <span class="n">Health</span>

<span class="n">Cheryl</span> <span class="n">found</span> <span class="n">this</span> <span class="n">source</span> <span class="n">after</span> <span class="n">Seema</span> <span class="ow">and</span> <span class="n">I</span> <span class="n">were</span> <span class="n">struggling</span><span class="o">.</span>

<span class="n">It</span> <span class="n">appears</span> <span class="n">to</span> <span class="n">be</span> <span class="n">coming</span> <span class="kn">from</span> <span class="nn">the</span> <span class="mi">2010</span> <span class="n">data</span><span class="o">.</span> <span class="n">Not</span> <span class="n">the</span> <span class="mi">5</span> <span class="n">yr</span> <span class="n">aggregates</span><span class="o">.</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">tanf</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">csa</span><span class="p">,</span> <span class="n">yr</span><span class="p">):</span>
 
  <span class="c1"># tanf.drop( columns=[&#39;geometry&#39;, &#39;Shape__Length&#39;,&#39;Shape__Area&#39;], inplace=True)</span>
  <span class="c1"># Baltimoire has records not in the </span>
  <span class="n">tanf</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">55</span><span class="p">,</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">tanf</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
  <span class="c1"># Perform the calculation</span>
  <span class="n">tanf</span><span class="p">[</span><span class="s1">&#39;106-tanf&#39;</span><span class="o">+</span><span class="n">year</span><span class="p">]</span> <span class="o">=</span> <span class="n">tanf</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">tanf</span><span class="p">[</span><span class="s1">&#39;FamHH_2010&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000</span> 
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  compareYears = gpd.read_file(&quot;https://services1.arcgis.com/mVFRs7NF4iFitgbY/ArcGIS/rest/services/Tanf/FeatureServer/0/query?where=1%3D1&amp;outFields=*&amp;returnGeometry=true&amp;f=pgeojson&quot;);</span>
<span class="sd">  prevYear = &#39;tanf&#39;+ str( int(year) - 1 )</span>
<span class="sd">  if prevYear in compareYears.columns:</span>
<span class="sd">    tanf = tanf.merge( compareYears[[&#39;CSA2010&#39;, prevYear]], left_on=&#39;CSA2010&#39;, right_on=&#39;CSA2010&#39;, how=&#39;outer&#39; ) </span>
<span class="sd">    tanf[&#39;change&#39;] = tanf[&#39;106-tanf&#39;+year] - tanf[ prevYear ]</span>
<span class="sd">    tanf[&#39;percentChange&#39;] = tanf[&#39;change&#39; ] / tanf[ prevYear ] * 100</span>
<span class="sd">    tanf[&#39;change&#39;] = tanf[&#39;change&#39;].apply(lambda x: &quot;{:.2f}&quot;.format(x) )</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;Records Matching Query: &#39;</span><span class="p">,</span> <span class="n">tanf</span><span class="o">.</span><span class="n">size</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">tanf</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="p">)</span>
  <span class="k">return</span> <span class="n">tanf</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fin</span> <span class="o">=</span> <span class="n">tanf</span><span class="p">(</span><span class="n">tandf</span><span class="p">,</span> <span class="n">csa</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;106-tanf&#39;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="tanf" class="doc_header"><code>tanf</code><a href="https://github.com/bnia/VitalSigns/tree/main/VitalSigns/dhr.py#L6" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>tanf</code>(<strong><code>df</code></strong>, <strong><code>csa</code></strong>, <strong><code>yr</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fin</span> <span class="o">=</span> <span class="n">tanf</span><span class="p">(</span><span class="n">tandf</span><span class="p">,</span> <span class="n">csa</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;106-tanf&#39;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="???-SNAP---G">??? SNAP - G<a class="anchor-link" href="#???-SNAP---G"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="https://bniajfi.org/indicators/Children%20And%20Family%20Health/SNAP">DESCRIPTION</a></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">snap</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">csa</span><span class="p">,</span> <span class="n">yr</span><span class="p">):</span>
  <span class="nb">id</span> <span class="o">=</span> <span class="s1">&#39;107&#39;</span>
  <span class="n">shortname</span> <span class="o">=</span> <span class="s1">&#39;snap&#39;</span>

  <span class="n">df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

  <span class="c1"># Create the Numerator </span>
  <span class="n">numer</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> 
  
  <span class="c1"># Group by CSA</span>
  <span class="n">numer</span> <span class="o">=</span> <span class="n">numer</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  

  <span class="c1"># Make sure ALL csas and BaltimoreCity are included and sorted.</span>
  <span class="n">numer</span> <span class="o">=</span> <span class="n">csa</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span> <span class="n">numer</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;CSA2010&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span> <span class="p">)</span> 
  <span class="n">numer</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="s1">&#39;Shape__Length&#39;</span><span class="p">,</span><span class="s1">&#39;Shape__Area&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  
  
  <span class="c1"># Do after sortViaCsaMerge to get index right. False records would show underneath it but still get added to the sum.</span>
  <span class="n">numer</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">55</span><span class="p">,</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">numer</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

  <span class="c1"># Perform the calculation</span>
  <span class="n">numer</span><span class="p">[</span><span class="nb">id</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">shortname</span><span class="o">+</span><span class="n">year</span><span class="p">]</span> <span class="o">=</span> <span class="n">numer</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">numer</span><span class="p">[</span><span class="s1">&#39;tpop10&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>
  <span class="n">netyet</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">  compareYears = gpd.read_file(&quot;https://services1.arcgis.com/mVFRs7NF4iFitgbY/ArcGIS/rest/services/&quot;+shortname+&quot;/FeatureServer/0/query?where=1%3D1&amp;outFields=*&amp;returnGeometry=true&amp;f=pgeojson&quot;);</span>
<span class="s2">  prevYear = shortname+ str( int(year) - 1 )</span>
<span class="s2">  if prevYear in compareYears.columns:</span>
<span class="s2">    numer = numer.merge( compareYears[[&#39;CSA2010&#39;, prevYear]], left_on=&#39;CSA2010&#39;, right_on=&#39;CSA2010&#39;, how=&#39;outer&#39; ) </span>
<span class="s2">    numer[&#39;change&#39;] = numer[id+&#39;-&#39;+shortname+year] - numer[ prevYear ]</span>
<span class="s2">    numer[&#39;percentChange&#39;] = numer[&#39;change&#39; ] / numer[ prevYear ] * 100</span>
<span class="s2">    numer[&#39;change&#39;] = numer[&#39;change&#39;].apply(lambda x: &quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;.format(x) )</span>
<span class="s2">    print( &#39;Records Matching Query: &#39;, numer.size / len(numer.columns) )</span>
<span class="s2">  &quot;&quot;&quot;</span>
  <span class="k">return</span> <span class="n">numer</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fin</span> <span class="o">=</span> <span class="n">snap</span><span class="p">(</span><span class="n">snapdf</span><span class="p">,</span> <span class="n">csa</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;107-snap&#39;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="snap" class="doc_header"><code>snap</code><a href="https://github.com/bnia/VitalSigns/tree/main/VitalSigns/dhr.py#L31" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>snap</code>(<strong><code>df</code></strong>, <strong><code>csa</code></strong>, <strong><code>yr</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fin</span> <span class="o">=</span> <span class="n">snap</span><span class="p">(</span><span class="n">tandf</span><span class="p">,</span> <span class="n">csa</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;???-snap&#39;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fin</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

