<!DOCTYPE HTML>

<!-- BEGIN html -->
<html lang="en-US">

<!-- BEGIN head -->
<head>
	<!-- Charset -->
    <meta charset="UTF-8">

	<!-- Description -->
    <meta name="description" content="BNIA - Baltimore Neighborhood Indicators Alliance, Providing reliable, actionable quality of life indicators for Baltimore’s neighborhoods">
	
	<!-- Keywords -->
	<meta name="keywords" content="BNIA - Baltimore Neighborhood Indicators Alliance, Providing reliable, actionable quality of life indicators for Baltimore’s neighborhoods">

	<!-- Author -->
	<meta name="author" content="BNIA &#8211; Baltimore Neighborhood Indicators Alliance">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
	
	<!-- RSS -->
	<link rel="alternate" type="application/rss+xml" title="BNIA &#8211; Baltimore Neighborhood Indicators Alliance RSS Feed" href="http://bniajfi.org/feed/" />
	<link rel="alternate" type="application/rss+xml" title="BNIA &#8211; Baltimore Neighborhood Indicators Alliance Comments Feed" href="http://bniajfi.org/comments/feed/" />
	
	<!-- Pingbacks -->
	<link rel="pingback" href="http://bniajfi.org/xmlrpc.php" />
	
	<!-- Favicon -->
		
	<!-- Title -->
	<title>
	BNIA &#8211; Baltimore Neighborhood Indicators Alliance	</title>
	
	<!-- Stylesheets -->
	<link rel="stylesheet" type="text/css" href="http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/style.css" />
	
    <!--[if lt IE 9]><script src="http://ie7-js.googlecode.com/svn/version/2.1(beta4)/IE9.js"></script><![endif]-->
	
		
	<!-- Theme Hook -->
	<script>(function(d, s, id){
				 var js, fjs = d.getElementsByTagName(s)[0];
				 if (d.getElementById(id)) {return;}
				 js = d.createElement(s); js.id = id;
				 js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.6";
				 fjs.parentNode.insertBefore(js, fjs);
			   }(document, 'script', 'facebook-jssdk'));</script><link rel='dns-prefetch' href='//platform.twitter.com' />
<link rel='dns-prefetch' href='//w.sharethis.com' />
<link rel='dns-prefetch' href='//ajax.googleapis.com' />
<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel='dns-prefetch' href='//maxcdn.bootstrapcdn.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="BNIA - Baltimore Neighborhood Indicators Alliance &raquo; Feed" href="http://bniajfi.org/feed/" />
<link rel="alternate" type="application/rss+xml" title="BNIA - Baltimore Neighborhood Indicators Alliance &raquo; Comments Feed" href="http://bniajfi.org/comments/feed/" />
<link rel="alternate" type="text/calendar" title="BNIA - Baltimore Neighborhood Indicators Alliance &raquo; iCal Feed" href="http://bniajfi.org/events/?ical=1" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.4\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.4\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/bniajfi.org\/wp-includes\/js\/wp-emoji-release.min.js?ver=2483f238954e7cae2cd4dcb43c59bf93"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55357,56692,8205,9792,65039],[55357,56692,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='login-with-ajax-css'  href='http://bniajfi.org/wp-content/plugins/login-with-ajax/widget/widget.css?ver=3.1.7' type='text/css' media='all' />
<link rel='stylesheet' id='wpa-css-css'  href='http://bniajfi.org/wp-content/plugins/wp-attachments/styles/0/wpa.css?ver=2483f238954e7cae2cd4dcb43c59bf93' type='text/css' media='all' />
<link rel='stylesheet' id='jquery-style-css'  href='http://bniajfi.org/wp-content/plugins/wordpress-creation-kit-pro/wordpress-creation-kit-api/assets/datepicker/datepicker.css?ver=2483f238954e7cae2cd4dcb43c59bf93' type='text/css' media='all' />
<link rel='stylesheet' id='wp-color-picker-css'  href='http://bniajfi.org/wp-admin/css/color-picker.min.css?ver=2483f238954e7cae2cd4dcb43c59bf93' type='text/css' media='all' />
<link rel='stylesheet' id='wck-colorpicker-style-css'  href='http://bniajfi.org/wp-content/plugins/wordpress-creation-kit-pro/wordpress-creation-kit-api/assets/colorpicker/colorpicker.css?ver=1.0' type='text/css' media='all' />
<link rel='stylesheet' id='tribe-common-skeleton-style-css'  href='http://bniajfi.org/wp-content/plugins/the-events-calendar/common/src/resources/css/common-skeleton.min.css?ver=4.12.5' type='text/css' media='all' />
<link rel='stylesheet' id='tribe-tooltip-css'  href='http://bniajfi.org/wp-content/plugins/the-events-calendar/common/src/resources/css/tooltip.min.css?ver=4.12.5' type='text/css' media='all' />
<link rel='stylesheet' id='default-css'  href='http://bniajfi.org/wp-content/plugins/ajax-wp-query-search-filter/classes/scripts/default.css?ver=all' type='text/css' media='all' />
<link rel='stylesheet' id='bbp-default-css'  href='http://bniajfi.org/wp-content/plugins/bbpress/templates/default/css/bbpress.css?ver=2.5.14-6684' type='text/css' media='screen' />
<link rel='stylesheet' id='bp-legacy-css-css'  href='http://bniajfi.org/wp-content/plugins/buddypress/bp-templates/bp-legacy/css/buddypress.min.css?ver=3.1.0' type='text/css' media='screen' />
<link rel='stylesheet' id='contact-form-7-css'  href='http://bniajfi.org/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=5.0.2' type='text/css' media='all' />
<link rel='stylesheet' id='ctf_styles-css'  href='http://bniajfi.org/wp-content/plugins/custom-twitter-feeds/css/ctf-styles.css?ver=1.2.9' type='text/css' media='all' />
<link rel='stylesheet' id='simple-share-buttons-adder-indie-css'  href='//fonts.googleapis.com/css?family=Indie+Flower&#038;ver=2483f238954e7cae2cd4dcb43c59bf93' type='text/css' media='all' />
<link rel='stylesheet' id='simple-share-buttons-adder-font-awesome-css'  href='//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css?ver=2483f238954e7cae2cd4dcb43c59bf93' type='text/css' media='all' />
<link rel='stylesheet' id='opensans-css'  href='http://fonts.googleapis.com/css?family=Open+Sans%3A400%2C600%2C700%2C800%2C300&#038;ver=2483f238954e7cae2cd4dcb43c59bf93' type='text/css' media='all' />
<link rel='stylesheet' id='opensanscondensed-css'  href='http://fonts.googleapis.com/css?family=Open+Sans+Condensed%3A700&#038;ver=2483f238954e7cae2cd4dcb43c59bf93' type='text/css' media='all' />
<link rel='stylesheet' id='reset-css'  href='http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/css/reset.css?ver=2483f238954e7cae2cd4dcb43c59bf93' type='text/css' media='all' />
<link rel='stylesheet' id='bootstrap-css'  href='http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/css/bootstrap.css?ver=2483f238954e7cae2cd4dcb43c59bf93' type='text/css' media='all' />
<link rel='stylesheet' id='main-css'  href='http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/css/main.css?ver=2483f238954e7cae2cd4dcb43c59bf93' type='text/css' media='all' />
<link rel='stylesheet' id='flexslider-css'  href='http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/css/flexslider.css?ver=2483f238954e7cae2cd4dcb43c59bf93' type='text/css' media='all' />
<link rel='stylesheet' id='prettyphoto-css'  href='http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/css/prettyPhoto.css?ver=2483f238954e7cae2cd4dcb43c59bf93' type='text/css' media='all' />
<link rel='stylesheet' id='youtube-channel-gallery-css'  href='http://bniajfi.org/wp-content/plugins/youtube-channel-gallery/styles.css?ver=2483f238954e7cae2cd4dcb43c59bf93' type='text/css' media='all' />
<link rel='stylesheet' id='jquery.magnific-popup-css'  href='http://bniajfi.org/wp-content/plugins/youtube-channel-gallery/magnific-popup.css?ver=2483f238954e7cae2cd4dcb43c59bf93' type='text/css' media='all' />
<link rel='stylesheet' id='rjqc-jqplot-css'  href='http://bniajfi.org/wp-content/plugins/rj-quickcharts/css/jquery.jqplot.min.css?ver=2483f238954e7cae2cd4dcb43c59bf93' type='text/css' media='all' />
<script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js?ver=2483f238954e7cae2cd4dcb43c59bf93'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var LWA = {"ajaxurl":"http:\/\/bniajfi.org\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script type='text/javascript' src='http://bniajfi.org/wp-content/plugins/login-with-ajax/widget/login-with-ajax.js?ver=3.1.7'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var BP_Confirm = {"are_you_sure":"Are you sure?"};
/* ]]> */
</script>
<script type='text/javascript' src='http://bniajfi.org/wp-content/plugins/buddypress/bp-core/js/confirm.min.js?ver=3.1.0'></script>
<script type='text/javascript' src='http://bniajfi.org/wp-content/plugins/buddypress/bp-core/js/widget-members.min.js?ver=3.1.0'></script>
<script type='text/javascript' src='http://bniajfi.org/wp-content/plugins/buddypress/bp-core/js/jquery-query.min.js?ver=3.1.0'></script>
<script type='text/javascript' src='http://bniajfi.org/wp-content/plugins/buddypress/bp-core/js/vendor/jquery-cookie.min.js?ver=3.1.0'></script>
<script type='text/javascript' src='http://bniajfi.org/wp-content/plugins/buddypress/bp-core/js/vendor/jquery-scroll-to.min.js?ver=3.1.0'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var BP_DTheme = {"accepted":"Accepted","close":"Close","comments":"comments","leave_group_confirm":"Are you sure you want to leave this group?","mark_as_fav":"Favorite","my_favs":"My Favorites","rejected":"Rejected","remove_fav":"Remove Favorite","show_all":"Show all","show_all_comments":"Show all comments for this thread","show_x_comments":"Show all comments (%d)","unsaved_changes":"Your profile has unsaved changes. If you leave the page, the changes will be lost.","view":"View"};
/* ]]> */
</script>
<script type='text/javascript' src='http://bniajfi.org/wp-content/plugins/buddypress/bp-templates/bp-legacy/js/buddypress.min.js?ver=3.1.0'></script>
<script type='text/javascript' src='https://platform.twitter.com/widgets.js?ver=2483f238954e7cae2cd4dcb43c59bf93'></script>
<script id='st_insights_js' type='text/javascript' src='http://w.sharethis.com/button/st_insights.js?publisher=4d48b7c5-0ae3-43d4-bfbe-3ff8c17a8ae6&#038;product=simpleshare'></script>
<script type='text/javascript' src='http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/js/jquery.tweet.js?ver=2483f238954e7cae2cd4dcb43c59bf93'></script>
<script type='text/javascript' src='http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/js/jquery.easing.1.3.js?ver=2483f238954e7cae2cd4dcb43c59bf93'></script>
<script type='text/javascript' src='http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/js/jquery.waitforimages.js?ver=2483f238954e7cae2cd4dcb43c59bf93'></script>
<script type='text/javascript' src='http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/js/bootstrap.js?ver=2483f238954e7cae2cd4dcb43c59bf93'></script>
<script type='text/javascript' src='http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/js/jquery.flexslider-min.js?ver=2483f238954e7cae2cd4dcb43c59bf93'></script>
<script type='text/javascript' src='http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/js/jquery.validate.min.js?ver=2483f238954e7cae2cd4dcb43c59bf93'></script>
<script type='text/javascript' src='http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/js/jquery.isotope.min.js?ver=2483f238954e7cae2cd4dcb43c59bf93'></script>
<script type='text/javascript' src='http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/js/main3.js?ver=2483f238954e7cae2cd4dcb43c59bf93'></script>
<script type='text/javascript' src='http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/js/jquery.redirectreg.js?ver=2483f238954e7cae2cd4dcb43c59bf93'></script>
<script type='text/javascript' src='http://bniajfi.org/wp-content/plugins/rj-quickcharts/js/min/rjqc-frontend-full.min.js?ver=2483f238954e7cae2cd4dcb43c59bf93'></script>
<link rel='https://api.w.org/' href='http://bniajfi.org/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://bniajfi.org/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://bniajfi.org/wp-includes/wlwmanifest.xml" /> 


	<script type="text/javascript">var ajaxurl = 'http://bniajfi.org/wp-admin/admin-ajax.php';</script>

<script>
var twitterWidgets;
!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];
  if(!d.getElementById(id)){
      js=d.createElement(s);
    js.id=id;js.src="//platform.twitter.com/widgets.js";
    fjs.parentNode.insertBefore(js,fjs);
  }}
  (document,"script","twitter-wjs");
  // twitterWidgets.onload = _ga.trackTwitter;
</script>
<meta name="tec-api-version" content="v1"><meta name="tec-api-origin" content="http://bniajfi.org"><link rel="https://theeventscalendar.com/" href="http://bniajfi.org/wp-json/tribe/events/v1/" />
<!-- Dynamic Widgets by QURL loaded - http://www.dynamic-widgets.com //-->
<script type="text/javascript">var wckAjaxurl = "https://bniajfi.org/wp-admin/admin-ajax.php";</script><link rel="me" href="https://twitter.com/bniajfi" /><meta name="twitter:partner" content="tfwp" />

		<style type="text/css" id="wp-custom-css">
			#nav { margin-top:0px; float:right; } 
#nav li { position:relative; display:inline-block; margin:0 4px; } 
#nav > li:last-child { margin-right:0px; }  
#nav li a { position:relative; display:block; padding:17px; min-width:40px; line-height: 18px; text-align:center; font-size:14px; z-index:300; }
#nav li a:hover, #nav li a.selected:hover, #nav li a.current { text-decoration:none;}

/* menu level 2 */
#nav ul { display:none; position:relative; width:160px; z-index:310; margin:0; position:absolute; top:35px; left:0; padding: 10px 0 0 0; background-image:url(https://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/img/background/nav-dropdown.png); background-position:18px 4px; background-repeat:no-repeat; background-color: #EEE;
box-shadow: 5px 5px 5px #888;}
#nav ul li { display:block; padding:0; margin:0; text-align:center;}
#nav ul li a { text-align:left; padding:10px 18px; font-size:12px; }
#nav ul li:first-child a { border-top:none; }
#nav ul li:last-child a { border-bottom:none; }

/* menu level 3 */
#nav ul ul { top:0; left:auto; right:-168px; padding:0px 0 0 8px; 
background:url(https://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/img/background/nav-dropdown-left.png) 1px 13px no-repeat; 
background-color: #EEE;
box-shadow: 5px 5px 5px #888;
z-index: 1;}

/* hyperlink in HeaderBlue */

#pTopic a {
	text-decoration: underline;
}

/*
#vsData img{
	visibility: hidden;
}
*/

#vsDownloads img {
	float: left;
	margin-left:5px !important;
	margin-right:10px !important;
	margin-top: 5px !important;
content:url("https://i.imgur.com/sGXFYtI.png");
	
}
/*
#vsDownloads img:hover{
content:url("https://i.imgur.com/S5F2d31.png")
}
*/
/* #vsTrends img{ visibility: hidden;}
*/

#vsGallery img {
	float: left;
	margin-left:5px !important;
	margin-right:10px !important;
	margin-top: 5px !important;
content:url("https://i.imgur.com/eaSw2du.png");
}

#divShare{
	display: none;
}

.span9 img{
	display: none;
}

.span9 h1{
	font-size: 28px !important;
	font-weight: 450;
}		</style>
	    <link href='http://fonts.googleapis.com/css?family=Lobster' rel='stylesheet' type='text/css'>
	<!-- <link href='../resources/rtable/responsive-tables.css' rel='stylesheet' type='text/css'> -->
	
<link rel="stylesheet" type="text/css" href="http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/css/bg_styles/default.css">	
    
	<style type="text/css">body {
background-image: none;
}
@media (max-width: 480px) {
.menu {
margin-top: -180px;
}
}
header {
background-color: #FFFFFF;
max-height: 180px;
}
h2 {
border-bottom: 1px solid #FF5D00;
background-image: none !important;
border-color: #FF5D00 !important;
}
#logo {
padding-bottom: 0px;
}
#nav li a {
color: #007db6;
font-family: Open Sans, sans-serif;
font-weight: 600;
font-size: 14px;
text-transform: uppercase;
}
#nav {
float: left;
margin-left: 0;
}
#logo p {
color: #FFF;
font-size: 10px;
font-weight: 700;
margin: -10px 0 7px 0;
}
.header-wrap {
padding-bottom: 15px;
background-color: #007db6;
background-image: none;}
.tab-content > .tab-pane, .pill-content > .pill-pane {
padding: 0;
}
.nav-tabs > .active > a, .nav-tabs > .active > a:hover {
color: #FFFFFF;
font-weight: 600;
}
.accordion-group.active .accordion-heading .accordion-toggle, .accordion-group .accordion-heading .accordion-toggle:hover, .accordion-group .accordion-heading .accordion-toggle, .nav-tabs > .active > a, .nav-tabs > .active > a:hover {
color: #007db6;
font-size: 14px;
}
.headerBlue {
color: #007db6;
}
.social {
margin: 10px 0 -15px 0;
}
.nav {
margin-bottom: -5px;
margin-left: 4px;
}
@media all and (max-width: 770px) {
    .txtLogo { display: none; }
}
#nav ul li a {
color: #007db6;
text-shadow: none;
font-size: 11px;
}
.accordion-group.active .accordion-heading .accordion-toggle, .accordion-group .accordion-heading .accordion-toggle:hover, .accordion-group .accordion-heading .accordion-toggle, .nav-tabs > .active > a, .nav-tabs >
 .active > a:hover {
background-color: #FFFFFF;
}
.polaroid {
padding: 4px;
line-height: 1.42857143;
background-color: #fff;
border: 1px solid #ddd;
border-radius: 4px;
-webkit-transition: all .2s ease-in-out;
transition: all .2s ease-in-out;
display: inline-block;
max-width: 100%;
}
.tab-content > .active, .pill-content > .active {
padding: 4px;
line-height: 1.42857143;
background-color: #fff;
border: 1px solid #ddd;
border-radius: 4px;
-webkit-transition: all .2s ease-in-out;
transition: all .2s ease-in-out;
display: inline-block;
max-width: 100%;
}
#comInfo {
background: white;
background: rgba(255,255,255,0.8);
box-shadow: 0 0 15px rgba(0,0,0,0.2);
border-radius: 5px;
position: relative;
z-index: 9999;
}
#comInner {
opacity:0.6;
filter:alpha(opacity=60); /* For IE8 and earlier */
}
#comNew {
height: 45px;
width: 275px;
position: absolute;
background-color: #FFFFFF;
bottom: 0;
z-index: 1000;
background: rgba(255,255,255,0.8);
box-shadow: 0 0 15px rgba(0,0,0,0.2);
border-radius: 5px;
}
h3 b {
color: #FF5D00 !important;
}
footer {
background-color: #007db6;
}
.polaroid {
padding: 4px;
line-height: 1.42857143;
background-color: #fff;
border: 1px solid #ddd;
border-radius: 4px;
-webkit-transition: all .2s ease-in-out;
transition: all .2s ease-in-out;
display: inline-block;
max-width: 100%;
}
.tab-content > .active, .pill-content > .active {
padding: 4px;
padding-right: 45px;
line-height: 1.42857143;
background-color: #fff;
border: 1px solid #ddd;
border-radius: 4px;
-webkit-transition: all .2s ease-in-out;
transition: all .2s ease-in-out;
display: inline-block;
max-width: 100%;
width: 95%;
}
#comInfo {
background: white;
background: rgba(255,255,255,0.8);
box-shadow: 0 0 15px rgba(0,0,0,0.2);
border-radius: 5px;
position: relative;
z-index: 9999;
}
#comInner {
opacity:0.6;
filter:alpha(opacity=60); /* For IE8 and earlier */
}
#comNew {
height: 45px;
width: 275px;
position: absolute;
background-color: #FFFFFF;
bottom: 0;
z-index: 1000;
background: rgba(255,255,255,0.8);
box-shadow: 0 0 15px rgba(0,0,0,0.2);
border-radius: 5px;
}
#comSearch {
position: absolute;
background-color: #FFFFFF;
z-index: 1000;
background: rgba(255,255,255,0.8);
box-shadow: 0 0 15px rgba(0,0,0,0.2);
border-radius: 5px;
right: 15px;
top: 10px;
}
.txtLogo {
color: #FFFFFF;
margin: 0;
padding: 0;
line-height: 1;
font-size: 14px;
}
#tLogo {
margin-top: 20px;
}
#boldSlogan {
font-weight: 800;
}
#tLogo {
margin-left: 0;
}
#imgSlogan {
margin-top: 70px;
}
#containLogo {

}
@media all and (max-width: 770px) {
    #imgSlogan { margin-top: 2px; }
    #containLogo { margin-bottom: 0px; }
    #tLogo { margin-top: 0px; }
     .header-wrap { max-height: 310px; }
     .header { max-height: 310px; }
     .menu {margin-top: -175px; }
}
#scrollable-dropdown-menu .tt-dropdown-menu {
  max-height: 150px;
  overflow-y: auto;
  width: 400px;
}

.tt-menu {
	background-color: rgb(255,255,255);
	border: 1px solid #CCC;
	margin-top: -10px;
}
.tt-suggestion {
	border-bottom: 1px solid #CCC;
	cursor: pointer;
}
.typeahead {
	width: 360px;
}</style>	
<!-- END head -->
</head>

<!-- BEGIN body -->
<body class="bp-legacy tribe-no-js no-js">
        <!-- ************************** HEADER -->
		<div class="span12" style="width: 100%; margin-left: 0;">
        <header class="header row clearfix">
			
            <div class="header-wrap">
			
			    <!-- ************************** CONTAINER -->
				
				<div id="containLogo" class="container" style="">
                <div class="row">
				
                    <!-- ************************** LOGO -->
                    <div id="logo" class="span2">
		
					<a href="http://bniajfi.org/"><img src="http://bniajfi.org/wp-content/uploads/2021/02/bnia_logo_new.png" alt="BNIA - Baltimore Neighborhood Indicators Alliance"></a>					
                    </div>
					
					<div id="tLogo" class="span5">
						<img id="imgSlogan" alt="Baltimore Neighborhood Indicators Alliance" src="https://bniajfi.org/wp-content/uploads/2021/02/bnia_text.png"/>					
					</div>
					
                    <!-- ************************** end LOGO -->
                    
                 
					
					<div class="span5" style="margin-top: 20px;">
						<form method="get" action="http://bniajfi.org/" style="float: right;display: inline; margin-bottom: 0;">
							<div class="input-append">
								<input type="text" id="headerSearchText" name="s" size="16" class="span3" placeholder="Enter keywords to search..." value="" style="outline: none; min-width: 250px;">
								<input type="submit" id="" class="send" value="Go" style="outline: none;">
							  </div>
						</form>
						<ul class="social" style="float: right; margin-top: 0px;">
							<li><a target="_blank" class="facebook" href="http://www.facebook.com/bniajfi/">Facebook</a></li>
							<li><a target="_blank" class="twitter" href="http://www.twitter.com/bniajfi/">Twitter</a></li>
							<li><a target="_blank" class="youtube" href="http://www.youtube.com/bniajfi">YouTube</a></li>
							<li><a target="_blank" class="rss" href="/feed/">RSS</a></li>
						</ul>
					
						<a href="http://www.ubalt.edu" target="_blank" title="University of Baltimore"><img src="https://www.ubalt.edu/_resources/images/ub-logo-big.svg" style="height: 55px; width: 160px; float: right; margin-top: -10px; margin-right: -15px"/></a>
					</div>
					
                </div>
                <!-- end row -->
				
				
            </div>
			</div>
            <!-- end header-wrap -->
			<div class="container">
			 <!-- ************************** NAV -->
                    <nav class="span12" style="width: inherit;">
					
                        <!-- PRIMARY NAV -->
						<ul id="nav" class=""><li id="menu-item-428" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-428"><a href="http://bniajfi.org/vital_signs/">Vital Signs</a>
<ul class="sub-menu">
	<li id="menu-item-1088" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1088"><a href="http://bniajfi.org/vital_signs/">Explore Vital Signs 19</a></li>
	<li id="menu-item-434" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-434"><a href="http://bniajfi.org/vital_signs/fullreport/">Vital Signs – Full Report</a></li>
	<li id="menu-item-432" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-432"><a href="http://bniajfi.org/vital_signs/cprofiles/">Community Profiles</a></li>
	<li id="menu-item-3117" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3117"><a href="http://bniajfi.org/indicators/all">Indicators</a></li>
	<li id="menu-item-7417" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7417"><a target="_blank" href="https://vital-signs-bniajfi.hub.arcgis.com/">Vital Signs Open Data</a></li>
	<li id="menu-item-983" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-983"><a href="http://bniajfi.org/vital_signs/archives">Archives</a></li>
</ul>
</li>
<li id="menu-item-429" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-429"><a href="http://bniajfi.org/resources/">Resource Library</a>
<ul class="sub-menu">
	<li id="menu-item-480" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-480"><a href="http://bniajfi.org/bnia_projects/">BNIA Projects and Research</a>
	<ul class="sub-menu">
		<li id="menu-item-438" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-438"><a href="http://bniajfi.org/currentprojects/">Current Projects</a></li>
		<li id="menu-item-439" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-439"><a href="http://bniajfi.org/publications_and_research/">All Research</a></li>
	</ul>
</li>
	<li id="menu-item-440" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-440"><a href="http://bniajfi.org/mapgallery/">Map Gallery</a>
	<ul class="sub-menu">
		<li id="menu-item-441" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-441"><a href="http://bniajfi.org/mapping-resources/">Mapping Resources</a></li>
	</ul>
</li>
	<li id="menu-item-442" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-442"><a href="http://bniajfi.org/community_mapping/">Community Mapping</a>
	<ul class="sub-menu">
		<li id="menu-item-6686" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6686"><a href="http://bniajfi.org/currentprojects/cultural-mapping-tool/">GEOLOOM co>map: Cultural Mapping in Baltimore</a></li>
		<li id="menu-item-479" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-479"><a href="http://realestate.bniajfi.org">Real Estate Map</a></li>
		<li id="menu-item-477" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-477"><a href="http://foreclosures.bniajfi.org">Foreclosures Map</a></li>
		<li id="menu-item-478" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-478"><a href="https://bniajfi.org/greenpatterns/">Green Patterns</a></li>
	</ul>
</li>
	<li id="menu-item-11562" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-11562"><a href="http://bniajfi.org/community-guidepost/">Community Guidepost</a></li>
</ul>
</li>
<li id="menu-item-1994" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-1994"><a href="http://bniajfi.org/resources/learning-community/">Learning Community</a>
<ul class="sub-menu">
	<li id="menu-item-2002" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-2002"><a href="http://bniajfi.org/resources/learning-community/projects/">Projects</a>
	<ul class="sub-menu">
		<li id="menu-item-2003" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2003"><a href="http://bniajfi.org/resources/learning-community/add-project/">Add Your Project</a></li>
	</ul>
</li>
	<li id="menu-item-2007" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-2007"><a href="http://bniajfi.org/resources/learning-community/for-instructors/">For Instructors</a>
	<ul class="sub-menu">
		<li id="menu-item-2010" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2010"><a href="http://bniajfi.org/resources/learning-community/for-instructors/register-your-class/">Register Your Class</a></li>
	</ul>
</li>
	<li id="menu-item-2016" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2016"><a href="http://bniajfi.org/resources/learning-community/new-member/">Join Learning Community</a></li>
	<li id="menu-item-2013" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2013"><a href="http://bniajfi.org/resources/learning-community/discussion/">Discussion Forum</a></li>
</ul>
</li>
<li id="menu-item-944" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-944"><a href="http://bniajfi.org/news_events">News &#038; Events</a>
<ul class="sub-menu">
	<li id="menu-item-956" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-956"><a href="http://bniajfi.org/data_day/">Baltimore Data Day (Week)</a></li>
	<li id="menu-item-1084" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1084"><a href="http://bniajfi.org/bnia-in-the-news/">BNIA Data In The News</a></li>
</ul>
</li>
<li id="menu-item-430" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-430"><a href="http://bniajfi.org/about_bnia/">About BNIA</a>
<ul class="sub-menu">
	<li id="menu-item-449" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-449"><a href="http://bniajfi.org/history/">History and Mission</a></li>
	<li id="menu-item-450" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-450"><a href="http://bniajfi.org/staff/">Staff</a></li>
	<li id="menu-item-1085" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1085"><a href="http://bniajfi.org/donate/">Donate</a></li>
</ul>
</li>
<li id="menu-item-431" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-431"><a href="http://bniajfi.org/help_center/">Help Center</a>
<ul class="sub-menu">
	<li id="menu-item-1087" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1087"><a href="http://bniajfi.org/faqs/">Frequently Asked Questions (FAQs)</a></li>
	<li id="menu-item-1086" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1086"><a href="http://bniajfi.org/contact_us/">Contact Us</a></li>
	<li id="menu-item-12994" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-12994"><a href="http://bniajfi.org/stay-connected/">Stay Connected</a></li>
</ul>
</li>
</ul>                        <!-- end PRIMARY NAV -->
                        
						
                    </nav>
			</div>
        </header>
		</div>
        <!-- ************************** end HEADER -->
	<!-- ************************** CONTAINER -->
    <div class="container">
	 
                        <!-- ************************** MIDDLE --> <section class="middle row">
  <!-- ************************** SIDEBAR -->
  <aside class="span4 content sidebar">
    <!-- SEARCH - WIDGET -->
    <div class="search-widget clearfix">
      <span style="display: block;">Share </span><!-- Simple Share Buttons Adder (7.4.18) simplesharebuttons.com -->
      <div id="ssba-classic-2" class="ssba ssbp-wrap ssbp--theme-1">
        <div style="display: flex;">
          <a data-site="" class="ssba_facebook_share" href="https://www.facebook.com/sharer.php?u=http://bniajfi.org/data_day/" target="_blank">
            <img src="https://bniajfi.org/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/facebook.png" style="padding-right: 20px; width: 35px;" title="Facebook" class="ssba ssba-img" alt="Share on Facebook">
            <div title="Facebook" class="ssbp-text" style="display: none;">Facebook</div>
          </a>
          <a data-site="" class="ssba_twitter_share" href="https://twitter.com/share?url=http://bniajfi.org/data_day/&amp;text=Baltimore%20Data%20Day%20%28Week%29%20" target="&quot;_blank&quot;">
            <img src="https://bniajfi.org/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/twitter.png" style="padding-right: 20px; width: 35px;" title="Twitter" class="ssba ssba-img" alt="Tweet about this on Twitter">
            <div title="Twitter" class="ssbp-text" style="display: none;">Twitter</div>
          </a>
          <a data-site="linkedin" class="ssba_linkedin_share ssba_share_link" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http://bniajfi.org/data_day/" target="&quot;_blank&quot;">
            <img src="https://bniajfi.org/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/linkedin.png" style="padding-right: 20px; width: 35px;" title="LinkedIn" class="ssba ssba-img" alt="Share on LinkedIn">
            <div title="Linkedin" class="ssbp-text" style="display: none;">Linkedin</div>
          </a>
          <a data-site="email" class="ssba_email_share" href="mailto:?subject=Baltimore%20Data%20Day%20(Week)&amp;body=%20http://bniajfi.org/data_day/">
            <img src="https://bniajfi.org/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/email.png" style="width: 35px;" title="Email" class="ssba ssba-img" alt="Email this to someone">
            <div title="email" class="ssbp-text" style="display: none;">email</div>
          </a>
        </div>
      </div>
    </div>
    <!-- end SEARCH - WIDGET -->
    <!-- WIDGET -->
    <div class="widget clearfix" style="display: block; margin-top: 5px;">
      <h3>Data Day Events</h3>
      <p>There are no upcoming events at this time.</p>
    </div>
    <div class="widget clearfix" style="display: block; margin-top: 5px;">
      <h3>Site Navigation</h3>
      <div class="menu-newsnav-container">
        <ul id="menu-newsnav" class="menu">
          <li id="menu-item-1524" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-home current-menu-ancestor current_page_ancestor menu-item-has-children menu-item-1524">
            <a href="https://bniajfi.org/">Home</a>
            <ul class="sub-menu">
              <li id="menu-item-1528" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-1528">
                <a href="https://bniajfi.org/vital_signs/">Vital Signs 19</a>
                <ul class="sub-menu">
                  <li id="menu-item-1529" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1529"><a href="https://bniajfi.org/vital_signs/fullreport/">Vital Signs – Full Report</a></li>
                  <li id="menu-item-1532" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1532"><a href="https://bniajfi.org/vital_signs/cprofiles/">Community Profiles</a></li>
                  <li id="menu-item-1531" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1531"><a href="https://bniajfi.org/vital_signs/data_downloads/">Data Downloads</a></li>
                  <li id="menu-item-1530" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1530"><a href="https://bniajfi.org/vital_signs/archives/">Archives</a></li>
                </ul>
              </li>
  
            <li id="menu-item-1526" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-ancestor current-menu-parent current_page_parent current_page_ancestor menu-item-has-children menu-item-1526">
              <a href="https://bniajfi.org/news_events/">News &amp; Events</a>
              <ul class="sub-menu">
                <li id="menu-item-1527" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-109 current_page_item menu-item-1527"><a href="https://github.com/bnia/">All Repositories </a></li>
                <li id="menu-item-1527" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-109 current_page_item menu-item-1527"><a href="https://bniajfi.org/VitalSigns/">Vital Signs Scripts </a></li>
                <li id="menu-item-1527" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-109 current_page_item menu-item-1527"><a href="https://github.com/dataplay/">Dataplay Scripts</a></li>
                <li id="menu-item-1527" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-109 current_page_item menu-item-1527"><a href="https://github.com/dataguide/">Data Handling Guidebook</a></li>
                <li id="menu-item-1527" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-109 current_page_item menu-item-1527"><a href="https://github.com/datalabs/">Data Laboratories</a></li>
              </ul>
            </li>

            </ul>
          </li>
        </ul>
      </div>
    </div>
    <!-- end WIDGET -->
    <!-- WIDGET -->
    <!-- end WIDGET -->
    <!-- WIDGET -->
    <!-- end WIDGET -->
  </aside>
  <!-- ************************** end SIDEBAR -->
  <!-- ************************** CONTENT -->
  <div class="span8 content">
  <!-- end WIDGET -->
  <!-- WIDGET -->
  <!-- end WIDGET -->
  <!-- WIDGET -->
  <!-- end WIDGET -->
  </aside>
  <!-- ************************** end SIDEBAR -->
    <div class="span8 content"> <!-- PAGE HEADER --> <div class="page-header"><h1><b>Mdprop_Permits_Fore_Vac Vio</b><small></small></h1></div> <!-- end PAGE HEADER --># default_exp mdprop<h3>43 baltvac - O</h3>
NO Query Found
Waiting on City Housing
Completed by Cheyrl<p>Todo:  </p>
<ul>
<li>Wrap as Function</li>
</ul>
<h4><strong>Columns Used</strong></h4>
<ul>
<li>
<p>✅ 32 - <strong>ownroc</strong> - (MdProp) Owner Occupied</p>
</li>
<li>
<p>✅ 34 - <strong>vacants</strong> - (MdProp[totalres], Vacants) number of demolition permits per 1000 residential properties</p>
</li>
<li>
<p>✅ xxx - <strong>baltvac</strong> - (Vacants) </p>
</li>
<li>
<p>✅ 35 - <strong>vio</strong> - (Violations, MdProp[totalres]) Number of of new constructio permits per 1000 residential properties</p>
</li>
<li>
<p>✅ 37 - <strong>Totalres</strong> - (Mdprop) The total number of residential properties located within an area as identified by Maryland Property View.</p>
</li>
<li>
<p>✅ 36 - <strong>resrehab</strong> - (MdProp[totalres], Permits) Percentage of properties with rehabilitation permits exceeding $5k</p>
</li>
<li>
<p>✅ 33 - <strong>fore</strong> - ( MdProp[totalres], Close_Crawl )</p>
</li>
<li>
<p>✅ 41 - <strong>demper</strong> - (MdProp[totalres], Permits) number of demolition permits per 1000 residential properties</p>
</li>
<li>
<p>✅ 42 - <strong>constper</strong> - (MdProp[totalres], Permits) Number of of new constructio permits per 1000 residential properties</p>
</li>
<li>
<p>✅ 141 - <strong>comprop</strong> - (MdProp) Percentage of properties with rehabilitation permits exceeding $5k</p>
</li>
<li>
<p>✅ 142 - <strong>crehab</strong> - (MdProp[comprop], Permits) Percentage of properties with rehabilitation permits exceeding $5k</p>
</li>
</ul>
<h4><strong>Datasets Used</strong></h4>
<ul>
<li>
<p>✅ foreclosures.foreclosures_201X <strong>(33-fore-&gt; 2018/ 2019 Close-Crawler)</strong></p>
</li>
<li>
<p>✅✔️ housing.vacants_201X <strong>(34-vacant -&gt; datenotice, dateabate, datecancle)</strong></p>
</li>
<li>
<p>✅ housing.permits_201X <strong>(36-resrehab, 41-demper, 42-constper -&gt; field22, casetype, propuse, existingus, cost)</strong></p>
</li>
<li>
<p>✅✔️ housing.mdprop_201X - <a href="https://bniajfi.org/indicators/Housing%20And%20Community%20Development/totalres">totalres</a> __( 33-fore, 34-vacant, 35-vio, 36-resrehab, 40-taxlien, 41-demper, 42-constper, __ ownroc <strong>)</strong> </p>
</li>
</ul>
<p>❌ = no data for</p>
<p>✔️ = Geocoded</p>
<p>✅ = Processed (starting from 2019)</p>
<p>This colab and more can be found at https://github.com/BNIA/vitalSigns.</p>
<p>General Outline</p>
<ol>
<li>Import and merge CSA/ BCity Esri boundary files</li>
<li>
</li>
</ol>
year = '20'<h2>About this Tutorial:</h2>
<h3>Whats Inside?</h3>
<h4><strong>The Tutorial</strong></h4>
<p>This lab is split into two sections. </p>
<h1>Guided Walkthrough</h1>
<h2>SETUP:</h2>
<h3>Import Modules</h3>
! pip install -U -q PyDrive
! pip install geopy
! pip install geopandas
! pip install geoplot!apt install libspatialindex-dev
!pip install rtree!pip install dataplay%%capture 
# These imports will handle everything
import os
import sys
import csv
import matplotlib.pyplot as plt
import numpy as np
import pandas as pd
import geopandas as gpd
from geopandas import GeoDataFrame
import psycopg2
import pyproj
from pyproj import Proj, transform
# conda install -c conda-forge proj4
from shapely.geometry import Point
from shapely import wkb
from shapely.wkt import loads
# https://pypi.org/project/geopy/
from geopy.geocoders import Nominatim

# In case file is KML, enable support
import fiona
fiona.drvsupport.supported_drivers['kml'] = 'rw'
fiona.drvsupport.supported_drivers['KML'] = 'rw'from IPython.display import clear_output
clear_output(wait=True)import ipywidgets as widgets
from ipywidgets import interact, interact_manual<h3>Configure Enviornment</h3>
# This will just beautify the output

pd.set_option('display.expand_frame_repr', False)
pd.set_option('display.precision', 2)
from IPython.core.interactiveshell import InteractiveShell
InteractiveShell.ast_node_interactivity = "all"

# pd.set_option('display.expand_frame_repr', False)
# pd.set_option('display.precision', 2)
# pd.reset_option('max_colwidth')
pd.set_option('max_colwidth', 20)
# pd.reset_option('max_colwidth')<h3>TPOP CSA and Baltimore</h3>
<p>Get Baltimore</p>
<details > <summary>Click to toggle</summary> csa = "https://services1.arcgis.com/mVFRs7NF4iFitgbY/ArcGIS/rest/services/Tpop/FeatureServer/0/query?where=1%3D1&outFields=*&returnGeometry=true&f=pgeojson"
csa = gpd.read_file(csa);
csa.head(1)</details><p>Get CSA</p>
url2 = "https://services1.arcgis.com/mVFRs7NF4iFitgbY/ArcGIS/rest/services/Tpop/FeatureServer/1/query?where=1%3D1&outFields=*&returnGeometry=true&f=pgeojson"
csa2 = gpd.read_file(url2);
csa2['CSA2010'] = csa2['City_1'] 
csa2['OBJECTID'] = 56 
csa2 = csa2.drop(columns=['City_1'])
csa2.head()<p>Append do no append Bcity. We put it on the Bottom of the df because when performing the ponp it returns only the last matching columns CSA Label. </p>
# csa = pd.concat([csa2, csa], ignore_index=True)
csa = csa.append(csa2).reset_index(drop=True)csa.head(3)csa.tail(3)csa.head()csa.drop(columns=['Shape__Area', 'Shape__Length', 'OBJECTID'], axis=1).to_file("BCity_and_CSA.geojson", driver='GeoJSON')<h1>MDProp</h1>
import pandas as pd
import geopandas 

original = gpd.read_file('MDPropertyView_2021_CSACity.shp')
original.columns
pd.set_option('display.max_columns', None)original.rename(columns={ 'CSA':'CSA2010', 'BaltCity':'InBaltimore'}, inplace=True)
df = original[ original['CSA2010'].notnull() | original['InBaltimore'].notnull()  ]print('After filtering records where a CSA or Baltimore geo-code match Exists')
print( 'All rows Before Filter: ', original.shape[0] ) # rows, columns
print( '# w BCity.isnull: ', df.InBaltimore.isnull().sum() ); bmorow = df[ df.CSA2010.isnull()  ].shape[0]
print( '# w CSA2010.isnull: ', bmorow ); csarow = df[ df.CSA2010.notnull()  ].shape[0] 
print( '# w CSA2010.notnull: ', csarow ); 
print( '# rows After Filter: ', df.shape[0],'==',csarow,'+',bmorow,'==', csarow + bmorow); # add baltimore city
df.CSA2010 = df.CSA2010.fillna('Baltimore City')mdprop = df.copy()
mdprop.head(1)<h1>Permits - OLD PointsInPolygons</h1>
<h2>Import</h2>
permits = gpd.read_file("Permits_2019_CSACity.shp");
permits.head()permits.columns
permits.crs
permits.head(5)# Convert to EPSG:4326
permits = permits.to_crs(epsg=4326)
permits.crs# Convert Geom to Coords
permits['x'] = permits.geometry.x
permits['y'] = permits.geometry.y
permits.head(5)permits = permits[ permits.geometry.y > 38 ]# Reference: All Points
base = csa.plot(color='white', edgecolor='black')
permits.plot(ax=base, marker='o', color='green', markersize=5);permits.columnscsa.tail()from dataplay import geoms
# Get CSA Labels for all Points.
# permitsCsa = geoms.getPolygonOnPoints(permits, csa, 'geometry', 'geometry', 'CSA2010' )
permitsCsa = geoms.workWithGeometryData(method='ponp', df=permits, polys=csa, ptsCoordCol='geometry', polygonsCoordCol='geometry', polyColorCol=False, polygonsLabel='CSA2010', pntsClr='red', polysClr='white')
# permitsCsa = permitsCsa.drop('geometry',axis=1)permitsCsa.head(10)<h2>Processing</h2>
<p>All</p>
permitsAll = permits# Reference: All Points
base = csa.plot(color='white', edgecolor='black')
permitsAll.plot(ax=base, marker='o', color='green', markersize=5);permits = permitsAll# y < 0
permitsLessThanZero = permits[ permits.geometry.y < 0 ]
print('Y<0: ', permitsLessThanZero.size, '\n')# y > 0
permitsGreaterThanZero = permits[ permits.geometry.y > 0 ]
print('Y>0: ', permitsGreaterThanZero.size, '\n')
permitsGreaterThanZero.plot();# 0 < y < 38
permitsOver38 = permits[ permits.geometry.y < 38 ]
permitsOver38 = permitsOver38[ permitsOver38.geometry.y > 0 ]
print('0 < y < 38: ', permitsOver38.size, '\n') # y > 38
permitsUnder38 = permits[ permits.geometry.y > 38 ]
print('Y>38 Less than Zero: ', permitsUnder38.size, '\n')
permitsUnder38.plot();<h1>Permits</h1>
import pandas as pd
import geopandas 

original = gpd.read_file("Permits_20"+year+"_CSACity.shp", geometry='geometry');
original.columns original.rename(columns={ 'CSA':'CSA2010', 'BaltCity':'InBaltimore'}, inplace=True)
df = original[ original['CSA2010'].notnull() | original['InBaltimore'].notnull()  ]print('After filtering records where a CSA or Baltimore geo-code match Exists')
print( 'All rows Before Filter: ', original.shape[0] ) # rows, columns
print( '# w BCity.isnull: ', df.InBaltimore.isnull().sum() ); bmorow = df[ df.CSA2010.isnull()  ].shape[0]
print( '# w CSA2010.isnull: ', bmorow ); csarow = df[ df.CSA2010.notnull()  ].shape[0] 
print( '# w CSA2010.notnull: ', csarow ); 
print( '# rows After Filter: ', df.shape[0],'==',csarow,'+',bmorow,'==', csarow + bmorow); # add baltimore city
df.CSA2010 = df.CSA2010.fillna('Baltimore City')permitsCsa = df.copy()
permitsCsa.head(1)<h1>Vacants</h1>
import pandas as pd
import geopandas 

original = gpd.read_file("Vacants_20"+year+"_CSACity.shp", geometry='geometry');
original.columns original.rename(columns={ 'CSA':'CSA2010', 'BaltCity':'InBaltimore'}, inplace=True)
df = original[ original['CSA2010'].notnull() | original['InBaltimore'].notnull()  ]print('After filtering records where a CSA or Baltimore geo-code match Exists')
print( 'All rows Before Filter: ', original.shape[0] ) # rows, columns
print( '# w BCity.isnull: ', df.InBaltimore.isnull().sum() ); bmorow = df[ df.CSA2010.isnull()  ].shape[0]
print( '# w CSA2010.isnull: ', bmorow ); csarow = df[ df.CSA2010.notnull()  ].shape[0] 
print( '# w CSA2010.notnull: ', csarow ); 
print( '# rows After Filter: ', df.shape[0],'==',csarow,'+',bmorow,'==', csarow + bmorow); # add baltimore city
df.CSA2010 = df.CSA2010.fillna('Baltimore City')vacants = df.copy()
vacants.head(1)<h1>Vio</h1>
import pandas as pd
import geopandas 

original = gpd.read_file("Violations_20"+year+"_CSACity.shp", geometry='geometry');
original.columns original.rename(columns={ 'CSA':'CSA2010', 'BaltCity':'InBaltimore'}, inplace=True)
df = original[ original['CSA2010'].notnull() | original['InBaltimore'].notnull()  ]print('After filtering records where a CSA or Baltimore geo-code match Exists')
print( 'All rows Before Filter: ', original.shape[0] ) # rows, columns
print( '# w BCity.isnull: ', df.InBaltimore.isnull().sum() ); bmorow = df[ df.CSA2010.isnull()  ].shape[0]
print( '# w CSA2010.isnull: ', bmorow ); csarow = df[ df.CSA2010.notnull()  ].shape[0] 
print( '# w CSA2010.notnull: ', csarow ); 
print( '# rows After Filter: ', df.shape[0],'==',csarow,'+',bmorow,'==', csarow + bmorow); # add baltimore city
df.CSA2010 = df.CSA2010.fillna('Baltimore City')violations = df.copy()
violations.head(1)<h1>Foreclosures_2019_CSACity</h1>
import pandas as pd
import geopandas 

original = gpd.read_file("Foreclosures_20192020_CSACity.shp", geometry='geometry');
original.columns original.rename(columns={ 'CSA':'CSA2010', 'BaltCity':'InBaltimore'}, inplace=True)
df = original[ original['CSA2010'].notnull() | original['InBaltimore'].notnull()  ]print('After filtering records where a CSA or Baltimore geo-code match Exists')
print( 'All rows Before Filter: ', original.shape[0] ) # rows, columns
print( '# w BCity.isnull: ', df.InBaltimore.isnull().sum() ); bmorow = df[ df.CSA2010.isnull()  ].shape[0]
print( '# w CSA2010.isnull: ', bmorow ); csarow = df[ df.CSA2010.notnull()  ].shape[0] 
print( '# w CSA2010.notnull: ', csarow ); 
print( '# rows After Filter: ', df.shape[0],'==',csarow,'+',bmorow,'==', csarow + bmorow); # add baltimore city
df.CSA2010 = df.CSA2010.fillna('Baltimore City')foreclosures = df.copy()
foreclosures.head(1)foreclosures19 = foreclosures[foreclosures['Case_Numbe'].str.contains("24O19")]
foreclosures20 = foreclosures[foreclosures['Case_Numbe'].str.contains("24O20")]
if (year=='19'): forclosure = foreclosures19.copy()
else: forclosure = foreclosures20.copy()forclosure.head()<h1>Create Indicators</h1>
<h3><a href="https://bniajfi.org/indicators/Housing%20And%20Community%20Development/totalres">Totalres 37</a> - (Mdprop) - Complete</h3>
mdprop.head(1)#export 
totalres = mdprop.copy()

totalres['totalres'+year] = 1
totalres = totalres[ totalres['DESCLU'].isin(['Apartments', 'Residential', 'Residential Commercial', 'Residential Condominium']) ]
totalres = totalres[ totalres['ADDRESS'].notna() ]
print(totalres.ADDRESS.unique() )
totalres = totalres[['CSA2010','totalres'+year]]
totalres = totalres.groupby('CSA2010').sum(numeric_only=True) 
# Make sure ALL csas and BaltimoreCity are included. among other things
totalres = csa[ ['CSA2010','tpop10'] ].merge( totalres, left_on='CSA2010', right_on='CSA2010', how='outer' ) 
# Update the baltimore CSA.
totalres.at[55,'totalres'+year] = totalres['totalres'+year].sum()

# Create the Indicator
totalres.to_csv('37-totalres-'+year+'.csv', index=False) 

totalres.head(58)<p>old_notes=&quot;&quot;&quot;
2016 uses dataset housing.mdprop_2017
2017 uses dataset housing.mdprop_2017v2
2016s dataset was collected in January of 2017
2017s dataset was collected in Novermber of 2017
&quot;&quot;&quot;</p>
<h3>OwnRoc 32 - ( MdProp[totalres] ) - Complete</h3>
original = """ with numerator AS (
   select (sum(
   case 
   when (ooi like 'H') AND (address != $$NULL$$) AND (desclu = $$Apartments$$ OR desclu = $$Residential$$ OR desclu = $$Residential Commercial$$ OR desclu = $$Residential Condominium$$)
   then 1
   else 0
   end)::numeric) as result, csa
   from vital_signs.match_csas_and_bc_by_geom('housing.mdprop_2017', 'gid', 'the_geom') a
   left join housing.mdprop_2017 b on a.gid = b.gid
   group by csa
   ),
   denominator AS (
    select (sum(
     case 
     when (address != $$NULL$$) AND (desclu = $$Apartments$$ OR desclu = $$Residential$$ OR desclu = $$Residential Commercial$$ OR desclu = $$Residential Condominium$$)
     then 1
     else NULL
     end)::numeric 
    ) as result, csa
    from vital_signs.match_csas_and_bc_by_geom('housing.mdprop_2017', 'gid', 'the_geom') a
    left join housing.mdprop_2017 b on a.gid = b.gid
    group by csa, the_pop
   ),
   tbl AS (
     select denominator.csa,(numerator.result / denominator.result)*(100::numeric) as result 
     from numerator left join denominator on numerator.csa = denominator.csa
    )
   update vital_signs.data
   set ownroc = result from tbl where data.csa = tbl.csa and data_year = '2016';
 """

ownroc_translation = """
  Numerator = sum vacants_2017 when 
    (ooi like 'H') AND 
    (address != $$NULL$$) AND 
    (desclu = $$Apartments$$ OR 
    desclu = $$Residential$$ OR 
    desclu = $$Residential Commercial$$ OR 
    desclu = $$Residential Condominium$$

  Denominator =  mdprop_2017.totalres
  return = (numerator / denominator )* 100
  """oldNotes = """ 2016 uses dataset housing.mdprop_2017
2017 uses dataset housing.mdprop_2017v2
2016s dataset was collected in January of 2017
2017s dataset was collected in Novermber of 2017
"""#export 
import datetime
ownroc = mdprop.copy()  

ownroc = ownroc[ ownroc['OOI']=='H']
ownroc = ownroc.dropna( subset=['ADDRESS'] )
ownroc = ownroc[ ownroc['DESCLU'].isin(['Apartments', 'Residential', 'Residential Commercial', 'Residential Condominium']) ] 
ownroc.to_csv('ownroc'+str(year)+'_Filtered_Records.csv', index=False)

print( 'Records Matching Query: ', ownroc.size / len(ownroc.columns) )

# Aggregate Numeric Values by Sum 
ownroc['ownrocCount'] = 1 
ownroc = ownroc.groupby('CSA2010').sum(numeric_only=True)   
ownroc = csa[ ['CSA2010'] ].merge( ownroc, left_on='CSA2010', right_on='CSA2010', how='outer' ) 
ownroc = csa.merge( ownroc, left_on='CSA2010', right_on='CSA2010', how='outer' )

# Create the Indicator
ownroc['ownroc'] = ownroc['ownrocCount'] * 100 / totalres['totalres'+year]
ownroc.at[55,'ownrocCount'] = ownroc['ownrocCount'].sum()
ownroc.at[55,'ownroc'] = ownroc['ownrocCount'].sum() * 100/ totalres['totalres'+year].sum()
ownroc = ownroc[ ['CSA2010', 'ownrocCount', 'ownroc'] ]
ownroc.to_csv('32-ownroc'+year+'.csv', index=False)

ownroc.tail(60)<h3>Vacant 34 - (MdProp[totalres], Vacants) - Complete</h3>
totalres = pd.read_csv('37-totalres-'+year+'.csv')# 34- vacant - percentage of residential properties that are vacant and abandoned

# https://services1.arcgis.com/mVFRs7NF4iFitgbY/arcgis/rest/services/vacant/FeatureServer/layers 

# Numerator: housing.vacants_201X
# Denominator: housing.mdprop_201X

long_Description: """
The percentage of residential properties that have been classified as being vacant and abandoned by the Baltimore City Department
 of Housing out of all properties. Properties are classified as being vacant and abandoned if: the property is not habitable and
  appears boarded up or open to the elements; the property was designated as being vacant prior to the current year and still
   remains vacant; and the property is a multi-family structure where all units are considered to be vacant.
"""

vacant_SQL = """
 2016
  with numerator AS (
   select (sum( case 
     when (datenotice between '2004-01-01' and '2016-12-31') AND (dateabate is NULL OR dateabate >= '2016-12-31') AND 
          (datecancel is NULL OR datecancel > '2016-12-31') then 1 else NULL end)::numeric) as result, csa
       from vital_signs.match_csas_and_bc_by_geom('housing.vacants_2016', 'gid', 'the_geom') a
         left join housing.vacants_2016 b on a.gid = b.gid
           group by csa ),
  denominator AS (
    select (sum(
     case 
     when (address != $$NULL$$) AND (desclu = $$Apartments$$ OR desclu = $$Residential$$ OR desclu = $$Residential Commercial$$ OR desclu = $$Residential Condominium$$)
     then 1
     else NULL
     end)::numeric 
    ) as result, csa
    from vital_signs.match_csas_and_bc_by_geom('housing.mdprop_2017', 'gid', 'the_geom') a
    left join housing.mdprop_2017 b on a.gid = b.gid
    group by csa, the_pop
   ),
  tbl AS (
     select denominator.csa,(numerator.result / denominator.result)*(100::numeric) as result 
     from numerator left join denominator on numerator.csa = denominator.csa
     )
  update vital_signs.data
  set vacant = result from tbl where data.csa = tbl.csa and data_year = '2016';"

 2017
   with numerator AS (
    select (sum( case 
     when (datenotice between '2004-01-01' and '2017-12-31') AND (dateabate is NULL OR dateabate >= '2017-12-31') AND (datecancel is NULL OR datecancel > '2017-12-31') then 1 else NULL end)::numeric) as result, csa
       from vital_signs.match_csas_and_bc_by_geom('housing.vacants_2017', 'gid', 'the_geom') a
         left join housing.vacants_2017 b on a.gid = b.gid
           group by csa ),
   denominator AS (
    select (sum( case 
     when (address != $$NULL$$) AND (desclu = $$Apartments$$ OR desclu = $$Residential$$ OR desclu = $$Residential Commercial$$ OR desclu = $$Residential Condominium$$)
       then 1 else NULL end)::numeric ) as result, csa
      from vital_signs.match_csas_and_bc_by_geom('housing.mdprop_2017vs', 'gid', 'the_geom') a
        left join housing.mdprop_2017vs b on a.gid = b.gid
          group by csa, the_pop ),
   tbl AS (
     select denominator.csa,(numerator.result / denominator.result)*(100::numeric) as result 
     from numerator left join denominator on numerator.csa = denominator.csa
     )
   select * from tbl order by csa asc"
   column "dateabate" does not exist
  """

vacant_translation = """
Numerator = sum vacants_2017 when 
  (datenotice between '2004-01-01' and '2017-12-31') 
  AND (dateabate is NULL OR dateabate >= '2017-12-31') 
  AND (datecancel is NULL OR datecancel > '2017-12-31')

 Denominator =  mdprop_2017.totalres

 return = (numerator / denominator )* 100
"""te = """
  with numerator AS (
   select (sum(
   case 
   when (datenotice between '2004-01-01' and '2017-12-31') AND (dateabate is NULL OR dateabate >= '2017-12-31') AND (datecancel is NULL OR datecancel > '2017-12-31')
   then 1
   else NULL
   end)::numeric) as result, csa
   from vital_signs.match_csas_and_bc_by_geom('housing.vacants_2017', 'gid', 'the_geom') a
   left join housing.vacants_2017 b on a.gid = b.gid
   group by csa
   ), 
   tbl AS (
     select denominator.csa,(numerator.result / denominator.result)*(100::numeric) as result 
     from numerator left join denominator on numerator.csa = denominator.csa
     )
select * from tbl order by csa asc
"""vacants.head(1)#export 
import datetime
vacantsCsa = vacants.copy()  

# (datenotice between '2004-01-01' and '2016-12-31') AND 
# (dateabate is NULL OR dateabate >= '2016-12-31') AND 
# (datecancel is NULL OR datecancel > '2016-12-31')

vacantsCsa['DateNotice2'] = pd.to_datetime(vacantsCsa['DateNotice'],infer_datetime_format=True)
vacantsCsa = vacantsCsa[
    ( vacantsCsa['DateNotice2']>=pd.Timestamp(2000+int(year)-13,1,1) ) & 
    ( vacantsCsa['DateNotice2']<=pd.Timestamp(2000+int(year),12,31) )
]

vacantsCsa.to_csv('vacants_Filtered_Records.csv', index=False)

print( 'Records Matching Query: ', vacantsCsa.size / len(vacantsCsa.columns) )

# Aggregate Numeric Values by Sum 
vacantsCsa['vacantsCount'] = 1
vacantsCsa = vacantsCsa.groupby('CSA2010').sum(numeric_only=True)  
vacantsCsa = totalres[ ['CSA2010', 'totalres'+year] ].merge( vacantsCsa, left_on='CSA2010', right_on='CSA2010', how='outer' )

# Create the Indicator
vacantsCsa['vacants'+year] = vacantsCsa['vacantsCount'] * 100 / totalres['totalres'+year]
vacantsCsa.at[55,'vacantsCount'] = vacantsCsa['vacantsCount'].sum()
vacantsCsa.at[55,'vacants'+year] = vacantsCsa['vacantsCount'].sum() * 100 / totalres['totalres'+year].sum()
vacantsCsa = vacantsCsa[ ['CSA2010', 'vacantsCount', 'vacants'+year, 'totalres'+year ] ]
vacantsCsa.to_csv('34-vacants'+year+'.csv', index=False)

vacantsCsa.tail(60)<h3>BaltVac 43 - (Vacants) - Complete</h3>
vacants.OwnerAbbr.unique()#export 
import datetime
baltvac = vacants.copy()  

baltvac = baltvac[ (baltvac['OwnerAbbr'].str.contains('DHCD|HABC|HUD|MCC|USA', regex=True, na=False) ) ]
baltvac['DateNotice2'] = pd.to_datetime(baltvac['DateNotice'],infer_datetime_format=True)
baltvac = baltvac[
    ( baltvac['DateNotice2']>=pd.Timestamp(2000+int(year)-13,1,1) ) & 
    ( baltvac['DateNotice2']<=pd.Timestamp(2000+int(year),12,31) )
]

baltvac.to_csv('baltvac_Filtered_Records.csv', index=False)

print( 'Records Matching Query: ', baltvac.size / len(baltvac.columns) )

# Aggregate Numeric Values by Sum 
baltvac['baltvacCount'] = 1
baltvac = baltvac.groupby('CSA2010').sum(numeric_only=True)  
baltvac = vacantsCsa[ ['CSA2010', 'vacants'+year] ].merge( baltvac, left_on='CSA2010', right_on='CSA2010', how='outer' )

# Create the Indicator
baltvac['baltvac'+year] = baltvac['baltvacCount'] / vacantsCsa['vacantsCount'] * 100
baltvac.at[55,'baltvacCount'] = baltvac['baltvacCount'].sum()
baltvac.at[55,'baltvac'+year] = baltvac['baltvacCount'].sum() * 100 / vacantsCsa['vacantsCount'].sum()
baltvac = baltvac[ ['CSA2010', 'baltvacCount', 'baltvac'+year, 'vacants'+year ] ]
baltvac.to_csv('43-baltvac'+year+'.csv', index=False)

baltvac.tail(60)<h3>Vio 35 - (MdProp[totalres], Violations) - Complete</h3>
a2016_query = """
  with numerator AS (
   select (sum(
   case 
   when (datenotice between '2016-01-01' and '2016-12-31') AND (dateabate is NULL OR dateabate >= '2016-12-31') AND (datecancel is NULL OR datecancel > '2016-12-31')  
    then 1
   else NULL
   end)::numeric) as result, csa
   from vital_signs.match_csas_and_bc_by_geom('housing.violations_thru2016', 'gid', 'the_geom') a
   left join housing.violations_thru2016 b on a.gid = b.gid
   group by csa
   ),
   denominator AS (
    select (sum(
     case 
     when (address != $$NULL$$) AND (desclu = $$Apartments$$ OR desclu = $$Residential$$ OR desclu = $$Residential Commercial$$ OR desclu = $$Residential Condominium$$)
     then 1
     else NULL
     end)::numeric 
    ) as result, csa
    from vital_signs.match_csas_and_bc_by_geom('housing.mdprop_2017', 'gid', 'the_geom') a
    left join housing.mdprop_2017 b on a.gid = b.gid
    group by csa, the_pop
   ),
   tbl AS (
     select denominator.csa,(numerator.result / denominator.result)*(100::numeric) as result 
     from numerator left join denominator on numerator.csa = denominator.csa
     )
   update vital_signs.data
   set vio = result from tbl where data.csa = tbl.csa and data_year = '2016';
   
 (datenotice between '2016-01-01' and '2016-12-31') AND (dateabate is NULL OR dateabate >= '2016-12-31') AND (datecancel is NULL OR datecancel > '2016-12-31') 
"""
a2017_query = """
 with numerator AS (
   select (sum(
   case 
   when (datenotice between '2017-01-01' and '2017-12-31') AND (dateabate is NULL OR dateabate >= '2017-12-31') AND (datecancel is NULL OR datecancel > '2017-12-31')  
    then 1
   else NULL
   end)::numeric) as result, csa
   from vital_signs.match_csas_and_bc_by_geom('housing.violations_2017', 'gid', 'the_geom') a
   left join housing.violations_2017 b on a.gid = b.gid
   group by csa
   ),
   denominator AS (
    select (sum(
     case 
     when (address != $$NULL$$) AND (desclu = $$Apartments$$ OR desclu = $$Residential$$ OR desclu = $$Residential Commercial$$ OR desclu = $$Residential Condominium$$)
     then 1
     else NULL
     end)::numeric 
    ) as result, csa
    from vital_signs.match_csas_and_bc_by_geom('housing.mdprop_2017v2', 'gid', 'the_geom') a
    left join housing.mdprop_2017v2 b on a.gid = b.gid
    group by csa, the_pop
   ),
   tbl AS (
     select denominator.csa,(numerator.result / denominator.result)*(100::numeric) as result 
     from numerator left join denominator on numerator.csa = denominator.csa
     )
     
  select * from tbl where 1 = 1 ORDER BY csa ASC;
"""
#export 
# Numerator
vio = violations.copy()  

# drop null 
vio['DateCancel'] = pd.to_datetime(vio['DateCancel'])
vio['DateAbate'] = pd.to_datetime(vio['DateAbate'])
vio['DateNotice'] = pd.to_datetime(vio['DateNotice'], errors='coerce')

# Numerator
vio = vio[['DateNotice', 'DateAbate', 'DateCancel','CSA2010']]
vio.head(1)

start_date = '20'+year+'-01-01'
end_date = '20'+year+'-12-31'

mask = vio[ ( vio['DateNotice'] > start_date ) & ( vio['DateNotice'] <= end_date) ]
mask1 = mask[ ( pd.isnull( mask['DateAbate'] ) ) | ( mask['DateAbate'] >= end_date ) ]
mask2 = mask1[ pd.isnull( mask1['DateCancel'] ) | ( mask1['DateCancel'] > end_date ) ]
vio = mask2.copy()

vio.to_csv('vio_Filtered_Records.csv', index=False)#export 
# Aggregate Numeric Values by Sum 
vio['vioCount'] = 1
vio = vio.groupby('CSA2010').sum(numeric_only=True) 
vio = totalres[ ['CSA2010', 'totalres'+year] ].merge( vio, left_on='CSA2010', right_on='CSA2010', how='outer' ) 

# Create the Indicator
vio['vio'] = vio['vioCount'] * 100 / totalres['totalres'+year]

# Create Baltimore's Record. 
vio.at[55,'vioCount'] = vio['vioCount'].sum()
vio.at[55,'vio'] = vio['vioCount'].sum() * 100 / totalres['totalres'+year].sum()

vio.to_csv('35-violations'+year+'.csv', index=False)

vio.tail()<h3>Fore 33 - (MdProp[totalres], Close Crawl) - Complete</h3>
<ul>
<li>case crawl should have a dramatic reduction in 2020. no foreclosures were permited after march 2020 because covid.</li>
</ul>
# 33 - fore - percent of properties under mortgage foreclosure

# https://services1.arcgis.com/mVFRs7NF4iFitgbY/arcgis/rest/services/Constper/FeatureServer/layers
# https://bniajfi.org/indicators/Housing%20And%20Community%20Development/fore

# Numerator: foreclosures.foreclosures_201X
# Denominator: housing.mdprop_201X
# run the 2018 and 2019 crawler first!

long_Description: """
  The percentage of properties where the lending company or loan servicer has filed a foreclosure proceeding with the 
  altimore City Circuit Court out of all residential properties within an area. This is not a measure of actual foreclosures 
  since not every property that receives a filing results in a property dispossession.
"""
fore_SQL = """
 2016
  with numerator AS (
   select (sum( case when csa_present then 1 else NULL end)::numeric) as result, csa
    from vital_signs.match_csas_and_bc_by_geom('foreclosures.foreclosures_2016', 'gid', 'the_geom') a
      left join foreclosures.foreclosures_2016 b on a.gid = b.gid 
        group by csa  ),
  denominator AS (
   select (sum( case when (address != $$NULL$$) 
      AND (desclu = $$Apartments$$ 
      OR desclu = $$Residential$$ 
      OR desclu = $$Residential Commercial$$ 
      OR desclu = $$Residential Condominium$$) then 1 else NULL end)::numeric  ) as result, csa
    from vital_signs.match_csas_and_bc_by_geom('housing.mdprop_2017', 'gid', 'the_geom') a
      left join housing.mdprop_2017 b on a.gid = b.gid
        group by csa, the_pop  ),
  tbl AS (
   select denominator.csa,(numerator.result / denominator.result)*(100::numeric) as result 
   from numerator left join denominator on numerator.csa = denominator.csa  )
  update vital_signs.data
  set fore = result from tbl where data.csa = tbl.csa and data_year = '2016'; 

 --/* <fore_16 number> */
  select(sum( case when csa_present then 1 else NULL end)::numeric) as result, csa
   from vital_signs.match_csas_and_bc_by_geom('foreclosures.foreclosures_2016', 'gid', 'the_geom') a
     left join foreclosures.foreclosures_2016 b on a.gid = b.gid
       group by csa order by csa = 'Baltimore City', csa

  WHERE (ooi like 'H') 
  AND (address != $$NULL$$) 
  AND (desclu = $$Apartments$$ 
  OR desclu = $$Residential$$ 
  OR desclu = $$Residential Commercial$$ 
  OR desclu = $$Residential Condominium$$
  """

fore_translation = "( count of closecrawl records per CSA / mdprop_2017.totalres )* 100"#export 
# Aggregate Numeric Values by Sum 
forclosure['foreCount'] = 1
fore = forclosure.groupby('CSA2010').sum(numeric_only=True) 
# Make sure ALL csas and BaltimoreCity are included. among other things
fore = totalres[ ['CSA2010', 'totalres'+year] ].merge( fore, left_on='CSA2010', right_on='CSA2010', how='outer' )

# Create the Indicator
fore['fore'] = fore['foreCount'] * 100 / fore['totalres'+year]

fore.at[55,'foreCount'] = fore['foreCount'].sum()
fore.at[55,'fore'] = fore['foreCount'].sum() * 100 / fore['totalres'+year].sum()

fore = fore[['CSA2010', 'foreCount', 'fore', 'totalres'+year ]]

fore.to_csv('33-fore'+year+'.csv', index=False)

fore.tail(60)<h3>Resrehab 36 - (MdProp[totalres], Permits) - Complete</h3>
# 36- resrehab - Percentage of properties with rehabilitation permits exceeding $5k

# https://services1.arcgis.com/mVFRs7NF4iFitgbY/arcgis/rest/services/resrehab/FeatureServer/layers

# Numerator: housing.permits_201X
# Denominator: housing.mdprop_201X

long_Description: """
  The percent of residential properties that have applied for and received a permit to renovate the interior and/or exterior 
  of a property where the cost of renovation will exceed $5,000. The threshold of $5,000 is used to differentiate a minor 
  and more significant renovation project.
  """

resrehab_SQL = """
  2016
    with numerator AS (
    select sum( case 
      when (exis = $$SF$$ OR exis = $$MF$$ ) AND (type1 = $$AA$$ OR type1 = $$ADD$$ OR type1 = $$ALT$$) AND (costts >=5000)
        then 1 else 0 end)::numeric as result, csa from vital_signs.match_csas_and_bc_by_geom('housing.permits_2016', 'gid', 'the_geom') a
        left join housing.permits_2016 b on a.gid = b.gid
          group by csa ),
    denominator AS (
      select (sum( case 
      when (address != $$NULL$$) AND (desclu = $$Apartments$$ OR desclu = $$Residential$$ OR desclu = $$Residential Commercial$$ OR desclu = $$Residential Condominium$$)
        then 1 else NULL end)::numeric ) as result, csa
          from vital_signs.match_csas_and_bc_by_geom('housing.mdprop_2017', 'gid', 'the_geom') a
            left join housing.mdprop_2017 b on a.gid = b.gid
              group by csa, the_pop ),
    tbl AS (
      select denominator.csa,(numerator.result / denominator.result)*(100::numeric) as result 
      from numerator left join denominator on numerator.csa = denominator.csa )
    update vital_signs.data
    set resrehab = result from tbl where data.csa = tbl.csa and data_year = '2016';"

  2017
    with numerator AS (
    select sum(case 
      when (existingus = $$SF$$ 
              OR propuse = $$SF$$ 
              OR existingus = $$MF$$ 
              OR propuse = $$MF$$ 
              OR existingus = $$DFAM$$ 
              OR propuse = $$DFAM$$ 
              OR existingus like '%1-%'
              OR propuse like '%1-%' 
            ) 
            AND casetype LIKE any (ARRAY['COM'])
            AND (field22 = $$AA$$ OR field22 = $$ADD$$ OR field22 = $$ALT$$) 
            AND (cost >=5000) then 1 else 0 end )::numeric as result, csa
      from vital_signs.match_csas_and_bc_by_geom('housing.permits_2017', 'gid', 'the_geom') a
        left join housing.permits_2017 b on a.gid = b.gid
          group by csa ),
    denominator AS (
    select (sum( case 
        when (address != $$NULL$$) AND (desclu = $$Apartments$$ OR desclu = $$Residential$$ OR desclu = $$Residential Commercial$$ OR desclu = $$Residential Condominium$$) then 1 else NULL end )::numeric ) as result, csa
      from vital_signs.match_csas_and_bc_by_geom('housing.mdprop_2017v2', 'gid', 'the_geom') a
        left join housing.mdprop_2017v2 b on a.gid = b.gid
          group by csa, the_pop ),
    tbl AS (
    select denominator.csa,(numerator.result / denominator.result)*(100::numeric) as result 
      from numerator left join denominator on numerator.csa = denominator.csa )
    select * from tbl where 1 = 1 ORDER BY csa ASC;"

    INVALID COLUMN NAMES
    "/* FIELD22: NEW ALT OTH DEM AA ADD */
    2016 - > exis, prop, type1, cossts
    2017 -> existingus, propuse, field22, cost
    """

resrehab_translation = """
  Numerator = sum permits_2017 when (
              existingus = $$SF$$ OR existingus = $$MF$$ OR existingus = $$DFAM$$ OR existingus like '%1-%'
              OR propuse = $$SF$$ OR propuse = $$MF$$ OR propuse = $$DFAM$$ OR propuse like '%1-%' 
            ) 
            AND casetype LIKE any (ARRAY['COM'])
            AND (field22 = $$AA$$ OR field22 = $$ADD$$ OR field22 = $$ALT$$) 
            AND (cost >=5000) then 1 else 0 end )
  Denominator = mdprop.totalres
  return = (numerator / denominator )* 100
  """<p>INVALID COLUMN NAMES
2016 - &gt; exis, prop, type1, cossts
2017 -&gt; existingus, propuse, field22, cost</p>
#export 
resrehab = permitsCsa
resrehab['Field22'] = resrehab['typework']

use = ".SF.|.MF.|.DFAM.|.1-.|SF|MF|DFAM|1-.|.1-" 
resrehab = resrehab[ 
  ( permitsCsa['existingus'].str.contains(use, regex=True, na=False) ) & 
  ( permitsCsa['propuse'].str.contains(use, regex=True, na=False) ) & 
  ( permitsCsa['casetype'].str.contains('.COM.|COM', regex=True, na=False) ) & 
  ( permitsCsa['Field22'].str.contains('.AA.|.ADD.|.ALT.|AA|ADD|ALT|ADD', regex=True, na=False) ) & 
  ( permitsCsa['cost'] >=5000 ) 
] 

resrehab.to_csv('resrehab'+year+'_Filtered_Records.csv', index=False)

print( 'Records Matching Query: ', resrehab.size / len(resrehab.columns) )

# Aggregate Numeric Values by Sum 
resrehab['resrehabCount'] = 1
resrehab = resrehab.groupby('CSA2010').sum(numeric_only=True) 

# Make sure ALL csas and BaltimoreCity are included. among other things
resrehab = totalres[ ['CSA2010','totalres'+year] ].merge( resrehab, left_on='CSA2010', right_on='CSA2010', how='outer' ) 

# Update the baltimore CSA.
resrehab.at[55,'resrehabCount'] = resrehab['resrehabCount'].sum() 

# Create the Indicator
resrehab['resrehab'+year] = resrehab['resrehabCount'] * 100 / totalres['totalres'+year]

resrehab = resrehab[ ['CSA2010', 'resrehabCount', 'resrehab'+year, 'totalres'+year ] ]

resrehab.to_csv('36-resrehab'+year+'.csv', index=False)

resrehab.head()
resrehab.tail()<h3>Demper 41 - (MdProp[totalres], Permits) - Complete</h3>
<p>INVALID COLUMN NAMES 2016 - &gt; exis, prop, type1, cossts 2017 -&gt; existingus, propuse, field22, cost</p>
# 41- demper - number of demolition permits per 1000 residential properties

# https://services1.arcgis.com/mVFRs7NF4iFitgbY/arcgis/rest/services/demper/FeatureServer/layers

# Numerator: housing.dempermits_201X
# Denominator: housing.mdprop_201X

long_Description: """
  The number of permits issued for the demolition of residential buildings per 1,000 existing residential properties. 
  The permits are analyzed by date of issue and not date of actual demolition.
  """

demper_SQL = """
  2016
    with numerator AS (
    select (sum( case 
      when csa_present then 1 else 0 end)::numeric) as result, csa
        from vital_signs.match_csas_and_bc_by_geom('housing.dempermits_2016', 'gid', 'the_geom') a
          left join housing.dempermits_2016 b on a.gid = b.gid
            group by csa ),
    denominator AS (
      select (sum(
      case 
      when (address != $$NULL$$) AND (desclu = $$Apartments$$ OR desclu = $$Residential$$ OR desclu = $$Residential Commercial$$ OR desclu = $$Residential Condominium$$)
      then 1
      else NULL
      end)::numeric 
      ) as result, csa
      from vital_signs.match_csas_and_bc_by_geom('housing.mdprop_2017', 'gid', 'the_geom') a
      left join housing.mdprop_2017 b on a.gid = b.gid
      group by csa, the_pop ),
    tbl AS (
      select denominator.csa,(numerator.result / denominator.result)*(1000::numeric) as result 
      from numerator left join denominator on numerator.csa = denominator.csa )
    update vital_signs.data
    set demper = result from tbl where data.csa = tbl.csa and data_year = '2016'; "
  
  2017
    with numerator AS (
    select (sum( 
      case 
        when csa_present AND casetype LIKE any ( ARRAY['DEM'] ) AND planaddres != '' 
          then 1 else 0
            end
    )::numeric) as result, csa
      from vital_signs.match_csas_and_bc_by_geom('housing.permits_2017', 'gid', 'the_geom') a
        left join housing.permits_2017 b on a.gid = b.gid
          group by csa ),
    denominator AS (
    select (sum( case 
      when (address != $$NULL$$) AND 
          (desclu = $$Apartments$$ 
            OR desclu = $$Residential$$ 
            OR desclu = $$Residential Commercial$$ 
            OR desclu = $$Residential Condominium$$ 
      ) then 1 else NULL end )::numeric ) as result, csa
        from vital_signs.match_csas_and_bc_by_geom('housing.mdprop_2017v2', 'gid', 'the_geom') a
          left join housing.mdprop_2017v2 b on a.gid = b.gid
            group by csa, the_pop ),
    tbl AS (
    select denominator.csa,(numerator.result / denominator.result)*(1000::numeric) as result 
      from numerator left join denominator on numerator.csa = denominator.csa 
    select * from tbl where 1 = 1 ORDER BY csa ASC;"

  INVALID COLUMN NAMES
  2016 - > exis, prop, type1, cossts
  2017 -> existingus, propuse, field22, cost
  """

demper_translation = """ ( sum permits_2017 when csa_present AND casetype LIKE any ( ARRAY['DEM'] ) AND planaddres != '' / mdprop.totalres )* 1000 """#export 
demper = permitsCsa[ 
  ( permitsCsa['casetype'].str.contains('DEM|.DEM.|DEM.|.DEM', regex=True, na=False) ) 
]

filter = demper["PLANADDRES"] != ""
demper = demper[filter]


demper.to_csv('demper'+year+'_Filtered_Records.csv', index=False)

print( 'Records Matching Query: ', demper.size / len(demper.columns) )


# Aggregate Numeric Values by Sum 
demper['demperCount'] = 1
demper = demper.groupby('CSA2010').sum(numeric_only=True) 

# Make sure ALL csas and BaltimoreCity are included. among other things
demper = totalres[ ['CSA2010','totalres'+year] ].merge( demper, left_on='CSA2010', right_on='CSA2010', how='outer' ) 

# Update the baltimore CSA.
demper.at[55,'demperCount'] = demper['demperCount'].sum() 

# Create the Indicator
demper['demper'+year] = demper['demperCount'] * 100 / totalres['totalres'+year]

# Create the Indicator
demper['demper'+year] = demper['demperCount'] * 1000 / totalres['totalres'+year]

demper = demper[['CSA2010', 'demperCount', 'demper'+year, 'totalres'+year ]]

demper.to_csv('41-demper'+year+'.csv', index=False)

demper.head(60)<h3>Constper 42 - (MdProp[totalres], Permits) - Complete</h3>
<p>INVALID COLUMN NAMES 2016 - &gt; exis, prop, type1, cossts 2017 -&gt; existingus, propuse, field22, cost</p>
# 42- constper - Number of of new constructio permits per 1000 residential properties

# https://services1.arcgis.com/mVFRs7NF4iFitgbY/arcgis/rest/services/constper/FeatureServer/layers

# Numerator: housing.permits_201X
# Denominator: housing.mdprop_201X

long_Description: """
  The number of permits issued for new residential buildings per 1,000 existing residential properties within a community. 
  The permits are analyzed by date of issue and not date of completion.
  """

constper_SQL = """
 2016
  with numerator as (
   select sum( case 
    when (prop = $$SF$$ OR prop = $$MF$$) AND (type1 = $$NEW$$) then 1 else 0 end)::numeric as result, csa
      from vital_signs.match_csas_and_bc_by_geom('housing.permits_2016', 'gid', 'the_geom') a
        left join housing.permits_2016 b on a.gid = b.gid
          group by csa ),
  denominator AS (
   select (sum( case 
    when (address != $$NULL$$) AND (desclu = $$Apartments$$ OR desclu = $$Residential$$ OR desclu = $$Residential Commercial$$ OR desclu = $$Residential Condominium$$)
      then 1 else NULL end)::numeric ) as result, csa
        from vital_signs.match_csas_and_bc_by_geom('housing.mdprop_2017', 'gid', 'the_geom') a
          left join housing.mdprop_2017 b on a.gid = b.gid
            group by csa, the_pop ),
  tbl AS (
   select denominator.csa,(numerator.result / denominator.result)*(1000::numeric) as result 
   from numerator left join denominator on numerator.csa = denominator.csa )
  update vital_signs.data
  set constper = result from tbl where data.csa = tbl.csa and data_year = '2016'; "

 2017
  with numerator as (
   select sum( 
    case 
      when (existingus = $$SF$$
      OR propuse = $$SF$$
      OR existingus = $$MF$$
      OR propuse = $$MF$$
      OR existingus = $$DFAM$$
      OR propuse = $$DFAM$$
      OR existingus like '%1-%'
      OR propuse like '%1-%'
    ) AND (field22 = $$NEW$$)
      AND casetype LIKE any ( ARRAY['COM'] ) 
        then 1 else 0 end )::numeric as result, csa
     from vital_signs.match_csas_and_bc_by_geom('housing.permits_2017', 'gid', 'the_geom') a
       left join housing.permits_2017 b on a.gid = b.gid
         group by csa ),
  denominator AS (
    select (sum( case 
      when (address != $$NULL$$) 
         AND (desclu = $$Apartments$$ 
            OR desclu = $$Residential$$ 
            OR desclu = $$Residential Commercial$$ 
            OR desclu = $$Residential Condominium$$
         ) then 1 else NULL end )::numeric ) as result, csa
   from vital_signs.match_csas_and_bc_by_geom('housing.mdprop_2017v2', 'gid', 'the_geom') a
     left join housing.mdprop_2017v2 b on a.gid = b.gid
       group by csa, the_pop ),
  tbl AS (
    select denominator.csa,(numerator.result / denominator.result)*(1000::numeric) as result 
    from numerator left join denominator on numerator.csa = denominator.csa )
  select * from tbl where 1 = 1 ORDER BY csa ASC;"

  INVALID COLUMN NAMES
  2016 - > exis, prop, type1, cossts
  2017 -> existingus, propuse, field22, cost
  """

constper_translation = """
  Numerator = sum permits_2017 when (existingus = $$SF$$ 
    OR existingus = $$DFAM$$ OR existingus = $$MF$$ OR existingus like '%1-%'
    OR propuse = $$SF$$ OR propuse = $$MF$$ OR propuse = $$DFAM$$ OR propuse like '%1-%'
    ) 
    AND (field22 = $$NEW$$)
    AND casetype LIKE any ( ARRAY['COM'] ) 
  Denominator = mdprop.totalres

  return = (numerator / Denominator )* 1000
  """permitsCsa.casetype.unique()#export 
# 2018 and 2017 is not working with the new datasets given (CSA LABELS)

use = "SF|MF|.SF.|.MF.|.SF|.MF|SF.|MF."
constper = permitsCsa
constper['Field22'] = constper['typework']
constper = constper[ 
  #( 
  #    permitsCsa['existingus'].str.contains(use, regex=True, na=False) |
  #    permitsCsa['propuse'].str.contains(use, regex=True, na=False)
  #) & 
  #( permitsCsa['casetype'].str.contains('COM|.COM.|COM.|.COM', regex=True, na=False) ) &  
  ( constper['Field22'].str.contains('NEW|.NEW.|NEW.|.NEW', regex=True, na=False) )
]

constper = constper[constper["PLANADDRES"] != ""]

constper = constper[['CSA2010','existingus','propuse','casetype','Field22','PLANADDRES' ]]

constper.to_csv('constper'+year+'_Filtered_Records.csv', index=False)

print( 'Records Matching Query: ', constper.size / len(constper.columns) )

# Aggregate Numeric Values by Sum 
constper['constperCount'] = 1
constper = constper.groupby('CSA2010').sum(numeric_only=True) 

# Make sure ALL csas and BaltimoreCity are included. among other things
constper = totalres[ ['CSA2010','totalres'+year] ].merge( constper, left_on='CSA2010', right_on='CSA2010', how='outer' ) 

# Update the baltimore CSA.
constper.at[55,'constperCount'] = constper['constperCount'].sum() 

# Create the Indicator
constper['42-constper'+year] = constper['constperCount'] * 1000 / totalres['totalres'+year]

constper.to_csv('42-constper'+year+'.csv', index=False)

constper.head(80)<h3>Comprop 141 - (MdProp) - Complete</h3>
"""
2016 uses dataset housing.mdprop_2017
2017 uses dataset housing.mdprop_2017v2
2016s dataset was collected in January of 2017
2017s dataset was collected in Novermber of 2017
""""""
<comprop>* Indicator Number 141/
		with tbl AS (
			select (sum(
						case 
						when (lu like 'C' OR lu LIKE 'EC' OR lu LIKE 'I')
						then 1
						else 0
						end)::numeric 
				) as result, csa
				from vital_signs.match_csas_and_bc_by_geom('housing.mdprop_2017', 'gid', 'the_geom') a
				left join housing.mdprop_2017 b on a.gid = b.gid
				group by csa, the_pop
			)
			update vital_signs.data
			set comprop = result from tbl where data.csa = tbl.csa and data_year = '2016';		
"""#export 
# sum( case when (lu like 'C' OR lu LIKE 'EC' OR lu LIKE 'I')

comprop = mdprop.copy() 
comprop['comprop'+year] = 1
# mdprop = csa[['CSA','comprop19']]
comprop = comprop[ comprop['LU'].isin( ['C','EC','I'] ) ]
comprop = comprop.groupby('CSA2010').sum(numeric_only=True) 
# Make sure ALL csas and BaltimoreCity are included. among other things
comprop = csa[ ['CSA2010','tpop10'] ].merge( comprop, left_on='CSA2010', right_on='CSA2010', how='outer' ) 
# Update the baltimore CSA.
comprop.at[55,'comprop'+year] = comprop['comprop'+year].sum() 
comprop = comprop[['comprop'+year, 'CSA2010']]
comprop.head(58)

# Create the Indicator
comprop.to_csv('141-comprop'+year+'.csv', index=False) <h3>Crehab 142 - (Permits, MdProp[comprop]) - Complete</h3>
<p>This is the original SQL query</p>
<p>It Uses Comprop 141.</p>
<p>2016 - &gt; exis, prop, type1, cossts  2017 -&gt; existingus, propuse, field22, cost   Column Errors  NO COLUMN exis  NO COLUMN prop</p>
originalQuery = """ <crehab_16> * Indicator Number 142/
		with numerator AS (
			select sum(
			case 
				when (
					exis LIKE any (ARRAY['COM','IND','BUS','AIR','ANIM','BAR','BEAU','DELI','FAC','ASM','ALV%','DOTH','DWC','EDU','FOOD','HCF','HIH','HOS','MIXC','INS','MER','LIB','MNTL','MOB','PUB','STO','UT','VAC','VAL','DFAM'])
					AND 
					prop LIKE any (ARRAY['COM','IND','BUS','AIR','ANIM','BAR','BEAU','DELI','FAC','ASM','ALV%','DOTH','DWC','EDU','FOOD','HCF','HIH','HOS','MIXC','INS','MER','LIB','MNTL','MOB','PUB','STO','UT','DFAM'])
					AND 
					type1 = ANY (ARRAY['AA','ALT','ADD','NEW'])
					and costts >=5000
			) 
			then 1
			else 0
			end)::numeric as result, csa
			from vital_signs.match_csas_and_bc_by_geom('housing.permits_2016', 'gid', 'the_geom') a
			left join housing.permits_2016 b on a.gid = b.gid
			group by csa
			),
			denominator AS (
				select (sum(
					case 
					when (lu like 'C' OR lu LIKE 'EC' OR lu LIKE 'I')
					then 1
					else 0
					end)::numeric 
				) as result, csa
				from vital_signs.match_csas_and_bc_by_geom('housing.mdprop_2017', 'gid', 'the_geom') a
				left join housing.mdprop_2017 b on a.gid = b.gid
				group by csa
			),
			tbl AS (
					select denominator.csa,(numerator.result / denominator.result)*(100::numeric) as result 
					from numerator left join denominator on numerator.csa = denominator.csa
				)
			update vital_signs.data
			set crehab = result from tbl where data.csa = tbl.csa and data_year = '2016';"""

original17Query = """
NEW SQL 17 QUERY Version 1
/* FIELD22: NEW ALT OTH DEM AA ADD */
with numerator AS (
  select sum(
    case 
      when (
        (
      existingus LIKE any (ARRAY['2-%','3-%','4-%','5-%','6-%','7-%', 'COM','IND','BUS','AIR','ANIM','BAR','BEAU','DELI','FAC','ASM','ALV%','DOTH','DWC','EDU','FOOD','HCF','HIH','HOS','MIXC','INS','MER','LIB','MNTL','MOB','PUB','STO','UT','VAC','VAL','DFAM'])
 )
        and casetype LIKE any (ARRAY['COM'])
 AND field22 = ANY (ARRAY['AA','ALT','ADD', 'NEW'])
        AND cost >=5000
      ) 
   then 1 else 0 end
 )::numeric as result, csa
   from vital_signs.match_csas_and_bc_by_geom('housing.permits_2017', 'gid', 'the_geom') a
     left join housing.permits_2017 b on a.gid = b.gid
       group by csa
),
denominator AS (
  select (sum(
    case 
      when (lu like 'C' OR lu LIKE 'EC' OR lu LIKE 'I')
        then 1 else 0 
          end
  )::numeric ) as result, csa
  from vital_signs.match_csas_and_bc_by_geom('housing.mdprop_2017v2', 'gid', 'the_geom') a
    left join housing.mdprop_2017v2 b on a.gid = b.gid
      group by csa
),
tbl AS (
  select denominator.csa,(numerator.result / denominator.result)*(100::numeric) as result 
    from numerator 
      left join denominator 
        on numerator.csa = denominator.csa
)
select * from tbl where 1 = 1 ORDER BY csa ASC;
"""<p>The above query is outdated because we shouldnt filter for new in the type1 column.</p>
<p>Also. NO FILTERING ON PROP!</p>
permitsCsa.head(1)# '2-%','3-%','4-%','5-%','6-%','7-%', 'COM','IND','BUS','AIR','ANIM','BAR','BEAU','DELI','FAC','ASM','ALV%','DOTH','DWC','EDU','FOOD','HCF','HIH','HOS','MIXC','INS','MER','LIB','MNTL','MOB','PUB','STO','UT','VAC','VAL','DFAM'
# crehab.loc[crehab['existingus'].str.contains('2-|3-|4-|5-|6-|7-|COM|IND|BUS|AIR|ANIM|BAR|BEAU|DELI|FAC|ASM|ALV|DOTH|DWC|EDU|FOOD|HCF|HIH|HOS|MIXC|INS|MER|LIB|MNTL|MOB|PUB|STO|UT|VAC|VAL|DFAM') == True]#export 
# get the permits file
crehab = permitsCsa.copy()   

# Our Column to Sum on
crehab['crehab'+year] = 1
# Filter 1

print('No Filter:', crehab.shape[0])
print('Filter Cost:', crehab[crehab['cost'] >=5000].cost.shape[0])
print('Filter ExistingUse:', crehab.loc[crehab['existingus'].str.contains('2-|3-|4-|5-|6-|7-|COM|IND|BUS|AIR|ANIM|BAR|BEAU|DELI|FAC|ASM|ALV|DOTH|DWC|EDU|FOOD|HCF|HIH|HOS|MIXC|INS|MER|LIB|MNTL|MOB|PUB|STO|UT|VAC|VAL|DFAM') == True].shape[0])
# print('Filter Propuse:', crehab.loc[ crehab['propuse'].str.contains('COM|IND|BUS|AIR|ANIM|BAR|BEAU|DELI|FAC|ASM|ALV|DOTH|DWC|EDU|FOOD|HCF|HIH|HOS|MIXC|INS|MER|LIB|MNTL|MOB|PUB|STO|UT|DFAM') == True].shape[0])
print('Filter typework:', crehab[  crehab['typework'].isin( ['AA','ALT','ADD'] ) ].shape[0])

crehab.loc[ crehab['propuse'].str.contains('COM|IND|BUS|AIR|ANIM|BAR|BEAU|DELI|FAC|ASM|ALV|DOTH|DWC|EDU|FOOD|HCF|HIH|HOS|MIXC|INS|MER|LIB|MNTL|MOB|PUB|STO|UT|DFAM') == True].propuse.unique()

crehab = crehab.loc[crehab['existingus'].str.contains('2-|3-|4-|5-|6-|7-|COM|IND|BUS|AIR|ANIM|BAR|BEAU|DELI|FAC|ASM|ALV|DOTH|DWC|EDU|FOOD|HCF|HIH|HOS|MIXC|INS|MER|LIB|MNTL|MOB|PUB|STO|UT|VAC|VAL|DFAM') == True]
# crehab = crehab.loc[ crehab['propuse'].str.contains('COM|IND|BUS|AIR|ANIM|BAR|BEAU|DELI|FAC|ASM|ALV|DOTH|DWC|EDU|FOOD|HCF|HIH|HOS|MIXC|INS|MER|LIB|MNTL|MOB|PUB|STO|UT|DFAM') == True]
crehab = crehab[ crehab['cost'] >=5000 ]
crehab = crehab[  crehab['typework'].isin( ['AA','ALT','ADD'] ) ]
crehab.head(1)#export 
crehab = crehab.groupby('CSA2010').sum(numeric_only=True) 
# Make sure ALL csas and BaltimoreCity are included. among other things
crehab = csa[ ['CSA2010','tpop10'] ].merge( crehab, left_on='CSA2010', right_on='CSA2010', how='outer' ) 
# Update the baltimore CSA.
crehab.at[55,'crehab'+year] = crehab['crehab'+year].sum() 
crehab = crehab[['crehab'+year, 'CSA2010']]
crehab['crehab'+year] = crehab['crehab'+year] *100 / comprop['comprop'+year]

crehab.head(58)

# Create the Indicator
crehab.to_csv('142-crehab'+year+'.csv', index=False) </div></section></div>    	<div class="row"  style="background-color: #FDFDFD; border-top: 15px solid #007db6; -moz-box-shadow: inset 0 0 5px #888; -webkit-box-shadow: inset 0 0 5px#888; box-shadow: inner 0 0 5px #888;">
		<div class="container" style="margin-top: 10px;">
		<style>#copy-text-lakin{overflow:hidden;}#copy-text-lakin::after{clear:both; content:' '; display:block}#copy-text-lakin>*{width:822px; float:left; margin:0}#copy-text-lakin>#copy-text-lak{margin-left:-822px; background-color:#007db6; width:100%}</style>
            <div class="row">
                <!-- widget -->
				<div class="span3 widget">
					<h3><b>SEARCH</b></h3><form method="get" action="http://bniajfi.org/">
	<div class="input-append">
		<input type="text" id="appendedPrependedInput" name="s" size="16" class="span3" placeholder="Enter keywords to search..." value=""><input type="submit" id="searchsubmit" class="send" value="Go">
	  </div>
</form>				</div>
                <!-- end widget -->
				
                <!-- widget -->
				<div class="span3 widget">
					<h3><b>CONNECT WITH US</b></h3>			<div class="textwidget"><ul class="social" style="float: none; margin-bottom: 20px;">
<li><a target="_blank" class="facebook" href="http://www.facebook.com/bniajfi/">Facebook</a></li>
<li><a target="_blank" class="twitter" href="http://www.twitter.com/bniajfi/">Twitter</a></li>
<li><a target="_blank" class="youtube" href="http://www.youtube.com/bniajfi">YouTube</a></li>
<li><a target="_blank" class="rss" href="/feed/">RSS</a></li>
</ul>
</div>
						</div>
                <!-- end widget -->
				
                <!-- widget -->
				<div class="span3 widget">
					<h3><b>DONATE</b></h3>			<div class="textwidget"><p>Help us keep this resource free and available to the public. Donate now!</p>
<p><a href="http://bniajfi.org/donate" title="Donate Now" class="btn btn-warning">Donate to BNIA-JFI</a></p>
</div>
						</div>
                <!-- end widget -->
				
                <!-- widget -->
				<div class="span3 widget">
					<h3><b>CONTACT US</b></h3>			<div class="textwidget"><p style="font-size: 11px; font-weight: 600;">Baltimore Neighborhood Indicators Alliance<br />
The Jacob France Institute<br />
1420 N. Charles Street, Baltimore, MD 21201<br />
410-837-4377 | <a href="mailto:bnia-jfi@ubalt.edu">bnia-jfi@ubalt.edu</a></p>
</div>
						</div>
                <!-- end widget -->
            </div>
            <!-- end row -->
		</div>
		</div>
		    <!-- ************************** FOOTER -->
    <footer class="footer" style="padding-top: 5px; padding-bottom: 5px;">	
								<!-- row -->
					<div class="container">
					<div class="row">
						<div class="span6">
							<p style="color: #FFF; font-size: 10px;">Baltimore Neighborhood Indicators Alliance - &copy; 2018</p>
						</div>
						<!-- copyright text -->
						<div class="span6 copy-text">
<div id="copy-text-lakin"><div id="copy-text-lak">
										<a href="http://www.ubalt.edu" target="_blank" title="University of Baltimore"><img src="https://www.ubalt.edu/_resources/images/ub-logo-big.svg" style="height: 50px; width: 155px; float: right; margin-top: -5px;"/></a>
							<a href="http://www.ubalt.edu/jfi" target="_blank" title="Jacob France Institute"><img src="/images/jfilogo.png" style="height: 50px; width: 170px; float: right; margin-top: -5px;"/></a>
							<br/><br/>
							<p> </p>
</div></div>
						</div>
						<!-- end copyright text -->
					</div>
					</div>
					<!-- end row -->
				
        <!-- end contaner -->	
    </footer>
    <!-- ************************** end FOOTER -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-50651404-1', 'bniajfi.org');
ga('require', 'linkid', 'linkid.js');
ga('send', 'pageview');

</script>		<script>
		( function ( body ) {
			'use strict';
			body.className = body.className.replace( /\btribe-no-js\b/, 'tribe-js' );
		} )( document.body );
		</script>
		<script> /* <![CDATA[ */var tribe_l10n_datatables = {"aria":{"sort_ascending":": activate to sort column ascending","sort_descending":": activate to sort column descending"},"length_menu":"Show _MENU_ entries","empty_table":"No data available in table","info":"Showing _START_ to _END_ of _TOTAL_ entries","info_empty":"Showing 0 to 0 of 0 entries","info_filtered":"(filtered from _MAX_ total entries)","zero_records":"No matching records found","search":"Search:","all_selected_text":"All items on this page were selected. ","select_all_link":"Select all pages","clear_selection":"Clear Selection.","pagination":{"all":"All","next":"Next","previous":"Previous"},"select":{"rows":{"0":"","_":": Selected %d rows","1":": Selected 1 row"}},"datepicker":{"dayNames":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"dayNamesShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"dayNamesMin":["S","M","T","W","T","F","S"],"monthNames":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthNamesShort":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthNamesMin":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"nextText":"Next","prevText":"Prev","currentText":"Today","closeText":"Done","today":"Today","clear":"Clear"}};/* ]]> */ </script><link rel='stylesheet' id='login-with-ajax-css'  href='http://bniajfi.org/wp-content/plugins/login-with-ajax/widget/widget.css?ver=3.1.7' type='text/css' media='all' />
<link rel='stylesheet' id='wpa-css-css'  href='http://bniajfi.org/wp-content/plugins/wp-attachments/styles/0/wpa.css?ver=2483f238954e7cae2cd4dcb43c59bf93' type='text/css' media='all' />
<script type='text/javascript' src='http://bniajfi.org/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='http://bniajfi.org/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var LWA = {"ajaxurl":"http:\/\/bniajfi.org\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script type='text/javascript' src='http://bniajfi.org/wp-content/plugins/login-with-ajax/widget/login-with-ajax.js?ver=3.1.7'></script>
 
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.css" />
  <script src="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js"></script><script src="http://code.highcharts.com/highcharts.js"></script>
<script src="http://code.highcharts.com/modules/exporting.js"></script>

<script src="http://twitter.github.io/typeahead.js/releases/latest/typeahead.bundle.js"></script>
<script src=http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/js/Chart.min.js></script><script src=http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/js/bnia.js></script><script src=http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/js/indList.js?t=200></script><script src=http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/js/map3.js?t=1></script><script src=http://bniajfi.org/wp-content/themes/Grido/Theme_v1_3/js/vschart.js></script><script type='text/javascript' src='/vs_resources/charts/Chart.HorizontalBar.js'></script>
</body>
</html>
<div id='template'>  </div>